webpackJsonp([8],{117:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=function(){function e(e,t,n,r){if(void 0===n&&(n=""),this.type=e,this.pos=t,this.text=n,this.len=r,t<0)throw new Error("Negative position is prohibited: "+t);if(r<0)throw new Error("Negative array size if prohibited: "+r)}return e}();t.Change=o;var i=function(){function e(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=""),void 0===r&&(r=0),this._type=e,this._pos=t,this._text=n,this._tlen=r,this._len=n.length}return e.prototype.extend=function(t,n,r){return new e(this._type,null==n?this._pos:n,null==r?this._text:r,t)},Object.defineProperty(e.prototype,"begin",{get:function(){return this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._len},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textLength",{get:function(){return this._tlen},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._pos+this._len},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this._type+this._pos+":"+this._text},e.prototype.pack=function(e){try{if("="===this._type)return"";var t=this._text.replace(/%/g,"%25").replace(/:/g,"%3A"),n=this._pos.toString(36),o=this._tlen.toString(36),i=(e||0).toString(36);return this._type+n+":"+o+":"+t+":"+i}catch(e){throw r.Monitoring.Logging.getLogger("commonOt").error("Cannot pack revision",e,{opType:this._type}),e}},e.prototype.apply=function(e){if("+"===this.type){if(e.length!==this._tlen)throw new Error("Text length doesn't match expected length during insert. It's most likely you have missed a transformation: expected:"+this._tlen+", actual:"+e.length);return e.slice(0,this._pos)+this._text+e.slice(this._pos)}if("-"===this._type){if(e.length!==this._tlen)throw new Error("Text length doesn't match expected length during delete. It's most likely you have missed a transformation: expected:"+this._tlen+", actual:"+e.length);return e.slice(0,this._pos)+e.slice(this._pos+this._len)}if("="===this._type)return e;throw new Error("Operation type isn't known or undefined: '"+this.type+"'")},e.prototype.transformAgainst=function(t,n,r){var o=0;if(this._tlen!==t._tlen)return[this];if("+"===this._type&&"+"===t._type){if(o=this._tlen+t._len,this._pos<t._pos)return[this.extend(o)];if(this._pos===t._pos&&n<r)return[this.extend(o)];if(t._pos<=this._pos)return[this.extend(o,this._pos+t._len)]}else if("+"===this._type&&"-"===t._type){if(o=this._tlen-t._len,this._pos<t._pos)return[this.extend(o)];if(this._pos===t._pos)return[this.extend(o)];if(t._pos<this._pos)return[this.extend(o,Math.max(this._pos-t._len,t._pos))]}else if("-"===this._type&&"-"===t._type){if(o=this._tlen-t._len,this._pos<t._pos){var i=Math.min(t._pos-this._pos,this._len);return[this.extend(o,this._pos,this._text.substr(0,i)+this._text.substr(i+t._len))]}if(this._pos===t._pos)return this._len<=t._len?[new e("=")]:[this.extend(o,this._pos,this._text.substr(t._len))];if(t._pos<this._pos){var s=t._pos+t._len-this._pos;return s>=this._len?[new e("=")]:s>0?[this.extend(o,t._pos,this._text.substr(s))]:[this.extend(o,this._pos-t._len)]}}else if("-"===this._type&&"+"===t._type){if(o=this._tlen+t._len,this._pos<t._pos){if(this._pos+this._len>t._pos){var a=t._pos-this._pos;return[this.extend(o,this._pos,this._text.substr(0,a)),this.extend(o,t._pos+t._len,this._text.substr(a))]}return[this.extend(o)]}if(this._pos===t._pos)return[this.extend(o,this._pos+t._len)];if(t._pos<this._pos)return[this.extend(o,this._pos+t._len)]}return[this]},e}();t.Operation=i},118:function(e,t,n){"use strict";function r(e){return e.view(function(e){return{enabled:!e.enabled}})}Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(287),s=n(12),a=n(5),c=n(555),u=n(146),l=n(150),h=n(293),d=n(7);!function(e){e[e.free=0]="free",e[e.premium=1]="premium"}(o=t.UserType||(t.UserType={}));var p=d.BrowserInfo.getBrowserInfo().browser;t.UserGroups={EXTENSION_INSTALLED:"extension-"+p,DESKTOP_EDITOR_INSTALLED:"desktop_editor_used",FREEBIE_USER:"freebie",PREMIUM_CONVERSION:"premium-conversion"};var f=function(){function e(e,t,n,a,l,h,p,f){var m=this;this._experiments=e,this._subscription=t,this._userProfile=n,this._settings=a,this._institution=l,this._browser=h,this._router=p,this._appConfig=f,this._isPhoenixEduUser=this._institution.view(function(e){return{enabled:m._router.query.get("edu").fold(function(){return null!==e&&/Phoenix University/i.test(e.name)},function(e){return"phoenix"===e})}}),this._eduUserFeature=this._institution.view(function(e){return{enabled:m._router.query.has("edu")||null!==e}}),this._nonEduUserFeature=r(this._eduUserFeature),this._usertestingGroups=["usertesting_2_002_usertesting","usertesting_3_003_usertesting","usertesting_4_004_usertesting"],this._denaliPreLaunchGroup="denali_partial_test1",this._denali50="denali_50_denali",this._denali50Control="denali_50_denali_control",this._denali2={AAGroups:["denali_2_editor_control_1","denali_2_editor_control_2"],BBHalfSidebarGroups:["denali_2_denali_sidebar_1","denali_2_denali_sidebar_2"],CCTheGreenButtonGroups:["denali_2_denali_green_btn_1","denali_2_denali_green_btn_2"]},this.isUserTesting=this._isUserTesting(this._usertestingGroups),this.isUserTesting1=this._isUserTesting(["usertesting_2_002_usertesting"]),this.isUserTesting2=this._isUserTesting(["usertesting_3_003_usertesting"]),this.isUserTesting3=this._isUserTesting(["usertesting_4_004_usertesting"]),this.showOnboarding=this._router.query.get("onboarding").exists(function(e){return"show"===e}),this.hideOnboarding=this._userProfile.get().email.indexOf("@bh.exacttarget.com")>-1||this._router.query.get("onboarding").exists(function(e){return"hide"===e}),this.isFree=this._userProfile.view(function(e){return e.type===o.free&&!e.isFreebie}).get()||this._router.query.has("isFree"),this.isPremium=this._userProfile.view(function(e){return e.type===o.premium}).get()&&!this._router.query.has("isFree"),this.isDesktopEditor=d.BrowserInfo.isDesktopEditor(this._browser),this.forceEditorTs=this._router.query.get("denali").exists(function(e){return"false"===e}),this._appInitedFromDenaliPage=this._router.isActive(u.Router.routes.denali_editor.href({docId:"*"})).get(),this.wootricTest=this._router.query.get("wootric").exists(function(e){return"test"===e}),this.eduUserFeature=this._eduUserFeature,this.proofit=s.Atom.combine(this._subscription.view(function(e){return d.Async.isOk(e)&&!!e.value.paymentMethod}),this._institution,function(e,t){return{enabled:!1===m.isUserTesting&&(null!==t?t.proofit:e)}}),this.proofitToolbarItem=s.Atom.combine(this.proofit,this._institution,this._userProfile,function(e,t,n){return{enabled:e.enabled||!n.isFreebie&&null===t}}),this.proofitTest=this._router.query.get("proofit"),this.plagiarism=this._institution.view(function(e){return{enabled:!(!1!==m.isUserTesting||e&&e.plagiarismDisabled)}}),this.banners=this.isDesktopEditor?s.Atom.create({enabled:!1}):this._nonEduUserFeature,this.navTutotial=this._eduUserFeature,this.tour=this._nonEduUserFeature,this.deleteAccount=r(this._isPhoenixEduUser),this.usernameUnderLogout=this._nonEduUserFeature,this.showChangeEmail=this._nonEduUserFeature,this.eduAdminPanelLink=this._institution.view(function(e){return{enabled:e&&e.admin}}),this.subscription=s.Atom.combine(this._userProfile,this._institution,function(e,t){return{enabled:null===t&&m.isPremium&&!e.isFreebie}}),this.goPremium={enabled:this.isFree},this.premiumBadge={enabled:this.isPremium},this.premiumCounter={enabled:!this.isFree},this.upgradeButton={enabled:this.isFree},this.appsSection=s.Atom.create({enabled:!this.isDesktopEditor}),this.desktopApps=r(this._isPhoenixEduUser),this.score=this._institution.view(function(e){return{enabled:!e||!e.scoreDisabled}}),this.downloadPdfReportButton={enabled:!this.isDesktopEditor},this.copyPasteMenuItems={enabled:!this.isDesktopEditor},this.quickReplacementsInCard=this._institution.view(function(e){return{enabled:!e||e.quickReplacement}}),this.hideTitleInEDUCard=this._institution.view(function(e){return{enabled:!e||!e.quickReplacement}}),this.showFullCards=this._institution.view(function(e){return{enabled:e&&e.fullCards}}),this.profileLink=r(this._isPhoenixEduUser),this.defaultAcademicGenre=s.Atom.create({enabled:!1}),this.enableTrackingOnDownload=this._isPhoenixEduUser.view(function(e){return!e}),this.phoenixReportBtn=this._isPhoenixEduUser,this.phoenixSupportLink=this._isPhoenixEduUser,this.phoenixTutorial=this._isPhoenixEduUser,this.phoenixTerms=s.Atom.combine(this._isPhoenixEduUser,this._settings.acceptedTermsVersion,function(e,t){var n=c.TermsOfService.termsVersion,r=i.valid(t)&&i.valid(n)&&i.gt(n,t)||!i.valid(t)||m._router.query.has("terms");return e.enabled&&r}),this.phoenixTour=this._isPhoenixEduUser,this.showSwitchToDenaliBtn={enabled:"prod"!==this._appConfig.env||this._userProfile.get().email.includes("@grammarly.com")}}return e.prototype._isUserTesting=function(e){var t=this;return this._experiments.view(function(t){return e.some(function(e){return t.has(e)})}).view(function(e){return t._router.query.has("hasUserTesting")||e&&!t._router.query.has("skipUserTesting")}).get()},e.prototype._isExperiment=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.some(function(t){return e._experiments.get().has(t)})},Object.defineProperty(e.prototype,"isInternalUser",{get:function(){var e=this._userProfile.get().email;return e.indexOf("@grammarly.com")>-1||e.indexOf("@bh.exacttarget.com")>-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDenaliV2",{get:function(){return!this.forceEditorTs&&(!!this._settings.forcedDenaliUI.get()||(this._userProfile.get().email.indexOf("@grammarly.com")>-1||(!!(this._isExperiment(this._denaliPreLaunchGroup)||this._isExperiment(this._denali50)||this._isExperiment(this._denali50Control)||this._isExperiment.apply(this,this._denali2.BBHalfSidebarGroups)||this._isExperiment.apply(this,this._denali2.CCTheGreenButtonGroups))||(this._appInitedFromDenaliPage||this._router.query.get("denali").exists(function(e){return"prod"===e})))))},enumerable:!0,configurable:!0}),e.prototype._isQueryExperiment=function(e){return this._router.query.get("exp").contains(e)},Object.defineProperty(e.prototype,"isDenaliAA_EditorTS",{get:function(){return this._isExperiment.apply(this,this._denali2.AAGroups)||this._isQueryExperiment("aa")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDenaliBB_HalfSidebar",{get:function(){return this._isExperiment.apply(this,this._denali2.BBHalfSidebarGroups)||this._isQueryExperiment("bb")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDenaliCC_TheGreenButton",{get:function(){return this._isExperiment.apply(this,this._denali2.CCTheGreenButtonGroups)||this._isQueryExperiment("cc")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showDiscoverabilityOnExit",{get:function(){return this._router.query.get("onexit").exists(function(e){return"show"===e})},enumerable:!0,configurable:!0}),e}();t.FeaturesModel=f;var m=function(){function e(e,t,n,r,o,i,s,c,u,d,p,m){this._state=e,this._authApi=t,this._irbisApi=n,this._dapi=r,this._subscribeUrl=o,this._upgradeBaseUrl=i,this._subscriptionUrl=s,this._browserType=c,this._browser=u,this._telemetry=d,this._router=p,this._appConfig=m,this._log=a.Monitoring.Logging.getLogger("model.account"),this.profile=this._state.view("userProfile"),this.subscription=new h.SubscriptionModelImpl(this._state.lens("subscription"),this._irbisApi,this._subscribeUrl,this._upgradeBaseUrl,this._subscriptionUrl,this._browserType,this._telemetry,this._appConfig,this.profile.get().id),this.settings=new l.SettingsModelImpl(this._state.lens("settings"),this._dapi,this._state.lens("userProfile").lens("id")),this.features=new f(this._state.view("experiments"),this.subscription.state,this.profile,this.settings,this._state.view("institution"),this._browser,this._router,this._appConfig)}return e.prototype.areValidCredentials=function(e,t){var n=this;return this._authApi.login(e,t).then(function(e){return e&&!e.err}).catch(function(e){if(401===e.code)return n._log.warn("authError: areValidCredentials",e),!1;throw n._log.error("authError: areValidCredentials",e),e})},e.prototype.changeName=function(e){var t=this;return this._authApi.changeName(e).then(function(){return t._state.lens("userProfile").lens("fullName").set(e)}).catch(this._log.handler("authError: changeName").error)},e.prototype.changeEmail=function(e,t){var n=this;return this._authApi.changeEmail(e,t).then(function(){return n._state.lens("userProfile").lens("newEmail").set(e)}).catch(this._log.handler("authError: changeEmail").warn)},e.prototype.changePassword=function(e,t,n){return this._authApi.changePassword(e,t,n).catch(this._log.handler("authError: changePassword").warn)},e.prototype.deleteAccount=function(){return this._irbisApi.deleteAccount().catch(this._log.handler("irbisError: deleteAccount failed").warn)},e}();t.UserAccountModelImpl=m},1322:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22);!function(e){e.empty={hovered:void 0,disabled:void 0,active:void 0},e.HoveredContextTypes={hovered:r.object},e.DisabledContextTypes={disabled:r.object},e.ActiveContextTypes={active:r.object},e.contextTypes=Object.assign({},e.HoveredContextTypes,e.DisabledContextTypes,e.ActiveContextTypes)}(t.ElementState||(t.ElementState={}))},1323:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(12),i=n(17),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._el=null,t}return r.__extends(t,e),t.prototype.unsubscribe=function(){this.subscription&&this.subscription.unsubscribe(),this.props.onUnmount&&this.props.onUnmount()},t.prototype.componentDidMount=function(){this.props.onMount&&(this.subscription=this.props.onMount(this._el))},t.prototype.componentDidUpdate=function(){this.props.remountOnUpdate&&this.props.onMount&&(this.unsubscribe(),this.subscription=this.props.onMount(this._el))},t.prototype.componentWillUnmount=function(){this.unsubscribe()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,r=t.className;return n&&n.length>1||r?i.createElement(o.F.div,{mount:function(t){return e._el=t},className:r},n):i.Children.only(this.props.children)},t}(i.Component);t.Lifecycle=s},1324:function(e,t,n){"use strict";function r(e){switch(e){case"webeditor":return n(532).textResources;case"desktopeditor":return n(1326).textResources;default:return i.assertNever(e)}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1325);t.TextResources=o.TextResources;var i=n(7);t.getTextResources=r},1325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22);!function(e){e.ContextTypes={textResources:r.object}}(t.TextResources||(t.TextResources={}))},1326:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(203),o=n(532);t.textResources=r.merge(o.textResources,{base:{tooltipDownloadProofreadVersion:"Export proofread version",tooltipDownloadOriginalVersion:"Export original version",tooltipDownload:"Export document",uploadText:"Import",tooltipUploadElementInput:"Click here to import document",menuDownloadText:"Export",documentPlaceholderText:"Import a document to save original formatting.",modalUploadingDocumentText:"Importing document",notificationUploadFileText:"Import a file in one of the following formats"},denali:{uploadMenuItem:"Import document",uploadDropZone:"Drop a text file here to import",downloadMenuItem:"Export",uploadNotificationTitle:"The document imported successfully",placeholder:{upload:"Import a document to save original formatting."}}})},1327:function(e,t,n){"use strict";function r(e,t){var n=a.Atom.create(d.defaultState);u.Monitoring.Logging.root.debug("Constructing model for "+e.env+" on the client");var r=e.enableTracking?o(e,p.RxFetch.withTargetTag(p.RxFetch.request,"gnar")):new h.DummyGnarClient;return r.getContainerId().then(function(e){return u.Monitoring.Logging.root.context.add({containerId:e})}).catch(function(e){return u.Monitoring.Logging.root.debug("cant get containerId",e)}),new d.AppModelImpl(n,new c.Auth(e.api.authUrl,p.RxFetch.request),new c.Institution(e.api.institutionUrl,p.RxFetch.request),new c.Dapi(e.api.dapiUrl,p.RxFetch.request),f.getBrowserInfo(),new c.Dictionary(e.api.capiApiUrl,p.RxFetch.request),new c.Irbis(e.api.irbisUrl,e.api.subscriptionUrl,p.RxFetch.request),new c.Dox(e.api.doxUrl,p.RxFetch.request),new h.EditorTelemetry(r,e.app.name),new g.GnarSpec(i(r)),e,t)}function o(e,t){var n=e.api.gnarApi.url,r=e.domains.cookie,o=new l.ContainerIdManager(new l.CookieStorage(r),[new l.LocalStorage,new l.MemoryStorage],u.Monitoring.Logging.root.getLogger("gnar.containerIdManager"),u.Monitoring.TimeSeries.root.getMetric("gnar.containerIdManager"));return new l.GnarClientImpl(n,e.app.name,m.buildInfo.version,t,o,u.Monitoring.Logging.root.getLogger("gnar"),u.Monitoring.TimeSeries.root.getMetric("gnar"))}function i(e){var t=u.Monitoring.Logging.root.getLogger("gnar.events");return s.__assign({},e,{track:function(n){var r=n.eventName,o=s.__rest(n,["eventName"]);return t.info(r,o),e.track(n)}})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(12),c=n(48),u=n(5),l=n(603),h=n(199),d=n(551),p=n(147),f=n(49),m=n(80),g=n(1372);t.defaultModel=r},1328:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1329:function(e,t,n){"use strict";function r(e,t){return o(o({},e),t)}function o(e,t){for(var n in t){var r=e[n]||{},i=t[n];null!=i&&null!=r&&i.constructor===Object&&r.constructor===Object?e[n]=o(r,i):e[n]=i}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.merge=r},1330:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(73),o=function(){function e(e,t,n){this._url=e,this._fetch=t,this._token=n,this._ajax=r.Ajax.factory(this._fetch,"auth")}return e.prototype._setToken=function(e){this._token=e},e.prototype.orAnonymous=function(e){var t=r.RequestBuilder.get(this._url,"user/oranonymous").queryParam("app",e);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build())},e.prototype.signup=function(e,t,n,o){return void 0===o&&(o=!1),this._ajax(r.RequestBuilder.post(this._url,"/signup").formParam("name",e).formParam("email",t).formParam("password",n).formParam("test",o.toString()).build())},e.prototype.login=function(e,t){return this._ajax(r.RequestBuilder.post(this._url,"/login").formParam("email",e).formParam("password",t).build())},e.prototype.logout=function(){return this._ajax(r.Request.post(this._url,"/logout"),r.Ajax.toVoid)},e.prototype.changeName=function(e){var t=r.RequestBuilder.post(this._url,"/user").json({name:e});return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),r.Ajax.toVoid)},e.prototype.changeEmail=function(e,t){var n=r.RequestBuilder.post(this._url,"/user/email/change").json({newEmail:e,password:t});return this._token&&n.cookie("grauth",this._token),this._ajax(n.build(),r.Ajax.toVoid)},e.prototype.changePassword=function(e,t,n){var o=r.RequestBuilder.post(this._url,"/user/password/change").formParam("email",e).formParam("new_pwd",n).formParam("old_pwd",t).build();return this._ajax(o,r.Ajax.toVoid)},e.prototype.getUser=function(e){var t=r.RequestBuilder.get(this._url,"user").queryParam("app",e);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build())},e.prototype.getSettings=function(){var e=r.RequestBuilder.get(this._url,"/user/settings");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build())},e.prototype._setSettings=function(e){var t=r.RequestBuilder.post(this._url,"/user/settings").json(e);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build())},e.prototype.setSettings=function(e){var t=this;return this.getSettings().then(function(n){return t._setSettings(Object.assign({},n,e))})},e.prototype.enableSandbox=function(e){var t=r.RequestBuilder.put(this._url,"user").json({id:e,customFields:{"sandbox.payments":"Yes"}});return this._ajax(t.build(),r.Ajax.toVoid)},e.prototype.addInstitution=function(e,t){var n=r.RequestBuilder.put(this._url,"user").json({id:e,institutionId:t});return this._ajax(n.build(),r.Ajax.toVoid)},e}();t.Auth=o;!function(e){e.email="EMAIL",e.google="GOOGLE",e.facebook="FACEBOOK"}(t.LoginType||(t.LoginType={}))},1331:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(534),s=n(5),a=n(563),c=n(117),u=n(195),l=n(149),h=n(535),d=n(536),p=n(60),f=n(29),m=n(533),g=n(98),_=n(546),y=n(202);!function(e){e[e.DISCONNECTED=0]="DISCONNECTED",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.STARTED=3]="STARTED",e[e.ANY=4]="ANY",e[e.CLOSED=5]="CLOSED"}(r||(r={}));var v;!function(e){e[e.CONNECT=0]="CONNECT",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECT=2]="DISCONNECT",e[e.START=3]="START",e[e.CLOSE=4]="CLOSE"}(v||(v={}));var b=function(){function e(e){var t=e.url,n=e.handler,o=e.context,i=void 0===o?y.DocumentContext.empty:o,c=e.dialect,h=void 0===c?"undefined":c,d=e.client,_=void 0===d?"web":d,b=e.clientVersion,w=void 0===b?"":b,E=e.extDomain,S=void 0===E?"":E,C=e.sendDelay,k=void 0===C?1e3:C,x=e.docid,T=void 0===x?"":x,A=e.token,I=void 0===A?"":A,O=this;this._log=s.Monitoring.Logging.getLogger("coreclients.capi",s.Logging.LogLevel.DEBUG),this._nextId=1,this._queue=new a.OperationQueue,this._commandsQueue=new Array,this._ack={},this._transformQueue=[],this._setContextFinishedAcc=new Set,this._checkingState="idle",this._recheckRevision=f.None,this._idleRestore=f.None,this._sendCmd=function(e,t){return f.Option.of(t).map(function(t){return O._sendInbandCommand(t,function(n){return e.onError(t.id,new Error(n))})}).getOrElse(-1)},this._statsRequester=new p.ValueRequester(this._sendCmd,15e3,"DocStats"),this._synonymsRequester=new p.ValueRequester(this._sendCmd,15e3,"Synonyms"),this._getTextRequester=new p.ValueRequester(this._sendCmd,15e3,"Text"),this._startSession=function(){O._sendMessage(O._createStartMessage()),O._handler.onSesionStarted({kind:"session_started"})},this._send=function(){void 0!==O._timeout&&(clearTimeout(O._timeout),O._timeout=void 0),O._log.trace("send("+O._fsm.current+")"),O._fsm.current===r.STARTED&&(!O._queue.isEmpty||O._commandsQueue.length>0)?(O._splitRevisions(O._queue.popAll(),O._commandsQueue).forEach(O._sendMessage),O._commandsQueue=[]):O._trySend(O._fsm.current)},this._sendMessage=function(e){O._log.isEnabled(s.Logging.LogLevel.TRACE)&&O._log.trace("Sending >>> "+JSON.stringify(e).replace("\n"," ").substring(0,300)),O._conn.send(e)},this._handler=Object.assign(new m.DefaultCAPIEventHandler,n||{}),this._url=t,this._context=i,this._dialect=h,this._client=_,this._clientVersion=w,this._extDomain=S,this._sendDelay=k,this._docid=T,this._token=I,this._fsm=new u.StateMachine(r.DISCONNECTED,r.CLOSED).with(r.ANY).parentOf(r.CONNECTED,r.CONNECTING,r.DISCONNECTED,r.STARTED).from(r.ANY).to(r.CLOSED).on(v.CLOSE).from(r.DISCONNECTED).to(r.CONNECTING).on(v.CONNECT).from(r.CONNECTING).to(r.CONNECTED).on(v.CONNECTED).from(r.CONNECTED,r.STARTED,r.CONNECTING).to(r.DISCONNECTED).on(v.DISCONNECT).from(r.CONNECTED).to(r.STARTED).on(v.START).on(r.CONNECTED,this._startSession).on(r.STARTED,function(e){return O._trySend(e.to)}).on(r.DISCONNECTED,function(e){return O._clear(e.args)}).on(r.CLOSED,function(){return O._close()}),this._log.isEnabled(s.Logging.LogLevel.TRACE)&&this._fsm.verbose(r,v),this._ws=l.WS.create().onMessage(function(e,t){return O._handleMessage(t)}).onDisconnect(function(e){return O._handleDisconnect(e)}).onError(l.errPrintln),this._tryConnect(),g.registerDebugHelper("closeCapiSocket",function(e,t){void 0===e&&(e=1e3),O._conn._ws.close(e,t)}),g.registerDebugHelper("capiState",this)}return e.prototype.setText=function(e){this._log.debug("setText(...)");this._clear("setText"),this._fsm.current===r.STARTED&&this._sendInbandCommand(this._createStartMessage());var t=this.pushChanges([new c.Operation("+",0,e,0)]);return this.checkingState="full",t},e.prototype.pushChange=function(e){return this.pushChanges([e])},e.prototype.pushChanges=function(e){var t=this;if(0===e.length)throw new Error("Empty changeset");if(this._checkIdle(),1===e.length&&"~"===e[0].type)return this._queue.isEmpty||this._sendInbandCommand(new h.Ping(this._nextId++)),Promise.resolve({kind:"finish",revision:this._queue.revision,score:f.None,dialect:this._dialect});for(var n=e.length-1;n>=0&&"*"!==e[n].type;)--n;var r=e;if(-1!==n){r=e.slice(n+1);var o=this.setText(e[n].text);if(0===r.length)return o}return new Promise(function(e,o){var i=r[0].textLength,s=r.reduce(function(e,t){return e+t.text.length},0);t._queue.pushAll(r,e,o);var a=r[r.length-1],c=a.textLength+("+"===a.type?1:-1)*a.length;s>0&&-1===n&&(10*s>i&&s>300&&c>300?(t.checkingState="full",t._recheckRevision=f.Some(t._queue.revision)):t._recheckRevision.isEmpty()&&(t.checkingState="checking")),t._trySend(t._fsm.current)})},Object.defineProperty(e.prototype,"checkingState",{get:function(){return this._checkingState},set:function(e){this._log.trace("CAPI CHECKING STATE to "+e),this._checkingState=e},enumerable:!0,configurable:!0}),e.prototype.accept=function(e,t,n){this._sendInbandCommand(new h.UserFeedback(this._nextId++,i.FeedbackType.ACCEPTED,e,t,n))},e.prototype.setContext=function(e){this._log.debug("setContext(...)"),"idle"===this.checkingState&&(this.checkingState="full"),this._queue.incRevision(),this._sendInbandCommand(new h.SetContext(this._nextId++,this._queue.revision,y.DocumentContext.serialize(e))),this._setContextFinishedAcc.add(this._queue.revision),this._context=e},e.prototype.reportUserFeedback=function(e,t){this._sendInbandCommand(new h.UserFeedback(this._nextId++,t===i.FeedbackType.SYNONYM_ACCEPTED?i.FeedbackType.ACCEPTED:t,e.id,e.begin))},e.prototype.dismissAll=function(e){this._sendInbandCommand(new h.UserFeedback(this._nextId++,i.FeedbackType.DISMISS_BY_LENS,void 0,void 0,void 0,void 0,e))},e.prototype.requestSynonyms=function(e,t){return this._synonymsRequester.request(new h.SynonymsRequest(this._nextId++,this._queue.revision,e,t))},e.prototype.requestDocStats=function(){var e=this,t=_.Async.retryCountPredicate(3);return _.Async.promiseRetrier(function(){return e._statsRequester.request(new h.StatsRequest(e._nextId++))},function(e){return t()&&"setText"===e.message})},e.prototype.enablePlagiarismSearch=function(){this._sendInbandCommand(new h.ToggleChecksRequest(this._nextId++,{plagiarism:!0}))},e.prototype.disablePlagiarismSearch=function(){this._sendInbandCommand(new h.ToggleChecksRequest(this._nextId++,{plagiarism:!1}))},e.prototype.setOption=function(e,t){this._log.trace("Set option "+t),this._sendInbandCommand(new h.Option(this._nextId++,e,t))},e.prototype.ping=function(){this._sendInbandCommand(new h.Ping(this._nextId++))},e.prototype.close=function(){return this._fsm.event(v.CLOSE)},e.prototype.getText=function(){return this._getTextRequester.request({id:this._nextId++,action:"get_debug_info"})},e.prototype._trySend=function(e){this._log.trace("_trySend("+e+")"),void 0===this._timeout&&e===r.STARTED&&(this._timeout=setTimeout(this._send,this._sendDelay))},e.prototype._close=function(){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(e){switch(e.label){case 0:return this._clear("close() called"),this._timeout&&clearTimeout(this._timeout),this._conn?[4,this._conn.close()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype._clear=function(e){var t=this;this._queue.clear(e),this._queue=new a.OperationQueue,this._commandsQueue.forEach(function(t){return t.fail(e)}),this._commandsQueue=[],Object.keys(this._ack).forEach(function(n){return t._ack[Number(n)].fail(e)}),this._timeout&&clearTimeout(this._timeout),this._ack={},this._setContextFinishedAcc.clear()},e.prototype._createStartMessage=function(){return new h.Start(this._nextId++,this._client,this._clientVersion,this._extDomain,this._dialect,this._docid,this._token,y.DocumentContext.serialize(this._context))},e.prototype._createSubmitOt=function(e,t){var n=Math.min.apply(Math,e.map(function(e){return e.revision}));return this._ack[n]={done:function(t){return e.forEach(function(e){return e.successCallback(t)})},fail:function(t){return e.forEach(function(e){return e.failureCallback(t)})}},t.push({capiRevision:n,revs:e}),new h.SubmitOt(this._nextId++,n,(r=new Array).concat.apply(r,e.map(function(e){return e.pack()})));var r},e.prototype._splitRevisions=function(e,t){var n=this;if(0===e.length)return t.map(function(e){return e.command});if(0===t.length)return[this._createSubmitOt(e,this._transformQueue)];var r=t.reduce(function(e,t){return(e[t.afterRevision]=e[t.afterRevision]||[]).push(t),e},{});return Object.keys(r).map(function(e){return Number(e)}).sort(function(e,t){return e-t}).map(function(e){return r[e]}).reduce(function(t,r,o,i){var s=e.filter(function(e){return(0===o||e.revision>i[o-1][0].afterRevision)&&e.revision<=r[0].afterRevision});s.length>0&&t.push(n._createSubmitOt(s,n._transformQueue)),r.forEach(function(e){return t.push(e.command)});var a=i.length-1===o?e.filter(function(e){return e.revision>r[0].afterRevision}):[];return a.length>0&&t.push(n._createSubmitOt(a,n._transformQueue)),t},[])},e.prototype._sendInbandCommand=function(e,t){return void 0===t&&(t=g.noop),this._checkIdle(),this._log.trace("_sendInbandCommand "+e.action),this._queue.isEmpty&&this._fsm.current===r.STARTED?(this._log.trace("Q.isEmpty, sending command immidiately",e),this._sendMessage(e)):this._commandsQueue.push({afterRevision:this._queue.revision,command:e,fail:t}),e.id},e.prototype._tryConnect=function(){return o.__awaiter(this,void 0,void 0,function(){var e,t,n,r,i;return o.__generator(this,function(o){switch(o.label){case 0:return[4,this._fsm.event(v.CONNECT)];case 1:if(!(e=o.sent()))return[2];o.label=2;case 2:return o.trys.push([2,9,,10]),[4,this._ws.connect(this._url)];case 3:t=o.sent(),this._conn=t,o.label=4;case 4:return o.trys.push([4,6,,8]),[4,this._fsm.event(v.CONNECTED,t)];case 5:if(!(n=o.sent()))throw new Error("State change failed");return[3,8];case 6:return r=o.sent(),this._log.warn("Connection cannot be finalized due to error",r),[4,t.close()];case 7:return o.sent(),[3,8];case 8:return[3,10];case 9:return i=o.sent(),l.errPrintln(i),[3,10];case 10:return[2]}})})},e.prototype._handleMessage=function(e){switch(this._log.isEnabled(s.Logging.LogLevel.TRACE)&&this._log.trace("Message <<< "+JSON.stringify(e).replace("\n"," ").substring(0,300)),e.action){case"start":this._fsm.event(v.START);break;case"alert":this._handleAlert(e);break;case"remove":this._handler.onRemove({kind:"alert_removed",alertId:e.id.toString()});break;case"finished":this._handleFinish(e);break;case"async_check_finished":this._handleAsyncCheckFinished(e);break;case"submit_ot":this._handleAck(e);break;case"feedback":case"option":case"set_context":case"toggle_checks":this._handleAck(e);break;case"error":this._log.error("Error",{message:e});var t=e;this._handler.onError(Object.assign({kind:"error"},t)),t.error===i.ErrorCode.CANNOT_GET_TEXT_STATS&&this._statsRequester.onError(e.id,new Error("Server Error"));break;case"pong":this._handler.onPong();break;case"synonyms":this._handleSynonyms(e);break;case"text_stats":e.readingTime=d.DocumentStatistics.calculateReadingTime(e),e.speakingTime=d.DocumentStatistics.calculateSpeakingTime(e),this._handler.onStats({kind:"stats",stats:e}),this._statsRequester.onValue(e.id,e);break;case"debug_info":this._handler.onDebugInfo({kind:"debug_info",info:e}),this._getTextRequester.onValue(e.id,e.text);break;default:this._log.error("Unknown message",{message:e})}},e.prototype._handleAlert=function(e){this._handler.beforeAlert({kind:"before_alert"});var t=Object.assign(e,{id:e.id.toString()}),n=t.rev;this._log.trace("_handleAlert",{trasnformQueue:this._transformQueue,queue:this._queue});var r=this._transformQueue.filter(function(e){return e.capiRevision>n}).reduce(function(e,t){return e.concat(t.revs.map(function(e){return new a.OperationSet(e.operations,e.revision)}))},[]).concat(this._queue.getChangesSince(n));r.length&&this._log.trace("ALERT transforming alert against staging operations",r);var o=i.RawAlert.transformMarkupAgainst(t,r);null!==o?this._handler.onAlert({kind:"alert_received",alert:o}):this._log.isEnabled(s.Logging.LogLevel.TRACE)&&this._log.trace("OT ALERT: discarding alert due to position overlap",{message:JSON.stringify(t).substring(0,200)})},e.prototype._handleAsyncCheckFinished=function(e){"plagiarism"===e.check&&this._handler.onPlagiarismFinish({kind:"plagiarism_finished",revision:e.rev})},e.prototype._handleFinish=function(e){var t=e.rev;this._transformQueue=this._transformQueue.filter(function(e){return e.capiRevision>t});var n=f.Option.of(e.scores),r={kind:"finish",revision:e.rev,score:n.map(function(t){return{errorRateScore:e.score,accuracy:t.Accuracy,clarity:t.Clarity,effectiveness:t.Effectiveness,rank:Math.min(100,Math.round(.5*t.Accuracy+.25*(t.Clarity+t.Effectiveness)))}}),dialect:e.dialect};"full"===this.checkingState&&this._recheckRevision.contains(r.revision)&&(this._recheckRevision=f.None,this._queue.isEmpty||(this.checkingState="checking")),this._queue.isEmpty&&(this.checkingState="idle"),this._handler.onFinish(r);var o=this._ack[r.revision];void 0!==o?(o.done(r),delete this._ack[r.revision]):this._setContextFinishedAcc.has(r.revision)?this._setContextFinishedAcc.delete(r.revision):this._log.warn("Finish for unexpected revision",{message:e})},e.prototype._handleAck=function(e){this._log.trace("<<< Acknowledge for "+e.action,{message:e})},e.prototype._handleSynonyms=function(e){var t=this,n={word:e.token,position:e.synonyms.pos},r=function(e){return e.derived},o=e.synonyms.meanings.length>0?f.Some({id:e.id.toString(),originalWord:e.token,synonymsOrGroups:1===e.synonyms.meanings.length?f.Either.left(e.synonyms.meanings[0].synonyms.map(r)):f.Either.right(e.synonyms.meanings.map(function(n){if(void 0===n.meaning)throw t._log.error("Absent meaning in synonyms group.",{token:e.token}),new Error("Absent meaning in synonyms group.");return{meaning:n.meaning,words:n.synonyms.map(r)}}))}):f.None,i=Object.assign({kind:"synonyms",synonyms:o},n);this._handler.onSynonyms(i),this._synonymsRequester.onValue(e.id,o)},e.prototype._handleDisconnect=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,r,i,s=this;return o.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,this._fsm.event(v.DISCONNECT,e.reason)];case 1:return(t=a.sent())?(this._log.warn("Disconnected due to ",e.reason),[4,this._fsm.event(v.CONNECT)]):[2];case 2:return(n=a.sent())?(r=function(t){return o.__awaiter(s,void 0,void 0,function(){var n,r,i;return o.__generator(this,function(o){switch(o.label){case 0:return[4,e.reconnect.scheduleReconnect(t)];case 1:n=o.sent(),this._conn=n,o.label=2;case 2:return o.trys.push([2,4,,6]),[4,this._fsm.event(v.CONNECTED,n)];case 3:if(!(r=o.sent()))throw new Error("State change failed");return[3,6];case 4:return i=o.sent(),this._log.warn("Reconnect failed due to error ",i),[4,n.close()];case 5:return o.sent(),[3,6];case 6:return[2]}})})},1001!==e.code&&1e3!==e.code||!this._queue.isEmpty?this._handler.onDisconnect(e,e.reconnect.nextDelay,r):(this._idleRestore=f.Some(function(){return r(0)}),this._log.debug("Postponed reconnect until changes arrive")),[3,4]):[2];case 3:return i=a.sent(),l.errPrintln(i),[3,4];case 4:return[2]}})})},e.prototype._checkIdle=function(){this._idleRestore.nonEmpty()&&(this._log.debug("We are idle... reconnecting before push."),this._idleRestore.get()(),this._idleRestore=f.None)},e.prototype._sendStatsRequest=function(){this._sendInbandCommand(new h.StatsRequest(this._nextId++))},e}();t.CAPIClientImpl=b},1332:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1333:function(e,t,n){"use strict";function r(e){if(null===e||"null"===e||"boolean"==typeof e)return null;var t=Number(e);return Number.isNaN(t)?null:t}function o(e){return"null"===e||"undefined"===e?null:"true"===e||"false"!==e&&"0"!==e&&Boolean(e)}function i(e,t){return"null"===e||"undefined"===e||null===e||void 0===e?t:"true"===e||"false"!==e&&"0"!==e&&Boolean(e)}function s(e){try{return JSON.parse(decodeURI(e))}catch(e){return null}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(73),c=function(){function e(e){this._value=e}return e.prototype.getStr=function(){return void 0!==this._value&&null!==this._value&&"undefined"!==this._value&&"null"!==this._value?String(this._value):null},e.prototype.getNum=function(){return r(this._value)},e.prototype.getBool=function(){return o(this._value)},e.prototype.getBoolOrDefault=function(e){return i(this._value,e)},e.prototype.getObject=function(){return s(this._value)},e.prototype.getArray=function(){return s(this._value)},e.prototype.getObjProp=function(e){return this._value.hasOwnProperty(e)?this._value[e]:null},e}();t.Property=c;var u=function(){function e(){}return e.prototype.getStr=function(e){return this.hasOwnProperty(e)?String(this[e]):null},e.prototype.getNum=function(e){return this.hasOwnProperty(e)?r(this[e]):null},e.prototype.getBool=function(e){return this.hasOwnProperty(e)?o(this[e]):null},e.prototype.getObject=function(e){return this.hasOwnProperty(e)?s(this[e]):null},e.prototype.has=function(e){return this.hasOwnProperty(e)},e.prototype.ifPresent=function(e,t){this[e]&&t&&t.apply(this[e])},e.of=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=new e,o=0,i=t;o<i.length;o++){var s=i[o];for(var a in s){var c=s[a];r[a]="object"==typeof c?encodeURI(JSON.stringify(c)):c}}return r},e.prototype.entries=function(){var e=this;return Object.keys(this).map(function(t){return[t,new c(e[t])]})},e.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t.find(function(t){return t.has(e)});return new c(r&&r[e])},e}();t.Properties=u;var l=function(){function e(e,t,n){this._token=n,this._endpoints={props:"props/v2",mimic:"mimic"},this._url=a.RequestBuilder.join(e,"api"),this._ajax=a.Ajax.factory(t,"dapi")}return e.prototype.load=function(){return this._execute(a.RequestBuilder.get(this._url,this._endpoints.props)).then(u.of)},e.prototype.get=function(e){return this._execute(a.RequestBuilder.get(this._url,this._endpoints.props,e),a.Ajax.parseText).then(function(t){return u.of((n={},n[e]=t||null,n));var n})},e.prototype.save=function(e){return this._execute(a.RequestBuilder.post(this._url,this._endpoints.props).json(e),a.Ajax.toVoid)},e.prototype.getMimic=function(e){return this._execute(a.RequestBuilder.get(this._url,this._endpoints.mimic).cookie("gnar_containerId",e))},e.prototype.getMimicWithProps=function(e){return this._execute(a.RequestBuilder.get(this._url,this._endpoints.mimic,"withProps").cookie("gnar_containerId",e)).then(function(e){var t=e.groups,n=e.properties;return{experiments:new Set(t),properties:u.of(n)}})},e.prototype._execute=function(e,t){return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),t)},e}();t.Dapi=l},1334:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(73),o=function(){function e(e,t,n){this._url=e,this._fetch=t,this._token=n,this._ajax=r.Ajax.factory(this._fetch,"capi")}return e.prototype._attachCookie=function(e){return this._token&&e.cookie("grauth",this._token),e.build()},e.prototype.get=function(){return this._ajax(this._attachCookie(r.RequestBuilder.get(this._url,"/dict")))},e.prototype.delete=function(e){return this._ajax(this._attachCookie(r.RequestBuilder.del(this._url,"/dict").pathParam(e)),r.Ajax.toVoid)},e.prototype.add=function(e){return this._ajax(this._attachCookie(r.RequestBuilder.post(this._url,"/dict").json({word:e})),r.Ajax.toVoid)},e}();t.Dictionary=o},1335:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(824),o=n(290),i=n(117),s=function(){function e(){}return e.diffAsChanges=function(e,t){var n=new r.diff_match_patch,o=n.diff_main(e,t,!0);n.diff_cleanupSemantic(o);var s=[],a=e.length,c=0;return o.forEach(function(e){e[0]===r.DIFF_EQUAL&&(c+=e[1].length),e[0]===r.DIFF_DELETE&&(s.push(new i.Change("-",c,e[1],a)),c+=e[1].length),e[0]===r.DIFF_INSERT&&s.push(new i.Change("+",c,e[1],a))}),s},e.diff=function(e,t,n){return void 0===n&&(n=0),new o.Changesets(this.diffAsOperations(e,t),n)},e.diffAsOperations=function(e,t){return this.diffAsChanges(e,t).map(function(e){return new i.Operation(e.type,e.pos,e.text,e.len)})},e}();t.Diff=s},1336:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=n(248),i=n(173),s=n(73),a=function(){function e(e,t,n){this._url=e,this._fetch=t,this._token=n,this._ajax=s.Ajax.factory(this._fetch,"institution"),this._log=r.Monitoring.Logging.getLogger("coreclients.institution")}return e.prototype._setToken=function(e){this._token=e},e.prototype.getInfo=function(){var e=s.RequestBuilder.get(this._url,"api/institution");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build()).then(this._parseInstitutionInfo)},e.prototype._parseInstitutionInfo=function(t){var n=this;return void 0===t?(this._log.warn("failed to parse institution info: empty payload"),e.emptyInfo):i.validate(t,e.InfoType).mapLeft(o.failure).fold(function(t){return n._log.warn("failed to parse institution info: incorrect payload",t),e.emptyInfo},function(e){return e})},e.InfoType=i.interface({id:i.number,name:i.string,plagiarismDisabled:i.boolean,scoreDisabled:i.boolean,licenseDiscountinued:i.boolean,quickReplacement:i.boolean,fullCards:i.boolean,proofit:i.boolean,domainValidation:i.boolean,admin:i.boolean}),e.emptyInfo={id:-1,name:"",plagiarismDisabled:!1,scoreDisabled:!1,licenseDiscountinued:!1,quickReplacement:!1,fullCards:!1,proofit:!1,domainValidation:!1,admin:!1},e}();t.Institution=a},1337:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(73),i=n(60),s=function(){function e(e,t,n,r){this._url=e,this._subscriptionUrl=t,this._fetch=n,this._token=r,this._ajax=o.Ajax.factory(this._fetch,"irbis")}return e.prototype.deleteAccount=function(){var e=o.RequestBuilder.del(this._url,"/api/user");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),o.Ajax.toVoid)},e.prototype.getStatus=function(){var e=o.RequestBuilder.get(this._subscriptionUrl);return this._token&&e.cookie("grauth",this._token),this._ajax(e.build())},e.prototype.cancelSubscription=function(){var e=o.RequestBuilder.post(this._subscriptionUrl,"/cancel");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),o.Ajax.toVoid)},e.prototype.renewSubscription=function(){var e=o.RequestBuilder.post(this._subscriptionUrl,"/renew");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),o.Ajax.toVoid)},e.prototype.ackPremiumConversion=function(){var e=o.RequestBuilder.post(this._subscriptionUrl,"/ack-premium-conversion");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),o.Ajax.toVoid)},e.prototype.generateTokenCreditCard=function(){var e=o.RequestBuilder.post(this._subscriptionUrl,"/token/card");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),o.Ajax.parseJSON)},e.prototype.getTokenRequest=function(e){var t=this;return i.retryWithDelay(function(){return r.__awaiter(t,void 0,void 0,function(){var t,n;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._tokenRequest(e)];case 1:if(!(t=r.sent()))throw new i.RetryError("empty response");if(n=JSON.parse(t),!n.token)throw new i.RetryError("empty token");return[2,n.token]}})})})},e.prototype.getPaypalRedirectPageRequest=function(e){var t=this;return i.retryWithDelay(function(){return r.__awaiter(t,void 0,void 0,function(){var t,n;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._tokenRequest(e)];case 1:if(!(t=r.sent()))throw new i.RetryError("empty response");if(n=JSON.parse(t),!n.paypalRedirectPage)throw new i.RetryError("empty paypalRedirectPage");return[2,n.paypalRedirectPage]}})})})},e.prototype._tokenRequest=function(e){var t=o.RequestBuilder.get(this._subscriptionUrl,"/token/request").pathParam(e);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),o.Ajax.parseText)},e.prototype.getAvailablePlans=function(){var e=o.RequestBuilder.get(this._subscriptionUrl,"/pricing");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build())},e.prototype.changePlan=function(e){var t=o.RequestBuilder.post(this._subscriptionUrl,"/set-plan").pathParam(e);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),o.Ajax.toVoid)},e.prototype.subscribeCard=function(e,t){var n=o.RequestBuilder.post(this._subscriptionUrl,"/subscribe-card").formParam("nonce",e);return t&&n.formParam("billingZip",t),this._token&&n.cookie("grauth",this._token),this._ajax(n.build(),o.Ajax.toVoid)},e.prototype.subscribeCardSandbox=function(e){void 0===e&&(e="1");var t=o.RequestBuilder.post(this._subscriptionUrl,"/subscribe-card").formParam("planId",e).formParam("nonce","fake-valid-nonce").formParam("sessionId","test-session").formParam("billingZip","12345");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),o.Ajax.toVoid)},e.prototype.updateCreditCard=function(e,t){var n=o.RequestBuilder.post(this._subscriptionUrl,"/update-card").formParam("nonce",e);return t&&n.formParam("billingZip",t),this._token&&n.cookie("grauth",this._token),this._ajax(n.build(),o.Ajax.toVoid)},e.prototype.subscribePaypal=function(e){var t=o.RequestBuilder.post(this._subscriptionUrl,"/token/paypal").formParam("nonce",e);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),o.Ajax.toVoid)},e.prototype.generateTokenPaypal=function(e){var t=e.cancelUrl,n=e.returnUrl,r=o.RequestBuilder.post(this._subscriptionUrl,"/token/paypal").formParam("cancelUrl",t).formParam("returnUrl",n);return this._token&&r.cookie("grauth",this._token),this._ajax(r.build(),o.Ajax.parseJSON)},e.prototype.updatePaypal=function(e){var t=o.RequestBuilder.post(this._subscriptionUrl,"/update-paypal").formParam("payPalToken",e);return this._token&&t.cookie("grauth",this._token),this._ajax(t.build(),o.Ajax.toVoid)},e.prototype.checkDownloadBillingReceipts=function(){var e=o.RequestBuilder.head(this._subscriptionUrl,"/receipt").header("Content-Type","application/pdf");return this._token&&e.cookie("grauth",this._token),this._ajax(e.build(),o.Ajax.assertMimeType("application/pdf"))},e}();t.Irbis=s},1338:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(206),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subs=null,t}return r.__extends(t,e),t.prototype._setupTitle=function(){return i.toObservable(this.props.title).filter(function(e){return null!==e}).subscribe(function(e){return document.title=e})},t.prototype.componentWillMount=function(){this._subs=this._setupTitle()},t.prototype.componentWillUnmount=function(){this._subs&&this._subs.unsubscribe(),this._subs=null},t.prototype.render=function(){return o.Children.only(this.props.children)},t}(o.Component);t.BasePage=s},1339:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(49),s=n(204),a=n(147),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.getChildContext=function(){var e=this.props.model,t=e.telemetry,n=e.gnarSpec,r=e.platformInfo,o=e.notifications,c=e.tooltip;return{appRouter:this.props.router,appConfig:this.props.config,textResources:a.getTextResources(i.isDesktopEditor(r.browser)?"desktopeditor":"webeditor"),telemetry:t,gnarSpec:n,pageId:"home",notifications:o,tooltip:c,screen:new s.ScreenContextImpl}},t.prototype.render=function(){return o.Children.only(this.props.children)},t.childContextTypes=s.baseComponentContextTypes,t}(o.Component);t.ContextAppender=c},1340:function(e,t,n){"use strict";function r(e,t){var n=a.Monitoring.Logging.getLogger("config.parser");return t.flatMap(function(e){return o.Try.of(function(){return JSON.parse(e)}).recover(n.handler("Parse error of the provided JSON config",{config:e}).info).toOption()}).fold(function(){return e},function(t){return i.validate(t,l).mapLeft(s.failure).mapLeft(function(e){return n.info("Validation error of the provided JSON config",{config:t,error:e})}).toOption().fold(function(){return e},function(t){return n.info("Load app with custom config",t),c.merge(e,t)})})}Object.defineProperty(t,"__esModule",{value:!0});var o=n(29),i=n(173),s=n(248),a=n(5),c=n(1329),u={_A:i._A,name:"httpString",validate:function(e,t){return"string"==typeof e&&e.match(/^(https?|wss):\/\/(\w|\d|-|\/|\.|\?|\=|\_)*(:(\d)*)?$/)?i.success(e):i.failure(e,t)}},l=i.partial({api:i.partial({authUrl:u,capiApiUrl:u,capiWsUrl:u,crashLogUrl:u,dapiUrl:u,doxUrl:u,felogUrl:u,gnarApi:i.partial({url:u}),institutionUrl:u,irbisUrl:u,onlineTestUrl:u,pdfGeneratorUrl:u,proofitResultUrl:u,wsTest:u}),desktop:i.partial({mac:i.partial({infoURL:u,installURL:u}),windows:i.partial({infoURL:u,installURL:u})}),edu:i.partial({adminPanelURL:u}),extension:i.partial({chrome:i.partial({infoURL:u,installURL:u}),firefox:i.partial({iconURL:u,infoURL:u,installURL:u}),safari:i.partial({installURL:u})}),funnel:i.partial({accountDeleted:u,mainPage:u,resetPassword:u,signin:u,signup:u,subscribe:u,upgrade:u}),officeAddIn:i.partial({infoURL:u,installURL:u}),support:i.partial({connectionTroubleshooting:u,contact:u,diagnosticTestPath:u,documentAcceptTrackedChanges:u,email:u,emailExistsKBUrl:u,login:u,mainPage:u,newRequest:u,phoenixSupportUrl:u,phoenixWritingHelpUrl:u})});t.createConfig=r},1341:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(22),s=n(12),a=n(145),c=function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)},u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(e){if(t.props.onClick&&t.props.onClick(e),!e.defaultPrevented&&0===e.button&&!t.props.target&&!c(e)){e.preventDefault();var n=(t.context.router.history,t.props.destination);t.context.appRouter.navigate(n)}},t}return r.__extends(t,e),t.prototype.componentWillMount=function(){if(!(this.context.appRouter instanceof a.Router.Impl||this.context.appRouter instanceof a.Router.DummyImpl))throw new TypeError("No router or invalid router supplied to Link.\n        It should be the editor-router and should come from the context.")},t.prototype.render=function(){var e=this.props,t=e.destination,n=e.className,i=e.activeClassName,a=e.children,c=r.__rest(e,["destination","className","activeClassName","children"]),u=this.context.router.history.createHref(t),l=this.context.appRouter.isActive(t);return o.createElement(s.F.a,r.__assign({},r.__assign({href:u},s.classes(n,l.view(function(e){return e&&i})),c),{onClick:this.handleClick}),a)},t.contextTypes=Object.assign({router:i.shape({history:i.shape({push:i.func.isRequired,replace:i.func.isRequired,createHref:i.func.isRequired}).isRequired}).isRequired},a.Router.ContextTypes),t}(o.Component);t.Link=u},1342:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(12),s=n(80),a=n(1327),c=n(7),u=n(295),l=n(303),h=n(145),d=n(1343),p=n(1339),f=n(49),m=n(1340),g=n(368),_=new h.Router.Impl,y=m.createConfig(s.appConfig,_.query.get("config")),v=a.defaultModel(y,_),b=d.routesMap(v),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getContent=function(e){return function(t){return c.Async.isOk(t)?e():c.Async.isError(t)||c.Async.isFatal(t)?o.createElement(l.Error500Page,null):o.createElement(u.Spinner,{className:g.spinner})}},t}return r.__extends(t,e),t.prototype.render=function(){var e=this;return o.createElement(h.Router.Wrapper,{routesMap:b,renderer:function(t,n){var s=t.match;t.location;return n.private&&(v.authentication.ensureAuthenticated(),v.authentication.status.filter(c.Async.isOk).first().subscribe(function(){v.apis.dox.clientType=v.userAccount.features.isDenaliV2?"denali_editor":"web"})),o.createElement(p.ContextAppender,r.__assign({},{model:v,router:_,config:y}),n.private?o.createElement(i.F.div,r.__assign({},i.classes(f.isDesktopEditor(v.platformInfo.browser)&&g.desktopEditorPreventSelection)),v.authentication.status.view(e._getContent(function(){return d.globalExperiment(v,_).getOrElseL(function(){return n.component(s.params)})}))):n.component(s.params))}})},t}(o.Component);t.Main=w},1343:function(e,t,n){"use strict";function r(e,t){var n=d.promiseToStream(e).map(function(e){return e.fold(function(){return c.createElement(_.Spinner,{className:y.spinner})},function(e){return e.fold(function(e){return h.Monitoring.Logging.getLogger("routes.loader").fatal("Fail on component load",e),c.createElement(p.Error500Page,null)},t)})});return c.createElement(l.F.div,null,n)}function o(e){return{documents:g.Router.bindComponent(g.Router.routes.documents,function(){return r(function(){return new Promise(function(e){return n.e(0).then(function(t){return e(n(1402))}.bind(null,n)).catch(n.oe)})},function(t){return c.createElement(t.DocumentsPage,{model:e})})}),profile:g.Router.bindComponent(g.Router.routes.profile,function(){return r(function(){return new Promise(function(e){return n.e(0).then(function(t){return e(n(1404))}.bind(null,n)).catch(n.oe)})},function(t){return c.createElement(t.ProfilePage,{model:e})})}),subscription:g.Router.bindComponent(g.Router.routes.subscription,function(){return r(function(){return new Promise(function(e){return n.e(0).then(function(t){return e(n(1405))}.bind(null,n)).catch(n.oe)})},function(t){return e.userAccount.features.isFree?c.createElement(b,{destination:g.Router.routes.free.href({})}):c.createElement(t.SubscriptionPage,{model:e})})}),apps:g.Router.bindComponent(g.Router.routes.apps,function(){return r(function(){return new Promise(function(e){return n.e(0).then(function(t){return e(n(1400))}.bind(null,n)).catch(n.oe)})},function(t){return c.createElement(t.AppsPage,{model:e})})}),new_document:g.Router.bindComponent(g.Router.routes.new_document,function(){return c.createElement(l.F.div,null,d.promiseToStream(function(){return e.documentsPage.actions.createDocument()}).map(function(e){return e.fold(function(){return c.createElement(_.Spinner,{className:y.spinner})},function(e){return e.map(function(e){return e.id.toString()}).fold(function(e){return h.Monitoring.Logging.getLogger("routes").fatal("Fail create new document",e),c.createElement(p.Error500Page,null)},function(e){return c.createElement(b,{destination:g.Router.routes.editor.href({docId:e})})})})}))}),editor:g.Router.bindComponent(g.Router.routes.editor,function(t){var o=t.docId;return e.userAccount.features.isDenaliV2?c.createElement(b,{destination:g.Router.routes.denali_editor.href({docId:o})}):(e.apis.dox.clientType="web",r(function(){return n.e(3).then(n.bind(null,1406))},function(t){return c.createElement(t.EditorPage,{model:e,docId:o})}))}),denali_editor:g.Router.bindComponent(g.Router.routes.denali_editor,function(t){var o=t.docId;return e.userAccount.features.forceEditorTs?c.createElement(b,{destination:g.Router.routes.editor.href({docId:o})}):(e.apis.dox.clientType="denali_editor",r(function(){return n.e(2).then(n.bind(null,1399))},function(t){return c.createElement(t.DenaliEditorPage,{wsConnectivity:e.wsConnectivity,networkState:e.networkState,notifications:e.denaliNotifications,doxApi:e.apis.dox,docId:o,userAccount:e.userAccount,logout:function(){return e.authentication.logout()},browser:e.platformInfo.browser})}))}),free:g.Router.bindComponent(g.Router.routes.free,function(){return e.userAccount.features.isFree?r(function(){return n.e(6).then(n.bind(null,1403))},function(t){return c.createElement(t.FreePage,{authentication:e.authentication,userAccount:e.userAccount})}):c.createElement(b,{destination:g.Router.routes.documents.href({})})}),componentBrowser:g.Router.bindComponent(g.Router.routes.component_browser,function(e){var t=e.component;return r(function(){return n.e(1).then(n.bind(null,1407))},function(e){return c.createElement(e.ComponentBrowserPage,{component:t})})}),card_iframe:g.Router.bindComponent(g.Router.routes.card_iframe,function(){return r(function(){return n.e(4).then(n.bind(null,1401))},function(e){return c.createElement(e.CardIframePage,null)})}),diagnostic_test:g.Router.bindComponent(g.Router.routes.diagnostic_test,function(){return r(function(){return n.e(5).then(n.bind(null,1408))},function(e){return c.createElement(e.DiagnosticPage,null)})}),notFound:g.Router.bindComponent(g.Router.routes.notFound,function(){return c.createElement(f.Error404Page,{requestedData:"page"})})}}function i(e,t){var n=t.title,r=t.text,o=d.promiseToStream(function(){return e.documentsPage.actions.createDocument(r,n)});return u.Option.some(c.createElement(l.F.div,null,o.map(function(e){return e.fold(function(){return c.createElement(_.Spinner,{className:y.spinner})},function(e){return e.map(function(e){return e.id.toString()}).fold(function(e){return h.Monitoring.Logging.getLogger("global_experiment").fatal("Fail when redirecting to usertesting doc",e),c.createElement(b,{destination:g.Router.routes.documents.href({})})},function(e){return c.createElement(b,{destination:g.Router.routes.denali_editor.href({docId:e})})})})})))}function s(e,t){var n=e.userAccount.features;return n.isUserTesting&&!t.isActive(g.Router.routes.denali_editor.href({docId:"*"})).get()?n.isUserTesting1?i(e,m.userTestingDemo):n.isUserTesting2?i(e,m.userTestingDemo2):n.isUserTesting3?i(e,m.userTestingDemo3):u.Option.none():u.Option.none()}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),c=n(17),u=n(29),l=n(12),h=n(5),d=n(206),p=n(303),f=n(1368),m=n(1382),g=n(145),_=n(295),y=n(368),v=n(204),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.context.appRouter;e.navigate(this.props.destination,e.locationState.getOrElse(void 0),!0)},t.prototype.render=function(){return null},t}(v.BaseComponent);t.routesMap=o,t.userTestingExperiment=i,t.globalExperiment=s},1344:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(287),i=n(12),s=n(27),a=n(48),c=n(5),u=n(7),l=n(49),h=n(118),d=n(293),p=n(150),f=n(29);t.defaultState=u.Async.defaultValue();var m="webeditor",g="desktopeditor",_=function(e){function t(){return e.call(this,{code:403,status:"error",message:"User is anonymous"})||this}return r.__extends(t,e),t}(a.HTTPError);t.AnonymousUserError=_;var y=function(e){function t(){return e.call(this,{code:0,status:"error",message:"User cannot use editor"})||this}return r.__extends(t,e),t}(a.HTTPError);t.CannotUseEditorError=y;var v=function(e){function t(t){return e.call(this,{code:t,status:"error",message:"Connection failed"})||this}return r.__extends(t,e),t}(a.HTTPError);t.ConnectionError=v;var b=function(){function e(e,t,n,r,o,i,s,h,d,p,f){var _=this;this._state=e,this._authApi=t,this._institutionApi=n,this._dapi=r,this._onAuthenticated=o,this._appConfig=i,this._telemetry=s,this._navigateToFreePage=h,this._modal=d,this._overlay=p,this._browser=f,this._log=c.Monitoring.Logging.getLogger("model.authentication"),this._authAppName=l.isDesktopEditor(this._browser)?g:m,this.status=this._state.view(function(e){return u.Async.map(e,function(e){return e})}),this._handleAuthError=function(e){e instanceof y?_._gotoFreePage():!e||401!==e.code&&403!==e.code?(_._log.fatal("authError: Failed to get user session","string"==typeof e?e:c.EventProps.fromAny(e)),_._state.modify(function(t){return u.Async.isOk(t)?u.Async.error(e||new Error("authError: Failed to get user session, error is undefined"))(t):t})):(_._log.warn("authError: Bad user session",e),_._gotoLogin())},this._retryWhen=function(e){return!(e instanceof a.HTTPError)||u.isServerErrorCode(e.code)}}return e.prototype.ensureAuthenticated=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t,n=this;return r.__generator(this,function(r){switch(r.label){case 0:if(!u.Async.isIdle(this._state.get()))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),this._state.modify(u.Async.begin),[4,this._getUserSession()];case 2:if(e=r.sent(),setTimeout(function(){n._onAuthenticated(e),n._state.modify(u.Async.success(e))},0),!e.userProfile.canUseEditor)throw new y;return[3,4];case 3:return t=r.sent(),this._handleAuthError(t),t instanceof y||this._state.modify(u.Async.error(t)),[3,4];case 4:return[2]}})})},e.prototype._parseUserProfileJSON=function(e,t,n,r){var o=new Set(e.groups.filter(Boolean)),i="Free"===e.type?h.UserType.free:"Premium"===e.type?h.UserType.premium:function(){throw new Error("Unknown user type "+e.type)}();return{userProfile:{id:e.id,email:e.email,newEmail:e.newEmail,fullName:e.name,isFreebie:o.has(h.UserGroups.FREEBIE_USER),isTest:e.isTest||!1,canUseEditor:"Premium"===e.type||e.freemium||!1,groups:o,type:i,loginType:e.loginType,registrationDate:e.registrationDate?f.Some(new Date(e.registrationDate)):f.None},subscription:d.defaultState,institution:r,settings:t,experiments:n}},e.prototype._parseLaterBanners=function(e){return e.map(function(e){if("object"==typeof e)return e;var t=e.split(":"),n=t[0],r=t[1];return{type:n,expire:parseInt(r,10)}})},e.prototype._parseUserSettings=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(d=a.Properties).find.apply(d,["banners"].concat(e)).getObject()||{},r=n.shown,o=void 0===r?[]:r,i=n.showen,s=void 0===i?[]:i,c=n.dismiss,u=void 0===c?[]:c,l=n.later,h=void 0===l?[]:l;return{firstCall:(p=a.Properties).find.apply(p,["firstCall"].concat(e)).getBool()||!1,seenWelcome:(f=a.Properties).find.apply(f,["seenWelcome"].concat(e)).getBool()||!1,forcedDenaliUI:(m=a.Properties).find.apply(m,["DN:forcedDenaliUI"].concat(e)).getBool()||!1,acceptedTermsVersion:(g=a.Properties).find.apply(g,["acceptedTermsVersion"].concat(e)).getStr()||"",dialectStrong:(_=a.Properties).find.apply(_,["dialectStrong"].concat(e)).getStr(),dialectWeak:(y=a.Properties).find.apply(y,["dialectWeak"].concat(e)).getStr(),denaliLens:(v=a.Properties).find.apply(v,["denaliLens"].concat(e)).getObject()||{},banners:{dismiss:u,later:this._parseLaterBanners(h),shown:o||s},onboardingPassed:(b=a.Properties).find.apply(b,["onboardingPassed"].concat(e)).getArray(),showExitNotification:(w=a.Properties).find.apply(w,["showExitNotification"].concat(e)).getBoolOrDefault(!0)};var d,p,f,m,g,_,y,v,b,w},e.prototype.checkAuthenticated=function(){return this._authApi.getUser(this._authAppName).then(function(e){if(e.anonymous)throw new _}).catch(this._handleAuthError)},e.prototype._getUserMimicWithProps=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t,n;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t=(e=this._dapi).getMimicWithProps,[4,this._telemetry.getContainerId()];case 1:return[4,t.apply(e,[r.sent()])];case 2:return[2,r.sent()];case 3:return n=r.sent(),this._log.warn("dapiError: Failed to get dapi props and mimic groups",n),[2,{experiments:new Set,properties:a.Properties.of({})}];case 4:return[2]}})})},e.prototype._getUserSession=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t,n,o,i,s,c;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._authApi.getUser(this._authAppName)];case 1:if(e=r.sent(),e.anonymous)throw new _;return[4,Promise.all([this._getUserMimicWithProps(),void 0!==e.institutionId?this._getUserInstitution():Promise.resolve(null)])];case 2:return t=r.sent(),n=t[0],o=n.properties,i=n.experiments,s=t[1],c=this._parseUserSettings(o,p.LocalStorageUserSettings.read(e.id),a.Properties.of(e.settings)),p.LocalStorageUserSettings.write(e.id,a.Properties.of(c)),[2,this._parseUserProfileJSON(e,c,i,s)]}})})},e.prototype._getUserInstitution=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t=this;return r.__generator(this,function(n){return e=i.Atom.create(u.Async.defaultValue()),u.Async.OperationRetrier.create(function(){return t._institutionApi.getInfo()},e,u.Async.OperationRetrier.RetryStrategy.conditional(this._retryWhen,u.Async.OperationRetrier.RetryStrategy.linear(3,3e3))),[2,e.do(function(e){u.Async.isError(e)&&1===e.attempt?t._log.info("institutionError: Failed to get institution info from first try",e.error):u.Async.isFatal(e)&&t._log.warn("institutionError: Can not get institution info",e.error)}).filter(u.Async.isTerminated).map(function(e){return u.Async.isFatal(e)?a.Institution.emptyInfo:e.value}).first().toPromise()]})})},e.prototype._gotoLogin=function(){this._gotoFunnelPage(this._appConfig.funnel.signin)},e.prototype._gotoFreePage=function(){this._navigateToFreePage()},e.prototype._gotoMainPage=function(){this._gotoFunnelPage(this._appConfig.funnel.mainPage)},e.prototype._gotoFunnelPage=function(e){if(l.isDesktopEditor(this._browser)){o.gt(l.getBrowserInfo().version,"1.5.29")?(this._log.info("Redirecting DTE to social signin page"),document.location.href=this._appConfig.funnel.socialSignin+"?fromDesktopEditor=true"):document.location.href=e}else document.location.href=e},e.prototype.logout=function(){var e,t=this,n=i.Atom.create(0),r=i.Atom.create(5),o=i.Atom.create(5),a=function(){return t._authApi.logout().catch(function(e){throw t._log.error("Logout error",e),e})},c=new s.Subject,l=function(){e.unsubscribe(),c.next(0),n.set(1),o.set(0),r.set(5)};this._modal.show({type:"inProgressSpinner"}),s.Observable.defer(a).retryWhen(function(i){return i.scan(function(e){return e+1},0).flatMap(function(i){if(i>10)throw o.set(-1),t._modal.hide(),t._overlay.show(),new Error("Logout retry limit exceeded");n.set(i);var a=Math.min(5*i,30);return r.set(a),o.set(a),e=s.Observable.interval(1e3).take(a).subscribe(function(){o.modify(function(e){return e-1}),0===o.get()&&c.next(0)}),c=new s.Subject})}).subscribe(function(){u.Extension.notifications.sendLogout(),t._gotoMainPage()},function(e){return t._log.error("Logout error",e)}),n.filter(function(e){return e>1}).first().subscribe(function(){return t._modal.notifications.show(t._modal.notifications.create.logoutError(l,o))})},e}();t.AuthenticationModelImpl=b},1345:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(7),s=function(){function e(e,t){this._notification=e,this._overlay=t}return e.prototype.getDisposer=function(e,t){var n=this;return void 0===t&&(t={hideOverlay:!1}),function(){e&&n._notification.hide(e),t.hideOverlay&&n._overlay.hide()}},e}();t.ErrorHandler=s;var a=function(e){function t(t,n){return e.call(this,t,n)||this}return r.__extends(t,e),t.prototype.handle=function(e){switch(e.type){case"slow":return this.getDisposer(this._notification.show(this._notification.create.slowNetwork()));case"offline":return this._overlay.show(),this.getDisposer(this._notification.show(this._notification.create.offline(e.timer.resetClock,e.timer.reconnectTime)),{hideOverlay:!0});default:return i.assertNever(e)}},t}(s);t.NetworkErrorHandler=a;var c=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._log=o.Monitoring.Logging.getLogger("connectivity.wsProtocol"),r}return r.__extends(t,e),t.prototype.handle=function(e){switch(this._log.info(e.type),e.type){case"offline":return this._overlay.show(),this.getDisposer(this._notification.show(this._notification.create.connectionWSError()),{hideOverlay:!0});default:return i.assertNever(e.type)}},t}(s);t.WsProtocolErrorHandler=c;var u=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i._authentication=r,i._log=o.Monitoring.Logging.getLogger("connectivity.dox"),i}return r.__extends(t,e),t.prototype.handle=function(e){switch(this._log.info(e.type),this._overlay.show(),e.type){case"unauthorized":return this._authentication.checkAuthenticated(),this.getDisposer(this._notification.show(this._notification.create.unauthorizedError()),{hideOverlay:!0});case"serverError":return this.getDisposer(this._notification.show(this._notification.create.serverError()),{hideOverlay:!0});case"blockedByClient":return this.getDisposer(this._notification.show(this._notification.create.connectionWSError()),{hideOverlay:!0});case"clientConnectionError":return this.getDisposer(this._notification.show(this._notification.create.clientConnectionError()),{hideOverlay:!0});case"unknownConnectionError":return this.getDisposer(this._notification.show(this._notification.create.unknownConnectionError()),{hideOverlay:!0});default:return i.assertNever(e.type)}},t}(s);t.DoxErrorHandler=u;var l=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._log=o.Monitoring.Logging.getLogger("connectivity.capi"),r}return r.__extends(t,e),t.prototype.handle=function(e){switch(this._log.info(e.type),e.type){case"offline":return this.getDisposer(this._notification.show(this._notification.create.checkingIsDown()));default:return i.assertNever(e.type)}},t}(s);t.CapiErrorHandler=l},1346:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(12),i=n(7),s=n(537);t.DoxOfflineType=s.DoxOfflineType;var a=function(){function e(e){var t=this;this._handlers=e,this.onlineState=o.Atom.create({network:{type:s.ONLINE},dox:{type:s.ONLINE},wsProtocol:{type:s.ONLINE},wsDox:{type:s.ONLINE},wsCapi:{type:s.ONLINE}}),this.networkOnline=this.onlineState.view(function(e){return"offline"!==e.network.type}),i.invariant(!this._subscription,"ConnectivityModel already subscribed"),this.onlineState.pairwise().subscribe(function(e){var n=e[0],r=e[1],o=t._getNextOfflineKey(n),i=t._getNextOfflineKey(r);if(null===i)return void(t._dispose&&t._dispose());var s=r[i];o===i&&n[o].type===s.type||(t._dispose&&t._dispose(),"online"!==s.type&&(t._dispose=t._handlers[i].handle(s)))})}return e.prototype.setState=function(e){var t=e.type,n=e.state;this.onlineState.modify(function(e){return r.__assign({},e,(o={},o[t]=n,o));var o})},e.prototype._getNextOfflineKey=function(e){if("offline"===e.network.type)return"network";if(e.wsProtocol.type!==s.ONLINE)return"wsProtocol";if(e.dox.type!==s.ONLINE)return"dox";if(e.wsDox.type!==s.ONLINE)return"wsDox";if(e.wsCapi.type!==s.ONLINE)return"wsCapi";if("slow"===e.network.type)return"network";var t=Object.keys(e).find(function(t){return"online"!==e[t].type});if(t)throw new i.InvariantError("Expected that state is online but got '"+t+"' is '"+e[t].type+"'");return null},e}();t.ConnectivityModelImpl=a},1347:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),o=n(12),i=n(5),s=n(147),a=n(7),c=10,u=5e3,l={method:"HEAD",mode:"cors"},h=function(){function e(e,t){var n=this;this._connectivity=e,this._onlineTestUrl=t,this._log=i.Monitoring.Logging.getLogger("networkConnectivity"),this._online=o.Atom.create("online"),this.check=a.throttleByPromise(function(){return n._checkRequest().then(n._setOnline).catch(function(){n._log.info("Online check failed, switching to offline state"),n._setOffline(n.check)})}),this.getOnlineStatus=function(){return n._online.get()},this.checkOnlineStatus=function(){return n.check().then(n.getOnlineStatus)},this._startReconnectTimer=function(e){n._stopTimer();var t=o.Atom.create(c),i=function(){t.set(c),e&&e()};n._reconnectTimer=r.Observable.interval(1e3).subscribe(function(){t.get()<=1&&e&&e(),t.modify(function(e){return e<=1?c:e-1})}),n._timer={resetClock:i,reconnectTime:t}},this._setOnline=function(){n._stopTimer(),n._online.modify(n._toSlowOrOnline)},this._setOffline=function(e){"offline"!==n._online.get()&&(n._startReconnectTimer(e),n._online.modify(n._toOffline))},this._checkRequest=function(){return a.Async.promiseWithTimeout(s.RxFetch.nativeFetch(n._onlineTestUrl+"?_="+Date.now(),l),u)},this._online.subscribe(function(e){switch(e){case"online":n._log.info("Switch back to online state"),n._connectivity.setState({type:"network",state:{type:"online"}});break;case"slow":n._connectivity.setState({type:"network",state:{type:"slow"}});break;case"offline":n._connectivity.setState({type:"network",state:{type:"offline",timer:n._timer}});break;default:a.assertNever(e)}}),this._online.filter(function(e){return"slow"!==e}).switchMap(function(e){return"offline"===e?r.Observable.empty():s.RxFetch.requestResults.filter(function(e){return"timeoutWarn"===e.type}).do(function(){n._online.modify(n._toSlow)}).switchMap(function(){return r.Observable.of(!1).delay(s.RxFetch.FETCH_TIMEOUT)})}).subscribe(function(){return n._online.modify(n._toOnline)}),r.Observable.fromEvent(window,"online").subscribe(this._setOnline),r.Observable.fromEvent(window,"offline").mapTo(void 0).subscribe(this._setOffline),this._online.switchMap(function(e){return"offline"===e?s.RxFetch.requestResults.filter(function(e){return"success"===e.type}):r.Observable.merge(s.RxFetch.requestResults.filter(function(e){var t=e.type;return"clientError"===t||"timeoutWarn"===t||"timeoutError"===t}),n._connectivity.onlineState.skip(1).filter(function(e){var t=e.dox,n=e.wsDox;return"online"!==e.wsCapi.type||"online"!==t.type||"online"!==n.type}))}).debounceTime(1e3).subscribe(this.check)}return e.prototype._stopTimer=function(){this._reconnectTimer&&(this._reconnectTimer.unsubscribe(),this._reconnectTimer=null)},e.prototype._toSlow=function(e){return"online"===e?"slow":e},e.prototype._toOnline=function(e){return"online"},e.prototype._toSlowOrOnline=function(e){return"offline"===e?"online":e},e.prototype._toOffline=function(e){return"offline"},e}();t.NetworkConnectivityModelImpl=h},1348:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(12),i=n(537),s=n(7),a=function(){function e(e,t){var n=this;this._connectivity=e,this._wsHandlers=t,this._wsState=o.Atom.create({wsDox:{type:i.ONLINE},wsCapi:{type:i.ONLINE}}),this._getChangedState=function(e){var t=e[0],r=e[1],o=Object.keys(t).find(function(e){return n._wasChanged(t,r,e)});return s.invariant(!!o,"WsState must be changed"),{type:o,state:r[o]}},this._handleStateChange=function(e){var t=e.type,r=e.state;r.type===i.ONLINE?n._connectivity.setState({type:t,state:{type:"online"}}):n._wsHandlers[t].handle(r)},this._wsState.pairwise().map(this._getChangedState).subscribe(this._handleStateChange)}return e.prototype.setState=function(e){var t=e.type,n=e.state;this._wsState.modify(function(e){return r.__assign({},e,(o={},o[t]=n,o));var o})},e.prototype._wasChanged=function(e,t,n){return e[n].type!==t[n].type},e}();t.WsConnectivityModelImpl=a},1349:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(80),i=n(7),s=n(560),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.CustomError),c=function(){function e(e,t){var n=this;this.networkState=e,this.connectivity=t,this.checkWs=function(){return"offline"===n.networkState.getOnlineStatus()?Promise.resolve():n._wsTest().catch(n._checkOnline)},this._wsTest=function(){return Promise.race([new Promise(function(e,t){var n=i.getWebSocket(o.appConfig.api.wsTest);if(!n)throw new a("Socket is not accessible");n.onmessage=function(){try{n.close(),e()}catch(e){t(e)}},n.onerror=function(e){return t(e)}}),s.timeoutLimit(s.TIMEOUT)])},this._checkOnline=function(){return n.networkState.checkOnlineStatus().then(function(e){return"offline"===e?Promise.resolve():Promise.reject(new a("Websocket test failed while network test passed"))})}}return e}();t.WsErrorHandler=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.handle=function(e){var t=this;switch(e.type){case"unknownConnectionError":case"clientConnectionError":case"blockedByClient":this.checkWs().then(function(){return t.connectivity.setState({type:"wsDox",state:{type:e.type}})}).catch(function(){t.connectivity.setState({type:"wsProtocol",state:{type:"offline"}})});break;case"serverError":case"unauthorized":this.connectivity.setState({type:"wsDox",state:{type:e.type}});break;default:i.assertNever(e.type)}},t}(c);t.WsDoxErrorHandler=u;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.handle=function(e){var t=this;switch(e.type){case"offline":this.checkWs().then(function(){return t.connectivity.setState({type:"wsCapi",state:{type:e.type}})}).catch(function(){t.connectivity.setState({type:"wsProtocol",state:{type:"offline"}})});break;default:i.assertNever(e.type)}},t}(c);t.WsCapiErrorHandler=l},1350:function(e,t,n){"use strict";function r(e){for(var t=0,n=Array.from(c.keys());t<n.length;t++){var r=n[t],o=new RegExp(r.replace("*","[\\w/]+"));if(e.match(o))return c.get(r)}throw new Error("pname doesn't match any of regexps")}function o(e){var t=r(e);if(!t)throw new Error("pname "+e+" should have a mapping");return t}function i(e,t){void 0===t&&(t=function(e){return e});try{return t(o(e))}catch(t){return void s.Monitoring.Logging.getLogger("model.denali.alert_to_lens").info("Can't find lens by pname",t,{pname:e})}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),a={},c=new Map;for(var u in a)!function(e){a[e].forEach(function(t){var n=t.title,r=t.rank,o=t.description;t.cards.forEach(function(t){c.set(t,{title:n,type:e,rank:r,description:o,key:n.replace(" ","_")})})})}(u);t.Lenses=Array.from(c.values()).filter(function(e,t,n){return n.findIndex(function(t){return t.key===e.key})===t}),t.pnameToLensUnsafe=o,t.pnameToLensProp=i},1351:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),o=n(27);t.defaultState={textScrollPosition:0};var i=function(){function e(){this.textScrollPosition=new o.Subject,this.sidebarScrollTopOffset=new o.Subject,this.viewportSize=r.Atom.create({top:0,height:0,scrollTop:0,left:0}),this.sidebarScrollBy=new o.Subject,this._textScrollOffsetReset=new o.Subject}return e.prototype.setTextScrollPosition=function(e){this.textScrollPosition.next(e)},e.prototype.clearTextScrollPosition=function(){this._textScrollOffsetReset.next(0)},e.prototype.createTextScrollOffset=function(e){var t={negativeTop:0,bottom:0};return o.Observable.merge(this._textScrollOffsetReset.mapTo(t),this.textScrollPosition.map(function(t){return{negativeTop:Math.max(-t,0),bottom:Math.max(t-e(),0)}}).startWith(t)).distinctUntilChanged()},e.prototype.ensureCardIsInSidebarViewport=function(e){var t=e.top,n=e.height,r=this.viewportSize.get();if(t<52)return this.sidebarScrollTopOffset.next(r.scrollTop+t-52),52;if(t+n>r.height){var o=r.height-n<52?r.height-52:n;return this.sidebarScrollTopOffset.next(r.scrollTop+(t+o-r.height)),r.height-o}return t},e.prototype.setViewportSize=function(e,t,n,r){this.viewportSize.set({top:e,left:t,height:n,scrollTop:r})},e.prototype.scrollBy=function(e){this.sidebarScrollBy.next(e)},e}();t.DenaliScrollModelImpl=i},1352:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),o=function(){function e(){var e=this;this.scrollTo=new r.Subject,this.focused=new r.Subject,this.focusedEvent=function(t){var n=t.target;"TEXTAREA"!==n.tagName&&"INPUT"!==n.tagName&&e.focused.next()}}return e.prototype.nextCursorPosition=function(e){var t=.7*Math.max(document.documentElement.clientHeight,window.innerHeight||0);e.top>t&&this.scrollTo.next(Math.round(e.top-t))},e}();t.DenaliEditorViewModel=o},1353:function(e,t,n){"use strict";function r(e,t){var n="prev"===t?e.previousSibling:e.nextSibling;if(!n)return e.parentNode?r(e.parentNode,t):"";var o=n.textContent;return o?" "===o?"prev"===t?r(n,"prev")+" ":" "+r(n,"next"):o:""}function o(e,t){var n=r(e,t);if(!n)return null;var o="prev"===t?n.replace(/\s$/," ").match(/\w+.\w+.?$/):n.replace(/^\s/," ").match(/^.?\w+.\w+/);return null===o?null:o[0]}function i(e){var t=document.querySelector(".gr_"+e.id);return t?[o(t,"prev"),o(t,"next")]:[null,null]}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1350);t.LensType=s.LensType,t.Lenses=s.Lenses,t.pnameToLensUnsafe=s.pnameToLensUnsafe,t.pnameToLensProp=s.pnameToLensProp,t.getAlertContext=i},1354:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),o=n(7);t.defaultState={dictionary:null,status:o.Async.defaultValue()};var i=function(){function e(e,t){this._state=e,this._api=t,this.dictionary=this._state.lens("dictionary"),this.syncStatus=this._state.lens("status"),this.isInProgress=this.syncStatus.view(function(e){return e.status===o.Async.Status.inProgress}),this.ready=this.dictionary.view(function(e){return null!==e}),this.isReadyOrError=r.Atom.combine(this.ready,this.syncStatus,function(e,t){return e||t.status===o.Async.Status.error}),this.isNotReadyOrInProgres=r.Atom.combine(this.ready,this.isInProgress,function(e,t){return!e||t})}return e.prototype.ensureReady=function(){var e=this;return this.ready.get()||this.isInProgress.get()?Promise.resolve():o.Async.runWithTimeout(function(){return e._api.get().then(function(t){return e.dictionary.set(t)})},this.syncStatus)},e.prototype.add=function(e){var t=this;return o.Async.modifyRemoteState(this.dictionary,function(t){return[e].concat(t||[])},function(){return o.Async.runWithTimeout(function(){return t._api.add(e).then(function(e){return Promise.resolve()})},t.syncStatus)})},e.prototype.remove=function(e){var t=this;return o.Async.modifyRemoteState(this.dictionary,function(t){return(t||[]).filter(function(t){return t!==e})},function(){return o.Async.runWithTimeout(function(){return t._api.delete(e).then(function(e){return Promise.resolve()})},t.syncStatus)})},e}();t.DictionaryModelImpl=i},1355:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(12),i=n(5),s=n(538),a=n(7),c=n(48);!function(e){e[e.documentTypeUnsupported=0]="documentTypeUnsupported",e[e.documentIsEmpty=1]="documentIsEmpty",e[e.documentSizeExceeded=2]="documentSizeExceeded",e[e.noFilesToUpload=3]="noFilesToUpload",e[e.onlyOneDocumentAllowed=4]="onlyOneDocumentAllowed"}(r||(r={}));var u=function(e){return e&&s.ACCEPTED_UPLOAD_EXTENSIONS.some(function(t){return e.toLowerCase().endsWith(t)})},l=function(){return a.Async.defaultValue()},h=function(){function e(e,t,n,r){var i=this;this._upload=e,this._navigateToDocument=t,this._notifications=n,this._telemetry=r,this._state=o.Atom.create(l()),this._inBackground=!1,this.state=this._state.view(),this._state.filter(function(e){return a.Async.isTerminated(e)}).subscribe(function(e){if(a.Async.isOk(e)){var t=e.value,n=t.id,r=t.notify,o=i._navigateToDocument.bind(i,n,{openSidebar:!0,showDocumentUploadedNotification:r});i._inBackground?i._notifications.show(i._notifications.create.documentUploaded(o)):o()}else i._handleError(e.error);i._state.set(l())})}return e.prototype.upload=function(e,t){var n=this;if(void 0===t&&(t=!0),a.Async.isInProgress(this._state.get())){var o={type:"clientError",errorType:r.onlyOneDocumentAllowed};return this._handleError(o),Promise.resolve(a.Either.left(o))}this._inBackground=!1,this._state.modify(a.Async.begin);var i=this._validateFile(e);if(null!==i){var s={type:"clientError",errorType:i};return this._state.modify(a.Async.fatal(s)),Promise.resolve(a.Either.left(s))}var c=e[0];return this._upload(c).then(function(e){var r=String(e.id);return n._state.modify(a.Async.success({id:r,notify:t})),n._telemetry.uploadDocument(!0),a.Either.right(r)}).catch(function(e){var t={type:"serverError",error:e};return n._state.modify(a.Async.fatal(t)),a.Either.left(t)})},e.prototype.navigated=function(){this._inBackground=!0},e.prototype._handleError=function(e){"clientError"===e.type?this._handleClientError(e):this._handleServerError(e)},e.prototype._handleServerError=function(e){var t=e.error;i.Monitoring.Logging.getLogger("document.upload").error("uploadDocument failed",t),t instanceof c.DoxErrors.FileSizeOutOfRangeError?(this._telemetry.uploadDocument(!1,"serverError",r[r.documentSizeExceeded]),this._notifications.show(this._notifications.create.documentSizeExceeded())):t instanceof c.DoxErrors.UnsupportedFileTypeError?(this._telemetry.uploadDocument(!1,"serverError",r[r.documentTypeUnsupported]),this._notifications.show(this._notifications.create.documentTypeUnsupported())):t instanceof c.DoxErrors.TrackedChangesIsUnsupported?(this._telemetry.uploadDocument(!1,"serverError",t.message),this._notifications.show(this._notifications.create.trackedChangesIsUnsupported())):t instanceof c.DoxErrors.TooManyRequestsError?(this._telemetry.uploadDocument(!1,"serverError",t.message),this._notifications.show(this._notifications.create.error())):(this._telemetry.uploadDocument(!1,"serverError",t&&t.message),this._notifications.show(this._notifications.create.documentUploadGeneralError()))},e.prototype._handleClientError=function(e){var t=e.errorType;switch(this._telemetry.uploadDocument(!1,"clientError",r[t]),t){case r.documentTypeUnsupported:this._notifications.show(this._notifications.create.documentTypeUnsupported());break;case r.documentIsEmpty:this._notifications.show(this._notifications.create.documentIsEmpty());break;case r.documentSizeExceeded:this._notifications.show(this._notifications.create.documentSizeExceeded());break;case r.noFilesToUpload:this._notifications.showMessage("No files to upload!");break;case r.onlyOneDocumentAllowed:this._notifications.showMessage("Only one document upload at a time is allowed");break;default:a.assertNever(t)}},e.prototype._validateFile=function(e){var t=e?e[0]:null;return t?e&&e.length>1?r.onlyOneDocumentAllowed:u(t.name)?t.size?t.size>4194304?r.documentSizeExceeded:null:r.documentIsEmpty:r.documentTypeUnsupported:r.noFilesToUpload},e}();t.UploadModel=h},1356:function(e,t,n){"use strict";function r(e,t){function n(r){try{return e()}catch(e){if(r<t.length)return t[r](),n(r+1);throw e}}return n(0)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),i=n(7),s=function(){function e(e,t,n,r,s,a){void 0===s&&(s=i.LocalStorage.DenaliStorage.fromLocalStorage(i.LocalStorage.ls)),void 0===a&&(a=12096e5);var c=this;this._deserializeAlerts=e,this._serializeAlerts=t,this._storageNamePrefix=n,this._storageAlertVersion=r,this._storage=s,this._maxCacheAgeMs=a,this._log=o.Monitoring.Logging.getLogger("model.editor.alert_cache"),this._alertCacheKeyRe=new RegExp(i.StringUtils.escapeRegExp(this._getStorageKeyVersionedPrefix())+"-.+"),requestAnimationFrame(function(){try{c._pruneOldVersions()}catch(e){c._log.debug("could not clean old versions alerts",e)}})}return e.prototype._decodeCacheItem=function(e){var t=this,n=e.match(/([^;]+);([^;]+);([^;]+);(.*)/);if(!n)throw new TypeError("unexpected value content");var r=n.splice(1,5).map(function(e){return JSON.parse(e)}),o=r[0],s=r[1],a=r[2],c=r[3];if(void 0!==o&&"number"==typeof o&&void 0!==s&&void 0!==a&&"boolean"==typeof a&&void 0!==c&&Array.isArray(c)){var u=i.lazy(function(){return t._deserializeAlerts(c)});return{timeStamp:o,context:s,isFreeUser:a,get alerts(){return u.value}}}throw new TypeError("unexpected value content")},e.prototype._encodeCacheItem=function(e){var t=e.timeStamp,n=e.context,r=e.isFreeUser,o=e.alerts;return[t,n,r,this._serializeAlerts(o)].map(function(e){return JSON.stringify(e)}).join(";")},e.prototype._getStorageKeyVersionedPrefix=function(){return this._storageNamePrefix+this._storageAlertVersion},e.prototype._getStorageKeyForDoc=function(e){return this._getStorageKeyVersionedPrefix()+"-"+e},e.prototype._isAlertCacheKey=function(e){return this._alertCacheKeyRe.test(e)},e.prototype._isOldAlertCacheKey=function(e){return e.startsWith(this._storageNamePrefix)&&!e.startsWith(this._getStorageKeyVersionedPrefix())},e.prototype._saveAlerts=function(e,t,n,r){var o=this._encodeCacheItem({timeStamp:Date.now(),context:t,isFreeUser:n,alerts:r});this._storage.setItem(this._getStorageKeyForDoc(e),o)},e.prototype._loadAlerts=function(e,t,n){var r=this._storage.getItem(this._getStorageKeyForDoc(e));if(r.isEmpty())return null;var o=void 0;try{o=this._decodeCacheItem(r.get())}catch(t){try{this._removeAlerts(e)}catch(e){this._log.debug("could not remove broken cache item",e)}return null}if(o.isFreeUser===n&&o.context===t)return o.alerts;try{this._removeAlerts(e)}catch(e){this._log.debug("could not remove cache for a user of different type",e)}return null},e.prototype._removeAlerts=function(e){this._storage.removeItem(this._getStorageKeyForDoc(e))},e.prototype._pruneOldEditor=function(){var e=this;this._storage.getKeys().filter(function(e){return/matches_\d+/.test(e)}).forEach(function(t){return e._storage.removeItem(t)})},e.prototype._getAlertCacheKeys=function(){var e=this;return this._storage.getKeys().filter(function(t){return e._isAlertCacheKey(t)})},e.prototype._pruneOld=function(){var e=this,t=Date.now();this._getAlertCacheKeys().forEach(function(n){var r=e._storage.getItem(n);if(!r.isEmpty()){var o=void 0;try{o=e._decodeCacheItem(r.get())}catch(t){return void e._storage.removeItem(n)}t-o.timeStamp>e._maxCacheAgeMs&&e._storage.removeItem(n)}})},e.prototype._pruneAll=function(){var e=this;this._getAlertCacheKeys().forEach(function(t){return e._storage.removeItem(t)})},e.prototype._pruneOldVersions=function(){var e=this;this._storage.getKeys().filter(function(t){return e._isOldAlertCacheKey(t)}).forEach(function(t){return e._storage.removeItem(t)})},e.prototype.load=function(e,t,n){return this._loadAlerts(e,t,n)},e.prototype.hasCache=function(e,t,n){var r=this;return this._storage.getItem(this._getStorageKeyForDoc(e)).map(function(e){return r._decodeCacheItem(e)}).filter(function(e){return e.context===t&&e.isFreeUser===n}).map(function(e){return!0}).getOrElse(!1)},e.prototype.save=function(e,t,n,o){var i=this;try{return r(function(){return i._saveAlerts(e,t,n,o)},[function(){return i._pruneOldEditor()},function(){return i._pruneOld()},function(){return i._pruneAll()}])}catch(e){this._log.warn("Cannot write to localStorage",e)}},e.prototype.remove=function(e){this._removeAlerts(e)},e}();t.AlertCacheImpl=s},1357:function(e,t,n){"use strict";function r(e,t){var n=e.extra_properties&&e.extra_properties[t];return i.Option.of(n)}function o(e){var n=e.rawMatch,o=r(n,"source").filter(function(e){return"PUBLICATION"===e}),a=r(n,"title"),c=o.fold(function(){return i.Option.some("A part of your paper is matching some text from the web. Please make sure that this text is properly referenced.")},function(){return a.map(function(e){return'A part of your document is matching the publication "'+e+'."'})}),u=o.fold(function(){return i.Either.left({title:a,dateAccessed:t.parseDateAccessed(n.details)})},function(){return i.Either.right({mla:r(n,"reference_mla"),apa:r(n,"reference_apa"),chicago:r(n,"reference_chicago")})});return{title:"Unoriginal text: "+s.StringUtils.wordCount(n.text)+" words",description:c,url:r(n,"url").filter(function(e){return e.length>0}),reference:u}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(29),s=n(7);t.parseDateAccessed=function(e){void 0===e&&(e="");var t=e.match(/accessed\s(.*?)\)/);return i.Option.of(t).mapN(function(e){return e[1]})},t.parsePlagiarism=o},1358:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),o=n(12),i=n(7),s=function(){function e(e,t,n){void 0===t&&(t=1e3),void 0===n&&(n=function(e,t){return e===t}),this._commitLocalChanges=e,this._bufferTimeMsec=t,this._equals=n,this._localChangeSink=new r.Subject,this._localChangeHandleSub=null,this._localChangePending=o.Atom.create(!1),this._unsavedLocalChangeCount=o.Atom.create(0),this._flushSink=new r.Subject,this.hasUnsavedChanges=o.Atom.combine(this._localChangePending,this._unsavedLocalChangeCount,function(e,t){return e||0!==t})}return e.prototype._handleLocalContentChange=function(e){var t=this;return this._unsavedLocalChangeCount.modify(function(e){return e+1}),this._localChangePending.set(!1),this._commitLocalChanges(e).then(function(e){return t._unsavedLocalChangeCount.modify(function(e){return e-1})})},e.prototype._bufferLocalChangesSync=function(){var e=this;return this._localChangeSink.distinctUntilChanged(this._equals).do(function(t){return e._localChangePending.set(!0)}).sample(r.Observable.interval(this._bufferTimeMsec).merge(this._flushSink)).distinctUntilChanged(function(t,n){var r=e._equals(t,n);return r&&e._localChangePending.set(!1),r}).concatMap(function(t){return e._handleLocalContentChange(t)}).subscribe()},e.prototype.setLocalValue=function(e){this._localChangeSink.next(e)},e.prototype.startSyncing=function(){i.invariant(null===this._localChangeHandleSub,"already syncing"),this._localChangeHandleSub=this._bufferLocalChangesSync()},e.prototype.stopSyncing=function(){if(!this._localChangeHandleSub)throw new i.InvariantError("already not syncing");this._localChangeHandleSub.unsubscribe(),this._localChangeHandleSub=null},e.prototype.syncNow=function(){this._flushSink.next(void 0)},e}();t.BufferedRemoteSync=s},1359:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(12),i=n(5),s=n(194),a=n(7),c=n(540),u=n(542),l=n(292),h=n(48);t.defaultState={session:null,document:c.defaultState};var d=function(){function e(e,t,n,s,h,d,p,f,m,g,_){var y=this;this._state=e,this._dialectSettingsModel=t,this._doxApi=n,this._capiWsUrl=s,this._features=h,this._telemetry=d,this._modal=p,this._alertCache=f,this._wsConnectivity=m,this._connectivity=g,this._notifications=_,this._log=i.Monitoring.Logging.getLogger("model.editor.editor_page"),this._sessionState=this._state.lens("session"),this.currentSession=o.Atom.create(null),this._doStartSession=function(e){return r.__awaiter(y,void 0,void 0,function(){var t,n,o,i,s,a,h;return r.__generator(this,function(r){switch(r.label){case 0:return t=new c.DocumentModelImpl(e,this._state.lens("document"),this._doxApi,this._doxConnectivity,this._connectivity.networkOnline,this._features.isUserTesting),[4,t.startSession()];case 1:return n=r.sent(),o=n.documentSession,i=n.initialGenre,s=n.initialChecks,this._sessionState.set(u.createDefaultState(i,s,this._features.defaultAcademicGenre.get().enabled)),a=this._sessionState,h=new u.EditorSessionImpl(a,o,new l.TextStatsModelImpl(a.lens("textStats")),this._capiWsUrl,this._dialectSettingsModel,this._features,this._telemetry,this._alertCache,this._capiConnectivity),this._telemetry.documentShow(e.toString()),[2,h]}})})},this._connectionManager=new a.ConnectionManager(this._doStartSession,function(e){return e.end()},this.currentSession),this._capiConnectivity=o.Atom.create({type:"init"}),this._doxConnectivity=o.Atom.create({type:"init"}),this._subs=[]}return e.prototype.startSession=function(e){var t=this;if(isNaN(Number(e)))throw new Error("Invalid documentId");var n=o.Atom.create(a.Async.defaultValue());this._subs=[a.Async.OperationRetrier.create(function(){return t._connectionManager.terminate(),t._connectionManager.connect(e)},n,a.Async.OperationRetrier.RetryStrategy.conditional(this._retryWhen,a.Async.OperationRetrier.RetryStrategy.linear(5,3e3))),n.filter(function(e){return a.Async.isError(e)&&3===e.attempt||a.Async.isFatal(e)}).subscribe(function(e){t._doxConnectivity.set({type:"error",reason:"session open",error:e.error})}),n.filter(a.Async.isOk).take(1).subscribe(function(){t._doxConnectivity.set({type:"success"})}),this._connectivity.networkOnline.subscribe(function(e){return e?t.listenConnectivity():t.clearConnectivityListener()})]},e.prototype.endSession=function(){this._subs.forEach(function(e){return e.unsubscribe}),this._subs=[],this.clearConnectivityListener(),this._connectionManager.terminate()},e.prototype._doxErrorHandler=function(e){var t=e.reason,n=e.error,r={reason:t};if(n)if(n instanceof h.HTTPError)this._httpErrorHandler(n.code,t,n);else if(n instanceof h.WSError)this._wsErrorHandler(n.code,t,n);else if(n instanceof h.OTRemoveError)this._log.info("DOX connectivity error: reset message",n,r);else if(n instanceof s.FetchError){var o="clientConnectionError";this._log.warn("DOX connectivity error: "+o,n,r),this._connectivity.setState({type:"dox",state:{type:o}})}else{var o="unknownConnectionError";this._log.error("DOX connectivity error: "+o,n,r),this._connectivity.setState({type:"dox",state:{type:o}})}else this._log.error("DOX connectivity error: unknown",r)},e.prototype._httpErrorHandler=function(e,t,n){var r=this,o={code:e,reason:t},i=function(e){r._log.error("DOX connectivity error: "+e,n,o),r._connectivity.setState({type:"dox",state:{type:e}})};switch(e){case h.DoxErrors.DoxHttpErrorCodes.NOT_FOUND:this._log.info("DOX connectivity error",n,o),this._modal.show({type:"documentNotFound"});break;case h.DoxErrors.DoxHttpErrorCodes.UNAUTHORIZED:i("unauthorized");break;case h.DoxErrors.DoxHttpErrorCodes.TOO_MANY_REQUESTS:this._log.warn("Too many requests",n,o),this._notifications.show(this._notifications.create.error());break;default:i(a.isServerErrorCode(e)?"serverError":"unknownConnectionError")}},e.prototype._wsErrorHandler=function(e,t,n){var r=this,o={code:e,reason:t},i=function(e){r._log.error("WS DOX connectivity error: "+e,n,o),r._wsConnectivity.setState({type:"wsDox",state:{type:e}})};switch(e){case h.DoxErrors.DoxWsErrorCodes.NOT_FOUND:this._log.info("WS DOX connectivity error",n,o),this._modal.show({type:"documentNotFound"});break;case h.DoxErrors.DoxWsErrorCodes.UNAUTHORIZED:i("unauthorized");break;case h.DoxErrors.DoxWsErrorCodes.BLOCKED_BY_CLIENT:i("blockedByClient");break;default:i([0,-1,1005,1006].indexOf(e)>0?"unknownConnectionError":"serverError")}},e.prototype.listenConnectivity=function(){var e=this;this._connectivitySubs=[this._doxConnectivity.distinctUntilChanged(function(e,t){return e instanceof h.WSError&&t instanceof h.WSError&&e===t}).subscribe(function(t){switch(t.type){case"error":e._doxErrorHandler(t);break;case"success":e._connectivity.setState({type:"dox",state:{type:"online"}}),e._wsConnectivity.setState({type:"wsDox",state:{type:"online"}});break;case"init":break;default:a.assertNever(t)}}),this._capiConnectivity.subscribe(function(t){switch(t.type){case"connected":e._wsConnectivity.setState({type:"wsCapi",state:{type:"online"}});break;case"disconnected":e._log.warn("CAPI disconnected",t.error),e._wsConnectivity.setState({type:"wsCapi",state:{type:"offline"}});break;case"init":break;default:a.assertNever(t)}})]},e.prototype.clearConnectivityListener=function(){this._connectivitySubs&&(this._connectivitySubs.map(function(e){return e.unsubscribe()}),this._connectivitySubs=[]),this._wsConnectivity.setState({type:"wsDox",state:{type:"online"}}),this._wsConnectivity.setState({type:"wsCapi",state:{type:"online"}}),this._doxConnectivity.set({type:"init"}),this._capiConnectivity.set({type:"init"}),this._connectivity.setState({type:"dox",state:{type:"online"}})},e.prototype._retryWhen=function(e){return e instanceof h.HTTPError?a.isServerErrorCode(e.code)||0===e.code:!(e instanceof h.WSError)||e.code<4e3},e}();t.EditorPageModelImpl=d},1360:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(60),o=n(544),i=n(12),s=function(){function e(e,t,n){var r=this;this._synonymsModel=e,this._es=t,this._apply=n,this.viewState=i.Atom.create(null),this._synonymsModel.state.subscribe(function(e){o.SynonymsModel.isReady(e)&&void 0!==e.synonyms&&r.viewState.set({synonymsState:e,popupVisible:!1})})}return e.prototype.apply=function(e){var t=this.viewState.get();null!==t&&o.SynonymsModel.isReady(t.synonymsState)&&void 0!==t.synonymsState.synonyms&&this._apply(t.synonymsState.synonyms.alert,t.synonymsState.query,e),this.hide()},e.prototype.showPopup=function(){r.invariant(o.SynonymsModel.isReady(this._synonymsModel.state.get()));var e=this._synonymsModel.state.get().query;this._es().highlightSynonym(e.start,e.word),this.viewState.modify(function(e){return null===e?null:{cursorPosition:e.cursorPosition,wordPosition:e.wordPosition,popupVisible:!0,synonymsState:e.synonymsState}})},e.prototype.hidePopup=function(){this.viewState.modify(function(e){return null===e?null:{cursorPosition:e.cursorPosition,popupVisible:!1,synonymsState:e.synonymsState}})},e.prototype.showButton=function(e){this.hide(),this._synonymsModel.query(e)},e.prototype.hide=function(){this._synonymsModel.abortQuery(),this.viewState.set(null)},e.prototype.move=function(e,t){this.viewState.modify(function(n){return null===n?null:{cursorPosition:e,wordPosition:t,popupVisible:n.popupVisible,synonymsState:n.synonymsState}})},e}();t.SynonymsViewModelImpl=s},1361:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(7),s=function(){function e(e,t,n,r,i){this._browser=e,this._chromeUrl=t,this._firefoxUrl=n,this._firefoxIconUrl=r,this._notifications=i,this._log=o.Monitoring.Logging.getLogger("model.extInstall")}return e.prototype._installChromeExtension=function(){var e=this;return new Promise(function(t,n){return window.chrome.webstore.install(e._chromeUrl,function(){i.Cookie.setInstallSourceCookie(),t(!0)},function(e,t){return n({err:e,errorCode:t})})})},e.prototype.install=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t,n,o=this;return r.__generator(this,function(r){switch(r.label){case 0:switch(e=this._browser){case"chrome":return[3,1];case"firefox":return[3,4];case"safari":case"edge":return[3,5]}return[3,6];case 1:return r.trys.push([1,3,,4]),[4,this._installChromeExtension()];case 2:return[2,r.sent()];case 3:return t=r.sent(),"userCancelled"===t.errorCode?this._log.warn("chrome extension install cancelled"):(n=t||new Error("banner: Click on install error is undefined"),this._log.error("chrome extension install failed",{error:n}),this._notifications.show(this._notifications.create.extensionInstallFailed())),[2,!1];case 4:return i.Cookie.setInstallSourceCookie(),window.InstallTrigger.install({Grammarly:{URL:this._firefoxUrl,IconURL:this._firefoxIconUrl,toString:function(){return o._firefoxUrl}}}),[2,!0];case 5:return[2,!0];case 6:throw new TypeError("Unexpected input in browser variable: "+this._browser)}})})},e}();t.ExtensionInstallModelImpl=s},1362:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultState={visible:!1,opts:{type:null}};var r=function(){function e(e,t,n){this._state=e,this.os=t,this.notifications=n,this.state=this._state.view()}return e.prototype.show=function(e){this._state.set({visible:!0,opts:e})},e.prototype.hide=function(){this._state.set(t.defaultState)},e}();t.ModalDialogModelImpl=r;var o=function(){function e(e){this._state=e,this.state=this._state.view()}return e.prototype.show=function(){this._state.set({visible:!0})},e.prototype.hide=function(){this._state.set({visible:!1})},e}();t.ModalOverlayModelImpl=o},1363:function(e,t,n){"use strict";function r(e,t,n,r){var s=3,a="windows"===n,c="mac"===n;return r&&!i.isAddinInstalled(e)&&a||s--,r&&!e.has(o.UserGroups.DESKTOP_EDITOR_INSTALLED)&&(a||c)||s--,i.isExtensionInstalled()&&s--,i.isBrowserHasExtension(t)||s--,s}Object.defineProperty(t,"__esModule",{value:!0});var o=n(118),i=n(197),s=["chrome","firefox","safari"],a=function(){function e(e,t,n){this.features=e,this._browser=t,this._os=n,this._showDesktopApps=this.features.desktopApps.get().enabled,this._appsSection=this.features.appsSection.get().enabled}return e.prototype.getAppsCount=function(e){return r(e,this._browser,this._os,this._showDesktopApps)},e.prototype.isAppsVisible=function(){var e=this;return this._appsSection&&(this._showDesktopApps||s.some(function(t){return t===e._browser}))},e}();t.NavigationBarModelImpl=a},1364:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(27),i=function(){function e(){this._dismissStream=new o.Subject}return e.prototype.dismiss=function(){this._cancel()},e.prototype.remind=function(){this._cancel()},e.prototype.cancel=function(){this._cancel()},e.prototype._cancel=function(){this._dismissStream.next(!1)},e}();t.ProofitBanner=i;var s=function(e){function t(t,n){var r=e.call(this)||this;return r._proofit=t,r._goToDocument=n,r._proofitStream=r._proofit.do(function(e){var t=e.id;return r._id=t}).map(function(e){return null!==e.id}),r.state=r._dismissStream.merge(r._proofitStream).distinctUntilChanged(),r}return r.__extends(t,e),t.prototype.install=function(){this.cancel(),this._id&&this._goToDocument(this._id)},t}(i);t.CancelledBanner=s;var a=function(e){function t(t){var n=e.call(this)||this;return n._proofitState=t,n.proofit=n._dismissStream.mapTo(null).merge(n._proofitState.map(function(e){return e})).distinctUntilChanged(),n}return r.__extends(t,e),t.prototype.install=function(){this.cancel()},t}(i);t.CompletedBanner=a},1365:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(287),o=n(27),i=n(12),s=n(5),a=n(194),c=n(7),u=n(80),l=function(){function e(e,t){var n=this;this._router=e,this._selfUpdate=t,this._logger=s.Monitoring.Logging.getLogger("router"),u.buildInfo.version&&setInterval(function(){return n.handleUpdate(e,u.buildInfo.version)},this._selfUpdate.versionCheckInterval)}return e.prototype.getVersion=function(){var e=this,t=i.Atom.create(c.Async.defaultValue());return c.Async.OperationRetrier.create(function(){return a.RxFetch.request(e._selfUpdate.versionFilePath).then(function(e){return e.json()})},t,c.Async.OperationRetrier.RetryStrategy.linear(this._selfUpdate.retryFailedVersionCheckLimit,this._selfUpdate.retryFailedVersionCheckInterval)),t.filter(c.Async.isTerminated).first().toPromise().then(function(e){if(c.Async.isFatal(e))throw e.error;return e.value}).catch(function(t){return e._logger.warn("forceReload.getVersion failed",t)})},e.prototype.handleUpdate=function(e,t){var n=this;this.getVersion().then(function(i){r.lt(t,i.minimalVersion)?(o.Observable.fromEvent(document,"visibilitychange").switchMap(function(){return"hidden"===document.visibilityState?o.Observable.of(!0).delay(n._selfUpdate.forceUpdateOnHiddenDelay):o.Observable.never()}).first().subscribe(e.forceReload),e.scheduleForceReload()):r.lt(t,i.currentVersion)&&setTimeout(e.scheduleForceReload,n._selfUpdate.latestVersionDelay)}).catch(function(e){return n._logger.warn("forceReload.handleUpdate failed",e)})},e}();t.SelfUpdate=l},1366:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(12),i=n(617),s=n(618),a=n(5),c=n(205),u=function(e,t){return new Promise(function(n,r){return e(t,function(e,t){if(e)return r(e);n(t)})})},l="braintree-hosted-fields-invalid",h=function(){function e(e,t,n){var h=this;this._notificationModel=e,this._irbisApi=t,this._updateSubscriptionState=n,this._log=a.Monitoring.Logging.getLogger("model.subscription.braintree"),this._braintreeInitializedInCreditCardForm=o.Atom.create(!1),this._teardownInProgress=!1,this.braintreeInitializedInCreditCardForm=this._braintreeInitializedInCreditCardForm.view(),this.updateCreditCard=function(e){return new Promise(function(t,n){h._hostedFields.tokenize(function(r,o){if(r){var i=h._hostedFields.getState().fields;return Object.keys(i).forEach(function(e){i[e].isValid||i[e].container.classList.add(l)}),void n(r)}o||n(r),h._irbisApi.updateCreditCard(o.nonce,e).then(function(){return Object.keys(h._hostedFields.getState().fields).forEach(function(e){return h._hostedFields.clear(e)}),t()}).then(h._updateSubscriptionState).catch(n)})})},this.getBraintreeClient=function(){return r.__awaiter(h,void 0,void 0,function(){var e,t;return r.__generator(this,function(n){switch(n.label){case 0:return this._braintreeClient?[2,this._braintreeClient]:[4,this._generateCardToken()];case 1:return e=n.sent(),[4,u(i.create,{authorization:e})];case 2:return t=n.sent(),this._braintreeClient=t,[2,t]}})})},this.initInCreditCardForm=function(e){return r.__awaiter(h,void 0,void 0,function(){var t,n,o,i;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),this._notificationModel.clearNotification(),[4,this.getBraintreeClient()];case 1:return t=r.sent(),n={client:t,styles:e.styles,fields:e.fields},[4,u(s.create,n)];case 2:return o=r.sent(),this._hostedFields=o,this._braintreeInitializedInCreditCardForm.set(!0),[3,4];case 3:return(i=r.sent())&&"HOSTED_FIELDS_INVALID_FIELD_SELECTOR"!==i.code?[2]:(this._notificationModel.setNotification(c.SubscriptionNotificationType.unknownError),[3,4]);case 4:return[2]}})})},this.cleanupInCreditCardForm=function(){try{if(h._notificationModel.clearNotification(),h._teardownInProgress)return;return h._teardownInProgress=!0,h._hostedFields&&h._hostedFields.teardown(function(e){h._teardownInProgress=!1,e?h._log.error("Could not tear down Hosted Fields!",e):h._braintreeInitializedInCreditCardForm.set(!1)})}catch(e){h._log.warn("Braintree teardown error",e)}}}return e.prototype._generateCardToken=function(){return r.__awaiter(this,void 0,void 0,function(){var e;return r.__generator(this,function(t){switch(t.label){case 0:return[4,this._irbisApi.generateTokenCreditCard()];case 1:return e=t.sent().requestId,[4,this._irbisApi.getTokenRequest(e)];case 2:return[2,t.sent()]}})})},e}();t.BraintreeModelImpl=h},1367:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(7),s=n(205),a=function(){function e(e,t,n){this._notificationModel=e,this._irbisApi=t,this._updateSubscriptionState=n,this._log=o.Monitoring.Logging.getLogger("model.subscription.PayPal")}return e.prototype.initialize=function(e){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this._initialize(e)];case 1:return n.sent(),[4,this._generateToken()];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this._log.error("paypal init error",t),this._notificationModel.setNotification(s.SubscriptionNotificationType.paypalError),[3,4];case 4:return[2]}})})},e.prototype.update=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t;return r.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this._token?[3,2]:[4,this._generateToken()];case 1:n.sent(),n.label=2;case 2:return[4,this._irbisApi.getPaypalRedirectPageRequest(this._token)];case 3:if(!(e=n.sent()))throw new Error("Irbis return undefined paypal url");return document.location.href=e,[4,i.delay(5e3)];case 4:return n.sent(),[3,6];case 5:return t=n.sent(),this._log.error("paypal update error",t),this._notificationModel.setNotification(s.SubscriptionNotificationType.paypalError),[3,6];case 6:return[2]}})})},e.prototype._initialize=function(e){var t=e.token,n=e.paypal;return r.__awaiter(this,void 0,void 0,function(){var e=this;return r.__generator(this,function(o){return t.map(function(t){return r.__awaiter(e,void 0,void 0,function(){return r.__generator(this,function(e){switch(e.label){case 0:return[4,this._irbisApi.updatePaypal(t)];case 1:return e.sent(),[4,this._updateSubscriptionState()];case 2:return e.sent(),[2]}})})}),n.map(function(e){return"ok"===e.toLowerCase()?s.SubscriptionNotificationType.paypalSuccess:s.SubscriptionNotificationType.paypalError}).map(this._notificationModel.setNotification),[2]})})},e.prototype._generateToken=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t;return r.__generator(this,function(n){switch(n.label){case 0:return e=this._generateLinks(),[4,this._irbisApi.generateTokenPaypal(e)];case 1:return t=n.sent().requestId,this._token=t,[2]}})})},e.prototype._generateLinks=function(){var e=document.location.protocol+"//"+document.location.host+document.location.pathname.replace(/\/$/,"");return{cancelUrl:e+"?paypal=error",returnUrl:e+"?paypal=ok"}},e}();t.PayPalModelImpl=a},1368:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(146),s=n(302),a=n(915),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.back=function(){window.history.back()},t.prototype.render=function(){return o.createElement(i.BasePage,{title:"Page not found | Grammarly"},o.createElement("div",null,o.createElement(s.Logo,{mainPageUrl:this.context.appConfig.funnel.mainPage}),o.createElement("div",{className:a.header},o.createElement("div",{className:a.headOne},"Sorry, we couldn’t find that ",this.props.requestedData),o.createElement("div",{className:a.headSub},o.createElement("span",{className:a.sub},"We can’t get you there from here, but here are some options that might help you get back on track:"))),o.createElement("div",{className:a.linkWrapper},o.createElement("span",{className:a.home},"Go to the"," ",o.createElement("a",{"data-name":"linkHomePage",className:a.link,href:this.context.appConfig.funnel.mainPage},"Grammarly Homepage"))),o.createElement("div",{className:a.linkWrapper},o.createElement("span",{className:a.back},"Return to"," ",o.createElement("a",{"data-name":"linkBackPage",className:a.link,onClick:this.back},"Previous Page"))),o.createElement("div",{className:a.linkWrapper},o.createElement("span",{className:a.support},"Contact"," ",o.createElement("a",{"data-name":"linkSupportPage",className:a.link,href:this.context.appConfig.support.mainPage},"Grammarly Support")))))},t}(i.BaseComponent);t.Error404Page=c},1369:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(615),n(1387),n(917);var r=n(209);try{"edge"===r().browser&&(window.fetch=null)}catch(e){}n(386)},1370:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(1375);t.errorSource={client:"client",server:"server"},t.accountType={free:"free",premium:"premium"};var s=function(){function e(e,t){var n=this;this._gnar=e,this._clientName=t,this._eventLogger=o.Monitoring.Logging.getLogger("events.tracking"),this._exceptionLogger=o.Monitoring.Logging.getLogger("exceptions"),this._unhandledLogger=this._exceptionLogger.getLogger("unhandled"),this._tsRoot=o.Monitoring.TimeSeries.root,this.getContainerId=function(){return n._gnar.getContainerId()},this._failedToFetch="Failed to fetch",this._rejections=new Map,o.Monitoring.Logging.root.debug("Starting telemetry"),window.addEventListener("error",this._unhandledError.bind(this)),window.addEventListener("unhandledrejection",this._unhandledRejection.bind(this)),window.addEventListener("rejectionhandled",this._rejectionHandled.bind(this)),document.addEventListener("visibilitychange",this._visibilityChanged.bind(this)),this._visibilityChanged(),window.screen&&o.Monitoring.Logging.getLogger("userStats").info("Screen",{size:window.screen.width+"x"+window.screen.height})}return e.prototype.setUser=function(e,t){o.Monitoring.Logging.root.context.add({user:{id:e}}),this._gnar.setUser(e,t),this._logEvent("setUser"),this._tsRoot.getCounter("userChanged").increment()},e.prototype._track=function(e,t){return void 0===t&&(t={}),this._gnar.track(r.__assign({eventName:this._clientName+"/"+e},t))},e.prototype.documentListOpened=function(){this._logEvent("myGrammarly-page-show"),this._track("myGrammarly-page-show")},e.prototype.deleteDocument=function(e){this._logEvent("deleteDocument-button-click",{docId:e}),this._track("deleteDocument-button-click")},e.prototype.uploadDocument=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=""),this._logEvent("uploadDocument-form-submit",{isSuccess:e,errorSource:t,errorMessage:n}),this._track("uploadDocument-form-submit",{isSuccess:e,errorSource:t,errorMessage:n})},e.prototype.downloadDocument=function(e){this._logEvent("downloadDocument-button-click",{docId:e}),this._track("downloadDocument-button-click")},e.prototype.copyDocument=function(e){this._logEvent("copyDocument-button-click",{docId:e}),this._track("copyDocument-button-click")},e.prototype.newDocument=function(){this._logEvent("newDocument-button-click"),this._track("newDocument-button-click")},e.prototype.documentShow=function(e){this._logEvent("document-page-show",{docId:e}),this._track("document-page-show"),this._tsRoot.getCounter("documentPageShow").increment()},e.prototype.reportOpened=function(e){this._logEvent("detailedReport-page-show",{score:e}),this._track("detailedReport-page-show")},e.prototype.reportDownload=function(e){this._logEvent("detailedReportDownload-button-click",{score:e}),this._track("detailedReportDownload-button-click")},e.prototype.settingsToggled=function(e,t){this._logEvent("setting-toggle-click",{isEnabled:e,settingName:t}),this._track("setting-toggle-click",{isEnabled:e,settingName:t})},e.prototype.documentGenreSelected=function(e){this._logEvent("documentGenre-button-click",{documentGenre:e}),this._track("documentGenre-button-click",{documentGenre:e})},e.prototype.profileOpened=function(){this._logEvent("profile-page-show"),this._track("profile-page-show")},e.prototype.accountOpened=function(){this._logEvent("account-page-show"),this._track("account-page-show")},e.prototype.supportClicked=function(){this._logEvent("support-link-click"),this._track("support-link-click")},e.prototype.deleteAccountButtonClicked=function(e){this._logEvent("deleteAccount-button-click",{accountType:e}),this._track("deleteAccount-button-click",{accountType:e})},e.prototype.keepAccountButtonClicked=function(e){this._logEvent("keepAccount-button-click",{accountType:e}),this._track("keepAccount-button-click",{accountType:e})},e.prototype.deleteAccountFormSubmit=function(e,t,n,r){void 0===n&&(n=""),void 0===r&&(r=""),this._logEvent("deleteAccount-form-submit",{isSuccess:e,accountType:t,errorSource:n,errorMessage:r}),this._track("deleteAccount-form-submit",{isSuccess:e,accountType:t,errorSource:n,errorMessage:r})},e.prototype.cancelFutureBillingClicked=function(){this._logEvent("cancelFutureBilling-button-click"),this._track("cancelFutureBilling-button-click")},e.prototype.confirmSubscriptionCancelClicked=function(){this._logEvent("confirmSubscriptionCancel-button-click"),this._track("confirmSubscriptionCancel-button-click")},e.prototype.continueUsingGrammarlyClicked=function(){this._logEvent("continueUsingGrammarly-button-click"),this._track("continueUsingGrammarly-button-click")},e.prototype.reactivateSubscriptionClicked=function(){this._logEvent("reactivateSubscription-button-click"),this._track("reactivateSubscription-button-click")},e.prototype.downloadReceiptButtonClicked=function(){this._logEvent("downloadReceipt-form-submit"),this._track("downloadReceipt-form-submit",{isSuccess:!0})},e.prototype.downloadReceiptError=function(e){this._exceptionLogger.error("downloadReceipt-form-error",e),this._track("downloadReceipt-form-submit",{isSuccess:!1,errorSource:t.errorSource.client,errorMessage:e.message})},e.prototype.appsPageShown=function(){this._logEvent("apps-page-show"),this._track("apps-page-show")},e.prototype.installAppClicked=function(e){this._logEvent("installApp-button-click",{app:e}),this._track("installApp-button-click",{app:e})},e.prototype.learnMoreClicked=function(e){this._logEvent("learnMoreAboutApp-button-click",{app:e}),this._track("learnMoreAboutApp-button-click",{app:e})},e.prototype.bannerActionClicked=function(e,t){this._logEvent("bannerMainAction-button-click",{bannerType:e,cta:t}),this._track("bannerMainAction-button-click",{bannerType:e,cta:t})},e.prototype.bannerCloseClicked=function(e){this._logEvent("bannerClose-button-click",{bannerType:e}),this._track("bannerClose-button-click",{bannerType:e})},e.prototype.bannerDismissClicked=function(e){this._logEvent("bannerDismiss-button-click",{bannerType:e}),this._track("bannerDismiss-button-click",{bannerType:e})},e.prototype.bannerLaterClicked=function(e){this._logEvent("bannerRemindLater-button-click",{bannerType:e}),this._track("bannerRemindLater-button-click",{bannerType:e})},e.prototype.bannerNotificationShow=function(e){this._logEvent("banner-notification-show",{bannerType:e}),this._track("banner-notification-show",{bannerType:e})},e.prototype.dictionaryOpened=function(){this._logEvent("dictionary-page-show"),this._track("dictionary-page-show")},e.prototype.addToDictionary=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=""),this._logEvent("addToDictionary-button-click",{isSuccess:e,errorSource:t,errorMessage:n}),this._track("addToDictionary-button-click")},e.prototype.removeFromDictionary=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=""),this._logEvent("removeFromDictionary-button-click",{isSuccess:e,errorSource:t,errorMessage:n}),this._track("removeFromDictionary-button-click")},e.prototype.languageOpened=function(){this._logEvent("language-page-show"),this._track("language-page-show")},e.prototype.showTour=function(e){this._logEvent("tour-popup-show",{theme:e}),this._track("tour-popup-show",{theme:e})},e.prototype.closeTour=function(e){this._logEvent("tour-popup-close",{theme:e}),this._track("tour-popup-close",{theme:e})},e.prototype.showTutorial=function(){this._logEvent("tutorial-popup-show"),this._track("tutorial-popup-show")},e.prototype.closeTutorial=function(){this._logEvent("tutorial-popup-close"),this._track("tutorial-popup-close")},e.prototype._getExtraProps=function(e){return e.reason||o.EventProps.fromAny(e)},e.prototype._logUnhandledPromiseRejection=function(e,t,n){var r=this._exceptionLogger.getLogger("unhandled.promiseRejection");("error"===e?r.error:r.warn).bind(r)("Unhandled rejection at promise: "+t,this._getExtraProps(n))},e.prototype._unhandledError=function(e){var t=e.error?e.error.message:e.message,n=i.isExternalException(e),r=n?o.Logging.LogLevel.INFO:o.Logging.LogLevel.ERROR,s=n?"unknownUnhandledError":"unhandledError";this._tsRoot.getCounter(s).increment();var a=e.reason;this._unhandledLogger.log(r,"Unhandled exception at "+e.filename+":"+e.lineno+":"+e.colno+" \n"+t,e.error,a&&{reason:a})},e.prototype._isEventSimulated=function(e){return!1===e.isTrusted},e.prototype._isExternalPromiseRejection=function(e,t){return i.isExternalException(e)||i.isExternalExceptionMessage(t)||this._isEventSimulated(e)},e.prototype._unhandledRejection=function(e){this._rejections.set(e.promise,Date.now());var t=e.reason?e.reason.message:e.message;this._isExternalPromiseRejection(e,t)?this._tsRoot.getCounter("unknownUnhandledPromise").increment():t===this._failedToFetch?this._logUnhandledPromiseRejection(e.reason&&e.reason.isRxFetch?"error":"warn",t,e):(this._logUnhandledPromiseRejection("error",t,e),this._tsRoot.getCounter("unhandledPromise").increment())},e.prototype._rejectionHandled=function(e){var t=this._rejections.get(e.promise);this._rejections.delete(e.promise);var n=e.reason?e.reason.message:e.message;this._exceptionLogger.getLogger("handled.promiseRejection").error("Rejection handled at promise: "+n+" in "+(t?Date.now()-t:NaN)+" ms",e.reason)},e.prototype._visibilityChanged=function(){o.Monitoring.Logging.root.context.add({visibilityState:document.visibilityState})},e.prototype._logEvent=function(e,t){void 0===t&&(t={}),this._eventLogger.info(e,t)},e}();t.EditorTelemetry=s},1371:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(547),i=function(){function e(){}return e.prototype.track=function(e){var t=o.ls.getItem("trackingGnar")||"",n=e.eventName,i=r.__rest(e,["eventName"]),s=0===Object.keys(i).length?"":":"+JSON.stringify(i);try{o.ls.setItem("trackingGnar",(t?t+"_&&_":"")+n+s)}catch(e){}return Promise.resolve()},e.prototype.pingMaybe=function(){},e.prototype.page=function(e,t){},e.prototype.setUser=function(e,t){},e.prototype.getContainerId=function(){return Promise.resolve("dummy_container_id")},e}();t.DummyGnarClient=i},1372:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.gnar=e}return e.prototype.subscriptionSummaryPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/subscriptionSummary-page-show",object:"page",objectId:"subscriptionSummary",pageId:e,url:t})},e.prototype.deleteAccountButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/deleteAccount-button-click",object:"button",objectId:"deleteAccount",accountType:e,pageId:t})},e.prototype.professionalProofreadingButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/professionalProofreading-button-click",isDenali:!0,object:"button",objectId:"professionalProofreading",pageId:e,placements:t})},e.prototype.settingToggleClick=function(e,t,n){return this.gnar.track({action:"click",eventName:"editor/setting-toggle-click",object:"toggle",objectId:"setting",isEnabled:e,pageId:t,settingName:n})},e.prototype.entireDocumentCopy=function(e){return this.gnar.track({action:"copy",eventName:"editor/entire-document-copy",object:"document",objectId:"entire",pageId:e})},e.prototype.performanceScoreButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/performanceScore-button-click",isDenali:!0,object:"button",objectId:"performanceScore",pageId:e})},e.prototype.newDocumentButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/newDocument-button-click",object:"button",objectId:"newDocument",pageId:e})},e.prototype.extensionPopupPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/extensionPopup-page-show",object:"page",objectId:"extensionPopup",pageId:e,url:t})},e.prototype.subscriptionManagePageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/subscriptionManage-page-show",object:"page",objectId:"subscriptionManage",pageId:e,url:t})},e.prototype.entireDocumentPaste=function(e){return this.gnar.track({action:"paste",eventName:"editor/entire-document-paste",object:"document",objectId:"entire",pageId:e})},e.prototype.tutorialPopupClose=function(e){return this.gnar.track({action:"close",eventName:"editor/tutorial-popup-close",object:"popup",objectId:"tutorial",pageId:e})},e.prototype.advancedIssuesSidebarShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/advancedIssues-sidebar-show",isDenali:!0,object:"sidebar",objectId:"advancedIssues",pageId:e,withItemizedIssues:t})},e.prototype.subscriptionCancelDonePageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/subscriptionCancelDone-page-show",object:"page",objectId:"subscriptionCancelDone",pageId:e,url:t})},e.prototype.bannerMainActionButtonClick=function(e,t,n){return this.gnar.track({action:"click",eventName:"editor/bannerMainAction-button-click",object:"button",objectId:"bannerMainAction",bannerType:e,cta:t,pageId:n})},e.prototype.referralNotificationShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/referral-notification-show",object:"notification",objectId:"referral",pageId:e,placement:t})},e.prototype.referralNotificationClose=function(e,t){return this.gnar.track({action:"close",eventName:"editor/referral-notification-close",object:"notification",objectId:"referral",pageId:e,placement:t})},e.prototype.bannerCloseButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/bannerClose-button-click",object:"button",objectId:"bannerClose",bannerType:e,pageId:t})},e.prototype.documentStatisticsButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/documentStatistics-button-click",isDenali:!0,object:"button",objectId:"documentStatistics",pageId:e})},e.prototype.addToDictionaryButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/addToDictionary-button-click",object:"button",objectId:"addToDictionary",pageId:e})},e.prototype.downloadButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/download-button-click",isDenali:!0,object:"button",objectId:"download",pageId:e})},e.prototype.installAppButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/installApp-button-click",object:"button",objectId:"installApp",app:e,pageId:t})},e.prototype.deleteDocumentButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/deleteDocument-button-click",object:"button",objectId:"deleteDocument",pageId:e})},e.prototype.keepAccountButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/keepAccount-button-click",object:"button",objectId:"keepAccount",accountType:e,pageId:t})},e.prototype.editPasswordFormSuccess=function(e){return this.gnar.track({action:"success",eventName:"editor/editPassword-form-success",object:"form",objectId:"editPassword",pageId:e})},e.prototype.deleteAccountFormSuccess=function(e,t){return this.gnar.track({action:"success",eventName:"editor/deleteAccount-form-success",object:"form",objectId:"deleteAccount",accountType:e,pageId:t})},e.prototype.copyToClipboardButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/copyToClipboard-button-click",isDenali:!0,object:"button",objectId:"copyToClipboard",pageId:e})},e.prototype.documentGenreButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/documentGenre-button-click",object:"button",objectId:"documentGenre",documentGenre:e,pageId:t})},e.prototype.setGoalsButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/setGoals-button-click",isDenali:!0,object:"button",objectId:"setGoals",pageId:e})},e.prototype.downloadDocumentButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/downloadDocument-button-click",object:"button",objectId:"downloadDocument",pageId:e})},e.prototype.editNameButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/editName-button-click",object:"button",objectId:"editName",pageId:e})},e.prototype.notAuthorizedUserSignout=function(e){return this.gnar.track({action:"signout",eventName:"editor/notAuthorized-user-signout",object:"user",objectId:"notAuthorized",pageId:e})},e.prototype.continueUsingGrammarlyButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/continueUsingGrammarly-button-click",object:"button",objectId:"continueUsingGrammarly",pageId:e})},e.prototype.appsPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/apps-page-show",object:"page",objectId:"apps",pageId:e,url:t})},e.prototype.reactivateSubscriptionButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/reactivateSubscription-button-click",object:"button",objectId:"reactivateSubscription",pageId:e})},e.prototype.lensSidebarShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/lens-sidebar-show",isDenali:!0,object:"sidebar",objectId:"lens",lensName:e,pageId:t})},e.prototype.tourPopupShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/tour-popup-show",object:"popup",objectId:"tour",pageId:e,theme:t})},e.prototype.tourPopupClose=function(e,t){return this.gnar.track({action:"close",eventName:"editor/tour-popup-close",object:"popup",objectId:"tour",pageId:e,theme:t})},e.prototype.assistantOpenButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/assistantOpen-button-click",isDenali:!0,object:"button",objectId:"assistantOpen",pageId:e,placement:t})},e.prototype.bannerRemindLaterButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/bannerRemindLater-button-click",object:"button",objectId:"bannerRemindLater",bannerType:e,pageId:t})},e.prototype.supportLinkClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/support-link-click",object:"link",objectId:"support",pageId:e,placement:t})},e.prototype.cancelFutureBillingButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/cancelFutureBilling-button-click",object:"button",objectId:"cancelFutureBilling",pageId:e})},e.prototype.dismissAllButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/dismissAll-button-click",isDenali:!0,object:"button",objectId:"dismissAll",lensName:e,pageId:t})},e.prototype.contactSupportButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/contactSupport-button-click",object:"button",objectId:"contactSupport",pageId:e})},e.prototype.selectLanguageButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/selectLanguage-button-click",object:"button",objectId:"selectLanguage",language:e,pageId:t})},e.prototype.editPasswordButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/editPassword-button-click",object:"button",objectId:"editPassword",pageId:e})},e.prototype.advancedIssuesButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/advancedIssues-button-click",isDenali:!0,object:"button",objectId:"advancedIssues",pageId:e,placements:t})},e.prototype.openLensButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/openLens-button-click",isDenali:!0,object:"button",objectId:"openLens",lensName:e,pageId:t})},e.prototype.bannerDismissButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/bannerDismiss-button-click",object:"button",objectId:"bannerDismiss",bannerType:e,pageId:t})},e.prototype.documentTypeUpdate=function(e,t){return this.gnar.track({action:"update",eventName:"editor/document-type-update",object:"type",objectId:"document",documentType:e,pageId:t})},e.prototype.tutorialPopupShow=function(e){return this.gnar.track({action:"show",eventName:"editor/tutorial-popup-show",object:"popup",objectId:"tutorial",pageId:e})},e.prototype.downloadReceiptButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/downloadReceipt-button-click",object:"button",objectId:"downloadReceipt",pageId:e})},e.prototype.bannerNotificationShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/banner-notification-show",object:"notification",objectId:"banner",bannerType:e,pageId:t})},e.prototype.learnMoreAboutAppButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/learnMoreAboutApp-button-click",object:"button",objectId:"learnMoreAboutApp",app:e,pageId:t})},e.prototype.documentPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/document-page-show",object:"page",objectId:"document",pageId:e,url:t})},e.prototype.assistantSidebarClose=function(e){return this.gnar.track({action:"close",eventName:"editor/assistant-sidebar-close",isDenali:!0,object:"sidebar",objectId:"assistant",pageId:e})},e.prototype.goalsFormSuccess=function(e,t,n,r,o,i){return this.gnar.track({action:"success",eventName:"editor/goals-form-success",isDenali:!0,object:"form",objectId:"goals",pageId:e,audience:t,domain:n,emotion:r,intent:o,style:i})},e.prototype.uploadDocumentFormSuccess=function(e){return this.gnar.track({action:"success",eventName:"editor/uploadDocument-form-success",object:"form",objectId:"uploadDocument",pageId:e})},e.prototype.languageSettingUpdate=function(e,t,n,r){return this.gnar.track({action:"update",eventName:"editor/language-setting-update",object:"setting",objectId:"language",language:e,languageSource:t,pageId:n,isLikeCapi:r})},e.prototype.editEmailFormSuccess=function(e){return this.gnar.track({action:"success",eventName:"editor/editEmail-form-success",object:"form",objectId:"editEmail",pageId:e})},e.prototype.editNameFormFail=function(e,t,n){return this.gnar.track({action:"fail",eventName:"editor/editName-form-fail",object:"form",objectId:"editName",pageId:e,fieldErrors:t,formErrorMessage:n})},e.prototype.printButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/print-button-click",isDenali:!0,object:"button",objectId:"print",pageId:e})},e.prototype.profileLanguagePageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/profileLanguage-page-show",object:"page",objectId:"profileLanguage",pageId:e,url:t})},e.prototype.doneEditingButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/doneEditing-button-click",isDenali:!0,object:"button",objectId:"doneEditing",pageId:e,placement:t})},e.prototype.reportPopupShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/report-popup-show",object:"popup",objectId:"report",pageId:e,reportScore:t})},e.prototype.removeFromDictionaryButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/removeFromDictionary-button-click",object:"button",objectId:"removeFromDictionary",pageId:e})},e.prototype.confirmSubscriptionCancelButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/confirmSubscriptionCancel-button-click",object:"button",objectId:"confirmSubscriptionCancel",pageId:e})},e.prototype.getPremiumButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/getPremium-button-click",isDenali:!0,object:"button",objectId:"getPremium",pageId:e,placement:t})},e.prototype.editEmailButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/editEmail-button-click",object:"button",objectId:"editEmail",pageId:e})},e.prototype.uploadDocumentFormFail=function(e,t,n){return this.gnar.track({action:"fail",eventName:"editor/uploadDocument-form-fail",object:"form",objectId:"uploadDocument",pageId:e,fieldErrors:t,formErrorMessage:n})},e.prototype.profileAccountPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/profileAccount-page-show",object:"page",objectId:"profileAccount",pageId:e,url:t})},e.prototype.editEmailFormFail=function(e,t,n){return this.gnar.track({action:"fail",eventName:"editor/editEmail-form-fail",object:"form",objectId:"editEmail",pageId:e,fieldErrors:t,formErrorMessage:n})},e.prototype.plagiarismButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/plagiarism-button-click",isDenali:!0,object:"button",objectId:"plagiarism",pageId:e,placements:t})},e.prototype.supportButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/support-button-click",object:"button",objectId:"support",pageId:e})},e.prototype.detailedReportDownloadButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/detailedReportDownload-button-click",object:"button",objectId:"detailedReportDownload",pageId:e,reportScore:t})},e.prototype.editNameFormSuccess=function(e){return this.gnar.track({action:"success",eventName:"editor/editName-form-success",object:"form",objectId:"editName",pageId:e})},e.prototype.assistantCloseButtonClick=function(e,t){return this.gnar.track({action:"click",eventName:"editor/assistantClose-button-click",isDenali:!0,object:"button",objectId:"assistantClose",pageId:e,placement:t})},e.prototype.detailedReportPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/detailedReport-page-show",object:"page",objectId:"detailedReport",pageId:e,url:t})},e.prototype.assistantSidebarShow=function(e){return this.gnar.track({action:"show",eventName:"editor/assistant-sidebar-show",isDenali:!0,object:"sidebar",objectId:"assistant",pageId:e})},e.prototype.denaliDocumentPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/document-page-show",isDenali:!0,object:"page",objectId:"document",pageId:e,url:t})},e.prototype.newDocumentDenaliButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/newDocument-button-click",isDenali:!0,object:"button",objectId:"newDocument",pageId:e})},e.prototype.profileDictionaryPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/profileDictionary-page-show",object:"page",objectId:"profileDictionary",pageId:e,url:t})},e.prototype.copyDocumentButtonClick=function(e){return this.gnar.track({action:"click",eventName:"editor/copyDocument-button-click",object:"button",objectId:"copyDocument",pageId:e})},e.prototype.deleteAccountFormFail=function(e,t,n,r){return this.gnar.track({action:"fail",eventName:"editor/deleteAccount-form-fail",object:"form",objectId:"deleteAccount",accountType:e,pageId:t,fieldErrors:n,formErrorMessage:r})},e.prototype.editPasswordFormFail=function(e,t,n){return this.gnar.track({action:"fail",eventName:"editor/editPassword-form-fail",object:"form",objectId:"editPassword",pageId:e,fieldErrors:t,formErrorMessage:n})},e.prototype.myGrammarlyPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/myGrammarly-page-show",object:"page",objectId:"myGrammarly",pageId:e,url:t})},e.prototype.subscriptionCancelPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/subscriptionCancel-page-show",object:"page",objectId:"subscriptionCancel",pageId:e,url:t})},e.prototype.documentShow=function(e){return this.gnar.track({action:"show",eventName:"editor/document-show",object:"document",pageId:e})},e.prototype.subscriptionBillingInfoPageShow=function(e,t){return this.gnar.track({action:"show",eventName:"editor/subscriptionBillingInfo-page-show",object:"page",objectId:"subscriptionBillingInfo",pageId:e,url:t})},e}();t.GnarSpec=r},1373:function(e,t,n){"use strict";function r(){try{var e=localStorage.getItem("pageReloadReason");if(!e)return;localStorage.removeItem("pageReloadReason");var t=JSON.parse(e);(function(e,t){return window.location.href===e&&Date.now()-t<_})(t.location,t.timestamp)&&i.Monitoring.Logging.root.info("Page was reloaded",t)}catch(e){}}function o(){var e=i.TimeSeriesImpl.MetricsStorage.createRoot(s.appConfig.env+"."+s.appConfig.app.name,s.appConfig.api.felogUrl,a.RxFetch.nativeFetch.bind(window));i.TimeSeriesImpl.MetricsConfig.configure(e);var t=function(){function e(e){var t=this;this._sink=e,this._counters=new Map;var n=i.Monitoring.TimeSeries.root.getMetric("logging.levels");Object.keys(i.Logging.LogLevel).map(function(e){return i.Logging.LogLevel[e]}).filter(function(e){return"number"==typeof e}).forEach(function(e){return t._counters.set(e,n.getCounter(i.Logging.LogLevel[e]))})}return e.prototype.append=function(e){var t=this._counters.get(e.level);return t&&t.increment(),this._sink.append(e)},e}(),n=function(){function e(e){this._sink=e,this._shortRateReporter={name:"short",indicator:new c.RateLimitIndicator(new c.RateLimiter(30,2e3),1e4),counter:i.Monitoring.TimeSeries.root.getCounter("logRates.short")},this._longRateReporter={name:"long",indicator:new c.RateLimitIndicator(new c.RateLimiter(120,24e4),3e4),counter:i.Monitoring.TimeSeries.root.getCounter("logRates.long")},this._counting=i.Monitoring.TimeSeries.root.getCounter("logRates.either"),this._countingStarted=0,this._droppingLimiter=new c.RateLimiter(2,6e4),this._dropped=0}return e.prototype.append=function(t){var n=this._shortRateReporter.indicator.hit(),r=this._longRateReporter.indicator.hit();if((n.wasTriggered||r.wasTriggered)&&(n.wasTriggered&&n.aboveThreshold&&this._shortRateReporter.counter.increment(),r.wasTriggered&&r.aboveThreshold&&this._longRateReporter.counter.increment(),n.aboveThreshold||r.aboveThreshold?this._counts||(this._counting.increment(),this._counts=new u.LRUCache(50),this._countingStarted=Date.now(),this._sink.append(this._createTriggeredEvent(t,"Logging rate is above threshold",{short:n,long:r})).catch(console.warn)):(this._counts=void 0,this._sink.append(this._createTriggeredEvent(t,"Logging rate is back to normal",{dropped:this._dropped})).catch(console.warn))),this._counts){var o=this._eventToString(t),i=this._counts.set(o,function(e){return(e||0)+1})||0;return i/((Date.now()-this._countingStarted)/1e3)>e.DROP_RATE&&i>e.DROP_COUNT&&!this._droppingLimiter.hit()?(this._drop(),Promise.reject("Log message discarded due to rate limiting: "+t.message)):this._sink.append(t)}return this._sink.append(t)},e.prototype._drop=function(){++this._dropped},e.prototype._createTriggeredEvent=function(e,t,n){return new i.LoggingImpl.LogEvent(i.Logging.LogLevel.ERROR,t,"editor.logging.rate",Date.now(),void 0,n,e.context)},e.prototype._eventToString=function(e){return e.level+e.logger+e.message},e.DROP_RATE=.5,e.DROP_COUNT=15,e}(),o=function(e,t){return void 0===t&&(t=!0),new i.LoggingImpl.PostFelogClient(e,s.appConfig.app.name,s.buildInfo.version,s.appConfig.env,a.RxFetch.withTargetTag(a.RxFetch.request,"logs"),t)},_=i.Logging.LogLevel.fromString(s.appConfig.logLevel),y=s.appConfig.collectLogs?new n(new t(new i.LoggingImpl.LogQueue(o(s.appConfig.api.felogUrl+"/log"),m,g))):{append:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.resolve()}},v=s.appConfig.collectCrashLogs?o(s.appConfig.api.felogUrl+"/crash",!1):void 0,b=function(e){return console.error("Error sending logs",e)},w=i.Logging.LogLevel.fromString(s.appConfig.crashLogLevel),E=s.appConfig.app.name,S=function(e){e.level>=_&&(s.appConfig.copyLogsToConsole&&h.ConsoleLogger.printToConsole(e),y.append(e).catch(b))},C=new h.TreeContext,k=S;if(v){var x=new h.SimpleLogger(E+".crashLogs",w,function(e){return v.append(e).catch(b)},new h.TreeContext(C)),T=new d.CrashLogWrapper(100,i.Logging.LogLevel.ERROR,S,x);k=T.sink,l.registerDebugHelper("printLogs",function(){T.logs.forEach(h.ConsoleLogger.printToConsole)})}var A=new h.SimpleLogger(E,Math.min(_,w),k,C);i.LoggingImpl.LoggingConfig.configure(A);var I=l.StringUtils.alphanumeric(f),O=p.getBrowserInfo(),D=O.browser,P=O.os,R=O.version,N=O.type,M={browser:D,os:P,version:String(R),type:N,raw:navigator.userAgent};i.Monitoring.Logging.root.context.add({userAgent:M,sessionId:I}),i.Monitoring.TimeSeries.root.getCounter("sessions").increment(),r(),i.Monitoring.Logging.root.info("Application starting. HTTP referrer: "+document.referrer),l.registerDebugHelper("kibana",function(){var e=encodeURIComponent("http://kibana.grammarly.io/app/kibana#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-30m,mode:quick,to:now))&_a=(columns:!(_source),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'f-log-editor-*',key:context.sessionId,negate:!f,value:'"+I+"'),query:(match:(context.sessionId:(query:'"+I+"',type:phrase))))),index:'f-log-editor-*',interval:auto,query:(query_string:(analyze_wildcard:!t,lowercase_expanded_terms:!f,query:'*')),sort:!('@timestamp',desc))");fetch("https://private.gram.ly/shorten?url="+e).then(function(e){return e.text()}).then(function(e){return i.Monitoring.Logging.root.info("Kibana URL for this session: ",e)})})}Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),s=n(80),a=n(194),c=n(1386),u=n(304),l=n(7),h=n(319),d=n(317),p=n(49),f=14,m=100,g=1e4,_=3e5;t.initializeMonitoring=o},1374:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=function(){function e(e,t){this._profile=e,this._subscription=t,this._log=r.Monitoring.Logging.getLogger("pixels"),this._counter=r.Monitoring.TimeSeries.root.getCounter("pixels")}return e.doTracking=function(t,n,r){n&&n.isPremiumConversion&&new e(t,n)._doTracking(r)},e.prototype._doTracking=function(e){var t=this;this._log.info("Forcing premium conversion tracking"),this._counter.increment(),e.ackPremiumConversion().then(function(){t._try(function(){return t._googleAdwordsPixel()},"googleAdwordsPixel"),t._try(function(){return t._universalTracking()},"universalTracking")}).catch(function(e){return t._log.error("ackPremiumConversion failed",e)})},e.prototype._try=function(e,t){try{e()}catch(e){this._log.error("Error while calling tracking pixel "+t,e)}},e.prototype._googleAdwordsPixel=function(){var e,t=this._subscription.currentPlan.periodMonths;switch(t){case 1:e="DWnkCMbLrwkQ4ozj9gM";break;case 3:e="lqBBCL7MrwkQ4ozj9gM";break;case 12:e="w4TvCLbNrwkQ4ozj9gM";break;default:e="-eBYCKTnylgQ4ozj9gM",this._log.error("Unexpected periodMonths "+t)}new Image(1,1).src="https://www.googleadservices.com/pagead/conversion/1054393954/?label="+e+"&guid=ON&script=0"},e.prototype._universalTracking=function(){var e=this._subscription.currentPlan,t=window.ga||this._initUniversalTracking();t("send","pageview","/thankyou"),t("ecommerce:addTransaction",{id:this._profile.email,affiliation:"",revenue:e.price+"",shipping:"",tax:""}),t("ecommerce:addItem",{id:this._profile.email,sku:e.periodMonths+"M",name:e.title+"",category:"Grammarly Subscription",price:e.price+"",quantity:"1"}),t("ecommerce:send")},e.prototype._initUniversalTracking=function(){var e=new Date,t={},n={};!function(t,n,r,o,i,s,a){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*e,s=n.createElement(r),a=n.getElementsByTagName(r)[0],s.async=1,s.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(s,a)}(window,document,"script",0,"ga",t,n);var r=window.ga;return r("create","UA-6331378-16","auto"),r("require","displayfeatures"),r("require","ecommerce"),r},e}();t.PixelTracking=o},1375:function(e,t,n){"use strict";function r(e){return/Unhandled exception at https?:\/\//.test(e)&&!/grammarly|cloudfront/.test(e)}function o(e){return u.test(e)}function i(e){return r(e)||c.test(e)}function s(e){var t=e.reason||e.error,n=t&&t.stack;if(n&&-1!==n.indexOf("denali"))return!1;if(!e.filename||/^javascript:/.test(e.filename))return!0;if(n&&o(n))return!0;try{return i((t?t.message:e.message)||JSON.stringify(t||a.EventProps.fromAny(e)))}catch(e){return!1}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),c=new RegExp(["^(Script error.?|Javascript error: Script error.? on line 0)$","(.*__gCrWeb.autofill.extractForms'\\))","(.*safari-extension.*)|(.*chrome-extension.*)|(.*moz-extension.*)",'Permission denied to access property "'].join("|"),"m"),u=new RegExp(["(.*safari-extension.*)|(.*chrome-extension.*)|(.*moz-extension.*)","<anonymous>"].join("|"),"m");t.containsExternalUrl=r,t.isExternalExceptionStack=o,t.isExternalExceptionMessage=i,t.isExternalException=s},1376:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=n(12),i=n(7),s="wootric-modal",a="wootric-text";!function(e){function t(e){return e&&e.id===a}e.isWootricTextArea=t;var n=function(){function e(e,t,n){var i=this;this._ls=e,this._isWootricTest=t,this._experimentGroup=n,this._log=r.Monitoring.Logging.getLogger("external.wootric"),this._isLoaded=this._isEnabled(),this._runOnLoad=!1,this._containerObserver=new MutationObserver(function(e){e.forEach(function(e){Array.from(e.addedNodes).forEach(function(e){if(e&&e.id===s){i.height.set(0);var t=document.getElementById(s);t&&i._surveyObserver.observe(t,{subtree:!0,attributes:!0,attributeFilter:["style","class"]})}})})}),this._surveyObserver=new MutationObserver(function(e){var t=document.getElementById(s);if(t)if(t.classList.contains("show")){var n=t.getBoundingClientRect();i.height.set(n.height)}else i.height.set(0)}),this.height=o.Atom.create(0)}return e.prototype._isEnabled=function(){return void 0!==window.wootric&&void 0!==window.WootricSurvey},e.prototype.load=function(e,t){var n=this;if(this._containerObserver.observe(document.body,{childList:!0}),this._isEnabled())this._isLoaded=!0;else{this._log.info("Loading Wootric snippet..");var r=document.createElement("script");r.type="text/javascript",r.async=!0;var o={email:e,created_at:Math.floor(t.getOrElse(new Date).getTime()/1e3),modal_footprint:"compact",account_token:"NPS-a6a6ec54",properties:{group:this._experimentGroup}};r.innerHTML="\n        "+(this._isWootricTest?"wootric_survey_immediately = true;":"")+"\n        window.wootricSettings = "+JSON.stringify(o)+";\n        ",document.body.appendChild(r);var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="https://disutgh7q0ncc.cloudfront.net/beacon.js",i.onload=function(){n._isLoaded=!0,n._runOnLoad&&(n._runOnLoad=!1,n.takeSurvey())},document.body.appendChild(i)}},e.prototype.getAppliedCount=function(){try{var e=this._ls.getItem("wootric_applied_alerts"),t=e?JSON.parse(e):0;return t&&"number"==typeof t?t:0}catch(e){return this._log.warn("Can't get applied alerts count",e),0}},e.prototype.updateAppliedCount=function(e){try{var t=this.getAppliedCount();this._ls.setItem("wootric_applied_alerts",e(t).toString())}catch(e){this._log.warn("Can't set applied alerts count",e)}},e.prototype.takeSurvey=function(){if(this._isLoaded){this._log.info("Wootric run called"),i.invariant(this._isEnabled(),"Wootric snippet should be loaded");try{window.wootric("run")}catch(e){this._log.warn("Can't run survey",e)}}else this._log.info("Wootric run called. Waiting for beacon onload..."),this._runOnLoad=!0},e.prototype.dispose=function(){if(this._isEnabled())try{window.WootricSurvey.stop()}catch(e){this._log.warn("Can't stop survey",e)}var e=document.getElementById(s);e&&e.remove(),this.height.set(0),this._containerObserver.disconnect(),this._surveyObserver.disconnect()},e}();e.WootricListenerModelImpl=n;var c=function(){function e(e,t,n){void 0===n&&(n=5),this._wootricListenerImpl=e,this._appliedAlertsCount=t,this._appliedAlertsLimit=n,this._subs=[],this.height=this._wootricListenerImpl.height}return e.prototype._takeSurvey=function(e){return this._wootricListenerImpl.getAppliedCount()>=this._appliedAlertsLimit&&(e&&this._wootricListenerImpl.takeSurvey(),!0)},e.prototype.init=function(e,t){var n=this;this._wootricListenerImpl.load(e,t),this._takeSurvey(!0)||this._subs.push(this._appliedAlertsCount.take(this._appliedAlertsLimit).subscribe(function(e){n._wootricListenerImpl.updateAppliedCount(function(e){return e+1}),n._takeSurvey(!1)&&(n._subs.forEach(function(e){return e.unsubscribe()}),n._subs=[])}))},e.prototype.dispose=function(){this._subs.forEach(function(e){return e.unsubscribe()}),this._wootricListenerImpl.dispose()},e}();e.WootricViewModelImpl=c}(t.Wootric||(t.Wootric={}))},1377:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27);!function(e){function t(t,o,i){return r.Observable.merge(n(t,o,i).takeUntil(e.hiddenObservable),e.hiddenObservable.mapTo(o).first())}function n(e,t,n){return r.Observable.create(function(r){function o(a){i||(i=a);var c=a-i;c<n?(r.next(Math.round(e+c/n*(t-e))),s=window.requestAnimationFrame(o)):(r.next(t),r.complete())}var i,s=window.requestAnimationFrame(o);return function(){return window.cancelAnimationFrame(s)}}).distinctUntilChanged()}function o(e){var t=new r.Subject;return{state:e.switchMap(function(e){return e?r.Observable.of("inProgress"):r.Observable.merge(r.Observable.of("fadeOut"),t.mapTo("end"))}),complete:function(){return t.next(!0)}}}function i(e){return r.Observable.create(function(t){var n=requestAnimationFrame(function(){return t.next(e)});return function(){return cancelAnimationFrame(n)}})}function s(e,t){return void 0===t&&(t=!1),r.Observable.create(function(n){function r(){n.next(e.shift()),e.length&&(o=requestAnimationFrame(r))}var o;return t?r():o=requestAnimationFrame(r),function(){return cancelAnimationFrame(o)}})}e.hiddenObservable=r.Observable.fromEvent(document,"visibilitychange").map(function(){return document.hidden}).startWith(document.hidden).filter(Boolean).repeat(1),e.createAnimationObservable=t,e.fadeOutState=o,e.rafScheduler=i,e.rafSequence=s}(t.Animation||(t.Animation={}))},1378:function(e,t,n){"use strict";function r(e,t){return e.reduce(function(e,n){return t(n)?e[0].push(n):e[1].push(n),e},[[],[]])}function o(e,t,n){if(n>=e.length||t>=e.length)return e;for(var r=new Set,o=Math.floor(t+n>t?Math.random()*(n-t)+1:0);r.size<o;){var i=Math.floor(Math.random()*e.length);r.add(i)}return Array.from(r).map(function(t){return e[t]})}function i(e){for(var t=e.slice(0),n=t.length;n>0;){var r=Math.floor(Math.random()*n);n--,o=[t[r],t[n]],t[n]=o[0],t[r]=o[1]}return t;var o}function s(e,t){for(var n=-1,r=e.length;n+1!==r;){var o=n+(r-n>>1);t(e[o])?n=o:r=o}return n+1}function a(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.sort(function(e,n){return t.reduce(function(t,r){return 0!==t?t:r(e,n)},0)})}function c(e,t,n){for(var r=t;r<e.length;++r)if(n(e[r]))return d.Some({index:r,value:e[r]});return d.None}function u(e,t,n){for(var r=t;r>=0;--r)if(n(e[r]))return d.Some({index:r,value:e[r]});return d.None}function l(e,t,n){return t<0||e.length<=t?d.None:c(e,t+1,n).orElseL(function(){return u(e,t-1,n)})}function h(e,t){for(var n,r=0;r<e.length;++r)!function(r){var o=t.findIndex(function(t){return e[r].equals(t)});-1!==o&&(e.splice(r--,1),t.splice(o,1)),n=r}(r),r=n;return e}Object.defineProperty(t,"__esModule",{value:!0});var d=n(29);t.partition=r,t.pickRandom=o,t.shuffle=i,t.lowerBound=s,t.sort=a,t.findIndexFrom=c,t.findLastIndexFrom=u,t.lookAround=l,t.arraySubstract=h},1379:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),o=n(12),i=n(49);r.Observable.fromEvent(window,"click").first().subscribe(function(){document.queryCommandSupported("copy")||s.copyApiAvailable.set(!1)});var s=function(){function e(){}return e.copy=function(e){this._clearSelection();var t=this._createHiddenSpan(e);return this.select(t),this._copy(e).then(function(){t.parentElement.removeChild(t)}).catch(function(e){throw t.parentElement.removeChild(t),e})},e.select=function(e){if(window.getSelection&&document.createRange){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}else if("selection"in document&&"createTextRange"in document.body){var n=document.body.createTextRange();n.moveToElementText(this),n.select()}},e._clearSelection=function(){var e=window.getSelection?window.getSelection():document.selection;"removeAllRanges"in e?e.removeAllRanges():"empty"in e&&e.empty()},e._createHiddenSpan=function(e){var t=document.createElement("span");return t.setAttribute("style",["all: unset","position: fixed","top -999px","left -999px","opacity: 0","background transparent","white-space: pre","-webkit-user-select: text","-moz-user-select: text","-ms-user-select: text","user-select: text"].join(";")),t.textContent=e,document.body.appendChild(t),t},e._copy=function(e){var t=this;return new Promise(function(n,r){try{("msie"===t._browser?window.clipboardData.setData("text",e):document.execCommand("copy"))?n():r(new Error("Copy API doesn't work"))}catch(e){r(e)}})},e._browser=i.getBrowserInfo().browser,e.copyApiAvailable=o.Atom.create(!0),e}();t.Clipboard=s},1380:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(12),s=n(195);!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.TERMINATING=3]="TERMINATING"}(r||(r={}));var a;!function(e){e[e.CONNECT=0]="CONNECT",e[e.CONNECTED=1]="CONNECTED",e[e.TERMINATE=2]="TERMINATE",e[e.TERMINATED=3]="TERMINATED"}(a||(a={}));var c=function(){function e(e,t,n){void 0===n&&(n=i.Atom.create(null));var c=this;this._connector=e,this._terminator=t,this._currentConnection=n,this._create=function(){return o.__awaiter(c,void 0,void 0,function(){var e,t,n;return o.__generator(this,function(r){switch(r.label){case 0:return e=this._connectionParams,[4,this._connector(e)];case 1:return t=r.sent(),n=e===this._connectionParams,n?[4,this._fsm.event(a.CONNECTED,t)]:[3,3];case 2:n=r.sent(),r.label=3;case 3:return n?(this._currentConnection.set(t),[3,6]):[3,4];case 4:return[4,this._terminator(t)];case 5:r.sent(),r.label=6;case 6:return[2]}})})},this._remove=function(){return o.__awaiter(c,void 0,void 0,function(){var e;return o.__generator(this,function(t){switch(t.label){case 0:return e=this._currentConnection.get(),this._currentConnection.set(null),[4,this._terminator(e)];case 1:return t.sent(),[4,this._fsm.event(a.TERMINATED,"removed")];case 2:return t.sent(),[2]}})})},this._processQueue=function(){return c._connectionParams?c._fsm.event(a.CONNECT,c._connectionParams):Promise.resolve(!0)},this._fsm=new s.StateMachine(r.IDLE).from(r.CONNECTED).to(r.TERMINATING).on(a.CONNECT,a.TERMINATE).from(r.IDLE,r.CONNECTING,r.TERMINATING).to(r.CONNECTING).on(a.CONNECT).from(r.CONNECTING).to(r.CONNECTED).on(a.CONNECTED).from(r.TERMINATING).to(r.IDLE).on(a.TERMINATED).on(r.CONNECTING,this._create).on(r.TERMINATING,this._remove).on(r.IDLE,this._processQueue)}return e.prototype.connect=function(e){return void 0===e&&(e="connection"),o.__awaiter(this,void 0,void 0,function(){var t;return o.__generator(this,function(n){switch(n.label){case 0:return(t=e===this._connectionParams&&(this._fsm.current===r.CONNECTED||this._fsm.current===r.CONNECTING))?[3,2]:(this._connectionParams=e,[4,this._fsm.event(a.CONNECT,e)]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.terminate=function(){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(e){switch(e.label){case 0:return this._connectionParams=null,[4,this._fsm.event(a.TERMINATE)];case 1:return e.sent(),[2]}})})},e}();t.ConnectionManager=c},1381:function(e,t,n){"use strict";function r(e){return s.default(e)}function o(e,t,n){s.default(e,t,n)}function i(){var e=new Date(Date.now()+36e5);o("grInstallSource","editor",{domain:a.appConfig.domains.cookie,path:"/",expires:e})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(306),a=n(80);t.getCookie=r,t.setCookie=o,t.setInstallSourceCookie=i},1382:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userTestingDemo={title:"Buying a car",text:"For years I have been driving an old used car with a lot of mileage, and I hate it. It gets me where I need to go, but I’m tired of fixing leaks and broken parts all the time. Its annoying that I have to take it to mechanic every times. Even when they take care of everything, I know in a week I’ll just end up going back there.\nI have finally decided that I am not going to do it anymore. I have decided to buy a new car! Unfortunately, I have a problem. I have no idea what car to get. Do I want something fast? Do I want something big? Do I want something stylish? Something economical? I have so many choices that I don’t even know where to begin. I am not sure if I will be able to make the decision on my own. I don't have a lot of money either, so I probably don't have many option.\nAfter I did some research, I knew that I would need some expert advice. Eventually, I went to a local dealership to check out some new models. I talked to the saleswoman and listened at she carefully. Her honesty and professionalism were really impressive. She had a lot of vary helpful suggestions and showed myself some safe affordable choices. After a long discussion I finally decided which one I wanted. She not only helped me with the paperwork and finished the sale, but also the insurance. I was expecting this purchase to be a serious hassle, but the experience was almost painless. Everything went smoothly, and now I have a brand new car!\nI was so excited when I pulled out of the lot that the first thing I did was change lanes right in front of other car. “That wasn't very nice,” I thought to myself. I needed to relax. I didn’t realize what a serious mistake I had made however. I hadn’t just cut off any other car, I had cut off a police car! It took a few seconds to realize what was happening when I saw the flashing lights in my rearview mirror. By the time I had managed to pull over, my heart was racing. I gathered all the paperwork as he approached my window.\n“You forgot to signal back there” said Officer Johnson, according to his nametag.\n“Yes, well, it’s a new car so I guess I was a bit unfamiliar with the controls,” I stammered.\nHe looked at me skeptically.\n“I’m pretty sure the controls for the turn signal are in the same place on every car.”\nWhat could I say? He was right.\n“I’m sorry,” I ventured.\nHe looked over my paper work and noticed that the car was new.\n“It would be unfortunate to get a ticket on your first day in a new vehicle,” he said, smiling. “Try not to cut in front of anyone on your way home.”\nI had never felt so relieved in my life.\n“Thank you, officer!”\nAs he made his way back to his car I let out a huge sigh. I took a few seconds to compose myself before shifting into gear and driving away from the side of the rode. Now I have a brand new car and a story to tell!\n"},t.userTestingDemo2={title:"Want to Really Understand What all the Hype of Cryptocurrency is About?",text:"If you read the headlines you may well think cryptocurrencies are a either a radically new way of paying that is our savior from ossified, corrupt governments or on the other side that they are speculative Ponzi schemes. The reality of course is that cryptocurrencies can be both and can be liberating and corrupting at the same time.\nMy goal with this post is to lay out a simple framework for anybody unsure whom to listen to orient your own views and develop a healthy skepticism for arguments lacking merit often by friends telling you how much money they’ve made.\nI’ll lay out the cases for and against cryptocurrencies:\nA. The Simple Case for Cryptocurrencies\nCurrency is something most of us take for granted in our daily lives and don’t give much thought as to where money came from, how it became accepted and trusted and how it’s evolved over time. It’s pretty tough to have a view on cryptocurrency if you don’t have a history of currency.\nCurrencies only began in earnest about 2,500 years ago and ever since have been a great enabler of democracy and social mobility, not the other way around. By making it easier to capture value for goods & services that ordinary people provide and by creating a means of storing value today that can be used in the future — currencies have literally changed society and the world.\nCurrencies enabled the creation of the first modern corporation (around 400 years ago to allow groups of shipping merchants to pool together risk), the modern stock markets (so that people could own a portion of a merchant ship & sell this when they needed more cash) and then spawned regulators that oversaw all of this because the minute you have markets you have people who manipulate them unsophisticated new traders out to make money that they hear everybody else is making. Sound familiar?\nCurrencies also begat debt markets and this credit has lifted millions out of poverty by allowing people to invest in capital equipment that they otherwise couldn’t afford today that can yields profits tomorrow.\n(There is a short reading list in the Appendix if you want to learn more.)\nThe strongest cases for the existence of cryptocurrencies in my mind include:\nAllowing for a decentralized Internet in which value is accrued to infrastructure, protocols and applications that serve market needs\nAllowing electronic trade across actors who may not know or trust each other without middlemen who take a heavy toll / tax on the transaction\nAllowing for (the potential of) a more stable currency than one’s own government for citizens who may live under despotic or irresponsible regimes\n1. Decentralized Internet —\nThis is perhaps the most unsexy part of cryptocurrency but the one that most purists I follow on this topic are most excited about. I believe this use of cryptocurrency will develop and flourish long after the dust settles from the hype and crash of today’s cryptocurrency bubble that we’re experiencing in 2017.\nThe Internet and World Wide Web themselves emerged from open protocols (HTTP, HTML, SMTP, etc) that allowed businesses, individuals and governments to put information online that was accessible to the masses and connected us all directly to communicate and eventually trade. The Internet allows people in relatively poorer parts of the world to complete work for relatively richer parts of the world at wages higher than a local economy may bear. This has massively enriched the world and one can see why a currency that underpins Internet infrastructure would be attractive.\nThe crypto in cryptocurrency is of course referring to cryptography or the ability to encrypt your transactions so they can’t be modified after they have been written to the blockchain. You can think of this effort as the same as the US government improving the quality of its dollar bills to make them harder to counterfeit. For any currency to have value it must be trusted to be authentic.\nIn order to have a secure, decentralized means of transferring money between individuals you need a way of providing services that a modern centralized financial system would offer. For example, you need to know if a transaction was completed, you need to know the parties involved, you need to ensure that they actually own the money that they are transferring and that they haven’t previously pledged it to somebody else. And you need a means of auditing transactions so that they are verifiable. This is what the “blockchain” you keep reading about provides. It is a “ledger” (like your normal accounting system that records debits & credits) that is “public” (anybody can see the transactions that took place) and “distributed” (it isn’t held by one company, it works more like Skype that is distributed on “nodes” all across the world who agree to process & store transactions in exchange for … you guessed it … Bitcoin — or some other cryptocurrency depending on the market).\nThe Internet that has offered the world so much economic opportunity has also centralized wealth creation into the hands of relatively few people on a scale and in a timeframe never seen before in history. And while many of the people bringing you the great applications and infrastructure you now rely on are benevolent, there is of course a normal incentive for these companies to use their scale advantages to continue to dominate the markets they’re in, making it harder for upstarts to compete.\nThis market structure in which the few, large players use their market position to eliminate competition is inevitable and it’s hard to blame large companies or countries who want to protect their advantages. It’s Hobbesian economics 101. When you achieve economies-of-scale advantages it doesn’t benefit you to help newer companies draft off of your infrastructure to rise and compete against you. Of course our beloved technology industry did itself rise on the back of infrastructure created by telecommunications & cable infrastructure as well as decades of media production (not to mention enormous tax dollars over decades that created the infrastructure in the first place).\nThe world in which our communications was controlled by the telephone and media companies of 20 years ago would have been much less innovative than what we have achieved, which is precisely why we need to protect future companies still to be created from anti-competitive behavior of today’s giants.\nAn example of this stranglehold is distribution systems to find new apps in a mobile Internet is tightly locked down by the oligopoly of Apple and Google. They control the placement of apps in the ecosystem, they get to rule on whether they want you to exist or not and they heavily tax your participation. Unsurprisingly this system favors products by companies that already have enormous resources. In many ways this system now mirrors the “decks” or “portals” that mobile phone companies used to control mobile app distribution 20 years ago.\nDistribution of media is also now tightly controlled by YouTube, Netflix, Facebook, Amazon and a handful of others that have huge scale advantages. And our social graphs are locked in Facebook, Twitter and Snapchat. Breakout companies become much harder and this isn’t likely to improve unless we give new companies the tools and capital they need to flourish.\nBecause so many of us (myself included) love out technology providers, few have begun to fully grasp how much centralized control, for example, Amazon has over cloud-based storage and processing and it’s even more dominant in eCommerce and physical, last-mile distribution. I love that Amazon can deliver me products a mere hours after I order them but fast-forward 20 years and if they have no real competition for last-mile distribution this eventually could produce negative consequences for the market and for consumers.\nCapitalism encourages creative destruction of systems that came before it in search of better, more efficient alternatives. Oligarchs use market power to stop these new forces. In order for young seedlings to become the giant trees of tomorrow we need a way to protect them and allow them to flourish.\nEnter the “decentralized Internet” (i.e. the one not controlled by just a handful of large corporations). If you think about some of the great breakout peer-to-peer file or resource sharing products like BitTorrent, Skype, Naspster, Gnutella, etc. they found a way to use distributed resources across the Internet not controlled by a centralized company. In essence users like you probably used many of these products without complete awareness that your computer became a node and was being used to transmit files.\nIt’s true the P2P sharing of music was initially destructive to artists and labels but it led to today’s streaming services that you now enjoy and pay for like Spotify, Pandora or Apple Music. Having a library at your fingertip of any song for a subscription fee is of enormous benefit to the consumer but never would have happened without the forces of creative destruction.\nEnter blockchain. Like the P2P services that came before it, it decentralizes the transfer of information across any node that will run its services and in this case what is transferred are all transactions between parties on the blockchain and stored on a public ledger.\nThe existence of cryptocurrencies can create a way to provide economic value for those who provide computing resource or bandwidth to a product built on P2P infrastructure. The currency provides a reward for the best applications that the market wants to use as well as to people on the network who are willing to let their computing power or bandwidth be used.\nAnd of course any kind of application could be written to run on this infrastructure including things like a file management system that could compete with Dropbox, a database or raw storage company that competes with Amazon’s AWS or something that doesn’t exist already in today’s world.\nFor example, using cryptography and the blockchain I could transmit a blog post or a picture to a third-party who could know authoritatively that this was written word-for-word by me and not doctored in any way (because it is encrypted using cryptography to be uniquely created by me). In a world where perhaps foreign governments start propagating false information to influence our society, guaranteeing authenticity would become a very big deal.\nThe biggest problem with today’s cryptocurrencies to provide this market for a decentralized Internet is akin to the problems with funding Dutch East India Company exploration in the Spice Islands. If the value of participating gyrates wildly based on information unrelated to the value of this exploration then it’s hard for participants to trust large amounts of capital to the system.\nThe problem that I see is that cryptocurrencies are not a “stable” store of value. In fact, they operate less like a “currency” and more like a “stock market” or a “commodity” whose price can fluctuate rapidly and thus people buying and selling it seem to be doing so in more of a speculative fashion.\nI believe the massive valuation increases in cryptocurrencies we’ve witnessed of late are not based on any fundamentals other than speculation and a drive for a quick profit by many who have gained from the market hype. I don’t believe this does any good for the legitimate long-term purposes of having cryptocurrencies.\nFor products or services to work with a non-governmental, uncontrolled currency based on cryptography, they have to rely on more than the promise of authentication that cryptography offers today. They need to be able to count on a stable currency or for people to trust they will get fair value from the system in the long run if they invest today.\nOf course when you publicly call cryptocurrencies speculation you predictably get lambasted as I’ve noticed if I ever write anything on Twitter. Nobody making massive amounts of money in a short period of time without any real basis for making this money would ever want to acknowledge the arguments of somebody who might stop them from making even more money. That would be like Turkey’s voting to have Thanksgiving dinner.\n2. Allow untrusted network participants to trade\nIf you started a business 200 years ago you could mostly only trade in your local economy and you relied about “traders” who could transport your products great distances to those who might like to buy them in foreign lands. But your buyers were limited so your market size was limited and thus your ability to build at scale was limited unless you controlled armies or natural resources.\nThe great promise of the Internet was the ability to break down barriers and allow you to sell products and services globally, benefitting buyer and seller. But as with most Internet businesses, over time middlemen become very powerful brokers in marketplace businesses. If you’re a driver you need to Uber or Lyft to give consumers the confidence that you’re trustworthy. If you want to buy artisan goods on Etsy, the marketplace helps you source goods and verify a degree of reputation. Same Airbnb, Upwork, Thumbtack and others.\nMiddlemen play the role of distribution, authenticating buyers/sellers, clearing financial transactions, providing insurance and restitution if something goes awry.\nIf distributed systems can be built and if blockchain can record transactions and if network protocols emerge that verify authenticity of users and provide useful services such as creating escrow in transactions then in theory cryptocurrency ought to streamline online business, remove more control from centralized brokers and reduce transaction costs.\nThis does not mean that all existing intermediaries go away. Mostly I think new types of brokers will emerge and this will drive down transactions costs, improve services and make it easier to do business with people around the globe.\n3. More Stable Currency for Some Citizens of the World\nSome people don’t trust their governments with a national currency. History is filled with governments who plundered resources on wars or explorations or have provided economic handouts to buy-off the loyalty of certain population and have printed money to meet their obligations. As economists know, sharp increases in the money supply is one major cause of inflation (inflation equals increases in the prices of goods & services) and inflation erodes the value of people holding that currency who hope to save it and spend it in the future. In short, with high inflation today’s money is worth less in the future so you wouldn’t want to “store” your wealth in cash if it is depreciating.\nThroughout history Governments have also restricted the flows of capital outside of national boundaries and have tightly tracked stores of capital as a means of controlling and/or taxing its citizens.\nIf one lives in the United States or other stable economies it’s far fetched to suggest that cryptocurrencies are more stable or more widely accepted than one’s national currency like the dollar. But of course if you live in a repressive regime and value the easier transfer of capital and particularly the anonymous transfer of capital then the additional risks of cryptocurrency fluctuations in value may be more attractive than a currency controlled by your local government.\nSo I think one’s embrace of cryptocurrency for reasons other than speculative, short-term gains may be inversely correlated with one’s trust for their local government to protect the value of their wealth through a stable economic system and currency.\nB. The Simple Case against Cryptocurrencies\nIn the case for cryptocurrencies I argued that some global citizens rightly don’t trust their governments to have control over their currency or their cash and don’t trust their own government to know what they are doing with their wealth.\nFor many good-standing citizens of the world who happen to live under oppressive regimes this is an understandable goal. But there are also many people in the world today who favor cash today precisely because they are conducting business that today’s societies don’t want to exist including illicit drug trafficking, the sex worker trafficking market, organized crime, foreign government interference in elections, terrorism, gun smuggling and so forth. What a few season of Narcos and you’ll see the role that untraceable cash plays in greasing illicit activities.\nSo I would outline the simple case against cryptocurrencies includes three completely related factors\nPowerful governments won’t tolerate the loss of monetary control or propagating illegal activities\nSocietal pressure to regulate cryptocurrency will increase as more people are duped, as more fraud is discovered, as more hacks occur and as more market participants collaborate to manipulate the value of the currencies themselves\nErosion of trust in the public will come as first-time cryptocurrency participants get duped, lose money and develop skepticism for the asset\n1. Governmental crackdowns\nGovernments regularly use surveillance to track illicit behavior and curb or curtail activities. Our own government in the US regularly looks for cases of racketeering, attempts to crack down on the drug trade, tries to prevent illegal sex trafficking, looks out for insider trading on stocks, tries to stop child pornography and so forth.\nOf course all of these illicit activities take place precisely because there is so much economic interests at stake in providing “social bads” to people who want to consume them. It’s no wonder that the creation of a currency that has total anonymity would gain favor first with people for whom so much money could be gained by improving the ability to transact without governmental oversight.\nNo event has gotten the US and other governments so involved in the crackdown of monetary flows than the movement of money for terrorist activities post 9/11. Terrorism at scale can only occur when these organizations can move money around to finance people who make bombs, buy guns, train recruits and so forth.\nAnd if you think the US government is going to allow wide-scale movement of money within the United States in which the government can’t identify the sources and uses of capital you’re kidding yourself.\nAlso recognize the important the monetary policy plays in government leaders try to preside over stable societies, to offer benefits and services to its population and even to finance wars in foreign lands or to protect one’s interests at home. Whatever you think of these governmental activities I can assure you that governments won’t cede monetary control easily.\nChina has already made moves to massively curtain Bitcoin activities so that should be a clue of what is to come. You think Turkey is going to be eager to allow the movement of capital it can’t track? Russia? Iran? No way.\nI know Putin talks about cryptocurrencies but since his geopolitical strategy seems to be destabilization of democratic regimes and alliances it would seem to me that Russia would have a strategy to use cryptocurrencies in a destabilizing way to its advantage. Think for example if the people with whom you’re trading currency can use huge piles of cash to drive up the value of your currency in a short period of time and then use coordinated groups to then drive down prices through trading and misinformation to destabilize people.\nDestabilizing untraceable currency markets unpinning our technology ecosystem must be at least as attractive as manipulating our social media advertising and media markets before an election. It certainly should be food for thought. Of course this won’t trouble your friend who just made 8x on his or her Ethereum coins over the past year. But if you’re thinking critically about the long-term future this should at least be part of your consideration set.\n2. Regulation\nMany cryptocurrency mega-cheerleaders are radical libertarians that want no governmental control of currency or trade or other forms of regulation. I understand why people are turned off by regulation and of course undue regulation can stifle business.\nBut for the same reason we have SEC oversight on trading public stocks, we need oversight or nefarious actors will manipulate the system. There is a fascinating story in “The Ascent of Money” by Niall Ferguson in which Ferguson describes how the modern corporation emerged. About 400 years ago merchants from the Netherlands were sending ships to Asia in search of spices widely desired in Europe. More than 50% of all ships that sailed wouldn’t return so groups of people banded together and formed the Dutch East India Company to share the risks and the rewards of their conquests.\nThis is amongst the first examples of the modern corporation. The company brought back spices and reaped profits that went back into building more ships and sailing back to Asia. The company didn’t distribute the profits to individual shareholders who instead were issued the modern form of a share certificate for their ownership. Because they couldn’t monetize this ownership they started selling shares of their ownership to others, thus perhaps the first stock market and transaction dating back to the early 1600s.\nNo sooner did people start selling shares in these companies than market speculators started spreading false stories about merchant ships being sunk or about large spice conquests to drive up or down the price of these stocks through false information and manipulation. So oversight became necessary to establish trust in the value of these assets.\nThis is where I see cryptocurrencies today. I speak to colleagues who participate in trading crypto who tell me that there are coordinate rings on encrypted instant messaging platforms like Telegram to have coordinated buying and selling of new currencies. This sounds to me like fraud, pure and simple.\nAnd I know that ICOs (initial coin offerings) are all the rage amongst startup and some are raising for entirely good and valuable reasons. On the other hand, with no oversight of the ICO process and with the possibility of Dutch East India Company style manipulation by either companies or individual buyers of these currencies, I worry about the integrity of the market unless there is oversight.\nWhat I can tell you from my vantage point? I see companies that have been trying to raise professional money for years and have struggled suddenly gearing up for ICOs because they know there is so much demand from them — precisely because so many people speculatively made money on Bitcoin and Ethereum.\nAsk yourself this — how did it go when a bunch of Internet companies when public in 1998–1999 with limited revenues or oversight? Why would pouring hundreds of millions into even earlier stage startups with even less or no oversight be a good idea?\nRegulation will come. It needs to come fast.\n3. Trust\nBetween 1998–2000 the world became enamored with the “new economy” and Internet companies that were going public on NASDAQ in the United States. Not to be outdone, the UK promoted the AIM market, Germany the Neuer Markt and France the Nouveau Marché all with the aim of taking Internet companies public.\nMany of these countries hadn’t been big stock speculators but the gains of the US Internet companies were too tempting. So ordinary citizens poured hard-earned money into owning any company that could claim to be an Internet company and their valuations skyrocketed with no underlying rationale.\nUnsurprisingly a whole generation of first time stock traders became jaded about not just Internet stocks but the entire public stock market system as many people lost a large portion of their net worth. Trust doesn’t come back easily, which is why the role of regulation is so important.\nIn order for people to trust cryptocurrencies in the long run they will need to believe they are transparent, fair, stable, safe and that somebody is watching over them to provide an imprimatur of trust.\nWithout trust no currency has value.\nC. The Arguments That Should Make You Suspicious\n1. Cryptocurrencies offer a better mechanism for companies (or funds) to raise money\nICOs are not a better way to raise capital than traditional routes, they are a different way and can work together with other forms of fund raising including traditional crowd-funding and/or product pre-release funding like Kickstarter and Indiegogo.\nI welcome the role that ICOs may play in some technology companies where a legitimate purpose exists for a “coin” or some form of token to exchange value between market participants. But I also believe that the backlash that will happen against ICO fraud will likely burn some people to future participation until and unless there are some frameworks for oversight of the market.\n2. Cryptocurrencies will eradicate VCs\nI know that people hate having to deal with people to raise money and the idea of being able to turn to an anonymous crowd and if they value what you do they will provide you money is appealing.\nBut putting large sums of money in the hands of first time or even experienced entrepreneurs with absolutely no oversight is a recipe for disaster. The fundamental role a VC plays is the role of board members and their job is to provide oversight (and even auditing) of the company for the purposes of protecting shareholders. This is the same board role that emerged from the Dutch East India Company to provide more transparency to investors.\nSo however populist the idea of cutting out people from the process may be, I strongly doubt it will replace the role of the existing venture capital ecosystem. In many ways, it could even become a new tool for earlier shareholder liquidity including the exit of some VC money. We’ll have to see how it all plays out.\n3. Cryptocurrencies will drive a reorganization of societies into more libertarian structures\nThe most vociferous promoters of cryptocurrency include a group of people who have a total disdain for governments and financial markets and imagine a world in which technologists cut out all power structures and create a truly flat world.\nI understand the idealistic tendencies in the same way I understand the idealistic tendencies of those who long for socialism or communism. It seems like the world would be a more fair place if it weren’t for leaders who run countries and organizations and benefit from these activities.\nThe problem without having governmental systems, however imperfect, is that the opposite is anarchy. And through every idealistic movement to bring equality to all ends in newer forms of power structures and usually wants that are less benign as they seek to hold on to power.\nI know it seems strange to veer into this topic in my post but the more time you spend listening to cryptocurrency promoters the more you realize that there really a small undercurrent who have an objective of subverting existing order. And no prizes for guessing who would benefit if this order was disrupted.\nD. So Where Do I Personally Net Out?\nAs with many things in life, I’m super optimistic that out of this current wave of innovation around distributed ledgers (blockchains) and cryptocurrencies (like Bitcoin and Ethereum) will come some great leaps forward of innovation that will benefit the world.\nAt the same time I remain skeptical about the motives of many of today’s market participants and extremely skeptical about the massive run up in valuation of many of today’s crytocurrencies. The arguments “for” of many market participants ring as hollow as they did in 2005 when they told me I was an idiot for believing that Florida real estate prices would drop or in the dotcom 1.0 boom where many companies had deeply inflated values.\nAs with every situation, I always try to think through, “What are the motives of those who are telling me A or B?” and “what is the intrinsic value of a given asset and what will determine its future value?”\nAppendix\nIf you really want to have an informed opinion money & currency then it would help to read a historical primer on the topic and I have two great recommendations. The first is “The History of Money” by Jack Weatherford (who also wrote one of my favorite books on world order & world trade, “Ghengis Khan and the Making of the Modern World”). And another great book on the role currencies play in the creation of governments and in war & peace read Niall Ferguson’s, “The Ascent of Money.” It’s pretty tough to pretend to have an opinion on cryptocurrency without first understanding the origins and evolution of money throughout the last 2,500 years.\np.s. Because this is a single sitting, top-of-mind post it shouldn’t be thought of like a research paper, it may be incomplete and I’m not trying to be the final authority on the topic. I think of this as more of a 101 primer for those who want to develop their own framework for thinking about the topic."},t.userTestingDemo3={title:"Bike whenever you like",text:'Remember when you were a careless eight year old kid riding a bike with your friends, racing each other around the neighborhood? Remember that feeling of absolute freedom as you felt the wind in your hair and the smile it put on your face? I never thought I would feel that way as a grown up, until my friends presented me a red brand-new bike. At first, I was a bit skeptical about the total idea of commuting by bike. One morning a couple of days later, I changed completely my mind.\nI was stuck at the traffic jam and saw in my rear mirror a man in a suit riding a classy bike with his laptop case in one hand and a handlebar in another. I figured out it would take him about 15 minutes to get to the office while I was still sitting in my car and waiting for the cars in line ahead to move , even if just for a inch. I was always very afraid of being late on my business meetings.\nThat is when I decided getting on the bike. I haven’t regretted my decision so far. One of the best things about cycling is that the bike is perfect for exercising. Just cycling to and from work or to the shops every day is enough to keep you healthy and happy. Besides, its incredible liberating to be able to get anywhere without loosing time in traffic jams. Also don\'t forget about the environment benefits. Cycling helps to reduce air pollution while reducing also traffic congestion and the need for gas.\nAt some point, I realized that I started to use the bike more often, not only to get to work, but also to catch up with friends and to head out for coffee on weekends. I loved this style of traveling because it lets you really appreciate what you are seeing around you. You can stop anywhere you want and yet you can cover some good distance. That daily distance I rode to work was no longer enough for me. I started riding to the nearest decent mountain bike trails so I could spent the day going up and down hills. I did it because it was fun. Because I enjoyed it.\n"I wish I could bike all the way round the world" I said to myself one day. And than I thought, "Why not?"\nOK, I knew I couldn’t ride across the oceans. I came up with the idea to ride across each of the continents, from coast to coast. The more I thought about it, the more excited I became about my future plans. If I will do this, I will have to thoroughly prepare, I thought. I was also very scare. Would I be able to make it over towering mountains and across burning deserts? What if I get lost somewhere and don\'t know the language?\nAfter a few months of training, I set off. This was hard at first, but soon I realized that everywhere I went people cheered me on when they heared about my journey. The newspaper back home reported on my progress. Once or twice I ran out of money and has to spend a couple weeks doing odd jobs before I could continue on my way . I never gave up on my idea, and a year and six month later, I found myself petaling back toward the place where it all began. my journey was over and I was home.\nThese days, I continue exploring the world with  my bike as often as I can. Thanks to my bike, I’ve made countless friends, seen incredible sights, and had unforgettable adventures. I will have missed out on all of that if I haven’t decide to try biking instead of driving! I guess there are an upside to traffic jams after all!'}},1383:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(913);!function(e){function t(e,t,n){var o=window.Grammarly,i=o&&o.desktopEditor;if(i&&i.openUpgradePage){var s=r(n),a=e.substring(e.indexOf("?")+1),c=t.api.redirect+"?upgrade=1&hash="+s+"&"+a;return i.openUpgradePage(c)}return!1}e.openUpgradeUrl=t}(t.actions||(t.actions={}))},1384:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){function t(e){return{kind:"left",value:e}}function n(e){return{kind:"right",value:e}}function r(e){return"left"===e.kind}function o(e){return"right"===e.kind}function i(e,t){return r(e)?e:t(e.value)}function s(t){return t.then(function(t){return e.right(t)}).catch(function(t){return e.left(t)})}e.left=t,e.right=n,e.isLeft=r,e.isRight=o,e.flatMap=i,e.fromPromise=s}(t.Either||(t.Either={}))},1385:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(29),o=n(98);!function(e){function t(e){return r.Option.of(e).filter(o.notEmpty)}function n(e){return r.Option.of(e).map(function(e){return e.filter(Boolean)}).filter(o.notEmpty)}e.string=t,e.array=n}(t.NotEmpty||(t.NotEmpty={}))},1386:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(196),o=function(){function e(e,t){if(this.messageCount=e,this.timeframe=t,e<1)throw new r.IllegalArgumentError("messagesCount should be > 1");if(t<=0)throw new r.IllegalArgumentError("timeframe should be > 0");this._allowance=e,this._lastChecked=Date.now()}return e.prototype.hit=function(){var e=Date.now(),t=e-this._lastChecked;return this._lastChecked=e,this._allowance+=t*(this.messageCount/this.timeframe),this._allowance>this.messageCount&&(this._allowance=this.messageCount),!(this._allowance<1)&&(this._allowance-=1,!0)},e.prototype.toString=function(){return"[ messageCount: "+this.messageCount+", timeframe: "+this.timeframe+", allowance: "+Math.trunc(1e3*this._allowance)/1e3+", _lastCheck: "+this._lastChecked+"]"},e}();t.RateLimiter=o;var i=function(){function e(e,t){if(this._limiter=e,this._cooldownTime=t,this._lastLimiting=0,this._aboveThreshold=!1,t<0)throw new r.IllegalArgumentError("cooldownTime should be non-negative")}return e.prototype.hit=function(){var e=this._limiter.hit(),t=!1;return e?this._aboveThreshold&&Date.now()-this._cooldownTime>this._lastLimiting&&(this._aboveThreshold=!1,t=!0):(this._lastLimiting=Date.now(),this._aboveThreshold||(this._aboveThreshold=!0,t=!0)),{allow:e,aboveThreshold:this._aboveThreshold,wasTriggered:t}},e}();t.RateLimitIndicator=i},1392:function(e,t){e.exports={}},1393:function(e,t){e.exports={clearfix:"_3e896f-clearfix",header:"_3e896f-header",headOne:"_3e896f-headOne",headSub:"_3e896f-headSub",sub:"_3e896f-sub",link:"_3e896f-link",logoWrapper:"_3e896f-logoWrapper",logo:"_3e896f-logo"}},1394:function(e,t){e.exports={clearfix:"_e36e5b-clearfix",header:"_e36e5b-header",headOne:"_e36e5b-headOne",headSub:"_e36e5b-headSub",sub:"_e36e5b-sub",link:"_e36e5b-link",logoWrapper:"_e36e5b-logoWrapper",logo:"_e36e5b-logo",linkWrapper:"_e36e5b-linkWrapper",back:"_e36e5b-back",home:"_e36e5b-home",support:"_e36e5b-support"}},1395:function(e,t){e.exports={clearfix:"_fda1ec-clearfix",header:"_fda1ec-header",headOne:"_fda1ec-headOne",headSub:"_fda1ec-headSub",sub:"_fda1ec-sub",link:"_fda1ec-link",logoWrapper:"_fda1ec-logoWrapper",logo:"_fda1ec-logo",robot:"_fda1ec-robot",contact:"_fda1ec-contact",smallText:"_fda1ec-smallText"}},1396:function(e,t){},1397:function(e,t){},1398:function(e,t,n){n(549),e.exports=n(550)},145:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(22),s=n(29),a=n(12),c=n(5),u=n(390),l=n(47),h=n(1003),d=n(383),p=n(7),f=n(908);t.Location=f.Location;var m=d.default();!function(e){function t(e){return{route:e,href:function(t){return{pathname:u.compile(e.path)(t),exact:e.exact,path:e.path}}}}function n(e,t){return r.__assign({},e.route,{component:t})}var d="nextLocationState",f=function(){function t(){var e=this;this._fullReload=!1,this._logger=c.Monitoring.Logging.getLogger("router"),this._nextLocationState=s.Option.empty(),this.location=a.Atom.create(this._parseLocation(m.location)),this.locationState=s.Option.empty(),this.query=new _(m.location.search),this.scheduleForceReload=function(){e._fullReload=!0,e._logger.info("forceReload.scheduled")},this.forceReload=function(){e._logger.info("forceReload.started"),window.location.reload()};var t=c.Monitoring.Logging.getLogger("router");t.info("Router init",m.location),this.locationState=this._loadLocationState(),m.listen(function(n){t.info("Location change",n),e.location.set(e._parseLocation(n)),e.locationState=e._nextLocationState,e._nextLocationState=s.None})}return t.prototype._parseLocation=function(e){return{pathname:e.pathname}},t.prototype.navigate=function(e,t,n){void 0===n&&(n=!1),t&&(this._nextLocationState=s.Option.of(t)),this._fullReload?(this._saveLocationState(e.pathname),this._logger.info("forceReload.startedOnNavigation"),window.location.href=e.pathname):n?m.replace(e):m.push(e)},t.prototype.isActive=function(t){return this.location.view(e.isActive(t))},t.prototype._saveLocationState=function(e){try{this._nextLocationState.forEach(function(t){window.localStorage.setItem(d,JSON.stringify({pathname:e,state:t}))})}catch(e){}},t.prototype._loadLocationState=function(){var e=this,t=s.Try.of(function(){var e=JSON.parse(window.localStorage.getItem(d)||"");return{state:e.state,pathname:e.pathname}}).filter(function(t){return t.pathname===e.location.get().pathname}).map(function(e){return e.state}).toOption();return function(){try{window.localStorage.removeItem(d)}catch(e){}}(),t},t}();e.Impl=f;var g=function(){function e(){this.location=a.Atom.create({pathname:"/",query:new URLSearchParams}),this.locationState=s.None,this._query=a.Atom.create(new _("")),this.navigate=p.noop,this.scheduleForceReload=p.noop,this.forceReload=p.noop}return Object.defineProperty(e.prototype,"query",{get:function(){return this._query.get()},enumerable:!0,configurable:!0}),e.prototype.isActive=function(e){return a.Atom.create(!1)},e.prototype.setQuery=function(e,t){var n=new URLSearchParams;n.set(e,t),this._query.set(new _(n.toString()))},e.prototype.setNextLocationState=function(e){throw new Error("Method not implemented.")},e}();e.DummyImpl=g;var _=function(){function e(e){this._searchParam=new URLSearchParams(e)}return e.prototype.has=function(e){return this._searchParam.has(e)},e.prototype.get=function(e){return s.Option.of(this._searchParam.get(e))},e}();e.ContextTypes={appRouter:i.object},e.page=t,e.bindComponent=n,e.isActive=function(e){return function(t){var n=t.pathname;return Boolean(l.matchPath(n,e))}},e.Wrapper=function(e){var t=e.routesMap,n=e.renderer;return o.createElement(l.Router,{history:m},o.createElement(l.Switch,null,p.ObjectUtils.toArray(t).map(function(e){return o.createElement(h.Route,{path:e.path,exact:e.exact,key:e.path,render:function(t){return n(t,e)}})})))},e.Block=function(e){var t=e.when,n=e.message;return o.createElement(a.F.div,null,t.map(function(e){return o.createElement(l.Prompt,{key:"prompt",when:e,message:n})}))},e.routes={documents:t({path:"/",exact:!0,private:!0}),profile:t({path:"/profile",private:!0}),subscription:t({path:"/subscription",private:!0}),apps:t({path:"/apps",private:!0}),new_document:t({path:"/docs/new",exact:!0,private:!0}),editor:t({path:"/docs/:docId",private:!0}),denali_editor:t({path:"/ddocs/:docId",private:!0}),free:t({path:"/free",private:!0}),component_browser:t({path:"/component_browser/:component?"}),card_iframe:t({path:"/card_iframe"}),diagnostic_test:t({path:"/diagnostic-test"}),notFound:t({path:"*"})}}(t.Router||(t.Router={}))},146:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(204);t.BaseComponent=r.BaseComponent,t.withContext=r.withContext,t.BaseComponentContext=r.BaseComponentContext;var o=n(1338);t.BasePage=o.BasePage;var i=n(1341);t.Link=i.Link;var s=n(145);t.Router=s.Router},147:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(194);t.RxFetch=o.RxFetch,t.FetchType=o.FetchType;var i=n(1323);t.Lifecycle=i.Lifecycle,t.Subscription=i.Subscription;var s=n(1324);t.TextResources=s.TextResources,t.getTextResources=s.getTextResources,r.__exportStar(n(1322),t)},148:function(e,t,n){"use strict";function r(e){return e?e[0].toUpperCase()+e.slice(1):""}function o(e){return e?e.replace(/(?:^|[-_\s])(\w)/g,function(e,t){return t?t.toUpperCase():""}):""}function i(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function s(e,t){if(void 0===e&&(e=""),!e||"undefined"==typeof window)return"";if(!t)return b.sanitize(e);var n=Object.assign({},t.allowedTags?{ALLOWED_TAGS:t.allowedTags}:{},t.sanitizeDom?{SANITIZE_DOM:t.sanitizeDom}:{});return b.sanitize(e,n)}function a(e,t){var n=e.match(t);return n&&n[1]}function c(e){return e.split(/\s+/)[0]}function u(e){if(!e)return 0;var t=e.replace(/[\W\d]/gi," ").replace(/\s+/gi," ").trim().split(" ");return 1===t.length&&""===t[0]?0:t.length}function l(e){return w.decode(e).length}function h(e){return e.replace(/\t/g,"    ")}function d(e,t,n){return 1===e?t:n}function p(e,t){return void 0===t&&(t="en-US"),e.toLocaleString(t,{minimumFractionDigits:2,maximumFractionDigits:2})}function f(e){return e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")}function m(e,t,n){return t>>=0,n=String(n||" "),e.length>t?String(e):(t-=e.length,t>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(e))}function g(e){var t=document.createElement("div");return t.innerHTML=s(e),t.textContent||t.innerText||""}function _(e){if(!e)return"";var t=document.createElement("a");return t.href=e,t.hostname}function y(e){return e&&(e<48||58===e||59===e||63===e)||!1}function v(e){if(e<0)throw new TypeError("Length should not be negative: "+e);return Array.from({length:e},function(){return E.charAt(Math.random()*E.length)}).join("")}Object.defineProperty(t,"__esModule",{value:!0});var b=n(828),w=n(98);t.nbsp=String.fromCharCode(160),t.capitalize=r,t.camelize=o,t.toTitleCase=i,t.sanitize=s,t.getFirstMatch=a,t.getFirstWord=c,t.wordCount=u,t.charCount=l,t.replaceTabsWithSpaces=h,t.pluralize=d,t.formatPrice=p,t.escapeRegExp=f,t.padStart=m,t.decodeHTMLCodes=g,t.urlToDomain=_,t.isBreakWordChar=y;var E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t.alphanumeric=v},149:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(195),s=n(593),a=n(60),c=n(5);!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e[e.CLOSED=3]="CLOSED",e[e.ANY=4]="ANY"}(r=t.States||(t.States={}));var u;!function(e){e[e.CONNECT=0]="CONNECT",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECT=2]="DISCONNECT",e[e.SEND=3]="SEND",e[e.CLOSE=4]="CLOSE"}(u=t.Events||(t.Events={})),t.errPrintln=function(e){c.Monitoring.Logging.getLogger("coreclients.errPrintln").error("WebSocket Error",e)},t.logPrintln=function(e){c.Monitoring.Logging.root.isEnabled(c.Logging.LogLevel.TRACE)&&c.Monitoring.Logging.getLogger("coreclients.errPrintln").trace("WebSocket:",{message:e})},t.ignore=function(e){};var l=function(){function e(){var e=this;this._log=c.Monitoring.Logging.getLogger("coreclients.ws"),this._maxDelay=6e4,this._delay=1e3,this._idleTimeout=-1,this._ondisconnect=t.logPrintln,this._onerror=t.errPrintln,this._onmessage=function(t,n){e._log.warn("Default message handler used <<< ",{message:n})},this._read=function(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t&&null!==t)return t}catch(e){}return e},this._write=function(e){return"string"==typeof e?e:JSON.stringify(e)}}return e.create=function(){return new e},e.prototype.setMaxReconnectDelay=function(e){return this._maxDelay=e,this},e.prototype.setInitialReconnectDelay=function(e){return this._delay=e,this},e.prototype.idle=function(e){return void 0===e&&(e=3e5),this._idleTimeout=e,this},e.prototype.writer=function(e){return this._write=e,this},e.prototype.reader=function(e){return this._read=e,this},e.prototype.onDisconnect=function(e){return this._ondisconnect=e,this},e.prototype.onMessage=function(e){return this._onmessage=e,this},e.prototype.onError=function(e){return this._onerror=e,this},e.prototype.connect=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,s=this;return o.__generator(this,function(o){return t=new i.StateMachine(r.DISCONNECTED,r.CLOSED).with(r.ANY).parentOf(r.CLOSED,r.CONNECTED,r.CONNECTING,r.DISCONNECTED).from(r.CONNECTING).to(r.CONNECTED).on(u.CONNECTED).from(r.CONNECTED,r.CONNECTING).to(r.DISCONNECTED).on(u.DISCONNECT).from(r.DISCONNECTED).to(r.CONNECTING).on(u.CONNECT).from(r.ANY).to(r.CLOSED).on(u.CLOSE).from(r.CONNECTED).to(r.CONNECTED).on(u.SEND).on(r.DISCONNECTED,function(e){return s._ondisconnect(e.args)}),n=new d(this._maxDelay,this._delay),n.initReconnect(e,function(e){return s._createWebSocket(e,t,n)}),[2,this._createWebSocket(e,t,n)]})})},e.prototype._createWebSocket=function(e,t,n){return o.__awaiter(this,void 0,void 0,function(){var i=this;return o.__generator(this,function(a){return[2,new Promise(function(a,c){return o.__awaiter(i,void 0,void 0,function(){var i,l,d=this;return o.__generator(this,function(m){switch(m.label){case 0:return[4,t.event(u.CONNECT)];case 1:return(i=m.sent())?(this._log.debug("Connecting to "+e),l=new s.w3cwebsocket(e),l.onopen=function(e){return o.__awaiter(d,void 0,void 0,function(){var e,i,s=this;return o.__generator(this,function(o){switch(o.label){case 0:return[4,t.event(u.CONNECTED)];case 1:return(e=o.sent())?(i=new h(l,t,this._write),l.onmessage=function(e){n.reset(),s._onmessage(i,s._read(e.data))},a(i),[2]):(c(new Error("WebSocket [ERROR] FSM cannot be switched to CONNECTED state from "+r[t.current])),l.close(4e3,"WebSocket lib initialized"),[2])}})})},l.onclose=function(r){d._log.debug("Connection to "+e+" closed",r);var o=new f({status:r.reason,message:"Connection to "+r.reason+" closed",code:r.code,url:e,event:r});t.event(u.DISCONNECT,new p(o,n))},l.onerror=function(r){try{var o=new f({status:"ws_error",message:"WebSocket error",url:e});try{d._onerror(o)}catch(e){d._log.error("OnError handler thrown an error",e)}t.event(u.DISCONNECT,new p(o,n))}finally{c(r)}},[2]):(c(new Error("\n          WebSocket [ERROR] FSM provided cannot be switched to CONNECTING state from "+r[t.current]+"\n        ")),[2])}})})})]})})},e}();t.WS=l;var h=function(){function e(e,t,n){this._ws=e,this._fsm=t,this.write=n}return e.prototype.send=function(e){var t=this;this._fsm.event(u.SEND).then(function(n){if(!n)throw new Error("WebSocket [ERROR]: Trying to send on invalid connection state: "+r[t._fsm.current]);t._ws.send(t.write(e))})},e.prototype.close=function(){var e=this;return this._fsm.event(u.CLOSE).then(function(t){if(!t)throw new Error("WebSocket [ERROR]: Trying to close connection which already closed or had invalid state: "+e._fsm.current);e._ws.close()})},Object.defineProperty(e.prototype,"url",{get:function(){return this._ws.url},enumerable:!0,configurable:!0}),e}();t.WSConnection=h;var d=function(){function e(e,t){this._maxDelay=e,this._initialDelay=t,this._log=c.Monitoring.Logging.getLogger("coreclients.wsreconnect"),this._prevDelay=0,this._reconnectCounter=0}return Object.defineProperty(e.prototype,"url",{set:function(e){this._log.info("WebSocket [INFO]: Url was overwritten "+this._url+" to "+e+" after disconnect"),this._url=e},enumerable:!0,configurable:!0}),e.prototype.initReconnect=function(e,t){this._reconnect=t,this._url=e},Object.defineProperty(e.prototype,"delay",{get:function(){return this._prevDelay},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reconnectCounter",{get:function(){return this._reconnectCounter},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._reconnectCounter=0,this._prevDelay=0},Object.defineProperty(e.prototype,"nextDelay",{get:function(){return Math.min(this._maxDelay,Math.max(this._initialDelay,2*this._prevDelay))},enumerable:!0,configurable:!0}),e.prototype.scheduleReconnect=function(e){return void 0===e&&(e=this.nextDelay),o.__awaiter(this,void 0,void 0,function(){var t=this;return o.__generator(this,function(n){if(e<0)throw new Error("WebSocket [ERROR]: Negative delay is not allowed: "+e);return 0===e?[2,this.reconnectNow()]:[2,new Promise(function(n,r){var o=function(){return t.reconnectNow(t._url).then(function(e){n(e)}).catch(function(e){return r(e)})};t._log.debug("Reconnecting to "+t._url+" after timeout "+e),t.cancelReconnect(),t._timer=setTimeout(o,e),t._prevDelay=e})]})})},e.prototype.reconnectNow=function(e){return void 0===e&&(e=this._url),o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(t){if(!this._reconnect)throw new Error("WebSocket [ERROR]: Reconnect is not set, consider setting it before reconnect will be triggered");return this.cancelReconnect(),this._reconnectCounter++,[2,this._reconnect(e)]})})},e.prototype.cancelReconnect=function(){this._timer&&clearTimeout(this._timer)},e}();t.WSReconnect=d;var p=function(){function e(e,t){this._error=e,this.reconnect=t}return e.prototype.toString=function(){return this._error.message},Object.defineProperty(e.prototype,"code",{get:function(){return this._error.code},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reason",{get:function(){return"WebSocket [CLOSE]: statusCode="+this._error.code+" reason: "+this._error.status},enumerable:!0,configurable:!0}),e}();t.WSCloseReason=p;var f=function(e){function t(t){var n=t.code,r=void 0===n?-1:n,o=t.status,i=t.url,s=t.message,a=t.body,c=(t.event,e.call(this,s)||this);return c.name="WSError",c.url=i,c.code=r,c.body=a,c.status=o,c}return o.__extends(t,e),t}(a.CustomError);t.WSError=f},150:function(e,t,n){"use strict";function r(e){return"american"===e||"british"===e||"canadian"===e||"australian"===e}function o(e){return e&&"null"!==e}Object.defineProperty(t,"__esModule",{value:!0});var i=n(29),s=n(27),a=n(48),c=n(5),u=n(7),l=n(80);t.isDialectString=r;var h=function(){function e(e,t,n){this._userSettings=e,this._dapi=t,this._userId=n,this._log=c.Monitoring.Logging.getLogger("model.settings"),this.firstCall=this._userSettings.lens("firstCall"),this.dialect=this._userSettings.view(function(e){return o(e.dialectStrong)?i.Some(e.dialectStrong):o(e.dialectWeak)?i.Some(e.dialectWeak):i.None}),this.dialectOrDefault=this.dialect.view(function(e){return e.fold(function(){return l.appConfig.defaultDialect},function(e){return e})}),this.seenWelcome=this._userSettings.lens("seenWelcome"),this.forcedDenaliUI=this._userSettings.lens("forcedDenaliUI"),this.acceptedTermsVersion=this._userSettings.lens("acceptedTermsVersion"),this.banners=this._userSettings.lens("banners"),this.denaliLens=this._userSettings.lens("denaliLens"),this.onboardingPassed=this._userSettings.lens("onboardingPassed"),this.showExitNotification=this._userSettings.lens("showExitNotification")}return e.prototype._sync=function(e){var t=this;return this._dapi.save(e).then(function(){return p.write(t._userId.get(),a.Properties.of(t._userSettings.get()))}).catch(this._log.handler("dapiError: save failed",{data:e}).warn)},e.prototype._setProperty=function(e,t){var n=this;return void 0===t&&(t=!0),u.Async.modifyRemoteStateOptimistic(this._userSettings,function(t){return Object.assign({},t,e)},function(){return n._sync(a.Properties.of(e))},t)},e.prototype.firstCallDone=function(){var e=this;return this._setProperty({firstCall:!0},!1).catch(function(t){t instanceof s.TimeoutError?e._log.warn("Cannot set first call as done",t):e._log.error("Cannot set first call as done",t)})},e.prototype.setDialect=function(e){return this._setProperty({dialectStrong:e}).then(function(t){return e})},e.prototype.setDialectWeak=function(e){return this._setProperty({dialectWeak:e}).then(function(t){return e})},e.prototype.welcomeTourLooked=function(){var e=this;return this._setProperty({seenWelcome:!0},!1).catch(function(t){e._log.warn("Cannot mark welcome tour as looked",t)})},e.prototype.acceptTerms=function(e){return this._setProperty({acceptedTermsVersion:e},!1).catch(this._log.handler("Cannot mark terms as accepted").error)},e.prototype._saveBanners=function(e){var t=e.shown,n=e.later,r=e.dismiss;return{shown:t,later:n.map(function(e){return e.type+":"+e.expire}),dismiss:r}},e.prototype.updateBanners=function(e){var t=this;return u.Async.modifyRemoteStateOptimistic(this.banners,function(t){return e},function(){return t._sync(a.Properties.of({banners:t._saveBanners(e)}))},!1).catch(function(e){e instanceof s.TimeoutError?t._log.warn("Cannot update banners state",e):t._log.error("Cannot update banners state",e)})},e.prototype.toggleMarkAsImportant=function(e,t){var n=Object.assign({},this.denaliLens.get());return n[e]=Object.assign({},n[e],{important:t}),this._setProperty({denaliLens:Object.assign({},n)},!1)},e.prototype.dismissAll=function(e){var t=Object.assign({},this.denaliLens.get());return t[e]=Object.assign({},t[e],{dissmissAllCounter:Math.sqrt(function(e){return e?e*e:1}(t[e]&&t[e].dismissAllCounter||0)+1)}),this._setProperty({denaliLens:Object.assign({},t)},!1)},e.prototype.updateOnboardingPassed=function(e){var t=new Set(this._userSettings.get().onboardingPassed),n=t.size;return e.forEach(function(e){return t.add(e)}),n===t.size?Promise.resolve():this._setProperty({onboardingPassed:Array.from(t)},!1)},e.prototype.updateExitNotification=function(e){var t=this;return this._setProperty({showExitNotification:e},!1).catch(function(e){t._log.warn("Cannot set showExitNotification",e)})},e}();t.SettingsModelImpl=h;var d=""+l.appConfig.userSettingsPrefix+l.appConfig.userSettingsVersion+"-",p=function(){function e(){}return e.read=function(e){try{var t=""+d+e;return a.Properties.of(JSON.parse(u.LocalStorage.readProperties(t)[t]))}catch(e){return a.Properties.of({})}},e.write=function(e,t){u.LocalStorage.writeProperties(a.Properties.of((n={},n[""+d+e]=JSON.stringify(t),n)));var n},e}();t.LocalStorageUserSettings=p},194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=n(27),s=n(7),a=n(386),c=function(e){function t(t){var n=e.call(this,"Client fetch error: "+(t&&t.message||t))||this;return n.name="FetchError",n.cause=t,n}return r.__extends(t,e),t}(s.CustomError);t.FetchError=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="TimeoutWarnError",t}return r.__extends(t,e),t}(s.CustomError);t.TimeoutWarnError=u;var l,h=function(){function e(){}return Object.defineProperty(e,"request",{get:function(){return l||(l=o.Monitoring.TimeSeries.root.getMetric("fetch")),e._request},enumerable:!0,configurable:!0}),e.withTimeout=function(t,n){return function(r,o){return s.Async.promiseWithTimeout(t(r,o),n).catch(function(t){if(t instanceof i.TimeoutError){var n=e._getMeta(r,o),s=n.method,a=n.target;throw e.requestResults.next({type:"timeoutError",url:r,target:a,method:s}),e._extendError(t,r,s,a)}throw t})}},e.withTargetTag=function(t,n){return function(r,o){return"string"==typeof r?(o=o||{},o[e.FETCH_TARGET_TAG_OPTION]=n):r[e.FETCH_TARGET_TAG_OPTION]=n,t(r,o)}},e._withTimeoutWarn=function(t,n){return function(r,o){return i.Observable.merge(t(r,o),i.Observable.interval(n).mapTo(new u)).do(function(t){if(t instanceof u){var n=e._getMeta(r,o),i=n.method,s=n.target;e.requestResults.next({type:"timeoutWarn",url:r,method:i,target:s})}}).filter(function(e){return!(e instanceof u)}).first().toPromise()}},e._extendError=function(e,t,n,r){var o="object"==typeof e?s.isClientFetchError(e)?new c(e):e:new Error(e);return Object.assign(o,{isRxFetch:!0,method:n,target:r,url:"string"==typeof t?t:t.url})},e._getMeta=function(t,n){return{method:e._getMethod(t,n),target:e._getTarget(t,n)}},e._getMethod=function(e,t){return(("string"==typeof e?t&&t.method:e.method)||"get").toLowerCase()},e._getTarget=function(t,n){var r=("string"==typeof t?n&&n[e.FETCH_TARGET_TAG_OPTION]:t[e.FETCH_TARGET_TAG_OPTION])||"unknown";return"logs"===r?void 0:r},e.FETCH_TIMEOUT=15e3,e.FETCH_TARGET_TAG_OPTION="grammarly_target",e.requestResults=new i.Subject,e.nativeFetch=a.bind(window),e._request=function(t,n){var r=e._getMeta(t,n),o=r.method,i=r.target,s=l.getTimer(o+"."+i+".time").start();return e._withTimeoutWarn(e.nativeFetch,e.FETCH_TIMEOUT)(t,n).then(function(n){return i&&s.stop(),e.requestResults.next(n.ok?{type:"success",method:o,target:i}:{type:"serverError",method:o,response:n,url:t,target:i}),n}).catch(function(n){var r="object"==typeof n?n:new Error(n||"Unknown fetch error");throw e.requestResults.next({type:"clientError",url:t,reason:r,method:o,target:i}),e._extendError(r,t,o,i)})},e}();t.RxFetch=h,h.requestResults.subscribe(function(e){if(e.target)try{l.getCounter(e.method+"."+e.target+"."+e.type).increment()}catch(e){console.error("Error while reporting timeseries metrics",e)}})},195:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(5),i=function(){function e(e,t,n,r){this.from=e,this.to=t,this.event=n,this.args=r}return e.prototype.toString=function(){return"Transition: From: "+this.from+" to: "+this.to+" (Args: "+this.args+")"},e}();t.EventInfo=i;var s=function(){function e(t,n){this._log=o.Monitoring.Logging.getLogger("coreclients.fsm"),this._parents={},this._transitions={},this._scheduled=[],this._listeners={},this._inTransition=!1,this._verbose=!1,this._id=++e._ids,this._initial=t,this._current=t,this._final=n||null}return Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFinal",{get:function(){return this._final===this._current},enumerable:!0,configurable:!0}),e.prototype.transition=function(e,t,n){this._transitions[e<<11|n]=t},e.prototype.parent=function(e,t){this._parents[e]=t},e.prototype.is=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.findIndex(function(t){return t===e._current})>=0},e.prototype.from=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(c.bind.apply(c,[void 0,this].concat(e)))},e.prototype.with=function(e){return new a(this,e)},e.prototype.verbose=function(e,t){return this._verbose=!0,this._states=e,this._events=t,this},e.prototype.on=function(e,t){return this._addCallback(this._listeners,e,t),this},e.prototype.event=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var n=this;return r.__generator(this,function(o){return[2,new Promise(function(o,s){return r.__awaiter(n,void 0,void 0,function(){var n,a,c,u,h;return r.__generator(this,function(d){switch(d.label){case 0:if(this._verbose&&this._trace("Handling event: "+this._eventName(e)),this._current===this._final)return this._trace("Cannot handle event "+e+": FSM is in it's final state"),[2,o(!1)];if(this._inTransition)return this._scheduled.push(new l(e,t,o,s)),[2];n=this._current,a=null,c=function(){var s,c,l,h,d,p,f;return r.__generator(this,function(m){switch(m.label){case 0:if(void 0===(s=u._transitions[n<<11|e]))return[3,10];u._inTransition=!0,c=u._listeners[s]||[],l=new i(u._current,s,e,t),m.label=1;case 1:m.trys.push([1,7,8,9]),u._verbose&&u._trace("Transition from "+u._stateName(l.from)+" to "+u._stateName(l.to)+" on "+u._eventName(e)+" Arguments: "+t),h=c.map(function(e){return Promise.resolve(e(l))}),u._current=s,u._inTransition=!1,d=function(e){return r.__generator(this,function(t){switch(t.label){case 0:return[4,u.event(e.event,e.args).then(function(t){return e.done(t)}).catch(function(t){return e.fail(t)})];case 1:return t.sent(),[2]}})},p=u._scheduled.shift(),m.label=2;case 2:return void 0===p?[3,5]:[5,d(p)];case 3:m.sent(),m.label=4;case 4:return p=u._scheduled.shift(),[3,2];case 5:return[4,Promise.all(h).then(function(e){return o(!0)})];case 6:return m.sent(),[3,9];case 7:return f=m.sent(),a=f,[3,9];case 8:return u._inTransition=!1,[7];case 9:return[2,"break"];case 10:return n=u._parents[n],[2]}})},u=this,d.label=1;case 1:return void 0===n?[3,3]:[5,c()];case 2:return h=d.sent(),"break"===h?[3,3]:[3,1];case 3:return a?s(a):o(!1),[2]}})})})]})})},e.prototype._addCallback=function(e,t,n){var r=e[t];return r||(r=[],e[t]=r),r.push(n),this},e.prototype._eventName=function(e){return void 0===this._events?e:this._events[e]},e.prototype._stateName=function(e){return void 0===this._states?e:this._states[e]},e.prototype._trace=function(e){this._log.trace("FSM#"+this._id+" [VERBOSE]: "+e)},e._ids=0,e}();t.StateMachine=s;var a=function(){function e(e,t){this.hsm=e,this.state=t}return e.prototype.childrenOf=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(t){return e.hsm.parent(e.state,t)}),this.hsm},e.prototype.parentOf=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(t){return e.hsm.parent(t,e.state)}),this.hsm},e}();t.WithBuilder=a;var c=function(){function e(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.hsm=e,this._states=t}return e.prototype.to=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new u(this.hsm,this._states,e)},e}();t.TransitionBuilder=c;var u=function(){function e(e,t,n){this.hsm=e,this.from=t,this.to=n}return e.prototype.on=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(t){return e.from.forEach(function(n){return e.to.forEach(function(r){return e.hsm.transition(n,r,t)})})}),this.hsm},e}();t.EventBuilder=u;var l=function(){function e(e,t,n,r){this.event=e,this.args=t,this.done=n,this.fail=r}return e}()},196:function(e,t,n){"use strict";function r(e,t){if(!e)throw new l("string"==typeof t?t:t&&t())}function o(e,t){if(!e)throw new l("string"==typeof t?t:t&&t());return e}function i(e){throw new d(e)}function s(e){if(!u.isObject(e))return!1;var t=e.name,n=e.message;return"FetchError"===t&&n===f||"TypeError"===t&&n===p||"TypeError"===t&&"Failed to fetch"===n}function a(e){return void 0!==e&&(e>=500&&e<=599)}Object.defineProperty(t,"__esModule",{value:!0});var c=n(2),u=n(203);t.CustomError=function(e){void 0===e&&(e="(nomessage)"),Error.call(this,e),this.stack=(new Error).stack,this.message=e,this.name=this.constructor.name},t.CustomError.prototype=Object.create(Error.prototype);var l=function(e){function t(t){return e.call(this,"Invariant condition failed: "+(t||"(unnamed)"))||this}return c.__extends(t,e),t}(t.CustomError);t.InvariantError=l;var h=function(e){function t(t){return e.call(this,t)||this}return c.__extends(t,e),t}(t.CustomError);t.IllegalArgumentError=h;var d=function(e){function t(t){return e.call(this,"Matching not exhaustive"+(t?": unexpected value "+t:""))||this}return c.__extends(t,e),t}(t.CustomError);t.MatchingNotExhaustiveError=d,t.invariant=r,t.expectNonNull=o,t.assertNever=i;var p="NetworkError when attempting to fetch resource.",f="Client fetch error: Failed to fetch";t.isClientFetchError=s,t.isServerErrorCode=a},197:function(e,t,n){"use strict";function r(){return void 0!==window.GR_EXTENSION_ID}function o(e){return"edge"===e?a.getBrowserInfo().parsedVersion>=15:["chrome","firefox","safari"].indexOf(e)>-1}function i(e){return Array.from(e).some(function(e){return e.indexOf("office-addin")>-1})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),a=n(49);!function(e){function t(e){var t=window;try{t.GR_EXTENSION_SEND&&t.GR_EXTENSION_SEND(e)}catch(t){s.Monitoring.Logging.getLogger("utils.extension").error("GR_EXTENSION_SEND("+e+") failed",t)}}function n(){t("editor-fix")}function r(){t("changed-dialect")}function o(){t("cleanup")}e.sendEditorFix=n,e.sendDialectChanged=r,e.sendLogout=o}(t.notifications||(t.notifications={}));!function(e){function t(e){window.top.postMessage({grammarly:!0,action:"open-url",url:e},"*")}e.openUrl=t}(t.actions||(t.actions={})),t.isExtensionInstalled=r,t.isBrowserHasExtension=o,t.isAddinInstalled=i},199:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=n(1371);t.DummyGnarClient=o.DummyGnarClient,t.telemetryContextType={telemetry:r.object},t.denaliTelemetryContextType={gnarSpec:r.object,pageId:r.string};var i=n(1370);t.EditorTelemetry=i.EditorTelemetry,t.TelemetryContainerId=i.TelemetryContainerId,t.errorSource=i.errorSource,t.ErrorSourceType=i.ErrorSourceType,t.DocumentTelemetry=i.DocumentTelemetry,t.CheckSettingName=i.CheckSettingName,t.DocumentTelemetryContext=i.DocumentTelemetryContext,t.AccountAndSupportTelemetry=i.AccountAndSupportTelemetry,t.AccountAndSupportTelemetryContext=i.AccountAndSupportTelemetryContext,t.accountType=i.accountType,t.SubscriptionTelemetry=i.SubscriptionTelemetry,t.SubscriptionTelemetryContext=i.SubscriptionTelemetryContext,t.AppsTelemetry=i.AppsTelemetry,t.AppsTelemetryContext=i.AppsTelemetryContext,t.TrackingAppType=i.TrackingAppType,t.TrackingBannerType=i.TrackingBannerType,t.DictionaryAndLanguageTelemetry=i.DictionaryAndLanguageTelemetry,t.DictionaryAndLanguageTelemetryContext=i.DictionaryAndLanguageTelemetryContext,t.DialectStringTelemetry=i.DialectStringTelemetry,t.TourTelemetry=i.TourTelemetry,t.TourTelemetryContext=i.TourTelemetryContext,t.BannersTelemetry=i.BannersTelemetry;var s=n(1374);t.PixelTracking=s.PixelTracking;var a=n(1376);t.Wootric=a.Wootric,t.WootricViewModel=a.WootricViewModel,t.FullWootricViewModel=a.FullWootricViewModel},201:function(e,t,n){"use strict";function r(e,n){var r=n?t.DefaultAcademicGenresTitleMap[e]:t.GenresTitleMap[e];if(!r)throw new TypeError("Coudn't find title for "+e);return r}function o(e){return{contextualSpelling:e,grammar:e,sentenceStructure:e,punctuation:e,style:e,enhancement:e,plagiarism:e}}function i(e,t){return Object.assign({},e,{plagiarism:t})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(97);t.GenresTitleMap={general:"General (default)",academic:"Academic",academic_general:"General academic",academic_essay:"Essay",academic_report:"Report",academic_case:"Case study",academic_review:"Book/literature review",academic_proposal:"Research proposal",academic_results:"Research results",academic_disser:"Dissertation",academic_letter:"Admission letter",business:"Business",business_other:"General business",business_letter:"Business letter",business_email:"Business email",business_report:"Report",business_memo:"Memo",business_proposal:"Proposal",business_article:"Article/blog post",business_adv:"Ad/website copy",technical:"Technical",technical_other:"General technical",technical_manual:"End-user assistance document",technical_documentation:"Technical documentation",technical_marketing:"Marketing document",medical:"Medical",medical_other:"General medical",medical_regulatory:"Regulatory writing",medical_educational:"Educational writing",creative:"Creative",creative_other:"General creative",creative_nonfiction:"Creative non-fiction",creative_novel:"Novel",creative_script:"Script",creative_story:"Short story",casual:"Casual",casual_other:"General casual",casual_email:"Personal email",casual_blog:"Personal blog post"},t.DefaultAcademicGenresTitleMap=Object.assign({},t.GenresTitleMap,{general:"General",academic_general:"General academic (default)"}),t.getGenreMenuTitle=r,t.createChecksDefaultState=o,t.setPlagiarism=i,t.defaultState={contextualSpelling:!0,grammar:!0,sentenceStructure:!0,punctuation:!0,style:!0,enhancement:!0,plagiarism:!1};var a=function(){function e(e,t,n){this._genre=e,this._checks=t,this._telemetry=n,this.genre=this._genre,this.contextualSpellingEnabled=this._checks.lens("contextualSpelling"),this.grammarEnabled=this._checks.lens("grammar"),this.sentenceStructureEnabled=this._checks.lens("sentenceStructure"),this.punctuationEnabled=this._checks.lens("punctuation"),this.styleEnabled=this._checks.lens("style"),this.enhancementEnabled=this._checks.lens("enhancement"),this.plagiarismEnabled=this._checks.lens("plagiarism"),this.checksEnabled=this._checks}return e.prototype.setGenre=function(e){this._genre.set(e)},e.prototype.toggleFreemiumChecks=function(){var e=[this.contextualSpellingEnabled,this.grammarEnabled,this.punctuationEnabled,this.sentenceStructureEnabled,this.styleEnabled],t=e.some(function(e){return e.get()});e.forEach(function(e){return e.set(!t)}),this._telemetry.settingsToggled(!t,"all")},e.prototype.isAlertGroupEnabled=function(e){var t=this._checks.get();return e===s.AlertGroup.contextualSpelling&&t.contextualSpelling||e===s.AlertGroup.enhancement&&t.enhancement||e===s.AlertGroup.grammar&&t.grammar||e===s.AlertGroup.plagiarism&&t.plagiarism||e===s.AlertGroup.punctuation&&t.punctuation||e===s.AlertGroup.sentenceStructure&&t.sentenceStructure||e===s.AlertGroup.style&&t.style},e}();t.CheckingSettingsModelImpl=a},202:function(e,t,n){"use strict";function r(e){if(!e)return"general";switch(e.split("_")[0]){case"academic":return"academic";case"business":return"business";case"technical":case"medical":return"technical";case"creative":return"creative";case"casual":return"casual";default:return"general"}}function o(e){switch(e){case"general":return"general";case"academic":return"academic_general";case"business":return"business_other";case"technical":return"technical_other";case"creative":return"creative_other";case"casual":return"casual_other";default:;return e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(173),s=n(248),a=n(381),c=n(5),u=n(29);!function(e){function t(e){return{goals:new Set,domain:e,audience:u.None,style:u.None,emotion:u.None}}function n(e,t){return t.map(function(t){return"formal"===t?"creative"!==e&&"casual"!==e:"academic"!==e}).getOrElse(!0)}function r(e,t){return{_A:i._A,name:e,validate:function(e,n){return t.indexOf(e)>-1?i.success(e):i.failure(e,n)}}}function o(e){return{_A:i._A,name:e.name+"Option",validate:function(t,n){return void 0===t?a.either.right(u.None):e.validate(t,n).map(u.Some)}}}function l(e){var t=i.validate(e,v).mapLeft(s.failure).mapLeft(function(e){return c.Monitoring.Logging.getLogger("coreclients.dox.context").warn("failed to parse document context",e),e});return a.either.isLeft(t)?u.Left(t.value):u.Right(t.value)}function h(e){if(void 0!==e)return l(e).fold(function(){},function(e){return e})}function d(e){var t=e.goals,n=e.domain,r=e.audience,o=e.style,i=e.emotion;return{goals:Array.from(t),domain:n.toLowerCase(),audience:r.getOrElse(void 0),style:o.getOrElse(void 0),emotion:i.getOrElse(void 0)}}e.goals=["inform","describe","convince","tellStory"],e.goalsLabels=["Inform","Describe","Convince","Tell A Story"],e.audiences=["general","knowledgeable","expert"],e.styles=["formal","informal"],e.emotions=["mild","strong"],e.domains=["general","academic","business","technical","creative","casual"],e.fromDomain=t,e.empty=t("general"),e.isStyleValidWithDomain=n;var p=r("goal",e.goals),f=r("audience",e.audiences),m=r("style",e.styles),g=r("emotion",e.emotions),_=r("domain",e.domains),y={_A:i._A,name:"goals",validate:function(e,t){return i.array(p).validate(e,t).map(function(e){return new Set(e)})}};e.option=o;var v=i.interface({goals:y,domain:_,audience:o(f),style:o(m),emotion:o(g)});e.tryParse=l,e.parse=h,e.serialize=d}(t.DocumentContext||(t.DocumentContext={})),t.genreToDomain=r,t.domainToGenre=o},203:function(e,t,n){"use strict";function r(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function o(e){return e&&!Array.isArray(e)&&"object"==typeof e}function i(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function s(e){return Object.keys(e).map(function(t){return e[t]})}function a(e,t){return function(n){var r=e,o=n[r],i=h.__rest(n,["symbol"==typeof r?r:r+""]);return"function"==typeof t?h.__assign((s={},s[e]=t(d.Option.of(o)),s),i):h.__assign((a={},a[e]=t,a),i);var s,a}}function c(e,t){return function(n){var r=e,o=n[r],i=h.__rest(n,["symbol"==typeof r?r:r+""]);return("function"==typeof t?t(d.Option.of(o)):t).fold(function(){return i},function(t){return h.__assign((n={},n[e]=t,n),i);var n})}}function u(e,t){return l(l({},e),t)}function l(e,t){for(var n in t){var r=e[n]||{},o=t[n];null!=o&&null!=r&&o.constructor===Object&&r.constructor===Object?e[n]=l(r,o):e[n]=o}return e}Object.defineProperty(t,"__esModule",{value:!0});var h=n(2),d=n(29);t.objectWithoutProperties=r,t.isObject=o,t.isEmptyObject=i,t.toArray=s,t.immutableUpdate=a,t.immutableUpdateOption=c,t.merge=u},204:function(e,t,n){"use strict";function r(e,n){var r="function"==typeof e?e:n,o="function"!=typeof e?e:void 0;return r.contextTypes=t.baseComponentContextTypes,o&&(r.propTypes=o),r}function o(e){return r(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),s=n(17),a=n(22),c=n(199),u=n(147),l=n(545),h=n(208),d=n(145),p=n(27),f={appConfig:a.object},m={screen:a.object};t.baseComponentContextTypes=Object.assign({router:a.object},d.Router.ContextTypes,f,c.telemetryContextType,c.denaliTelemetryContextType,u.TextResources.ContextTypes,h.notificationsContextTypes,l.Tooltip.ContextTypes,m);var g=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(n,e),n.contextTypes=t.baseComponentContextTypes,n}(s.Component);t.BaseComponent=g,t.component=r,t.withContext=o;var _=function(){function e(){this.resize=p.Observable.fromEvent(window,"resize").share().mapTo(void 0)}return Object.defineProperty(e.prototype,"remSize",{get:function(){var e=this;return this.resize.map(function(){return e._getRemSize()}).startWith(this._getRemSize()).distinctUntilChanged()},enumerable:!0,configurable:!0}),e.prototype._getRemSize=function(){return parseFloat(getComputedStyle(document.documentElement).fontSize||"16")},e}();t.ScreenContextImpl=_},205:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.updateBilling=0]="updateBilling",e[e.paymentError=1]="paymentError",e[e.subscriptionUpdated=2]="subscriptionUpdated",e[e.subscriptionCancelled=3]="subscriptionCancelled",e[e.cantUpgradeSubscription=4]="cantUpgradeSubscription",e[e.resumedSubscription=5]="resumedSubscription",e[e.cantResumeSubscription=6]="cantResumeSubscription",e[e.unknownError=7]="unknownError",e[e.mobileCancel=8]="mobileCancel",e[e.paypalSuccess=9]="paypalSuccess",e[e.paypalError=10]="paypalError"}(t.SubscriptionNotificationType||(t.SubscriptionNotificationType={}))},206:function(e,t,n){"use strict";function r(e){return e instanceof c.Observable?e:c.Observable.of(e)}function o(e,t){return e instanceof c.Observable?e.map(t):t(e)}function i(e){return c.Observable.fromPromise(e().then(function(e){return a.Some(a.Right(e))}).catch(function(e){return a.Some(a.Left(e))})).startWith(a.None)}function s(e){return function(t,n){return n.catch(e.handler(t+" exception").error).retry(3).subscribe()}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(29),c=n(27);t.voidValue=void 0,t.toVoid=function(){return t.voidValue},t.toOptionValueOnly=function(e){return e.fold(function(){return c.Observable.empty()},function(e){return c.Observable.of(e)})},t.toAtom=function(e){return function(t){return e.set(t)}},t.or=function(e,t){return function(n){return n?e:t}},t.orEmpty=function(e){return t.or(e,c.Observable.empty())},t.delay=function(e,t){return c.Observable.of(e).delay(t)},t.toObservable=r,t.mapMaybeObservable=o,t.promiseToStream=i,t.createRetrySubscriber=s},207:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(73),i=n(289),s=n(149);!function(e){function t(e){return r.__awaiter(this,void 0,void 0,function(){var t,s,u;return r.__generator(this,function(r){switch(r.label){case 0:t={},s="",r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.text()];case 2:return s=r.sent(),t=JSON.parse(s),[3,4];case 3:return u=r.sent(),t={info:"unknown"},[3,4];case 4:switch(t.info){case"too_big":throw new n(i.MAX_FILE_SIZE,t.status,t.info,e.url);case"document not found":throw new a(t.status,t.info,e.url);case"user not found":throw new c(t.status,t.info,e.url);case"tracked":throw new l(t.status,t.info,e.url);case"too many requests":throw new h(t.status,t.info,e.url);default:throw new o.HTTPError({code:e.status,status:e.statusText,url:e.url,body:s})}return[2]}})})}e.DoxWsErrorCodes={NORMAL_CLOSURE:1e3,GOING_AWAY:1001,TOO_BIG:1009,VIOLATED_POLICY:1008,UNEXPECTED_CONDITION:1011,SERVICE_RESTART:1012,BLOCKED_BY_CLIENT:4e3,UNAUTHORIZED:4001,NOT_FOUND:4004,TOO_MANY_REQUESTS:4029,UNKNOWN_WS_ERROR:-1},e.DoxHttpErrorCodes={NOT_FOUND:404,UNAUTHORIZED:401,BAD_REQUEST:400,TOO_MANY_REQUESTS:429},e.CLOSED_ERROR=new s.WSError({status:"closed",message:"client was closed from client side"});var n=function(t){function n(n,r,o,i){void 0===r&&(r="too_big"),void 0===o&&(o="Document is too big");var s=t.call(this,{code:e.DoxHttpErrorCodes.BAD_REQUEST,message:o,url:i,status:r})||this;return s.maxSizeLimit=n,s.name="FileSizeOutOfRangeError",s}return r.__extends(n,t),n}(o.HTTPError);e.FileSizeOutOfRangeError=n;var a=function(t){function n(n,r,o){void 0===n&&(n="not_found"),void 0===r&&(r="Document doesn't exist");var i=t.call(this,{code:e.DoxHttpErrorCodes.NOT_FOUND,message:r,url:o,status:n})||this;return i.name="DocumentNotFoundError",i}return r.__extends(n,t),n}(o.HTTPError);e.DocumentNotFoundError=a;var c=function(t){function n(n,r,o){void 0===n&&(n="error"),void 0===r&&(r="user not found");var i=t.call(this,{code:e.DoxHttpErrorCodes.UNAUTHORIZED,message:r,url:o,status:n})||this;return i.name="UnauthorizedError",i}return r.__extends(n,t),n}(o.HTTPError);e.UnauthorizedError=c;var u=function(t){function n(n,r,o,i){void 0===r&&(r="bad_type"),void 0===o&&(o="Unsupported file type");var s=t.call(this,{code:e.DoxHttpErrorCodes.BAD_REQUEST,message:o,url:i,status:r})||this;return s.originalFileName=n,s.name="UnsupportedFileTypeError",s}return r.__extends(n,t),n}(o.HTTPError);e.UnsupportedFileTypeError=u;var l=function(t){function n(n,r,o){void 0===n&&(n="error"),void 0===r&&(r="Document with tracked changes is not supported");var i=t.call(this,{code:e.DoxHttpErrorCodes.BAD_REQUEST,message:r,url:o,status:n})||this;return i.name="TrackedChangesIsUnsupported",i}return r.__extends(n,t),n}(o.HTTPError);e.TrackedChangesIsUnsupported=l;var h=function(t){function n(n,r,o){void 0===n&&(n="error"),void 0===r&&(r="Too many requests");var i=t.call(this,{code:e.DoxHttpErrorCodes.TOO_MANY_REQUESTS,message:r,url:o,status:n})||this;return i.name="TooManyRequestsError",i}return r.__extends(n,t),n}(o.HTTPError);e.TooManyRequestsError=h;var d=function(e){function t(t,n,r,o){void 0===n&&(n=0),void 0===r&&(r="connect_error"),void 0===o&&(o="Cannot connect");var i=e.call(this,{code:n,message:o,url:t,status:r})||this;return i.name="ConnectionError",i}return r.__extends(t,e),t}(o.HTTPError);e.ConnectionError=d;var p=function(e){function t(t,n,r,o){void 0===n&&(n="disconnected"),void 0===r&&(r="Cannot connect to DOX");var i=e.call(this,{status:n,message:r,code:t,url:o})||this;return i.name="WSDisconnectedOnInitError",i}return r.__extends(t,e),t}(s.WSError);e.WSDisconnectedOnInitError=p;var f=function(t){function n(n,r,o){void 0===n&&(n="too_big"),void 0===r&&(r="Message is too big, server rejected it");var i=t.call(this,{status:n,message:r,code:e.DoxWsErrorCodes.TOO_BIG,url:o})||this;return i.name="WSMessageIsTooBigError",i}return r.__extends(n,t),n}(s.WSError);e.WSMessageIsTooBigError=f;var m=function(e){function t(t,n,r,o,i){void 0===o&&(o="Disconnected after multiple retries");var s=e.call(this,{status:r,message:o,code:n,url:i})||this;return s.retriesMade=t,s}return r.__extends(t,e),t}(s.WSError);e.WSDisconnectedAfterMultipleRetries=m,e.doxErrorMapper=t}(t.DoxErrors||(t.DoxErrors={}))},208:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=n(12),i=n(5),s=function(){function e(){}return e.prototype.error=function(e){return{type:"error",args:{errorMessage:e},dontRemoveOnAnyAction:!0,denaliShowTimeMs:1/0,denaliCloseOnClick:!0}},e.prototype.documentUploaded=function(e){return{type:"documentUploaded",args:{navigateToDocument:e},showTimeMs:1/0}},e.prototype.denaliDocumentUploaded=function(e){return{type:"denaliDocumentUploaded",args:{navigateToDocuments:e},severity:"info",showTimeMs:1/0}},e.prototype.newDocumentCreated=function(e){return{type:"newDocumentCreated",args:{navigateToDocument:e},showTimeMs:1/0}},e.prototype.documentDeleted=function(e,t,n,r){return void 0===r&&(r=!1),{type:"documentDeleted",args:{documentTitle:t,documentId:e,failedToRestore:r,restoreDocument:n}}},e.prototype.documentTypeUnsupported=function(){return{type:"documentTypeUnsupported"}},e.prototype.trackedChangesIsUnsupported=function(){return{type:"trackedChangesIsUnsupported",showTimeMs:3e4}},e.prototype.documentUploadGeneralError=function(){return{type:"documentUploadGeneralError"}},e.prototype.documentIsEmpty=function(){return{type:"documentIsEmpty"}},e.prototype.generic=function(e,t,n){return{type:"generic",args:{message:e,description:t},severity:n||"info",denaliShowTimeMs:5e3}},e.prototype.documentSizeExceeded=function(){return{type:"documentSizeExceeded"}},e.prototype.changeEmail=function(e){return{type:"changeEmail",args:{email:e}}},e.prototype.logoutError=function(e,t){return{type:"logoutError",args:{forceRetry:e,timeToRetry:t},showTimeMs:1/0,dontCloseOnClick:!0,important:!0,severity:"error"}},e.prototype.unauthorizedError=function(){return{type:"unauthorizedError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0,severity:"error"}},e.prototype.offline=function(e,t){return{type:"offline",args:{resetClock:e,reconnectTime:t},showTimeMs:1/0,dontCloseOnClick:!0,important:!0,severity:"error"}},e.prototype.slowNetwork=function(){return{type:"slowNetwork",showTimeMs:1/0,dontCloseOnClick:!0,denaliShowTimeMs:5e3,denaliCloseOnClick:!0}},e.prototype.serverError=function(){return{type:"serverError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0,severity:"error"}},e.prototype.unknownConnectionError=function(){return{type:"unknownConnectionError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0,severity:"error"}},e.prototype.connectionWSError=function(){return{type:"connectionWSError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0,severity:"error"}},e.prototype.clientConnectionError=function(){return{type:"clientConnectionError",showTimeMs:1/0,dontCloseOnClick:!0,important:!0,severity:"error"}},e.prototype.checkingIsDown=function(){return{type:"checkingIsDown",showTimeMs:1/0,dontCloseOnClick:!0,denaliCloseOnClick:!0}},e.prototype.extensionInstallFailed=function(){return{type:"extensionInstallFailed"}},e.prototype.copyToClipboardFailed=function(){return{type:"copyToClipboardFailed",denaliShowTimeMs:5e3,denaliCloseOnClick:!0}},e.prototype.alertUndo=function(e,t){return{type:"alertUndo",args:{undoAction:e,action:t},showTimeMs:1/0,size:"flexible",severity:"info"}},e.prototype.denaliAlertUndo=function(e,t,n){return{type:"alertUndoDenali",undoHandler:e,dismissedHandler:t,args:n,denaliShowTimeMs:5e3,size:"flexible",severity:"info",exclusiveTag:"alertUndoDenali"}},e.prototype.proofitPaymentDeclinedError=function(e,t){return{type:"proofitPaymentDeclinedError",denaliCloseOnClick:!0,denaliShowTimeMs:1/0,args:{paymentMethod:e,creditCardSuffix:t}}},e.prototype.proofitEmptyDocumentError=function(){return{type:"proofitEmptyDocumentError",denaliCloseOnClick:!0,denaliShowTimeMs:1/0}},e.prototype.proofitDocumentProofreadError=function(e){return{type:"proofitDocumentProofreadError",denaliCloseOnClick:!0,denaliShowTimeMs:1/0,args:{navigateToDocuments:e}}},e.prototype.proofitCancelled=function(){return{type:"proofitCancelled",denaliCloseOnClick:!0,denaliShowTimeMs:1/0}},e.prototype.proofitCompleted=function(e,t,n){return{type:"proofitCompleted",severity:"info",denaliCloseOnClick:!0,denaliShowTimeMs:1/0,args:{email:e,documentTitle:t,documentDownloadUrl:n}}},e.prototype.proofitInProgress=function(e){return{type:"proofitInProgress",args:{email:e}}},e}();t.EditorNotificationFactory=s,t.defaultState={items:[],counterId:0};var a=function(){function e(e){this._getNotification=e}return e.prototype.show=function(e){return this._getNotification().show(e)},e.prototype.showMessage=function(e){return this._getNotification().showMessage(e)},e.prototype.showError=function(e,t){return this._getNotification().showError(e,t)},e.prototype.hide=function(e){return this._getNotification().hide(e)},Object.defineProperty(e.prototype,"create",{get:function(){return this._getNotification().create},enumerable:!0,configurable:!0}),e}();t.ProxyShowNotificationsModel=a;var c=function(){function e(e){this._state=e,this._items=this._state.lens("items"),this.items=this._items.view(),this.create=new s}return e.prototype.show=function(e){return i.Monitoring.Logging.getLogger("notifications").log("error"===e.type?i.Logging.LogLevel.WARN:i.Logging.LogLevel.INFO,"Notification shown: "+e.type,i.EventProps.fromAny(e)),this._addNotifications(this._state,e).id},e.prototype.showMessage=function(e,t){return this.show(this.create.generic(e,t))},e.prototype.showError=function(e){return this.show(this.create.error(e))},e.prototype.hide=function(e){this._hideNotification(this._state,e)},e.prototype.expire=function(e){this._hideNotification(this._state,e)},e.prototype.cleanup=function(){this._items.modify(this._cleanup)},e.prototype._addNotifications=function(e,t){var n=this,r=(e.get().counterId||0)+1,o=Object.assign({},t,{id:r});return e.modify(function(e){var t=n._cleanup(e&&e.items||[]),i=t.filter(function(e){return e.important}),s=t.filter(function(e){return!e.important});return{counterId:r,items:i.concat([o],s)}}),o},e.prototype._cleanup=function(e){return e.filter(function(e){return e&&!e.expired&&(e.dontRemoveOnAnyAction||e.important)})},e.prototype._hideNotification=function(e,t){e.lens("items").lens(o.Lens.find(function(e){return t===e.id})).lens(o.Lens.create(function(e){return e&&e.expired},function(e,t){return t?Object.assign({},t,{expired:e}):t})).set(!0)},e}();t.NotificationsModelImpl=c,t.notificationsContextTypes={notifications:r.object}},289:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_FILE_SIZE=4194304},290:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(60),i=n(117),s=function(){function e(e,t){void 0===t&&(t=0),this._operations=e,this.rev=t}return e.prototype.toString=function(){return this._operations.map(function(e){return e.toString()}).join(" ")},e.prototype.withRevision=function(t){return new e(this._operations,t)},Object.defineProperty(e.prototype,"revision",{get:function(){return this.rev},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"operations",{get:function(){return this._operations},enumerable:!0,configurable:!0}),e.prototype.apply=function(e){for(var t=this.sequencify(),n=0,r=t._operations;n<r.length;n++){e=r[n].apply(e)}return e},e.prototype.sequencify=function(){var t=this,n=[];return this._operations.forEach(function(e){if("="!==e.type){var r=[e];n.forEach(function(e){r=r.map(function(n){return n.transformAgainst(e,t.rev,t.rev)}).reduce(function(e,t){return e.concat(t)},[])}),n=n.concat(r)}}),new e(n,this.rev)},e.prototype.transformAgainst=function(t){var n=this;if(t instanceof e){var r=[],o=t;return o=o.sequencify(),this._operations.forEach(function(e){var t=[e];o._operations.forEach(function(e){t=t.map(function(t){return t.transformAgainst(e,n.rev,o.rev)}).reduce(function(e,t){return e.concat(t)},[])}),r=r.concat(t)}),new e(r,this.rev)}throw new Error("Should be transformed only against Changesets")},e.prototype.pack=function(e){var t=this;return this._operations.map(function(n){return n.pack(e||t.rev)}).join("")},e.unpack=function(t){if(Array.isArray(t))throw new Error("Illegal argument "+t);if(""===t)return new e([]);var n=t.match(/(\+|-|=)\w+?:\w+?:[^:]*?:\w+/g);if(!n)throw new Error("Cannot unpack invalid serialized changeset string");var r=0;return new e(n.filter(function(e){return!e.startsWith("=")}).map(function(e){var t=e.substr(1).split(":");r=parseInt(t[3],36);var n=e.substr(0,1);return new i.Operation(n,parseInt(t[0],36),t[2].replace(/%3A/gi,":").replace(/%25/g,"%"),parseInt(t[1],36))}),r)},e}();t.Changesets=s;var a=function(e){function t(t){void 0===t&&(t="Unknown reason");var n=e.call(this,t)||this;return n.name="OTError",n.reason=t,n}return r.__extends(t,e),t}(o.CustomError);t.OTError=a;var c=function(e){function t(t){void 0===t&&(t="removed");var n=e.call(this,t)||this;return n.name="OTRemoveError",n}return r.__extends(t,e),t}(a);t.OTRemoveError=c;var u=function(){function e(e,t,n,r){void 0===n&&(n=function(){}),void 0===r&&(r=function(){}),this.changes=e,this.revision=t,this.successCallback=n,this.failureCallback=r,this._cs=new s(this.changes,this.revision)}return e.prototype.apply=function(e){return this._cs.apply(e)},e.prototype.pack=function(){return this._cs.pack()},e}();t.Revision=u;var l=function(e){function t(t,n){return void 0===n&&(n=0),e.call(this,t,n)||this}return r.__extends(t,e),t.prototype.sequencify=function(){return this},t}(s);t.OperationsSet=l;var h=function(){function e(e){void 0===e&&(e=0),this._operations=[],this._staging=!1,this._revision=e}return Object.defineProperty(e.prototype,"revision",{get:function(){return this._revision},enumerable:!0,configurable:!0}),e.prototype.push=function(e,t,n){this.pushAll([e],t,n)},e.prototype.pushAll=function(e,t,n){var r=new u(e,++this._revision,t,n);this._operations.push(r)},e.prototype.clear=function(e,t){void 0===t&&(t=0);var n="string"==typeof e?e:e.message;this._operations.forEach(function(e){return e.failureCallback(new a(n))}),this._operations=[],this._revision=t,this._staging=!1},e.prototype.acknowledge=function(e){if(this._staging){this._staging=!1;var t=this._operations.shift();t&&t.successCallback(e)}},e.prototype.forEach=function(e){this._operations.forEach(function(t){return e(new s(t.changes,t.revision))})},e.prototype.remove=function(){var e=this._operations.shift();return e&&(this._staging=!1,e.failureCallback(new c)),void 0!==e},e.prototype.poll=function(){var e=this._operations.slice(0,1);return 0===e.length?null:(this._staging=!0,e[0])},e.prototype.pop=function(){var e=this._operations.shift();return void 0===e?null:e},e.prototype.popAll=function(){if(this.isStaging)throw new Error("Invalid state");var e=this._operations;return this._operations=[],e},e.prototype.reload=function(e,t){if(this._staging){var n=this._operations.slice(0,1);if(0!==n.length){try{var r=n[0];t=new s(r.changes,e._revision).apply(t),e.pushAll(r.changes,r.successCallback,r.failureCallback),e._staging=!0}catch(e){}this.remove()}}try{for(var o=t,i=0,c=this._operations;i<c.length;i++){var u=c[i];o=new s(u.changes,e._revision).apply(o)}t=o;for(var l=0,h=this._operations;l<h.length;l++){var u=h[l];e.pushAll(u.changes,u.successCallback,u.failureCallback)}}catch(e){for(var d=0,p=this._operations;d<p.length;d++){var u=p[d];u.failureCallback(new a("cannot be applied"))}}return t},Object.defineProperty(e.prototype,"length",{get:function(){return this._operations.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStaging",{get:function(){return this._staging},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._operations.length},enumerable:!0,configurable:!0}),e.prototype.transformAgainst=function(e,t){void 0===t&&(t=e.revision);var n=t+1;return this._operations=this._operations.map(function(t){var r=new s(t.changes,n),o=e.transformAgainst(r),i=r.transformAgainst(e);return e=o,new u(i.operations,i.revision,t.successCallback,t.failureCallback)}),this._revision=this.isEmpty?t:this._operations[this.length-1].revision,e.withRevision(e.revision)},e.prototype.getChangesSince=function(e){return this._operations.filter(function(t){return t.revision>e}).map(function(e){return new s(e.changes,e.revision)})},e}();t.ChangesetsQueue=h},291:function(e,t,n){"use strict";function r(e,t,n,r){switch(t.kind){case"common":return new i.CommonCardModelImpl(e,t,n,r);case"plagiarism":return new i.PlagiarismCardModelImpl(e,t,n);case"enhancement":return new i.EnhancementCardModelImpl(e,t,n,r);case"synonym":return new i.SynonymsCardModelImpl(e,t,n);default:var o=t;throw new a.MatchingNotExhaustiveError(o)}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),i=n(296),s=n(571),a=n(7);t.defaultState={cardHeights:{},cardStates:{}};var c=function(){function e(e,t,n){var r=this;this._state=e,this._editor=t,this._features=n,this._cardsHeights=this._state.lens("cardHeights"),this._cardsState=this._state.lens("cardStates"),this.positions=o.Atom.combine(this._editor.alerts,this._cardsHeights,function(e,t){return s.getCardsPositions(Object.keys(e).reduce(function(n,r){return n[r]={alert:e[r],cardHeight:t[r]||i.DEFAULT_CARD_HEIGHT},n},{}))}),this.focusedCardHeight=this._editor.focusedAlert.switchMap(function(e){return r._cardsHeights.view(function(t){return e.id?t[e.id]:null})}),this.guideId=o.Atom.combine(this._editor.highlightedAlert,this._editor.focusedAlert,function(e,t){if(!e)return null;var n=t.id&&r._cardsState.get()[t.id];return e===t.id&&!n||n&&n.transientVisualState!==i.VisualState.applied?null:e})}return e.prototype.setCardHeight=function(e,t){this._cardsHeights.modify(function(n){return Object.assign({},n,(r={},r[e]=t,r));var r})},e.prototype.getOrCreateCardModel=function(e){var t=this._editor.alerts.get()[e];a.invariant(null!==t,"expect alert #"+e+" to exist");var n="synonym"===t.alert.kind?i.defaultSynonymState:i.defaultState;return this._cardsState.modify(function(t){return t[e]?t:Object.assign({},t,(r={},r[e]=n,r));var r}),r(this._cardsState.lens(o.Lens.key(e).compose(o.Lens.withDefault(n))),t.alert,this._editor,this._features)},e.prototype.removeCardModelState=function(e){this._cardsState.modify(function(t){return a.ObjectUtils.objectWithoutProperties(t,[e])})},e}();t.CardsModelImpl=c},292:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.words=0]="words",e[e.characters=1]="characters",e[e.speakingTime=2]="speakingTime",e[e.readingTime=3]="readingTime"}(r=t.TextStatsView||(t.TextStatsView={})),t.defaultState={textStatsView:r.words};var o=[r.words,r.characters,r.readingTime,r.speakingTime],i=function(){function e(e){this._state=e,this.textStatsView=this._state.lens("textStatsView")}return e.prototype.toggleTextStatsView=function(){this.textStatsView.set(o[(o.indexOf(this.textStatsView.get())+1)%o.length])},e}();t.TextStatsModelImpl=i},293:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(60),o=n(48);t.PaymentPlan=o.PaymentPlan,t.PaymentMethod=o.PaymentMethod;var i=n(12),s=n(5),a=n(7),c=n(205),u=n(1366),l=n(1367),h=n(567);t.defaultState=a.Async.defaultValue();var d=function(){function e(n,o,s,h,d,p,f,m,g){var _=this;this.state=n,this._irbisApi=o,this._subscribeUrl=s,this._upgradeBaseUrl=h,this._subscriptionUrl=d,this._browserType=p,this._telemetry=f,this._appConfig=m,this._userId=g,this._notification=i.Atom.create(null),this._operation=null,this._getSubsciption=function(){return _._irbisApi.getStatus().then(function(e){return e.plans||(e.plans=[]),e})},this._updateSubscriptionState=function(){return _._getSubsciption().then(function(e){return _.state.set(a.Async.ok(e)),e})},this.notification=this._notification,this.braintreeApi=new u.BraintreeModelImpl(this,this._irbisApi,this._updateSubscriptionState),this.paypalApi=new l.PayPalModelImpl(this,this._irbisApi,this._updateSubscriptionState),this.browserType=this._browserType,this.ensureHasSubscription=function(){r.invariant(null!==_._operation,"operation must be created"),_._operation=_._operation;var e=_.state.get();a.Async.isOk(e)||a.Async.isInProgress(e)||(a.Async.isError(e)&&_._operation.unsubscribe(),_._operation=null,_.state.set(t.defaultState),_._createOperation())},this.setNotification=function(e,t){requestAnimationFrame(function(){return _._notification.set({type:e,planName:t})})},this._createOperation(),this.state.subscribe(function(t){a.Async.isError(t)&&1===t.attempt?e._log.warn("cant get user subscription",t.error):a.Async.isFatal(t)&&(e._log.error("cant get user subscription",t.error),_.setNotification(c.SubscriptionNotificationType.unknownError))})}return e.prototype.clearNotification=function(){this._notification.set(null)},e.prototype.changePlan=function(t){var n=this;return this.clearNotification(),this._irbisApi.changePlan(t).then(this._updateSubscriptionState).then(function(e){n.setNotification(c.SubscriptionNotificationType.subscriptionUpdated,e.queuedPlan&&e.queuedPlan.title||e.currentPlan.title)}).catch(function(t){n.setNotification(c.SubscriptionNotificationType.cantUpgradeSubscription),e._log.error("changePlan: cantUpgradeSubscription",t)})},e.prototype.cancelSubscription=function(){var t=this;return this._telemetry.confirmSubscriptionCancelClicked(),this.clearNotification(),this._irbisApi.cancelSubscription().then(this._updateSubscriptionState).then(function(){return t.setNotification(c.SubscriptionNotificationType.subscriptionCancelled)}).catch(function(n){t.setNotification(c.SubscriptionNotificationType.unknownError),e._log.error("cancelSubscription: unknownError",n)})},e.prototype.renewSubscription=function(){var t=this;return this._telemetry.reactivateSubscriptionClicked(),this.clearNotification(),this._irbisApi.renewSubscription().then(this._updateSubscriptionState).then(function(){return t.setNotification(c.SubscriptionNotificationType.resumedSubscription)}).catch(function(n){t.setNotification(c.SubscriptionNotificationType.cantResumeSubscription),e._log.error("renewSubscription: cantResumeSubscription",n)})},e.prototype.navigateToSubscribeUrl=function(){document.location.href=this._subscribeUrl},e.prototype.navigateToUpgradeUrl=function(e,t){var n=h.getUpgradeUrl(this._upgradeBaseUrl,e,t);window.parent===window?a.DesktopEditor.actions.openUpgradeUrl(n,this._appConfig,this._userId)||(document.location.href=n):a.Extension.actions.openUrl(n)},e.prototype.downloadBillingReceipts=function(){var e=this;return this._irbisApi.checkDownloadBillingReceipts().then(function(){return window.location.href=e._subscriptionUrl+"/receipt",e._telemetry.downloadReceiptButtonClicked(),a.delay(500)}).then(a.noop).catch(function(t){e.setNotification(c.SubscriptionNotificationType.unknownError),e._telemetry.downloadReceiptError(t)})},e.prototype._createOperation=function(){r.invariant(null===this._operation,"cant create another operation"),this._operation=a.Async.OperationRetrier.create(this._getSubsciption,this.state,a.Async.OperationRetrier.RetryStrategy.conditional(function(e){return 401!==e.code},a.Async.OperationRetrier.RetryStrategy.linear(3,3e3)))},e._log=s.Monitoring.Logging.getLogger("model.subscription"),e}();t.SubscriptionModelImpl=d},295:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(12),s=n(843);t.Spinner=function(e){var t=e.className,n=void 0!==t&&t,a=e.size,c=void 0===a?18:a,u=e.color,l=void 0===u?"#666":u,h={width:c+"px",height:c+"px",backgroundColor:l};return o.createElement("div",r.__assign({},i.classes(s.spinner,n)),o.createElement("div",{style:h,className:s.item}),o.createElement("div",{style:h,className:s.item}),o.createElement("div",{style:h,className:s.item}))}},296:function(e,t,n){"use strict";function r(e){var t=e.category,n=e.extraProperties,r=e.todo;return"Unknown"===t?"Unknown word":"Misspelled"===t?"":n.isDidYouMean||n.isShowTitle?"Check word usage":r}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(12),s=n(5),a=n(97),c=n(559);t.CommonHeaderModel=c.CommonHeaderModel;var u=n(297),l=n(7);t.DEFAULT_CARD_HEIGHT=36;var h;!function(e){e[e.expanded=0]="expanded",e[e.expandedMore=1]="expandedMore",e[e.collapsed=2]="collapsed",e[e.applied=3]="applied",e[e.hidden=4]="hidden"}(h=t.VisualState||(t.VisualState={})),t.defaultState={hovered:!1,expandButtonHovered:!1,undoButtonHovered:!1,transientVisualState:h.collapsed},t.defaultSynonymState={hovered:!1,expandButtonHovered:!1,undoButtonHovered:!1,transientVisualState:h.expanded};var d=function(){function e(e,t){this._state=e,this._focused=t,this._transientVisualState=this._state.lens("transientVisualState"),this.visualState=i.Atom.combine(this._transientVisualState,this._focused,function(e,t){return t?e===h.collapsed?h.expanded:e:e===h.expanded||e===h.expandedMore?h.collapsed:e}),this.isExpanded=this._transientVisualState.view(function(e){return e===h.expanded}),this.isExpandedMore=this._transientVisualState.view(function(e){return e===h.expandedMore}),this.isApplied=this._transientVisualState.view(function(e){return e===h.applied}),this.isHidden=this._transientVisualState.view(function(e){return e===h.hidden}),this.isActive=this._transientVisualState.view(function(e){return e===h.expanded||e===h.expandedMore}),this.isExpandButtonHovered=this._state.lens("expandButtonHovered"),this.isUndoButtonHovered=this._state.lens("undoButtonHovered"),this.isCardHovered=this._state.lens("hovered")}return e.prototype._transitionState=function(e,t){var n,r,o=this;if(this._transientVisualState.modify(function(t){var i=o.visualState.get(),s=e.find(function(e){return void 0!==e.from.find(function(e){return i===e})});if(s)return n=i,r=s.to,s.to;throw new TypeError("Can't transition Card from "+h[i])}),void 0===n||void 0===r)throw new l.InvariantError("Expected modify to complete by this point");t&&t(n,r)},e}();t.CardModelStateImpl=d;var p=function(e){function t(t,n,r){var o=e.call(this,t,r.isFocused(n.id))||this;return o._editorEngine=r,o.replace=function(e){o._applyThisAlert({action:"replace",replacementText:e,isSynonym:!1})},o.id=n.id,o.title=n.title,o}return o.__extends(t,e),t.prototype.toggleExpand=function(){var e=this.visualState.get()===h.collapsed;e?this._editorEngine.setFocusedAlert(this.id,"click"):(this._editorEngine.setHighlightedAlert(null),this._editorEngine.setFocusedAlert(null,null)),this._transitionState([{from:[h.expanded,h.expandedMore],to:h.collapsed},{from:[h.collapsed],to:h.expanded}]),e&&t._cardExpandCounter.increment()},t.prototype.hoverExpandButton=function(){this.isExpandButtonHovered.set(!0)},t.prototype.unhoverExpandButton=function(){this.isExpandButtonHovered.set(!1)},t.prototype.hoverUndoButton=function(){this.isUndoButtonHovered.set(!0)},t.prototype.unhoverUndoButton=function(){this.isUndoButtonHovered.set(!1)},t.prototype.hoverCard=function(){this._editorEngine.setHighlightedAlert(this.id),this.isCardHovered.set(!0)},t.prototype.unhoverCard=function(){this._editorEngine.setHighlightedAlert(null),this.isCardHovered.set(!1)},t.prototype.toggleMore=function(){this._transitionState([{from:[h.expanded],to:h.expandedMore},{from:[h.expandedMore],to:h.expanded}])},t.prototype.expand=function(){this._transitionState([{from:[h.collapsed],to:h.expanded}])},t.prototype.collapse=function(){this._transitionState([{from:[h.expanded,h.expandedMore],to:h.collapsed}])},t.prototype.showMore=function(){this._transitionState([{from:[h.expanded],to:h.expandedMore}])},t.prototype.showLess=function(){this._transitionState([{from:[h.expandedMore],to:h.expanded}])},t.prototype.hide=function(){this._transitionState([{from:[h.applied],to:h.hidden}])},t.prototype._applyThisAlert=function(e){this._editorEngine.applyAlert(this.id,e),this._transitionState([{from:[h.expanded,h.expandedMore,h.collapsed],to:h.applied}]),t._cardApplyCounter.getCounter(e.action).increment()},t.prototype.ignore=function(){this._applyThisAlert({action:"ignore"})},t.prototype.acknowledge=function(){this._applyThisAlert({action:"acknowledge"})},t.prototype.addToDictionary=function(){this._applyThisAlert({action:"addToDictionary"})},t.prototype.undoInteraction=function(){this._editorEngine.undoLastAlertAction(),this.unhoverUndoButton(),this._transitionState([{from:[h.applied],to:h.collapsed}])},t._cardExpandCounter=s.Monitoring.TimeSeries.root.getCounter("cards.expand"),t._cardApplyCounter=s.Monitoring.TimeSeries.root.getCounter("cards.apply"),t}(d);t.CardModelBaseImpl=p;var f=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r)||this;return i._alert=n,i._features=o,i.kind="common",i.highlightText=i._alert.highlightText,i.isTextCard=u.isNoReplacement(i._alert.replacements),i.isUnknowWord="Unknown"===i._alert.category,i.details=i._alert.details,i.examples=i._alert.examples,i.explanation=i._alert.explanation,i.extraProperties=i._alert.extraProperties,i.hasReplacementsInContent=!u.isNoReplacement(i._alert.replacements)&&!!i.extraProperties.isShowTitle,i.hasAcknowledgeButton=0===i._alert.replacements.length&&i._alert.group!==a.AlertGroup.contextualSpelling,i.hasAddToDictionary=!!i._alert.extraProperties.hasAddToDictionary,i.showFullCard=i._features.showFullCards.get().enabled,i.isShowMore=Boolean(!i.showFullCard&&(i.details||i.examples&&i.examples.length)),i.hideTitleInEDUCard=i._features.hideTitleInEDUCard.get().enabled,i}return o.__extends(t,e),t.prototype.getHeader=function(e,t){return new c.CommonHeaderModelImpl(this.title,this._alert.todo,this._alert.replacements,e,t,this._alert.extraProperties,this._features.quickReplacementsInCard.get().enabled,this.replace)},t.prototype.getFooterProps=function(){return{hasAcknowledgeButton:this.hasAcknowledgeButton,hasAddToDictionary:this.hasAddToDictionary,isShowMore:this.isShowMore}},t.prototype.getReplacements=function(){var e=this._alert,t=e.category,n=e.extraProperties,o=e.todo;return u.getReplacementListModel({title:r({category:t,extraProperties:n,todo:o}),replacements:this._alert.replacements,onReplace:this.replace})},t}(p);t.CommonCardModelImpl=f;var m=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o._alert=n,o.kind="plagiarism",o.url=o._alert.url,o.description=o._alert.description,o.reference=o._alert.reference,o}return o.__extends(t,e),t.prototype.getHeader=function(e,t){return new c.PlagiarismHeaderModelImpl(this.title,e,t,this._alert.url)},t}(p);t.PlagiarismCardModelImpl=m;var g=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r)||this;return i._alert=n,i._features=o,i.kind="enhancement",i.details=i._alert.details,i.examples=i._alert.examples,i.explanation=i._alert.explanation,i.hasReplacements=!u.isNoReplacement(i._alert.replacements),i.hasAcknowledgeButton=!i.hasReplacements,i.hasAddToDictionary=!1,i.showFullCard=i._features.showFullCards.get().enabled,i.isShowMore=Boolean(!i.showFullCard&&(i.details||i.examples&&i.examples.length)),i.isVisibleQuickReplacement=i._features.quickReplacementsInCard.get().enabled,i}return o.__extends(t,e),t.prototype.getReplacements=function(){var e=this._alert,t=e.category,n=e.extraProperties,o=e.todo;return u.getReplacementListModel({title:r({category:t,extraProperties:n,todo:o}),replacements:this._alert.replacements,onReplace:this.replace})},t.prototype.getHeader=function(e,t){return new c.EnhancementHeaderModelImpl(this.title,e,t,this.isVisibleQuickReplacement)},t.prototype.getFooterProps=function(){return{hasAcknowledgeButton:this.hasAcknowledgeButton,hasAddToDictionary:this.hasAddToDictionary,isShowMore:this.isShowMore}},t}(p);t.EnhancementCardModelImpl=g;var _=function(e){function t(t,n,r){var o=e.call(this,t,r.isFocused(n.id))||this;return o._alert=n,o._editorEngine=r,o.kind="synonyms",o.visualState=o._transientVisualState,o.replace=function(e){o._applyThisAlert({action:"replace",replacementText:e,isSynonym:!0})},o.id=o._alert.id,o.title=o._alert.title,o.explanation="",o.details="",o.examples=[],o.meanings=o._alert.meanings.map(function(e){return{title:e.title,list:u.getReplacementFlatListModel({title:e.title,replacements:e.replacements,onReplace:function(e){return o.replace(e)}})}}),o.isAnyMeanings=Boolean(o.meanings.length),o}return o.__extends(t,e),t.prototype._applyThisAlert=function(e){this._editorEngine.applyAlert(this.id,e),this._transitionState([{from:[h.expanded,h.expandedMore,h.collapsed],to:h.applied}])},t.prototype.hide=function(){this._transitionState([{from:[h.applied],to:h.hidden}])},t.prototype.collapse=function(){this._transientVisualState.get()!==h.hidden&&this._transitionState([{from:[h.expanded],to:h.hidden}])},t.prototype.undoInteraction=function(){this._editorEngine.undoLastAlertAction(),this._transitionState([{from:[h.applied],to:h.expanded}])},t.prototype.select=function(){this._editorEngine.setHighlightedAlert(this.id)},t.prototype.deselect=function(){this._editorEngine.setHighlightedAlert(null)},t}(d);t.SynonymsCardModelImpl=_},297:function(e,t,n){"use strict";function r(e){return e.map(function(e){return e.transform}).every(function(e){return e.every(function(e){return"delete"!==e.type})})&&2===e.length}function o(e){return 1===e.length}function i(e){return e.reduce(function(e,t){return e+("arrow"!==t.type?t.text.length:0)},0)>35}function s(e){var t=e.filter(function(e){return"delete"===e.type});if(0===t.length)return!1;var n=t[0],r=n.text.replace(/,/g,"").split(" ").filter(Boolean)||[];return n.text.match(/^,(.*?),$/)&&n.text.length>2&&r.length>1}function a(e){return!e||0===e.length}function c(e){var t=e.isDidYouMean,n=e.isActive,c=e.replacements,u=e.todo,l=e.onReplace;if(a(c))return new p;var y="Click to "+u;return t?new g(y,c[0],l):r(c)?new h(y,c[0],c[1],l):i(c[0].transform)?new _(y,c,l):s(c[0].transform)?new m(y,c[0],l):o(c)?new f(y,c[0],l):new d(y,n,c,l)}Object.defineProperty(t,"__esModule",{value:!0});var u,l=n(2);!function(e){e[e.or=0]="or",e[e.single=1]="single",e[e.list=2]="list",e[e.flatList=3]="flatList",e[e.multi=4]="multi",e[e.multiExpanded=5]="multiExpanded",e[e.long=6]="long",e[e.didYouMean=7]="didYouMean",e[e.sideCommas=8]="sideCommas",e[e.empty=9]="empty"}(u=t.CardReplacementTemplate||(t.CardReplacementTemplate={})),t.isOrReplacement=r,t.isSingleReplacement=o,t.isLongReplacement=i,t.isSideCommasReplacement=s,t.isNoReplacement=a;var h=function(){function e(e,t,n,r){var o=this;this.tooltipText=e,this._replacement1=t,this._replacement2=n,this._onReplace=r,this.template=u.or,this.transform1=this._replacement1.transform,this.transform2=this._replacement2.transform,this.onReplace1=function(){return o._onReplace(o._replacement1.newText)},this.onReplace2=function(){return o._onReplace(o._replacement2.newText)}}return e}();t.CardReplacementOr=h;var d=function(){function e(e,t,n,r){var o=this;this.tooltipText=e,this.isExpanded=t,this.replacements=n,this._onReplace=r,this.getOnReplace=function(e){return function(){return o._onReplace(e.newText)}},this.template=this.isExpanded?u.multiExpanded:u.multi}return e.prototype.getTitleReplacement=function(){return new f(this.tooltipText,this.replacements[0],this._onReplace)},e}();t.CardReplacementMulti=d;var p=function(){function e(){this.template=u.empty,this.tooltipText=""}return e}();t.EmptyReplacement=p;var f=function(){function e(e,t,n){var r=this;this.tooltipText=e,this._replacement=t,this._onReplace=n,this.transform=this._replacement.transform,this.onReplace=function(){return r._onReplace(r._replacement.newText)},this.template=u.single}return e}();t.CardReplacementSingle=f;var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.template=u.sideCommas,t}return l.__extends(t,e),t}(f);t.CardReplacementSideCommas=m;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.template=u.didYouMean,t}return l.__extends(t,e),t}(f);t.CardReplacementDidYouMean=g;var _=function(){function e(e,t,n){var r=this;this.tooltipText=e,this.replacements=t,this._onReplace=n,this.getOnReplace=function(e){return function(){return r._onReplace(e.newText)}},this.template=u.long}return e}();t.CardReplacementLong=_;var y=function(){function e(e,t,n){var r=this;this.headerText=e,this.replacements=t,this._onReplace=n,this.template=u.list,this.tooltipText="",this.getOnReplace=function(e){return function(){return r._onReplace(e.newText)}}}return e}();t.CardReplacementList=y;var v=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.headerText=t,o.template=u.flatList,o}return l.__extends(t,e),t}(y);t.CardReplacementFlatList=v,t.getReplacementModel=c,t.getReplacementListModel=function(e){var t=e.title,n=e.replacements,r=void 0===n?[]:n,o=e.onReplace;return new y(t,r,o)},t.getReplacementFlatListModel=function(e){var t=e.title,n=e.replacements,r=void 0===n?[]:n,o=e.onReplace;return new v(t,r,o)}},298:function(e,t,n){"use strict";function r(e){switch(e){case"red":return o.red;case"green":return o.green;case"yellow":return o.yellow;default:return o.grey}}Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(7);!function(e){e[e.red=0]="red",e[e.green=1]="green",e[e.yellow=2]="yellow",e[e.grey=3]="grey"}(o=t.AlertExampleColor||(t.AlertExampleColor={}));!function(e){e[e.italic=0]="italic",e[e.plain=1]="plain"}(t.AlertExampleTextType||(t.AlertExampleTextType={})),t.getColor=r;t.parseExamples=function(e){return e?e.replace(/^<p>/,"").split("<p>").map(function(e){var t=e.match(/<span.*?<\/span><br\/>/g);return t&&t.length?t.map(function(e){var t=r(i.StringUtils.getFirstWord(i.StringUtils.getFirstMatch(e,/^<span.*?class="(.+?)".*?>/)||"")),n=i.StringUtils.getFirstMatch(e,/^<span.*?>(.+?): /)||"Comment",o=i.StringUtils.getFirstMatch(e,/^<span.*?>(?:.+?: )?(.+?)<\/span><br\/>/);return o?{color:t,type:n,text:o}:null}).filter(function(e){return!!e}):[]}).filter(function(e){return e.length}):[]}},299:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CardBaseClassName="cardBaseClassName";!function(e){function t(e,t){return{kind:"single",alertId:e,action:t}}function n(e){return{kind:"batchIgnore",alertIds:e}}function r(e){return"single"===e.kind}function o(e){return"batchIgnore"===e.kind}e.createSingle=t,e.createBatchIgnore=n,e.isSingle=r,e.isBatchIgnore=o}(t.AppliedAlertAction||(t.AppliedAlertAction={}));!function(e){e[e.idle=0]="idle",e[e.inProgress=1]="inProgress",e[e.finished=2]="finished"}(t.CheckingStatus||(t.CheckingStatus={}))},300:function(e,t,n){"use strict";function r(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60);return{h:t,m:n,s:e-3600*t-60*n}}function o(e){return s.padStart(String(e),2,"0")}function i(e,t){var n=void 0===t?{}:t,i=n.short,a=void 0!==i&&i,c=n.withSec,u=void 0!==c&&c,l=r(e),h=l.h,d=l.m,p=l.s,f=[];return h>0&&f.push(o(h)+" "+(a?"h":s.pluralize(h,"hour","hours"))),(d>0||!u)&&f.push(o(d)+" "+(a?"min":s.pluralize(d,"minute","minutes"))),u&&f.push(o(p)+" "+(a?"sec":s.pluralize(p,"second","seconds"))),f.join(" ")}Object.defineProperty(t,"__esModule",{value:!0});var s=n(148);t.MS_IN_SEC=1e3,t.MS_IN_MIN=60*t.MS_IN_SEC,t.MS_IN_HOUR=60*t.MS_IN_MIN,t.MS_IN_DAY=24*t.MS_IN_HOUR,t.secondsToTime=r,t.formatTime=i},301:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(29),o=n(73),i=n(207),s=function(){function e(e,t,n){this._doxUrl=e,this._fetch=t,this._token=n,this._ajax=o.Ajax.factory(this._fetch,"proofit",i.DoxErrors.doxErrorMapper)}return e.prototype._processOptions=function(t){var n=t.words,r=t.turnaroundOptions;return r&&r.length||(r=[]),{words:n,turnaroundOptions:r.map(function(t){return{enabled:t.enabled,label:t.label,minutesToProcess:t.minutesToProcess,perWord:t.perWord,price:t.price,turnaround:e.parsePlanOption(t.turnaround)}})}},e.prototype.getOptions=function(e){var t=o.RequestBuilder.get(this._doxUrl,"documents/"+e+"/proofit/turnaroundOptions");return this._token&&t.cookie("grauth",this._token),this._ajax(t.build()).then(this._processOptions)},e.prototype.createJob=function(t){var n=t.docId,r=t.turnaround,i=e.PlanType[r],s=o.RequestBuilder.post(this._doxUrl,"documents/"+n+"/proofit/job").queryParam("turnaround",i);return this._token&&s.cookie("grauth",this._token),this._ajax(s.build()).then(e.parseCreateJobResult)},e}();t.Proofit=s,function(e){function t(e){switch(e){case"New":return c.newJob;case"Building":return c.building;case"paymentError":return c.paymentError;case"duplicate":return c.duplicate;case"emptyDocument":return c.emptyDocument;case"Completed":return c.completed;case"Cancelled":return c.cancelled;default:return c.unknown}}function n(e){switch(e){case"Instant":return u.Instant;case"ThreeHours":return u.ThreeHours;case"TwentyFourHours":return u.TwentyFourHours;default:throw new Error("Unknown plan option "+e)}}function o(e){if(!e)return null;try{e.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/)&&(e=e.replace(/\s/,"T"));return new Date(e).getTime()}catch(e){return null}}function i(e){return e?{downloadResultUrl:e.downloadResultUrl||null,submitted:o(e.submitted),corrections:e.corrections||null,due:o(e.due),price:e.price||null,name:e.name||null,completed:o(e.completed),id:e.id||null,status:t(e.status),is_dox_applied:e.is_dox_applied||null}:null}function s(e){return e?r.Some({downloadResultUrl:e.downloadResultUrl||r.None,submitted:o(e.submitted),corrections:e.corrections,due:o(e.due),price:e.price,name:e.name,completed:o(e.completed)||r.None,id:e.id,status:t(e.status),is_dox_applied:e.is_dox_applied}):r.None}function a(e){var n=e.data;return{jobId:n.jobId,status:t(n.status),token:n.token}}var c;!function(e){e.paymentError="paymentError",e.duplicate="duplicate",e.emptyDocument="emptyDocument",e.newJob="newJob",e.building="building",e.completed="completed",e.cancelled="cancelled",e.unknown="unknown"}(c=e.JobStatus||(e.JobStatus={}));var u;!function(e){e[e.Instant=0]="Instant",e[e.ThreeHours=1]="ThreeHours",e[e.TwentyFourHours=2]="TwentyFourHours"}(u=e.PlanType||(e.PlanType={})),e.processOptions=function(e){var t=e.data;return{words:t.words,turnaroundOptions:t.turnaroundOptions.map(function(e){return{enabled:e.enabled,label:e.label,minutesToProcess:e.minutesToProcess,perWord:e.perWord,price:e.price,turnaround:n(e.turnaround)}})}},e.parseStatus=t,e.parsePlanOption=n,e.parseResult=i,e.parseResultOption=s,e.parseCreateJobResult=a}(s=t.Proofit||(t.Proofit={})),t.Proofit=s},302:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),o=n(914),i=n(860);t.Logo=function(e){return r.createElement("div",{"data-name":"gr-logo",className:o.logoWrapper},r.createElement("a",{href:e.mainPageUrl},r.createElement("img",{className:o.logo,src:i})))}},303:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(17),i=n(146),s=n(302),a=n(916),c=n(861),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return o.createElement(i.BasePage,{title:"Grammarly"},o.createElement("div",null,o.createElement(s.Logo,{mainPageUrl:this.context.appConfig.funnel.mainPage}),o.createElement("div",{className:a.robot},o.createElement("img",{src:c,width:155,height:215})),o.createElement("div",{className:a.header},o.createElement("div",{className:a.headOne},"Our grammar robot is recharging."),o.createElement("div",{className:a.headSub},o.createElement("p",{className:a.sub},"Grammarly is currently unavailable while we make upgrades",o.createElement("br",null),"to improve the service for you. Please try again in a minute."))),o.createElement("div",{className:a.smallText},"We apologize for the inconvenience and appreciate your patience.",o.createElement("br",null),"For more information, please"," ",o.createElement("a",{className:a.contact,href:this.context.appConfig.support.newRequest},"contact support"),".")))},t}(i.BaseComponent);t.Error500Page=u},304:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.capacity=e,this.size=0,this._keymap={}}return e.prototype.put=function(e,t){var n={key:e,value:t};if(this._keymap[e]=n,this._tail?(this._tail.newer=n,n.older=this._tail):this._head=n,this._tail=n,this.size===this.capacity)return this.shift().value;++this.size},e.prototype.get=function(e){var t=this._getImpl(e);return t&&t.value},e.prototype.peek=function(e){var t=this._keymap[e];return t&&t.value},e.prototype.set=function(e,t){var n=this._getImpl(e),r=t(n&&n.value);return r?n?n.value=r:this.put(e,r):n&&this.remove(e),r},e.prototype.getRef=function(e){return this._getImpl(e)},e.prototype.remove=function(e){var t=this._keymap[e];if(t)return delete this._keymap[e],t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this._head=t.newer):t.older?(t.older.newer=void 0,this._tail=t.older):this._head=this._tail=void 0,--this.size,t.value},e.prototype.forEach=function(e){for(var t in this._keymap)e(t,this._keymap[t].value)},e.prototype.shift=function(){var e=this._head;return this._head&&(this._head.newer?(this._head=this._head.newer,this._head.older=void 0):this._head=void 0,e.newer=e.older=void 0,delete this._keymap[e.key]),e},e.prototype._getImpl=function(e){var t=this._keymap[e];if(t)return t===this._tail?t:(t.newer&&(t===this._head&&(this._head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this._tail,this._tail&&(this._tail.newer=t),this._tail=t,t)},e}();t.LRUCache=r},368:function(e,t){e.exports={spinner:"_51ca9a4d-editor-core-spinner",desktopEditorPreventSelection:"_a3ef96c1-editor-core-desktopEditorPreventSelection"}},48:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(552);t.CAPI=o;var i=n(1333);t.Dapi=i.Dapi,t.Properties=i.Properties;var s=n(1330);t.Auth=s.Auth,t.User=s.User,t.UserType=s.UserType,t.LoginType=s.LoginType;var a=n(1337);t.Irbis=a.Irbis,t.SubscriptionStatus=a.SubscriptionStatus,t.PaymentPlan=a.PaymentPlan,t.PaymentMethod=a.PaymentMethod,t.CreditCard=a.CreditCard;var c=n(73);t.Ajax=c.Ajax,t.MimeType=c.MimeType,t.Request=c.Request,t.RequestBuilder=c.RequestBuilder,t.HTTPError=c.HTTPError;var u=n(149);t.WSError=u.WSError;var l=n(290);t.OTError=l.OTError,t.OTRemoveError=l.OTRemoveError;var h=n(117);t.Change=h.Change,t.ChangeType=h.ChangeType;var d=n(60);t.CustomError=d.CustomError;var p=n(301);t.Proofit=p.Proofit;var f=n(564);t.Dox=f.Dox,t.Document=f.Document,t.DocumentSettings=f.DocumentSettings,t.Remote=f.Remote,t.RemoteDocument=f.RemoteDocument,t.RemoteDocumentsList=f.RemoteDocumentsList,t.OrderBy=f.OrderBy,t.SearchRequest=f.SearchRequest,t.CreateRequest=f.CreateRequest,t.CheckingSettings=f.CheckingSettings;var m=n(207);t.DoxErrors=m.DoxErrors,r.__exportStar(n(289),t);var g=n(202);t.DocumentContext=g.DocumentContext,t.genreToDomain=g.genreToDomain,t.domainToGenre=g.domainToGenre;var _=n(1334);t.Dictionary=_.Dictionary;var y=n(1336);t.Institution=y.Institution},49:function(e,t,n){"use strict";function r(e){if(e){var t=e.match(/^Grammarly\s+Desktop\s+Editor\s(.*\s)?(\d+\.\d+\.\d+).*-(osx|windows)$/);if(t){var n=parseFloat(t[2]);return{browser:"desktop-editor",version:t[2],parsedVersion:isNaN(n)?0:n,os:"osx"===t[3]?"mac":"windows",type:"desktop",supported:function(){return!1}}}}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(209),i=n(209);t.Browser=i.Browser,t.PlatformInfo=i.PlatformInfo,t.BrowserType=i.BrowserType,t.OS=i.OS,t.getBrowserInfo=function(){return r(navigator.userAgent)||o()},t.isDesktopEditor=function(e){return"desktop-editor"===e},t.isDownloadAttrSupported="chrome"===t.getBrowserInfo().browser,t.hotkeyLabel=function(e,t){return("mac"===t||"ios"===t?"⌘":"Ctrl+")+e},t.isMac=function(e){return"mac"===e||"ios"===e}},532:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),o=n(49);t.textResources={base:{tooltipDownloadProofreadVersion:"Download proofread version",tooltipDownloadOriginalVersion:"Download original version",tooltipDownload:"Download",uploadText:"Upload",tooltipUploadElementInput:"Click here to upload document",menuDownloadText:"Download",documentPlaceholderText:"Upload a document to save original formatting.",modalUploadingDocumentText:"Uploading document",notificationUploadFileText:"Upload a file in one of the following formats",copyToClipboardIsNotAvailable:"Click and copy with "+o.hotkeyLabel("C",o.getBrowserInfo().os)},denali:{notEnoughTextToAnalize:r.createElement("p",null,"Write away! We need at least 4 sentences ",r.createElement("br",null),"for Grammarly to work its true magic"),notEnoughTextToAnalizePlain:"Write away! We need at least 4 sentences for Grammarly to work its true magic.",rankTooltip:function(e){return r.createElement("p",null,"Your text scores higher than ",e,"% ",r.createElement("br",null),"of all texts checked by Grammarly ",r.createElement("br",null),"where comparable goals were set")},documentStats:{uniqueWords:r.createElement("p",null,"Measures vocabulary diversity by calculating",r.createElement("br",null),"the number of unique words."),rareWords:r.createElement("p",null,"Measures depth of vocabulary by identifying words that are",r.createElement("br",null),"not among the 5,000 most common English words."),readability:r.createElement("p",null,"In the Flesch reading-ease test, higher scores",r.createElement("br",null),"indicate material that is easier to read.")},sidebar:{openLabel:"start assistant",fixErrorsLabel:"Correct with Assistant",checkingLabel:"checking …",criticalIssue:"Critical issue",criticalIssues:"Critical issues",advancedIssue:"Advanced issue",advancedIssues:"Advanced issues"},uploadMenuItem:"Upload document",uploadDropZone:"Drag a text file here to upload",uploadDropZoneTypes:"Microsoft Word (.doc, .docx), OpenOffice (.odt), TXT and RTF are welcome",downloadMenuItem:"Download",uploadNotificationTitle:"The document was uploaded successfully",goals:{header:r.createElement("span",null,"The more Grammarly knows about the context",r.createElement("br",null)," of your writing, the more customized and",r.createElement("br",null)," ","helpful suggestions it will propose."),upgradeHookTitle:r.createElement("span",null,"Get the most accurate and relevant corrections",r.createElement("br",null),"for your specific writing situation")},plagiarism:{lensDescription:function(e,t,n){return r.createElement("span",null,r.createElement("em",null,e,"%")," ","of your text matches"," ",r.createElement("em",null,t," fragments")," ","from"," ",r.createElement("em",null,n," sources")," ","on the web or in Grammarly’s archives of academic publications. Cite them with the style you prefer or with the most common citation styles:")},title:"Plagiarism",description:"Finds unoriginal text by checking against academic databases and over 8 billion web pages.",originalText:r.createElement("span",null,"Looks like your text is 100% original. ",r.createElement("br",null),"We found no matching text in our databases or on the Internet.")},documentPerformanceRankText:function(e){return r.createElement("span",null,"Great job! Your text is expected to ",r.createElement("br",null),"perform ",r.createElement("b",null,"better than ",e,"%")," of comparable ",r.createElement("br",null),"texts written by other Grammarly users.")},proofitTitle:"Professional Proofreaders",proofitDescription:"Our professional proofreaders are ready to check your document right now.",card:{less:"Less",more:"More",dismiss:"Dismiss",addToDict:"Add to dictionary",like:"I'll address this",dislike:"Not helpful",wrong:"Incorrect suggestion",offensive:"Offensive content"},placeholder:{typeOrPasteText:"Type or paste ("+o.hotkeyLabel("V",o.getBrowserInfo().os)+") your text here.",upload:"Upload a document to save original formatting."}}}},533:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=function(){};t.defaultReconnect=function(e,t,n){var o=r.Monitoring.Logging.getLogger("coreclients.capi");return o.info("Disconnected from CAPI.",e.reason),n(t).catch(function(e){o.warn("Reconnect failed with an error: ",e)})};var i=function(){function e(){this.onSesionStarted=o,this.beforeAlert=o,this.onAlert=o,this.onRemove=o,this.onSynonyms=o,this.onPlagiarism=o,this.onPlagiarismFinish=o,this.onError=o,this.onFinish=o,this.onStats=o,this.onPong=o,this.onDebugInfo=o,this.onDisconnect=t.defaultReconnect}return e}();t.DefaultCAPIEventHandler=i},534:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){function t(e,t){return Object.assign({},e,{begin:e.begin+t,end:e.end+t,highlightBegin:e.highlightBegin+t,highlightEnd:e.highlightEnd+t})}function n(e){return"Originality"===e.cardLayout.category}function r(e){return!0===e.hidden}function o(e,n){for(var r=0,o=n;r<o.length;r++)for(var i=o[r],s=0,a=i.operations;s<a.length;s++){var c=a[s];if(c.end>e.begin&&e.end>c.begin||c.end>e.highlightBegin&&e.highlightEnd>c.begin)return null;if("+"===c.type){if(e.end===c.begin){var u=c.text.charCodeAt(0);if(64<u&&u<91||96<u&&u<123)return null}(e.begin<0||e.highlightBegin<0||e.begin>=c.begin||e.highlightBegin>=c.begin)&&(e=t(e,c.length))}else"-"===c.type&&(e.begin>=c.begin||e.highlightBegin>=c.begin)&&(e=t(e,-c.length))}return e}function i(e){if(!e)return!1;var t=e;return Number.isInteger(t.rev)&&Number.isInteger(t.begin)&&Number.isInteger(t.end)&&Number.isInteger(t.highlightBegin)&&Number.isInteger(t.highlightEnd)}e.shift=t,e.isPlagiarism=n,e.isHidden=r,e.transformMarkupAgainst=o,e.isRawAlert=i,e.mock={id:"",rev:0,pname:"Spelling/BritishVsAmerican/BrInstOfAm/BrInstOfAm",group:"ContextualSpelling",category:"BritishVsAmerican",categoryHuman:"British vs American",hidden:!1,text:"centralise",todo:"correct",title:"Inconsistent spelling",transforms:["<span class='gr_grammar_del'>centralise</span>→<span class='gr_grammar_ins'>centralize</span>"],details:"<p>One of&nbsp;the most obvious differences between American and British English is&nbsp;the spelling of&nbsp;certain words such as&nbsp;<b>color/colour, learned/learnt,</b> and <b>toward/towards</b>. Typically, the spelling of&nbsp;words like these only varies by&nbsp;one or&nbsp;two letters. In&nbsp;the interest of&nbsp;consistency and clarity, you should use the spelling that will be&nbsp;more familiar to&nbsp;your intended audience.\n",explanation:"<p>The word <b>centralise</b> is&nbsp;a&nbsp;British English spelling. In&nbsp;the interest of&nbsp;consistency, consider replacing it&nbsp;with the American English spelling.\n",examples:'<p><span class="grey">British: I&nbsp;wish you success in&nbsp;all your endeavours.</span><br/><span class="grey">American: I&nbsp;wish you success in&nbsp;all your endeavors.</span><br/><p><span class="grey">British: Sweet yoghurts contain a&nbsp;lot of&nbsp;sugar.</span><br/><span class="grey">American: Sweet yogurts contain a&nbsp;lot of&nbsp;sugar.</span><br/><p><span class="grey">British: Serena moved towards the blinking light.</span><br/><span class="grey">American: Serena moved toward the blinking light.</span><br/>',free:!0,highlightBegin:5092,highlightEnd:5102,highlightText:"",begin:5092,end:5102,replacements:["centralize"],extra_properties:{priority:"2"},cardLayout:{category:"Accuracy",group:"Spelling",groupDescription:"Checks spelling, confused words, capitalization",rank:10}},e.mockPlagiarism={id:"",rev:0,transforms:[],title:"Citation audit",details:"",explanation:"",examples:"",free:!1,hidden:!1,todo:"",cardLayout:{category:"Originality",group:"Unoriginal content",groupDescription:"Unoriginal content from the web",rank:0},category:"Plagiarism",categoryHuman:"Unoriginal content",begin:156,end:697,text:"",group:"Plagiarism",pname:"Plagiarism/Plagiarism/UnoriginalContent",highlightBegin:156,highlightEnd:697,highlightText:"",replacements:[],extra_properties:{}}}(t.RawAlert||(t.RawAlert={}));!function(e){e[e.NOT_AUTHORIZED=0]="NOT_AUTHORIZED",e[e.SESSION_NOT_INITIALIZED=1]="SESSION_NOT_INITIALIZED",e[e.BAD_REQUEST=2]="BAD_REQUEST",e[e.BACKEND_ERROR=3]="BACKEND_ERROR",e[e.AUTH_ERROR=4]="AUTH_ERROR",e[e.RUNTIME_ERROR=5]="RUNTIME_ERROR",e[e.ILLEGAL_DICT_WORD=6]="ILLEGAL_DICT_WORD",e[e.TIMEOUT=7]="TIMEOUT",e[e.CANNOT_FIND_SYNONYM=8]="CANNOT_FIND_SYNONYM",e[e.CANNOT_GET_TEXT_STATS=9]="CANNOT_GET_TEXT_STATS"}(t.ErrorCode||(t.ErrorCode={}));!function(e){e[e.INFO=0]="INFO",e[e.WARN=1]="WARN",e[e.ERROR=2]="ERROR"}(t.ErrorSeverity||(t.ErrorSeverity={}));!function(e){e.IGNORE="IGNORE",e.IGNORE_ALL="IGNORE_ALL",e.ADD_TO_DICTIONARY="ADD_TO_DICTIONARY",e.REPORT_SUGGESTION="REPORT_SUGGESTION",e.REMOVE_FROM_DICTIONARY="REMOVE_FROM_DICTIONARY",e.LOOKED="LOOKED",e.ACCEPTED="ACCEPTED",e.ACKNOWLEDGED="ACKNOWLEDGED",e.POPUP_OPEN="POPUP_OPEN",e.POPUP_CLOSE="POPUP_CLOSE",e.UNDOED="UNDOED",e.LIKE="LIKE",e.DISLIKE="DISLIKE",e.WRONG_SUGGESTION="WRONG_SUGGESTION",e.OFFENSIVE_CONTENT="OFFENSIVE_CONTENT",e.EXPANDED="EXPANDED",e.DISMISS_BY_LENS="DISMISS_BY_LENS",e.SYNONYM_ACCEPTED="SYNONYM_ACCEPTED"}(t.FeedbackType||(t.FeedbackType={}))},535:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.id=e}return e}();t.MessageBase=o;var i=function(e){function t(t){var n=e.call(this,t)||this;return n.action="ping",n}return r.__extends(t,e),t}(o);t.Ping=i;var s=function(e){function t(t){var n=e.call(this,t)||this;return n.action="pong",n}return r.__extends(t,e),t}(o);t.Pong=s;var a=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.name=n,o.value=r,o.action="option",o}return r.__extends(t,e),t}(o);t.Option=a;var c=function(e){function t(t,n,r,o,i,s,a,c){void 0===a&&(a="");var u=e.call(this,t)||this;return u.client=n,u.clientVersion=r,u.extDomain=o,u.dialect=i,u.docid=s,u.token=a,u.documentContext=c,u.action="start",u}return r.__extends(t,e),t}(o);t.Start=c;var u=function(e){function t(t,n,r,o,i){var s=e.call(this,t)||this;return s.rev=n,s.score=r,s.dialect=o,s.scores=i,s.action="finished",s}return r.__extends(t,e),t}(o);t.Finish=u;var l=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.rev=n,o.documentContext=r,o.action="set_context",o}return r.__extends(t,e),t}(o);t.SetContext=l;var h=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.rev=n,o.check=r,o.action="async_check_finished",o}return r.__extends(t,e),t}(o);t.AsyncCheckFinished=h;var d=function(e){function t(t,n,r,o){var i=e.call(this,t)||this;return i.rev=n,i.ch=r,i.genre=o,i.action="submit_ot",i}return r.__extends(t,e),t}(o);t.SubmitOt=d;var p=function(e){function t(t,n,r,o,i,s,a,c,u,l,h,d,p,f,m,g,_,y,v,b,w,E,S,C){var k=e.call(this,t)||this;return k.rev=n,k.begin=r,k.end=o,k.highlightBegin=i,k.highlightEnd=s,k.text=a,k.pname=c,k.highlightText=u,k.category=l,k.categoryHuman=h,k.group=d,k.title=p,k.details=f,k.examples=m,k.explanation=g,k.transforms=_,k.replacements=y,k.free=v,k.extra_properties=b,k.hidden=w,k.cardLayout=E,k.sentence_no=S,k.todo=C,k.action="alert",k}return r.__extends(t,e),t}(o);t.Alert=p;var f=function(e){function t(t){var n=e.call(this,t)||this;return n.action="remove",n}return r.__extends(t,e),Object.defineProperty(t.prototype,"alertId",{get:function(){return this.id},enumerable:!0,configurable:!0}),t}(o);t.RemoveAlert=f;var m=function(e){function t(t,n){var r=e.call(this,t)||this;return r.checks=n,r.action="toggle_checks",r}return r.__extends(t,e),t}(o);t.ToggleChecksRequest=m;var g=function(e){function t(t,n,r,o){var i=e.call(this,t)||this;return i.rev=n,i.begin=r,i.token=o,i.action="synonyms",i}return r.__extends(t,e),t}(o);t.SynonymsRequest=g;var _=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.token=n,o.synonyms=r,o.action="synonyms",o}return r.__extends(t,e),t}(o);t.SynonymsMessage=_;var y=function(e){function t(t,n,r,o,i,s,a){var c=e.call(this,t)||this;return c.type=n,c.alertId=r,c.position=o,c.text=i,c.previousText=s,c.lens=a,c.action="feedback",c}return r.__extends(t,e),t}(o);t.UserFeedback=y;var v=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.error=n,o.severity=r,o.action="error",o}return r.__extends(t,e),t}(o);t.Error=v;var b=function(e){function t(t){var n=e.call(this,t)||this;return n.action="get_text_stats",n}return r.__extends(t,e),t}(o);t.StatsRequest=b},536:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(300);!function(e){function t(e,t){var n=t/60,o=r.secondsToTime(e.words/n);return o.s=o.h>0&&o.m>10?0:Math.floor(o.s),o}function n(e){return t(e,250)}function o(e){return t(e,130)}function i(t,n){var r={words:t,chars:n,sentences:Math.floor(t/5),readingTime:{},speakingTime:{},uniqueWords:40*Math.random(),uniqueWordsIndex:100*Math.random(),rareWords:20*Math.random(),rareWordsIndex:100*Math.random(),wordLength:5.4,wordLengthIndex:100*Math.random(),sentenceLength:16.7,sentenceLengthIndex:100*Math.random(),readabilityScore:73,readabilityDescription:"Your text is likely to be understood by a reader who has at least 7th grade education (age 12)"};return r.readingTime=e.calculateReadingTime(r),r.speakingTime=e.calculateSpeakingTime(r),r}e.calculateReadingTime=n,e.calculateSpeakingTime=o,e.generateStats=i}(t.DocumentStatistics||(t.DocumentStatistics={}))},537:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONLINE="online"},538:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(27),i=n(12),s=n(5),a=n(7),c=n(48);t.ACCEPTED_UPLOAD_EXTENSIONS=["doc","docx","odt","rtf","htm","html","txt"].map(function(e){return"."+e}),t.ACCEPTED_UPLOAD_MIME_TYPES=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","text/rtf","text/html","text/plain"],t.defaultState={searchText:"",wsConnection:a.Async.defaultValue(),proofitResults:{},deletedDocumentIds:[],first100:a.Async.defaultValue(),remoteSearch:a.Async.defaultValue()};var u=100,l=function(){function e(e,t){this._doxApi=e,this._state=t,this._log=s.Monitoring.Logging.getLogger("model.documents.proofit"),this._operation=null,this.results=this._state.lens("proofitResults"),this.cancelled=new o.Subject,this.wsConnection=this._state.lens("wsConnection")}return e.prototype.init=function(){var e=this;a.invariant(null===this._operation,"Expect operation to be not established"),this._operation=a.Async.OperationRetrier.create(function(){return e._connect()},this.wsConnection)},e.prototype.reset=function(){var e=this.wsConnection.get();a.Async.isOk(e)?this._terminate(e.value):this._operation&&this._operation.unsubscribe(),this._operation=null,this.wsConnection.set(t.defaultState.wsConnection)},e.prototype._connect=function(){var e=this;return this._doxApi.openDocumentsWS(function(t,n){e.results.modify(function(e){return Object.assign({},e,(r={},r[t]=n.proofit,r));var r}),n.proofit&&n.proofit.status===c.Proofit.JobStatus.cancelled&&e.cancelled.next({id:t})}).then(function(e){return{unsubscribe:e.close.bind(e)}})},e.prototype._terminate=function(e){return r.__awaiter(this,void 0,void 0,function(){var n;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.results.set(t.defaultState.proofitResults),this.cancelled.next({id:null}),[4,e.unsubscribe()];case 1:return r.sent(),[3,3];case 2:throw n=r.sent(),this._log.error("Failed to close dox session",n),n;case 3:return[2]}})})},e}();t.DocumentListProofitModelImpl=l;var h=function(){function e(e,t,n,r,o){var l=this;this._state=e,this._doxApi=t,this._settings=n,this._connectivity=r,this._handleHttpDoxError=o,this._log=s.Monitoring.Logging.getLogger("model.documents.list"),this._isLocalSearch=i.Atom.create(!1),this._first100=this._state.lens("first100"),this._remoteSearch=this._state.lens("remoteSearch"),this._deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.searchText=this._state.lens("searchText"),this._trimmedSearchText=this.searchText.view(function(e){return e.trim()}),this.isFirstTimeLoaded=this._first100.view(a.Async.isOk),this.isSearching=this._remoteSearch.view(function(e){return a.Async.isInProgress(e)||a.Async.isError(e)}),this.searchResults=i.Atom.combine(this._first100,this._remoteSearch,this._deletedDocumentIds,this._trimmedSearchText,function(e,t,n,r){return a.Async.flatMap(e,function(e){return a.Async.isTerminated(t)?a.Async.flatMap(t,function(t){return a.Async.ok(l._localSearch(e,t||[],n,r))}):a.Async.ok(l._localSearch(e,[],n,r))})}),this._retryWhen=function(e){return!(e instanceof c.HTTPError)||a.isServerErrorCode(e.code)},this._documentSubs=[],this._settings.firstCall.get()||this._first100.filter(a.Async.isOk).first().subscribe(function(){l._settings.firstCallDone()}),this._first100.filter(function(e){return a.Async.isOk(e)}).subscribe(function(e){return l._isLocalSearch.set(e.value.length<u)}),this.searchResults.filter(function(e){return a.Async.isError(e)||a.Async.isFatal(e)}).subscribe(function(e){a.Async.isFatal(e)?(e instanceof c.HTTPError?l._handleHttpDoxError(e.error,"DOX: Cannot load document list"):l._connectivity.setState({type:"dox",state:{type:a.isServerErrorCode(e.error.code)?"serverError":"unknownConnectionError"}}),l._log.error("DOX: Cannot load document list",e.error)):a.Async.isError(e)&&l._log.warn("DOX: Attempt to load document list failed",e.error,{attempt:e.attempt})})}return e.prototype.load=function(){this._reset(),this._loadDocuments()},e.prototype.reset=function(){this._documentSubs.map(function(e){return e.unsubscribe()}),this._documentSubs=[],this._reset()},e.prototype._reset=function(){this.searchText.set(t.defaultState.searchText),this._isLocalSearch.set(!1),this._remoteSearch.set(a.Async.defaultValue()),this._first100.set(a.Async.defaultValue())},e.prototype._loadDocuments=function(){var e=this,t=i.Atom.create(!1);this._documentSubs=[a.Async.OperationRetrier.create(function(){return e._doxApi.listDocuments(u,c.OrderBy.Updated,!e._settings.firstCall.get())},this._first100,a.Async.OperationRetrier.RetryStrategy.conditional(this._retryWhen,a.Async.OperationRetrier.RetryStrategy.linear(3,3e3))),this._trimmedSearchText.withLatestFrom(this._first100,t).filter(function(e){return!e[0]}).throttleTime(1e3).filter(function(e){var t=(e[0],e[1]),n=e[2];return a.Async.isTerminated(t)&&!n}).subscribe(function(){t.set(!0),e._doxApi.listDocuments(u,c.OrderBy.Updated,!1).then(function(t){return e._first100.set(a.Async.ok(t))}).catch(function(t){t instanceof c.HTTPError&&e._handleHttpDoxError(t,"Failed to refresh document list"),e._log.info("Failed to refresh document list",t)}).then(function(){t.set(!1)})}),this._isLocalSearch.switchMap(function(t){return t?o.Observable.empty():o.Observable.merge(e._trimmedSearchText.map(function(e){return a.Either.left(e)}),e._trimmedSearchText.debounceTime(500).map(function(e){return a.Either.right(e)})).switchMap(function(t){return e._remoteSearch.set(a.Async.defaultValue()),a.Either.isLeft(t)||!t.value?o.Observable.empty():o.Observable.using(function(){return a.Async.OperationRetrier.create(function(){return e._doxApi.searchDocument(c.SearchRequest.contains(t.value),u)},e._remoteSearch,a.Async.OperationRetrier.RetryStrategy.conditional(e._retryWhen,a.Async.OperationRetrier.RetryStrategy.linear(3,3e3)))},function(){return e._remoteSearch.filter(a.Async.isTerminated).first()})})}).subscribe()]},e.prototype._localSearch=function(e,t,n,r){var o=new RegExp(r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return t.concat(e.filter(function(e){return!r||o.test(e.firstContent)||o.test(e.title)}).filter(function(e){return-1===t.findIndex(function(t){return t.id===e.id})})).filter(function(e){return n.indexOf(e.id)<0})},e}(),d=function(){function e(e,t,n,r,o,a,c,u,l){this._state=e,this._doxApi=t,this._alertCache=n,this._navigateToDocument=r,this._notifications=o,this._connectivity=a,this.browser=c,this._enableTrackingOnDownload=u,this._handleHttpDoxError=l,this._log=s.Monitoring.Logging.getLogger("model.documents.actions"),this._deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.documentUploadProgress=i.Atom.create(null)}return e.prototype.createDocument=function(e,t){return this._doxApi.createDocument(c.CreateRequest.text(e,t))},e.prototype.createDocumentAndNavigate=function(e){var t=this;return this.createDocument().then(function(n){e.get()?t.navigateToDocument(n.id):t._notifications.show(t._notifications.create.newDocumentCreated(function(){return t.navigateToDocument(n.id)}))}).catch(function(e){return t.handleCreateDocumentError(e)})},e.prototype.deleteDocument=function(e){var t=this;return this._deletedDocumentIds.modify(function(t){return t.concat([e])}),this._doxApi.deleteDocumentById(e).catch(function(n){throw t._deletedDocumentIds.modify(function(t){return t.filter(function(t){return t!==e})}),n}).then(function(n){try{t._alertCache.remove(e.toString())}catch(e){t._log.debug("could not remove alert cache for deleted doc",e)}})},e.prototype.restoreDocument=function(e){var t=this;return this._deletedDocumentIds.modify(function(t){return t.filter(function(t){return t!==e})}),this._doxApi.restoreDocumentById(e).catch(function(n){throw t._deletedDocumentIds.modify(function(t){return t.concat([e])}),n instanceof c.HTTPError&&t._handleHttpDoxError(n,"Failed to restore document"),n})},e.prototype.getDownloadUrl=function(e){return this._doxApi.downloadLink(e,this._enableTrackingOnDownload)},e.prototype.uploadDocument=function(e){return r.__awaiter(this,void 0,void 0,function(){var t=this;return r.__generator(this,function(n){switch(n.label){case 0:return[4,this._doxApi.createDocument(c.CreateRequest.file(e)).then(function(e){return t._state.lens("first100").modify(function(t){return a.Async.isOk(t)?a.Async.ok(new Array(e).concat(t.value)):t}),e})];case 1:return[2,n.sent()]}})})},e.prototype.navigateToDocument=function(e){this._navigateToDocument(""+e)},e.prototype.handleCreateDocumentError=function(e){e instanceof c.HTTPError?(this._handleHttpDoxError(e,"Failed to create new document"),this._log.warn("Failed to create new document",e)):a.isClientFetchError(e)?(this._log.warn("Failed to create new document",e),this._notifications.showError("Failed to create new document: "+(e&&e.message))):(this._log.error("Failed to create new document",e),this._notifications.showError("Failed to create new document: "+(e&&e.message)))},e.prototype.handleDeleteDocumentError=function(e){e instanceof c.HTTPError&&(this._handleHttpDoxError(e,"Failed to remove document"),this._log.error("Failed to remove document",e))},e}(),p=function(){function e(e,t,n,r,o,i,s,a,c){this._state=e,this._doxApi=t,this._settings=n,this._alertCache=r,this._browser=o,this._connectivity=i,this._notifications=s,this._navigateToDocument=a,this._enableTrackingOnDownload=c,this.proofit=new l(this._doxApi,this._state),this.list=new h(this._state,this._doxApi,this._settings,this._connectivity,this._doxHttpErrorHandler),this.actions=new d(this._state,this._doxApi,this._alertCache,this._navigateToDocument,this._notifications,this._connectivity,this._browser,this._enableTrackingOnDownload,this._doxHttpErrorHandler)}return e.prototype._doxHttpErrorHandler=function(e,t){switch(e.code){case c.DoxErrors.DoxHttpErrorCodes.UNAUTHORIZED:this._connectivity.setState({type:"dox",state:{type:"unauthorized"}});break;case c.DoxErrors.DoxHttpErrorCodes.TOO_MANY_REQUESTS:this._notifications.show(this._notifications.create.error());break;default:this._notifications.showError(e.message)}},e}();t.DocumentsPageModelImpl=p},539:function(e,t,n){"use strict";function r(e,t){if(e<=0)return null;var n=t.filter(function(e){return e.group===s.AlertGroup.plagiarism}).reduce(function(e,t){return e+t.range.end-t.range.start},0);return Math.round(Math.min(100,n/e*100))}function o(e,t){var n=e>0?t.reduce(function(e,t){return e+(a[t.group]||0)},0)/e:null;return null!==n?Math.floor(100*(1-Math.min(1,11*n))):null}function i(e,t,n,i){var s=n.filter(function(e){return"synonym"!==e.kind}),a=n.filter(function(e){return"plagiarism"===e.kind}).length,c=s.filter(function(e){return e.isFree}).length;return{criticalAlerts:c,premiumAlerts:i-a,visiblePremiumAlerts:s.length-c-a,plagiarismPercentage:r(e,s),score:o(t,s)}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(97),a=(c={},c[s.AlertGroup.contextualSpelling]=1.2,c[s.AlertGroup.grammar]=1,c[s.AlertGroup.sentenceStructure]=.9,c[s.AlertGroup.punctuation]=.7,c[s.AlertGroup.style]=.3,c[s.AlertGroup.enhancement]=0,c[s.AlertGroup.plagiarism]=0,c);t.calculateScores=i;var c},540:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(27),i=n(541),s=n(7),a=n(5),c=n(48);!function(e){e[e.documentNotFound=0]="documentNotFound",e[e.unauthorized=1]="unauthorized",e[e.changed=2]="changed",e[e.disconnected=3]="disconnected",e[e.cannotReconnect=4]="cannotReconnect"}(t.DocEventType||(t.DocEventType={})),t.defaultState={session:null};var u=function(){function e(e,t,n,i,c,u){var l=this;this._docId=e,this._state=t,this._doxApi=n,this._doxConnectivity=i,this._networkOnline=c,this._preventSyncWithDox=u,this._sessionState=this._state.lens("session"),this._session=null,this._remoteChangeSubject=new o.Subject,this._reconnect=function(e){return r.__awaiter(l,void 0,void 0,function(){var t,n;return r.__generator(this,function(r){switch(r.label){case 0:if(!this._session)throw new s.InvariantError("Expect remote session to be established");r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._connectToDox()];case 2:return t=r.sent().remoteDoc,this._session.setRemoteDocumentSession(t),null!==e&&t.setText(e),a.Monitoring.Logging.getLogger("model.editor.document_model").info("Dox connection restored"),[3,4];case 3:return n=r.sent(),this._doxConnectivity.set({type:"error",reason:"session reconnect",error:n}),[3,4];case 4:return[2]}})})}}return e.prototype.startSession=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t,n,o=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._connectToDox()];case 1:return e=r.sent(),t=e.remoteDoc,n=e.doc,this._sessionState.set(i.createInitialState(this._docId,n.title,t.getText(),{source:"init",proofit:n.proofit})),this._session=new i.DocumentSessionImpl(this._sessionState,this._doxApi,t,n,this._remoteChangeSubject,this._doxConnectivity,function(){o._reconnectSubscription&&o._reconnectSubscription.unsubscribe()},this._preventSyncWithDox),[2,{documentSession:this._session,initialGenre:n.genre,initialChecks:n.checks}]}})})},e.prototype._connectToDox=function(){return r.__awaiter(this,void 0,void 0,function(){var e,t,n=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this._doxApi.getDocumentById(this._docId)];case 1:return e=r.sent(),[4,this._doxApi.openDocumentById(this._docId,function(e,t){if(!n._session)throw new s.InvariantError("Expect remote session to be established");n._preventSyncWithDox||(n._session.localText.set(t),n._remoteChangeSubject.next(t))},function(e,t){if(!n._session)throw new s.InvariantError("Expect remote session to be established");n._session.proofitState.set({source:"websocket",proofit:t.proofit||null})},function(e,t,r){e.code!==c.DoxErrors.DoxWsErrorCodes.NOT_FOUND&&e.code!==c.DoxErrors.DoxWsErrorCodes.UNAUTHORIZED||n._doxConnectivity.set({type:"error",reason:e.reason,error:new c.WSError({code:e.code,message:e.reason,status:e.reason})}),c.RemoteDocument._defaultReconnect(e,t,r)})];case 2:return t=r.sent(),t.linkToDocument(e),this._scheduleReconnect(t),this._doxConnectivity.set({type:"success"}),[2,{remoteDoc:t,doc:e}]}})})},e.prototype._scheduleReconnect=function(e){var t=this,n=this._networkOnline.partition(Boolean),r=n[0],o=n[1];this._reconnectSubscription&&this._reconnectSubscription.unsubscribe(),this._reconnectSubscription=o.take(1).switchMap(function(){if(!t._session)throw new s.InvariantError("Expect remote session to be established");var n=t._session.localText.get();return e.close(),r.take(1).mapTo(n)}).subscribe(this._reconnect)},e}();t.DocumentModelImpl=u},541:function(e,t,n){"use strict";function r(e,t,n,r){return{id:e,title:t,localText:n,proofitState:r}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),i=n(5),s=n(7),a=n(1358),c=n(48);t.createInitialState=r;var u=function(){function e(e,t,n,r,u,l,h,d){var p=this;this._state=e,this._doxApi=t,this._remoteDocSession=n,this._document=r,this._textChangedByServer=u,this._documentErrors=l,this._onClose=h,this._preventSyncWithDox=d,this._sessionActive=!0,this._contentSync=new a.BufferedRemoteSync(function(e){if(p._preventSyncWithDox)return Promise.resolve();s.invariant(null!==p._remoteDocSession,"Expect remote session to be established");var t=p._remoteDocSession.getText(),n=p._remoteDocSession.setText(p.localText.get()).catch(function(e){e&&"reset"===e.message?i.Monitoring.Logging.getLogger("model.editor.document_model").warn("Got DOX reset",e):p._documentErrors.set({type:"error",reason:"Cannot set text: "+(e&&e.message),error:e})});return n.then(function(e){void 0!==e&&e!==t&&p.proofitState.get().proofit&&(p._document.resetProofit(),p._doxApi.saveDocument(p._document).then(function(){return p.proofitState.set({proofit:null,source:"websocket"})}))}),n.then(function(){})}),this._titleSync=this._createDocumentDataSync(function(e,t){e.title=t},1e3),this._genreSync=this._createDocumentDataSync(function(e,t){e.setGenre(t)},200),this._checksSync=this._createDocumentDataSync(function(e,t){e.setChecks(t)},200),this._contextSync=this._createDocumentDataSync(function(e,t){e.setContext(t)},1e3),this._alertCountSync=this._createDocumentDataSync(function(e,t){e.errors=t},3e3),this._allSyncs=[this._contentSync,this._titleSync,this._genreSync,this._checksSync,this._contextSync,this._alertCountSync],this.localTitle=this._state.lens("title"),this.localText=this._state.lens("localText"),this.proofitState=this._state.lens("proofitState"),this.proofitCompleted=this.proofitState.skip(1).map(function(e){var t=e.proofit;return t&&t.status===c.Proofit.JobStatus.completed?t:null}).distinctUntilChanged(),this.id=this._state.view("id"),this.isNew=this._state.view(function(e){return!(!e.title&&!e.localText)}).scan(function(e,t){return e||t},!1),this.localChangesSaved=o.Atom.combine(this._contentSync.hasUnsavedChanges,this._titleSync.hasUnsavedChanges,this._genreSync.hasUnsavedChanges,this._checksSync.hasUnsavedChanges,this._contextSync.hasUnsavedChanges,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.every(function(e){return!1===e})}),this.textChangedByServer=this._textChangedByServer,this._allSyncs.forEach(function(e){return e.startSyncing()})}return e.prototype.setRemoteDocumentSession=function(e){this._remoteDocSession=e},e.prototype._createDocumentDataSync=function(e,t){var n=this;return new a.BufferedRemoteSync(function(t){if(n._preventSyncWithDox)return Promise.resolve();s.invariant(null!==n._document,"Expect remote session to be established"),e(n._document,t);var r=o.Atom.create(s.Async.defaultValue());return s.Async.OperationRetrier.create(function(){return n._doxApi.saveDocument(n._document)},r,s.Async.OperationRetrier.RetryStrategy.conditional(function(e){return!(e instanceof c.HTTPError)||s.isServerErrorCode(e.code)},s.Async.OperationRetrier.RetryStrategy.linear(3,3e3))),r.filter(s.Async.isTerminated).first().toPromise().then(function(e){s.Async.isFatal(e)&&n._documentErrors.set({type:"error",reason:"Saving document error: "+e.error.message,error:e.error})})},t)},e.prototype._expectActiveSession=function(){s.invariant(this._sessionActive,"Expect remote session to be established")},e.prototype.setDocumentContent=function(e){this._expectActiveSession(),this._contentSync.setLocalValue(e),this.localText.set(e)},e.prototype.setDocumentTitle=function(e){this._expectActiveSession(),this.localTitle.set(e),this._titleSync.setLocalValue(e)},e.prototype.setDocumentGenre=function(e){var t=this;this._expectActiveSession(),this._genreSync.setLocalValue(e),this._document.context.map(function(){var n=Object.assign({},t.context,{domain:c.genreToDomain(e)});t._contextSync.setLocalValue(n)})},e.prototype.setDocumentAlertCount=function(e){this._expectActiveSession(),this._alertCountSync.setLocalValue(e)},e.prototype.setDocumentChecks=function(e){this._expectActiveSession(),this._checksSync.setLocalValue(e)},e.prototype.end=function(){var e=this;return new Promise(function(t,n){e._onClose(),e._alertCountSync.syncNow(),e._allSyncs.forEach(function(e){return e.stopSyncing()}),e._expectActiveSession(),e._sessionActive=!1,e._remoteDocSession.close().then(function(){return t()})})},Object.defineProperty(e.prototype,"context",{get:function(){var e=this;return this._document.context.getOrElse(function(){var t=c.genreToDomain(e._document.genre);return Object.assign({},c.DocumentContext.empty,{domain:t})})},enumerable:!0,configurable:!0}),e.prototype.setDocumentContext=function(e){this._expectActiveSession(),this._contextSync.setLocalValue(e),this._genreSync.setLocalValue(c.domainToGenre(e.domain))},e}();t.DocumentSessionImpl=u},542:function(e,t,n){"use strict";function r(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1);var r=d.Cookie.getCookie(m),o=c.setPlagiarism(t||c.defaultState,"true"===r),i=e||(n?"academic_general":"general");return{textStats:u.defaultState,checkingSettings:o,checkingGenre:i,editor:l.defaultState,cards:h.defaultState}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(48),s=n(12),a=n(5),c=n(201),u=n(292),l=n(543),h=n(291),d=n(7),p=n(1351),f=n(1352),m="isPlagiarismFunnel";t.defaultState=r(),t.createDefaultState=r;var g=function(){function e(e,t,n,r,o,i,a,c,u){this._state=e,this.documentSession=t,this.textStats=n,this._capiWsUrl=r,this._dialectSettingsModel=o,this._features=i,this._telemetry=a,this._alertCache=c,this._capiConnectivity=u,this.editorEngine=s.Atom.create(null),this.cardsModel=null,this.denaliScrollModel=new p.DenaliScrollModelImpl,this.denaliEditorViewModel=new f.DenaliEditorViewModel,this.contextState=s.Atom.create(this.documentSession.context),this._documentSyncSubs=null}return e.prototype.startEditor=function(e,t,n){var r=this;d.invariant(null===this.editorEngine.get()&&null===this._documentSyncSubs,"editor should not be started");var o=new c.CheckingSettingsModelImpl(this._state.lens("checkingGenre"),this._state.lens("checkingSettings"),this._telemetry),s=this._dialectSettingsModel.dialectOrDefault.get(),a=new l.GrammarlyEditorEngine(this._state.lens("editor"),e,"textarea",t,this.documentSession.id.get(),this.documentSession.localText.get(),this._capiWsUrl,o,this._dialectSettingsModel,function(){return r._alertCache.load(r.documentSession.id.get().toString(),s,r._features.isFree)},function(e){return r._alertCache.save(r.documentSession.id.get().toString(),s,r._features.isFree,e)},this._telemetry,this._capiConnectivity,this._features.isDesktopEditor?"desktop_editor":void 0,n,this._features.isUserTesting);return this.cardsModel=new h.CardsModelImpl(this._state.lens("cards"),a,this._features),a.mount(),this._documentSyncSubs=[this.documentSession.textChangedByServer.subscribe(function(e){a.setDocumentContent(e)}),a.textChangedByUser.subscribe(function(e){r.documentSession.setDocumentContent(e)}),a.scores.view(function(e){return[e.visiblePremiumAlerts,e.criticalAlerts]}).skip(1).subscribe(function(e){var t=e[0],n=e[1];r.documentSession.setDocumentAlertCount(n+(r._features.isFree?0:t))}),o.checksEnabled.skip(1).subscribe(function(e){return r.documentSession.setDocumentChecks(e)}),o.genre.skip(1).subscribe(function(e){return r.documentSession.setDocumentGenre(e)})],n&&this._documentSyncSubs.push(this.contextState.skip(1).subscribe(function(e){r.documentSession.setDocumentContext(e),o.genre.set(i.domainToGenre(e.domain))})),this.editorEngine.set(a),a},e.prototype.stopEditor=function(){var e=this.editorEngine.get();if(!e||!this._documentSyncSubs)throw new d.InvariantError("editor should be started");this._documentSyncSubs.forEach(function(e){return e.unsubscribe()}),this._documentSyncSubs=null,this.editorEngine.set(null),e.unmount()},Object.defineProperty(e.prototype,"isActive",{get:function(){return null!==this.editorEngine.get()},enumerable:!0,configurable:!0}),e.prototype.end=function(){return o.__awaiter(this,void 0,void 0,function(){var e;return o.__generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.isActive&&this.stopEditor(),[4,this.documentSession.end()];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),a.Monitoring.Logging.getLogger("model.editor.editor_sesion").error("DOX editor session end failed",e),[3,3];case 3:return[2]}})})},e}();t.EditorSessionImpl=g},543:function(e,t,n){"use strict";function r(e){function t(e){var t=typeof e;return null!=e&&("object"===t||"function"===t)}function n(e){var n={};for(var r in e)"ts"!==r&&"renderTs"!==r&&"tracked"!==r&&("r"!==r&&"origReplacements"!==r&&"rHtml"!==r&&"examples"!==r&&"references"!==r&&"rawMatch"!==r&&(t(e[r])||"selected"===r&&!Array.isArray(e[r]))||(n[r]=e[r]));return n}return e.filter(function(e){return!e.replaced}).map(n)}function o(e,t,n,r,o,i,s,a,c,l,h,d,p,g,_){g&&(u.Capi.CLIENT_NAME=g);var v=u({silentLogs:!0,el:e,docid:parseInt(r,10),value:o,sid:0,capiUrl:i,matches:h,apps:{plagiarismActive:s},editorType:"textarea"===t?{textarea:!0,value:"textarea"}:{contenteditable:!0,value:"contenteditable"},asPlainText:!0,textareaWrapSelector:"#"+n,plagiarismCheckDelay:1e4,dialect:a.orNull(),filter:function(e){return e?e.filter(function(e){return(_||!e.rawMatch.hidden)&&("synonyms"===e.rawMatch.action||c(y.alertGroupFromString(e.rawMatch.group)))}):[]},canRemoveSynonym:function(e){return!!m.DOM.hasParentWithClassName(e,"closeSyn")||!m.DOM.hasParentWithClassName(e,"cardSyn")},extendParams:function(e){e.genre=l()},exposeRawMatch:!0,exposeSynApi:!0,getContainerId:d.getContainerId,capiIdleTimeout:24e4,textareaBottomPadding:36,removeByPIDOnIgnore:!_,synAutofix:!0,skipMousedownWhen:function(e){return m.DOM.hasParentWithClassName(e.target,b.CardBaseClassName)}});if(_)v.synonyms.disable(),v.getMatchClass=function(e){if(!e.rawMatch)return"";if("synonyms"===e.rawMatch.action)return"gr_syn_replaced";var t=f.pnameToLensProp(e.rawMatch.pname,function(e){return e.type});if(!t||e.rawMatch.hidden)return"";var n=["grAlert"+t];e.replaced&&n.push("Replaced"),e.selected&&n.push(" sel");var r=p(e.rawMatch);return r&&n.push(" "+r)," gr_"+e.rawMatch.id+" "+n.join("")};else{var w=v.getMatchClass;v.getMatchClass=function(e,t){var n=w(e,t);return e.rawMatch?((e.rawMatch.renderedOnce||"safari"===C.browser)&&(n+=" gr_disable_anim_appear"),"synonyms"===e.rawMatch.action&&(n+=" gr_syn_replaced"),e.rawMatch.renderedOnce=!0,n):n}}return v}function i(e){return e.rawMatch.group||"synonyms"===e.rawMatch.action}Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(27),c=n(29),u=n(577),l=n(48),h=n(12),d=n(5),p=n(150),f=n(1353),m=n(7),g=n(49),_=n(201),y=n(97),v=n(554),b=n(299),w=n(539),E=n(1360),S=n(544);t.defaultState={pendingAlertAction:null,alertHighlights:{focused:{id:null,source:null},highlighted:null},alerts:{},premiumMatches:[],checkingStatus:b.CheckingStatus.idle};var C=g.getBrowserInfo(),k=function(){function e(e,t,n,r,o,i,u,l,p,g,v,C,k,x,T,A){var I=this;this._state=e,this._domElement=t,this._textAreaType=n,this._textAreaWrapperElementId=r,this._docId=o,this._initialText=i,this._capiWsUrl=u,this._checkingSettings=l,this._dialectSetting=p,this._getCachedMatches=g,this._cacheSerializableMatches=v,this._telemetry=C,this._capiConnectivity=k,this._capiClientName=x,this._isDenali=T,this._isUserTesting=A,this.synonymsViewModel=new E.SynonymsViewModelImpl(new S.SynonymsModelImpl(function(e,t){return s.__awaiter(I,void 0,void 0,function(){var n,r,o;return s.__generator(this,function(i){switch(i.label){case 0:if(!this._editor)throw new m.InvariantError("editor should be mounted");return this._editor.synonyms.requestSynonyms(e,t),[4,this._synonymAlerts.first().toPromise()];case 1:if(n=i.sent(),n.title===t){if(0!==n.meanings.length)return r=function(e){return{word:e.newText,definition:""}},o=1===n.meanings.length?c.Either.left(n.meanings[0].replacements.map(r)):c.Either.right(n.meanings.map(function(e){return{meaning:e.title,words:e.replacements.map(r)}})),[2,{originalWord:t,synonymsOrGroups:o,alert:n}];throw new Error("Wrong synonym alert for "+t+": expecting meanings to exists")}throw new Error("Wrong synonym alert: expecting "+t+", got "+n.title)}})})}),function(){if(!I._editor)throw new m.InvariantError("editor should be mounted");return I._editor.synonyms},function(e,t,n){var r=e.match;r.replaced=!0,r.replace(n,!1)}),this.pendingAlertAction=this._state.lens("pendingAlertAction"),this._undoedAction=h.Atom.create(null),this.undoedAlert=this._undoedAction.skip(1).switchMap(function(e){return e?I._visibleAlerts.view(function(t){return t[e.id]}).filter(function(e){return!!e}).take(1):a.Observable.of(null)}),this._log=d.Monitoring.Logging.getLogger("model.editor.ge_engine"),this._tsCheckingStatus=d.Monitoring.TimeSeries.root.getCounter("model.editor.ge_engine.checking_status_inprogress"),this.appliedAlertIds=new Set,this._highlights=this._state.lens("alertHighlights"),this._focusedAlert=this._highlights.lens("focused"),this._highlightedAlert=this._highlights.lens("highlighted"),this._visibleAlerts=this._state.lens("alerts"),this._synonymAlerts=new a.Subject,this._matchFilterState=h.Atom.create({typeOrCategory:null,premium:null}),this._visibleAlertsFlattened=h.Atom.combine(this._visibleAlerts,this._matchFilterState,function(e,t){return Object.keys(e).map(function(t){return e[t]}).filter(function(e){return I._isVisible(e.alert.pname,e.alert.isFree,t)})}),this._premiumMatches=this._state.lens("premiumMatches"),this._checkingStatus=this._state.lens("checkingStatus"),this._textChangedByUser=new a.Subject,this._editor=null,this._editorEventSubs=null,this.denaliScores=h.Atom.create({accuracy:0,clarity:0,effectiveness:0,score:0,rank:0}),this._editorRendered=this._unsafeEditorEvent("rendered"),this._editorAlertRemovedOnServer=this._unsafeEditorEvent("serverRemove"),this._editorAlertSelected=this._unsafeEditorEvent("selectedMatch"),this._editorAlertDeselected=this._unsafeEditorEvent("deselectedMatch"),this._editorSending=this._unsafeEditorEvent("sending"),this._capiSocketConnect=this._unsafeEditorEvent("socketConnect"),this._capiSocketStart=this._unsafeEditorEvent("socketStart"),this._capiSocketError=this._unsafeEditorEvent("socketError"),this._capiSocketDisconnect=this._unsafeEditorEvent("disconnect"),this._editorFinishedChecking=this._unsafeEditorEvent("finish"),this._pastedTextSize=new a.Subject,this.recheckingState=h.Atom.create(this._initialText.length>0),this._editorPlagiarismChecked=this._unsafeEditorEvent("plagiarismChecked"),this._editorFix=this._unsafeEditorEvent("fix"),this.alerts=this._visibleAlerts,this.checkingStatus=this._checkingStatus,this.appliedAlertsCount=h.Atom.create(0),this.hoveredAlert=a.Observable.fromEvent(this._domElement,"mousemove").throttleTime(100).map(function(e){var t=I._domElement.getBoundingClientRect();return I._getAlertByPosition({x:e.clientX-t.left,y:e.clientY-t.top})}).map(function(e){return null===e?null:!0===e.alert.hidden?null:e}).map(function(e){var t=I.pendingAlertAction.get();return t&&e?b.AppliedAlertAction.isSingle(t)?e.alert.id===t.alertId?null:e:-1!==t.alertIds.indexOf(e.alert.id)?null:e:e}),this.settings=this._checkingSettings,this.localText=h.Atom.create(this._initialText),this.approximateWordCount=h.Atom.create(m.StringUtils.wordCount(this._initialText)),this.approximateCharCount=h.Atom.create(m.StringUtils.charCount(this._initialText)),this.scores=h.Atom.combine(this.localText.view(function(e){return null!=e?e:""}),this.approximateWordCount,this._visibleAlerts,this._premiumMatches,function(e,t,n,r){return w.calculateScores(e.length,t||0,Object.keys(n).filter(function(e){return!I.appliedAlertIds.has(e)}).map(function(e){return n[e].alert}),r.length)}),this.alertsCount=this._visibleAlerts.view(function(e){var t=_.createChecksDefaultState(0);return Object.keys(e).map(function(t){return e[t].alert}).forEach(function(e){switch(e.group){case y.AlertGroup.contextualSpelling:t.contextualSpelling++;break;case y.AlertGroup.enhancement:t.enhancement++;break;case y.AlertGroup.grammar:t.grammar++;break;case y.AlertGroup.plagiarism:t.plagiarism++;break;case y.AlertGroup.punctuation:t.punctuation++;break;case y.AlertGroup.sentenceStructure:t.sentenceStructure++;break;case y.AlertGroup.style:t.style++;break;case y.AlertGroup.synonym:break;default:throw new TypeError("Unknown alert group: "+e.group)}}),t}),this.premiumAlertsCount=this.scores.view("premiumAlerts"),this.textChangedByUser=this._textChangedByUser.distinctUntilChanged().skipWhile(function(e){return e===I._initialText}),this.focusedAlert=h.Atom.combine(this._visibleAlerts,this._focusedAlert,function(e,t){return I._getSynonymAlert(e)||t}),this.highlightedAlert=this._highlightedAlert,this._matchClassAppender=function(e){var t=I._matchFilterState.get();return I._isVisible(e.pname,e.free,t)?void 0:"grAlertHidden"},this._filterByCategory=function(e,t){if(!t)return!0;switch(t.type){case"category":return f.pnameToLensProp(e,function(e){return e.key})===t.value;case"type":return f.pnameToLensProp(e,function(e){return e.type})===t.value;default:return m.assertNever(t)}},this._filterByPremium=function(e,t){if(!t)return!0;switch(t.type){case"premium":return!e;case"free":return e;default:return m.assertNever(t)}},this._isVisible=function(e,t,n){return I._filterByPremium(t,n.premium)&&I._filterByCategory(e,n.typeOrCategory)}}return e.prototype._unsafeEditorEvent=function(e){var t=this;return a.Observable.fromEventPattern(function(n){if(!t._editor)throw new m.InvariantError("editor should be mounted");t._editor.on(e,n)},function(n){if(!t._editor)throw new m.InvariantError("editor should be mounted");t._editor.off(e,n)},function(e){return e})},e.prototype.updatePastedTextSize=function(e){this._pastedTextSize.next(e)},e.prototype._mergeUndoedAlert=function(e){var t=this._undoedAction.get();if(t){var n=e.find(function(e){return e.value===t.value&&e.rawMatch.pname===t.rawMatch.pname&&e.rawMatch.begin===t.rawMatch.begin});n&&n.id!==t.id&&(this._visibleAlerts.modify(function(e){var r=e[t.id];return Object.assign({},e,(o={},o[t.id]=null,o),(i={},i[n.id]={alert:v.createAlert(n),highlightPosition:r.highlightPosition},i));var o,i}),this._focusedAlert.modify(function(e){return e.id===t.id?{id:n.id,source:"undo"}:e}),this._highlightedAlert.modify(function(e){return e&&e===t.id?n.id:e}))}},e.prototype._updateRemovedAlerts=function(e){var t=this;this._focusedAlert.modify(function(e){return e.id&&!t._unsafeGetMatchById(e.id)?{id:null,source:null}:e}),this._highlightedAlert.modify(function(e){return e&&!t._unsafeGetMatchById(e)?null:e}),this._visibleAlerts.modify(function(t){var n=e.filter(function(e){return i(e)&&void 0!==t[e.id]}),r={};return n.forEach(function(e){return r[e.id]=t[e.id]}),r}),this.pendingAlertAction.modify(function(e){return e&&b.AppliedAlertAction.isSingle(e)&&!t._unsafeGetMatchById(e.alertId)?null:e})},e.prototype._updateAddedAlerts=function(e){var t=this,n=function(){return t._domElement.getBoundingClientRect()};this._visibleAlerts.modify(function(r){var o=e.filter(i),s={};return o.map(function(e){try{return{match:e,highlightPosition:m.DOM.absToRelativeBuggy(e.getEl()&&e.getEl().getClientRects()[0],n())}}catch(e){return t._log.error(e),null}}).forEach(function(e){if(e)try{var n=v.createAlert(e.match);"synonym"===n.kind&&t._isDenali?t._synonymAlerts.next(n):s[e.match.id]={alert:r[e.match.id]?r[e.match.id].alert:n,highlightPosition:e.highlightPosition}}catch(e){t._log.error("Failed to create alert, skip it",e)}}),s})},e.prototype._updatePremiumAlertCount=function(e){this._premiumMatches.set(e.getMatches().filter(function(e){return!e.rawMatch.free&&"synonyms"!==e.rawMatch.action}))},e.prototype._getCurrentVisibleMatches=function(e){return e.getFiltered().filter(function(e){return e.getEl()})},e.prototype._subscribeToUpdateCheckingStatus=function(){var e=this;return a.Observable.merge(this._editorSending.mapTo(1),this._editorFinishedChecking.mapTo(-1),this._editorPlagiarismChecked.mapTo(-1),this._capiSocketDisconnect.mapTo(NaN)).scan(function(e,t){return Number.isNaN(t)?0:Math.max(0,e+t)},0).map(function(e){return 0===e?b.CheckingStatus.finished:b.CheckingStatus.inProgress}).subscribe(function(t){return e._checkingStatus.set(t)})},e.prototype._checkPlagiarism=function(e){var t=this;void 0===e&&(e=100),setTimeout(function(){t._editor&&t._checkingSettings.plagiarismEnabled.get()&&t._editor.checkPlagiarism()},e)},e.prototype.mount=function(){var e=this;m.invariant(null==this._editorEventSubs&&null==this._editor,"editor should not be mounted");var t,n=this._dialectSetting.dialect.get();try{t=this._getCachedMatches()}catch(e){this._log.error("could not load cached alerts",e)}if(this._editor=o(this._domElement,this._textAreaType,this._textAreaWrapperElementId,this._docId,this._initialText,this._capiWsUrl,function(){return e._checkingSettings.plagiarismEnabled.get()},n,function(t){return e._checkingSettings.isAlertGroupEnabled(t)},function(){return e._checkingSettings.genre.get()},t||[],this._telemetry,this._matchClassAppender,this._capiClientName,this._isDenali),this._editorEventSubs=[this._editorRendered.subscribe(function(){e._editor&&(e._undoedAction.get()&&e._mergeUndoedAlert(e._getCurrentVisibleMatches(e._editor)),e._updateRemovedAlerts(e._getCurrentVisibleMatches(e._editor)),e._updatePremiumAlertCount(e._editor))}),a.Observable.merge(this._editorRendered,a.Observable.fromEvent(window,"resize")).auditTime(50).subscribe(function(){e._editor&&(e._updateAddedAlerts(e._getCurrentVisibleMatches(e._editor)),e._updatePremiumAlertCount(e._editor))}),a.Observable.merge(this._editorRendered,this._checkingStatus.skip(1).filter(function(e){return e===b.CheckingStatus.finished})).auditTime(1e3).subscribe(function(){e._editor&&e._tryCacheCurrentAlerts()}),this._editorRendered.subscribe(function(){if(e._editor){var t=e._editor.getText();e.localText.set(t),e._textChangedByUser.next(e._editor.getText())}}),this.localText.audit(function(e){return a.Observable.timer(e&&e.length>1e3?1e3:100)}).startWith(this.localText.get()).subscribe(function(t){e.approximateWordCount.set(m.StringUtils.wordCount(t)),e.approximateCharCount.set(m.StringUtils.charCount(t))}),this._editorAlertRemovedOnServer.subscribe(function(t){e.appliedAlertIds.has(t.id)&&(t.cancelServerRemove=!0);var n=e._undoedAction.get();n&&n.id===t.id&&(t.cancelServerRemove=!0,e._undoedAction.set(null))}),this._editorAlertSelected.subscribe(function(t){m.invariant(null===e._focusedAlert.get().id,"alert selected without prior deselect:\n            had "+e._focusedAlert.get()+" selected,\n            selecting "+t.id),e._focusedAlert.set({id:t.id,source:"text"})}),this._editorAlertDeselected.subscribe(function(t){m.invariant(e._focusedAlert.get().id===t.id||e._highlightedAlert.get()===t.id,"other alert deselected:\n            had "+e._focusedAlert.get()+" selected,\n            deselecting "+t.id),e._focusedAlert.modify(function(e){return e.id===t.id?{id:null,source:null}:e}),e._highlightedAlert.modify(function(e){return e===t.id?null:e})}),this._subscribeToUpdateCheckingStatus(),this._checkingSettings.genre.skip(1).subscribe(function(t){e._editor&&(e.pendingAlertAction.get()&&e.commitLastAlertAction(),e._editor.hardReset(),e._checkPlagiarism(1e3))}),this._checkingSettings.checksEnabled.skip(1).subscribe(function(t){e._editor&&(e.pendingAlertAction.get()&&e.commitLastAlertAction(),e._editor.render(),e._checkPlagiarism())}),n.nonEmpty()?a.Subscription.EMPTY:this._editorFinishedChecking.map(function(e){return e&&e.dialect}).filter(function(e){return p.isDialectString(e)}).first().subscribe(function(t){return e._dialectSetting.setDialectWeak(t)}),a.Observable.merge(this._capiSocketDisconnect.filter(function(e){return 4095!==e.code&&1001!==e.code}).map(function(e){var t=e.code,n=e.reason;return{type:"disconnected",error:new l.WSError({status:n,code:t,message:"Cannot connect to CAPI"})}}),this._capiSocketStart.mapTo({type:"connected"})).distinctUntilChanged(function(e,t){return e.type===t.type}).switchMap(function(e){return"connected"===e.type?a.Observable.of(e):a.Observable.of(e).delay(5e3)}).subscribe(function(t){return e._capiConnectivity.set(t)}),this._capiSocketConnect.subscribe(function(t){var n=e.pendingAlertAction.get();if(e._editor&&n)if(e._log.debug("Pending alert action on CAPI connect: kind = "+n.kind+";\naction = "+(b.AppliedAlertAction.isSingle(n)&&n.action)),b.AppliedAlertAction.isSingle(n)){var r=e._unsafeGetMatchById(n.alertId),o=r&&!r.undoed;o||e._log.error("Alerts not in sync: pending undone alert action")}else b.AppliedAlertAction.isBatchIgnore(n)&&!n.alertIds.some(function(t){var n=e._unsafeGetMatchById(t);return n&&!n.undoed||!1})&&e._log.error("Alerts not in sync: pending undone alert action")}),this._capiSocketError.map(function(e){var t=e.code,n=e.reason;return new l.WSError({status:n,code:t,message:"CAPI socket error"})}).distinctUntilChanged(function(e,t){return e.code===t.code}).subscribe(function(t){return e._log.warn("CAPI socket error",t)}),this._editorFix.subscribe(m.Extension.notifications.sendEditorFix),this._undoedAction.subscribe(function(t){t&&t.id&&(e.setFocusedAlert(t.id,"undo"),e.setHighlightedAlert(t.id))}),a.Observable.merge(this.textChangedByUser.debounceTime(1e3).mapTo(!0),this.textChangedByUser.mapTo(!1),this._checkingSettings.genre.mapTo(!0)).distinctUntilChanged().switchMap(function(t){return t?e._checkingStatus.switchMap(function(e){return e===b.CheckingStatus.inProgress?a.Observable.timer(12e3):a.Observable.empty()}):a.Observable.empty()}).subscribe(function(){return e._tsCheckingStatus.increment()})],this._isDenali){var r=function(e,t){var n=e.slice(0,t+1).search(/\w+$/),r=e.slice(t).search(/\W/);return[n,r<0?e.length-1:r+t]},i=function(){if(!e._editor)throw new m.InvariantError("editor should be mounted");var t=e._editor.getSelection(),n=function(e){var t=e.s,n=e.text||"",o=r(n,t),i=o[0],s=o[1];return{pos:t,s:i,e:s,word:n.slice(i,s)}}(t),o=function(t){return c.Option.of(e._editor.dom.htmlDom.renderRange({s:t.s,e:t.s+1})[0]).map(function(t){var n=m.DOM.absToRelativeBuggy(t.getClientRects()[0],e._domElement.getBoundingClientRect());return t.className="denaliCarretPoint",e._editor.dom.htmlDom.removeBySelector(".denaliCarretPoint"),n})},i=o(t),s=o(n);return i.chain(function(e){return s.map(function(t){return{cursor:e,word:t}})})},s=function(){requestAnimationFrame(function(){return i().map(function(e){return{cursor:{x:e.cursor.left,y:e.cursor.top},word:{x:e.word.left,y:e.word.top}}}).map(function(t){return e.synonymsViewModel.move(t.cursor,t.word)})})};if(!this._isUserTesting){var u=a.Observable.merge(a.Observable.fromEvent(this._domElement,"click")).map(function(){if(!e._editor)throw new m.InvariantError("editor should be mounted");var t=e._editor.getSelection();return c.Option.of(t.s===t.e?t:null).map(function(e){var t=e.s,n=e.text||"",o=r(n,t),i=o[0],s=o[1];return{pos:t,s:i,e:s,word:n.slice(i,s)}}).filter(function(e){return e.word.length>2&&e.pos>e.s})}).share(),h=u.distinctUntilChanged(function(e,t){return e.equals(t)}).subscribe(function(t){t.fold(function(){return e.synonymsViewModel.hide()},function(t){return e.synonymsViewModel.showButton({start:t.s,word:t.word})})});this.synonymsViewModel.viewState.view(function(e){return null===e?null:e.synonymsState}).filter(function(e){return null!==e&&S.SynonymsModel.isReady(e)&&void 0!==e.synonyms}).subscribe(function(){s()}),this._editorEventSubs.push(h)}this._editorEventSubs.push(this._matchFilterState.skip(1).subscribe(function(){if(!e._editor)throw new m.InvariantError("editor should be mounted");e._getCurrentVisibleMatches(e._editor).forEach(function(t){var n=t.getEl(),r=e._editor.getMatchClass(t,"");n.className!==r&&(n.className=r)})}),this._editorFinishedChecking.subscribe(function(t){var n=t.scores,r=void 0===n?{Accuracy:0,Clarity:0,Effectiveness:0}:n,o=t.score,i=void 0===o?0:o;return e.denaliScores.set({accuracy:r.Accuracy,clarity:r.Clarity,effectiveness:r.Effectiveness,score:i,rank:Math.round(.5*r.Accuracy+.25*(r.Clarity+r.Effectiveness))})}),a.Observable.merge(this._capiSocketStart.mapTo(!0),this._pastedTextSize.filter(function(e){return e>1e3}).mapTo(!0),this._editorFinishedChecking.debounceTime(1e3).mapTo(!1)).subscribe(function(t){return e.recheckingState.set(e._initialText.length>0&&t)}))}this._editor.run(),this._checkPlagiarism()},e.prototype._unsafeGetMatchById=function(e){if(!this._editor)throw new Error("editor should be mounted");return this._editor.matches.byId(e)},e.prototype._getMatchById=function(e){var t=this._unsafeGetMatchById(e);if(!t)throw new m.InvariantError("expected non-null match #"+e);return t},e.prototype._updateHighlights=function(e,t){var n=this;[e.focused.id,e.highlighted].forEach(function(e){var t=null!==e&&n._unsafeGetMatchById(e);t&&t.deselect(!0)}),[t.focused.id,t.highlighted].forEach(function(e){try{null!==e&&n._getMatchById(e).select(!0)}catch(e){n._log.warn("Update highlights failed",e)}})},e.prototype._tryCacheCurrentAlerts=function(){if(!this._editor)throw new m.InvariantError("editor should be mounted");try{this._cacheSerializableMatches(r(this._editor.getMatches().filter(function(e){return"synonyms"!==e.rawMatch.action})))}catch(e){this._log.error("could not cache alerts",e)}},e.prototype.unmount=function(){if(!this._editor||!this._editorEventSubs)throw new m.InvariantError("editor should be mounted");this.pendingAlertAction.get()&&this.commitLastAlertAction(),this._tryCacheCurrentAlerts(),this._editorEventSubs.forEach(function(e){return e.unsubscribe()}),this._editorEventSubs=null,this._editor.exit(),this._editor=null},e.prototype.setDocumentContent=function(e){if(!this._editor)throw new m.InvariantError("editor should be mounted");this.pendingAlertAction.get()&&this.commitLastAlertAction(),this._editor.setText(e)},e.prototype.skipInputEvents=function(e){var t=(void 0===e?{turnBack:!1}:e).turnBack;if(!this._editor)throw new m.InvariantError("editor should be mounted");this._editor.inputListener.skipInputEvents(!1!==t||void 0)},e.prototype._applyAlert=function(e,t){if(!this._editor)throw new m.InvariantError("editor should be mounted");var n=this._getMatchById(e);switch(t.action){case"replace":n.replaced=!0,n.replace(t.replacementText,!1),t.isSynonym&&n.removeUnderline(),this.appliedAlertsCount.modify(function(e){return e+1});break;case"ignore":case"addToDictionary":case"acknowledge":this._isDenali?(n.replaced=!0,n.getEl().className=this._editor.getMatchClass(n,"")):n.getEl().classList.add("gr_replaced");break;default:return m.assertNever(t)}this.pendingAlertAction.set(b.AppliedAlertAction.createSingle(e,t)),this.appliedAlertIds.add(e)},e.prototype.batchIgnore=function(e){var t=this;if(!this._editor)throw new m.InvariantError("editor should be mounted");var n=this.pendingAlertAction.get();if(n&&(this.commitLastAlertAction(),b.AppliedAlertAction.isBatchIgnore(n)&&n.alertIds.length>0&&JSON.stringify(n.alertIds)===JSON.stringify(e)))throw new m.InvariantError("alert was already applied");try{e.forEach(function(e){return requestAnimationFrame(function(){t._getMatchById(e).replaced=!0,t.appliedAlertIds.add(e)})}),this.pendingAlertAction.set(b.AppliedAlertAction.createBatchIgnore(e))}catch(e){this._log.warn("Apply alert failed, action: batchIgnore",e)}this._focusedAlert.set({id:null,source:null}),this.setHighlightedAlert(null)},e.prototype.applyAlert=function(e,t){if(!this._editor)throw new m.InvariantError("editor should be mounted");var n=this.pendingAlertAction.get();if(n&&(this.commitLastAlertAction(),b.AppliedAlertAction.isSingle(n)&&n.alertId===e))throw new m.InvariantError("alert was already applied");try{this._applyAlert(e,t)}catch(e){this._log.warn("Apply alert failed, action: "+t.action,e)}this._focusedAlert.set({id:null,source:null}),this.setHighlightedAlert(null),this._undoedAction.set(null)},e.prototype.commitLastAlertAction=function(){var e=this;if(!this._editor)throw new m.InvariantError("editor should be mounted");var t=this.pendingAlertAction.get();if(!t)throw new m.InvariantError("can not commit when no action was applied");if(b.AppliedAlertAction.isBatchIgnore(t))return t.alertIds.forEach(function(t){e._getMatchById(t).ignore()}),this.appliedAlertIds.clear(),void this.pendingAlertAction.set(null);if("replace"===t.action.action&&t.action.isSynonym)return void this.pendingAlertAction.set(null);try{var n=this._getMatchById(t.alertId);switch(t.action.action){case"replace":n.remove();break;case"ignore":n.ignore();break;case"addToDictionary":this._isUserTesting?n.remove():n.addToDict();break;case"acknowledge":n.acknowledged();break;default:return m.assertNever(t.action)}}catch(e){this._log.warn("commitLastAlertAction failed",e)}this.appliedAlertIds.clear(),this.pendingAlertAction.set(null)},e.prototype._removeUndoStyles=function(e){this._isDenali?(e.replaced=!1,e.getEl().className=this._editor.getMatchClass(e,"")):e.getEl().classList.remove("gr_replaced")},e.prototype.undoLastAlertAction=function(){var e=this;if(!this._editor)throw new m.InvariantError("editor should be mounted");var t=this.pendingAlertAction.get();if(!t)throw new m.InvariantError("can not undo when no action was applied");if(b.AppliedAlertAction.isBatchIgnore(t))return void t.alertIds.forEach(function(t){e._removeUndoStyles(e._getMatchById(t))});var n=this._getMatchById(t.alertId);"replace"===t.action.action&&(n.undo(),this.appliedAlertIds.delete(t.alertId)),this._removeUndoStyles(n),this._undoedAction.set(this._unsafeGetMatchById(t.alertId)),this.pendingAlertAction.set(null)},e.prototype.setFocusedAlert=function(e,t){m.invariant(null!==this._editor,"editor should be mounted");var n=this._highlights.get();this._focusedAlert.set({id:e,source:t}),this._updateHighlights(n,this._highlights.get())},e.prototype.setHighlightedAlert=function(e){m.invariant(null!==this._editor,"editor should be mounted");var t=this._highlights.get();this._highlightedAlert.set(e),this._updateHighlights(t,this._highlights.get())},e.prototype.getAllAlerts=function(){return this._editor?this._editor.getMatches().filter(function(e){return y.alertGroupFromString(e.rawMatch.group)!==y.AlertGroup.plagiarism&&"synonyms"!==e.rawMatch.action}).map(v.createAlert):[]},e.prototype._getAlertByPosition=function(e){var t=e.x,n=e.y;return this._visibleAlertsFlattened.get().find(function(e){var r=e.highlightPosition;return r.left<=t&&t<=r.left+r.width&&r.top<=n&&n<=r.top+r.height})||null},e.prototype._getSynonymAlert=function(e){var t=Object.keys(e).find(function(t){return e[t].alert.group===y.AlertGroup.synonym});return t?{id:t}:null},e.prototype.isFocused=function(e){return this.focusedAlert.view(function(t){return t.id===e})},e.prototype.getCurrentSelection=function(){if(!this._editor)throw new m.InvariantError("editor should be mounted");var e=this._editor.getSelection();return e?{start:e.s,end:e.e}:null},e.prototype.setSelection=function(e){if(!this._editor)throw new m.InvariantError("editor should be mounted");this._editor.setCursor({s:e.start,e:e.end})},e.prototype.getUnderlinedHtml=function(){if(!this._editor)throw new m.InvariantError("editor should be mounted");return this._editor.dom.cloneVal.innerHTML},e.prototype.filterViewByTypeOrCategoryOnly=function(e){this._matchFilterState.set({typeOrCategory:e,premium:null})},e.prototype.filterView=function(e){this._matchFilterState.set(e)},e}();t.GrammarlyEditorEngine=k},544:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(304),i=n(5),s=n(12);!function(e){e[e.Querying=0]="Querying",e[e.Ready=1]="Ready"}(r=t.SynonymsStateKind||(t.SynonymsStateKind={}));var a;!function(e){function t(e){return null!==e&&e.kind===r.Ready}function n(e){return null!==e&&e.kind===r.Querying}e.isReady=t,e.isQuerying=n}(a=t.SynonymsModel||(t.SynonymsModel={}));var c=function(){function e(e){this._query=e,this.state=s.Atom.create({kind:r.Ready}),this._log=i.Monitoring.Logging.getLogger("editor.SynonymsModelImpl"),this._cache=new o.LRUCache(20)}return e.prototype.query=function(e){var t=this;this._log.trace("SynonymsQuery: "+e.word),this.state.set({kind:r.Querying,query:e});var n=this._getKey(e),o=this._cache.get(n);if(void 0!==o){this._log.trace("Cache hit for "+n);var i={kind:r.Ready,query:e,synonyms:o};this._onResponse(i)}else this._query(e.start,e.word).then(function(o){var i={kind:r.Ready,query:e,synonyms:o};t._cache.put(n,o),t._onResponse(i)}).catch(function(e){t.abortQuery()})},e.prototype.abortQuery=function(){a.isQuerying(this.state.get())&&this.state.set({kind:r.Ready})},e.prototype._getKey=function(e){return e.word+"#"+e.start},e.prototype._onResponse=function(e){this._log.trace("_onResponse() newState: "+e);var t=this.state.get();a.isQuerying(t)&&t.query.word===e.query.word?this.state.set(e):this._log.trace("Discarding result for "+e.query.word)},e}();t.SynonymsModelImpl=c},545:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=n(29),i=n(7);!function(e){var t;t||(t={}),e.genUuid=function(){return i.StringUtils.alphanumeric(12)},e.defaultState={visible:!1,content:o.None},e.ContextTypes={tooltip:r.object};var n=function(){function t(t){var n=this;this._state=t,this.visible=this._state.lens("visible"),this.content=this._state.lens("content"),this.hasContent=this._state.view(function(e){return e.content.nonEmpty()}),this.state=this._state.view(function(e){return e.content.filter(function(){return e.visible})}),this.show=function(){n.visible.set(!0)},this.hide=function(){n._state.set(e.defaultState)}}return t.prototype.setContent=function(e){this.content.set(o.Some(e))},t.prototype.cleanContent=function(t){this._state.modify(function(n){return n.content.exists(function(e){return e.uuid===t})?e.defaultState:n})},t}();e.Impl=n}(t.Tooltip||(t.Tooltip={}))},546:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(27),i=n(196),s=n(98);!function(e){function t(e){var t=0;return function(){return t++<e}}function n(e,t){return new Promise(function(n,r){e().catch(function(n){if(t(n))return e();throw n}).then(n).catch(r)})}function a(){return{status:k.idle}}function c(e){return{status:k.ok,value:e}}function u(e){return e.status===k.idle}function l(e){return e.status===k.inProgress}function h(e){return e.status===k.ok}function d(e){return e.status===k.error}function p(e){return e.status===k.fatal}function f(e){return h(e)||p(e)}function m(e){return f(e)||d(e)}function g(e,t){return h(e)?t(e.value):e}function _(e,t){return h(e)?c(t(e.value)):e}function y(e){return i.invariant(!l(e),"Can't enter begin state - unexpected status '"+k[e.status]+"'"),{status:k.inProgress}}function v(e,t){return function(n){i.invariant(!f(n),"Can't enter error state - unexpected status '"+k[n.status]+"'");var r=k.error;return t?{status:r,error:e,attempt:t}:{status:r,error:e}}}function b(e){return function(t){return i.invariant(d(t)||l(t),"Can't enter fatal state - unexpected status '"+k[t.status]+"'"),{status:k.fatal,error:e}}}function w(e){return function(t){return i.invariant(!h(t),"Can't enter ok state - unexpected status '"+k[t.status]+"'"),c(e)}}function E(t,n,r,i){return void 0===r&&(r=e.DEFAULT_TIMEOUT_MS),void 0===i&&(i=function(e){return e}),new Promise(function(e,s){n.modify(y);var a=!1;o.Observable.defer(t).last().timeout(r).subscribe(function(t){n.modify(w(i(t))),a=!0,e(t)},function(e){n.modify(v(e)),a=!0,s(e)},function(){if(!a){var e=void 0;n.modify(function(t){return t.status!==k.ok&&t.status!==k.error?v(e=new x)(t):t}),e&&s(e)}})})}function S(e,t,n){var r=e.get();return n().then(function(n){return new Promise(function(n){e.modify(t),n()})}).catch(function(t){return e.set(r),Promise.reject(t)})}function C(e,t,n,r){void 0===r&&(r=!0);var o=e.get();return e.modify(t),n().catch(function(t){return r&&e.set(o),Promise.reject(t)})}e.retryCountPredicate=t,e.promiseRetrier=n;var k;!function(e){e[e.idle=0]="idle",e[e.inProgress=1]="inProgress",e[e.ok=2]="ok",e[e.error=3]="error",e[e.fatal=4]="fatal"}(k=e.Status||(e.Status={})),e.defaultValue=a,e.ok=c,e.isIdle=u,e.isInProgress=l,e.isOk=h,e.isError=d,e.isFatal=p,e.isTerminated=f,e.isSomething=m,e.flatMap=g,e.map=_,e.begin=y,e.error=v,e.fatal=b,e.success=w,e.DEFAULT_TIMEOUT_MS=1e4;var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.CustomError);e.NoValueReturnedError=x,e.runWithTimeout=E,e.promiseWithTimeout=function(e,t){return o.Observable.from(e).timeout(t).toPromise()},e.modifyRemoteState=S,e.modifyRemoteStateOptimistic=C;!function(t){function n(t,n,a){void 0===a&&(a=r.noRetry);var c=0;n.modify(y);var u=o.Observable.defer(t).catch(function(e){throw n.modify(v(e,++c)),e}).retryWhen(a).catch(function(e){return n.modify(b(e)),o.Observable.never()}).map(w).do(n.modify.bind(n)).first().subscribe(s.noop);return{unsubscribe:function(){e.isTerminated(n.get())||(i.invariant(!u.closed,"cannot abort completed operation"),u.unsubscribe())}}}var r;!function(e){e.noRetry=function(e){return e.switchMap(function(e){return o.Observable.throw(e)}).first()},e.linear=function(e,t){return void 0===t&&(t=1e3),function(n){return n.switchMap(function(n,r){if(r>=e)throw n;return o.Observable.timer(r*t)})}},e.conditional=function(e,t){return function(n){return o.Observable.merge(t(n.takeWhile(e)),n.skipWhile(e).map(function(e){throw e}))}}}(r=t.RetryStrategy||(t.RetryStrategy={})),t.create=n}(e.OperationRetrier||(e.OperationRetrier={}))}(t.Async||(t.Async={}))},547:function(e,t,n){"use strict";function r(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return 0===e.length?i.Properties.of(t.ls):i.Properties.of.apply(i.Properties,e.map(function(e){return n={},n[e]=t.ls.getItem(e),n;var n}))}function o(e){for(var n=0,r=e.entries();n<r.length;n++){var o=r[n],i=o[0],a=o[1];try{var c=a.getStr();c&&t.ls.setItem(i,c)}catch(e){return void s.Monitoring.Logging.getLogger("model.settings.localStorage").warn("Cannot save data to local storage",e)}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(48),s=n(5),a=n(98),c=n(29);t.ls=window.localStorage||Object.create({getItem:function(e){return null},setItem:function(e,t){return a.noop},removeItem:function(e){return null}}),t.readProperties=r,t.writeProperties=o;!function(e){function t(e){return{getItem:function(t){return c.Option.of(e.getItem(t))},setItem:function(t,n){return e.setItem(t,n)},safeRemoveItem:function(t){try{e.removeItem(t)}catch(e){}},getKeys:function(){return Object.keys(e)},removeItem:function(t){return e.removeItem(t)}}}e.fromLocalStorage=t}(t.DenaliStorage||(t.DenaliStorage={}))},549:function(e,t,n){n(844),e.exports=n(1392)},550:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(1369),n(1373).initializeMonitoring();var r=n(17),o=n(553),i=n(1342);o.render(r.createElement(i.Main,null),document.getElementById("page"))},551:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(146),o=n(208);t.Notifications=o;var i=n(557),s=n(293);t.Subscription=s;var a=n(150);t.Settings=a;var c=n(118);t.Account=c;var u=n(1344),l=n(1363);t.NavigationBar=l;var h=n(1354);t.Dictionary=h;var d=n(545);t.Tooltip=d.Tooltip;var p=n(1362);t.Modal=p;var f=n(572);t.NewEditor=f;var m=n(296);t.Card=m;var g=n(97);t.Alert=g;var _=n(298);t.AlertExamples=_;var y=n(538);t.Documents=y;var v=n(566);t.Apps=v;var b=n(556);t.Banners=b;var w=n(1364);t.ProofitBanners=w;var E=n(1361);t.Extension=E;var S=n(1346);t.Connectivity=S;var C=n(1348);t.WsConnectivity=C;var k=n(1365),x=n(1347),T=n(1355);t.DocumentUpload=T;var A=n(1345),I=n(1349),O=n(199),D=n(49);t.BrowserInfo=D;var P=n(7);t.defaultState={authentication:u.defaultState,userAccount:null,notifications:o.defaultState,denaliNotifications:i.defaultState,dictionary:h.defaultState,tooltip:d.Tooltip.defaultState,modal:p.defaultState,overlay:p.defaultState,newEditorPage:f.editorPageDefaultState,banner:b.defaultState,documentsPage:y.defaultState,online:!0};var R=function(){function e(e,t,n,s,a,l,m,g,_,y,v,b){var w=this;this._state=e,this._authApi=t,this._institutionApi=n,this._dapi=s,this.platformInfo=a,this._dictionaryApi=l,this._irbisApi=m,this._doxApi=g,this.telemetry=_,this.gnarSpec=y,this._appConfig=v,this._router=b,this._nullableUserAccount=this._state.lens("userAccount"),this._userAccount=this._nullableUserAccount.filter(function(e){return null!==e}).map(function(e){return e}),this.editorTsNotifications=new o.NotificationsModelImpl(this._state.lens("notifications")),this.denaliNotifications=new i.DenaliNotificationsModelImpl(this._state.lens("denaliNotifications"),this._appConfig,this._router.location),this._navigateToDocument=function(e,t){w._router.navigate(r.Router.routes.editor.href({docId:e}),t)},this.notifications=new o.ProxyShowNotificationsModel(function(){return w._router.isActive(r.Router.routes.denali_editor.href({docId:"*"})).get()?w.denaliNotifications:w.editorTsNotifications}),this.unsafeUserAccount=null,this.modal=new p.ModalDialogModelImpl(this._state.lens("modal"),this.platformInfo.os,this.notifications),this.overlay=new p.ModalOverlayModelImpl(this._state.lens("overlay")),this.authentication=new u.AuthenticationModelImpl(this._state.lens("authentication"),this._authApi,this._institutionApi,this._dapi,function(e){w._nullableUserAccount.set(e),w.unsafeUserAccount=new c.UserAccountModelImpl(w._nullableUserAccount,w._authApi,w._irbisApi,w._dapi,w._appConfig.funnel.subscribe,w._appConfig.funnel.upgrade,w._appConfig.api.subscriptionUrl,w.platformInfo.type,w.platformInfo.browser,w.telemetry,w._router,w._appConfig)},this._appConfig,this.telemetry,function(){return w._router.navigate(r.Router.routes.free.href({}))},this.modal,this.overlay,this.platformInfo.browser),this.dictionary=new h.DictionaryModelImpl(this._state.lens("dictionary"),this._dictionaryApi),this.tooltip=new d.Tooltip.Impl(this._state.lens("tooltip")),this._navigationBar=null,this._alertCache=new f.AlertCacheImpl(function(e){return e},function(e){return e},this._appConfig.alertCachePrefix,this._appConfig.alertCacheVersion),this._newEditorPage=null,this.connectivity=new S.ConnectivityModelImpl({network:new A.NetworkErrorHandler(this.notifications,this.overlay),wsProtocol:new A.WsProtocolErrorHandler(this.notifications,this.overlay),dox:new A.DoxErrorHandler(this.notifications,this.overlay,this.authentication),wsDox:new A.DoxErrorHandler(this.notifications,this.overlay,this.authentication),wsCapi:new A.CapiErrorHandler(this.notifications,this.overlay)}),this.networkState=new x.NetworkConnectivityModelImpl(this.connectivity,this._appConfig.api.onlineTestUrl),this.wsConnectivity=new C.WsConnectivityModelImpl(this.connectivity,{wsDox:new I.WsDoxErrorHandler(this.networkState,this.connectivity),wsCapi:new I.WsCapiErrorHandler(this.networkState,this.connectivity)}),this.selfUpdate=new k.SelfUpdate(this._router,this._appConfig.selfUpdate),this.extension=new E.ExtensionInstallModelImpl(this.platformInfo.browser,this._appConfig.extension.chrome.installURL,this._appConfig.extension.firefox.installURL,this._appConfig.extension.firefox.iconURL,this.notifications),this.apis={dox:this._doxApi},this._userAccount.distinctUntilChanged(function(e,t){return e.userProfile.id===t.userProfile.id}).subscribe(function(e){var t=e.userProfile,n=t.id,r=t.isTest;return _.setUser(n,r)}),this._userAccount.filter(function(e){return!0!==e.userProfile.isTest&&P.Async.isOk(e.subscription)&&e.userProfile.groups.has(c.UserGroups.PREMIUM_CONVERSION)}).distinctUntilChanged(function(e,t){return e.userProfile.id===t.userProfile.id}).subscribe(function(e){return O.PixelTracking.doTracking(e.userProfile,e.subscription.value,w._irbisApi)})}return Object.defineProperty(e.prototype,"userAccount",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this.unsafeUserAccount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navigationBar",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this._navigationBar=this._navigationBar||new l.NavigationBarModelImpl(this.unsafeUserAccount.features,this.platformInfo.browser,this.platformInfo.os)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"newEditorPage",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");var e=this.unsafeUserAccount,t=e.settings,n=(e.profile,e.features);return this._newEditorPage=this._newEditorPage||new f.EditorPageModelImpl(this._state.lens("newEditorPage"),t,this._doxApi,this._appConfig.api.capiWsUrl,n,this.telemetry,this.modal,this._alertCache,this.wsConnectivity,this.connectivity,this.notifications)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"documentsPage",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this._documentsPage=this._documentsPage||new y.DocumentsPageModelImpl(this._state.lens("documentsPage"),this._doxApi,this.unsafeUserAccount.settings,this._alertCache,this.platformInfo.browser,this.connectivity,this.notifications,this._navigateToDocument,this.unsafeUserAccount.features.enableTrackingOnDownload.get())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"documentUpload",{get:function(){var e=this;if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return this._documentUpload=this._documentUpload||new T.UploadModel(function(t){return e.documentsPage.actions.uploadDocument(t)},this._navigateToDocument,this.notifications,this.telemetry)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apps",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return new v.AppsModelImpl(this.platformInfo.browser,this.platformInfo.os,this.extension,this.unsafeUserAccount.features.desktopApps,this.telemetry)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"banners",{get:function(){if(!this.unsafeUserAccount)throw new P.InvariantError("User should be already authenticated");return new b.BannersModelImpl(this._state.lens("banner"),this.platformInfo.browser,this.platformInfo.os,this.extension,this.telemetry)},enumerable:!0,configurable:!0}),e}();t.AppModelImpl=R},552:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(533);t.CAPIClient=o.CAPIClient,t.CAPIEventHandler=o.CAPIEventHandler,t.defaultReconnect=o.defaultReconnect;var i=n(1331);t.CAPIClientImpl=i.CAPIClientImpl;var s=n(535);t.ClientType=s.ClientType,r.__exportStar(n(534),t),r.__exportStar(n(1332),t);var a=n(536);t.DocumentStatistics=a.DocumentStatistics},554:function(e,t,n){"use strict";function r(e){var t=e.rawMatch;return d.invariant("synonym"!==t.action,"Do not use `getBasicAlertFields` for synonyms."),{id:t.id.toString(),title:t.title,hidden:t.hidden,category:t.category,categoryHuman:t.categoryHuman,pid:t.pid,pname:t.pname,isFree:t.free,highlightText:t.highlightText,range:{start:t.begin,end:t.end},group:p.alertGroupFromString(t.group)}}function o(e){var t=e.rawMatch,n=t.synonyms.token,r=e.value;return{id:e.id,title:n||r,hidden:!1,category:t.category,categoryHuman:t.categoryHuman,pid:t.pid,pname:t.pname,isFree:!0,highlightText:"",range:{start:e.begin,end:e.end},group:p.AlertGroup.synonym}}function i(e){var t=e.rawMatch,n=t.extra_properties||{},o=r(e);t.replacements&&t.transforms&&d.invariant(t.replacements.length===t.transforms.length,"every transform should have replacement");var i={kind:"common",details:t.details,explanation:t.explanation,examples:p.parseExamples(t.examples),todo:t.todo,replacements:(t.transforms||[]).map(function(e,n){return p.createReplacement(e,t.replacements[n])}),extraProperties:{hasAddToDictionary:!!n.add_to_dict,isDidYouMean:!!n.did_you_mean,isShowTitle:!!n.show_title,isEnhancement:!!n.enhancement,plagiarismUrl:n.url,sentence:n.sentence,priority:n.priority?parseInt(n.priority,10):0}};return Object.assign(o,i)}function s(e){var t=p.parsePlagiarism(e),n=r(e),o={kind:"plagiarism",title:t.title,description:t.description,url:t.url,reference:t.reference};return Object.assign(n,o)}function a(e){var t=e.rawMatch,n=r(e),o={details:t.details,explanation:t.explanation,examples:p.parseExamples(t.examples),todo:t.todo,kind:"enhancement",replacements:(t.replacements||[]).map(p.createSimpleReplacement),extraProperties:{isEnhancement:!0}};return Object.assign(n,o)}function c(e,t){return void 0===t&&(t=""),e&&""!==e&&""!==t&&(e.includes(t)||t.includes(e))}function u(e){var t=h.Monitoring.Logging.getLogger("grammarly_editor_alert.synonyms"),n=h.Monitoring.TimeSeries.root.getMetric("grammarly_editor_alert"),r=e.rawMatch,i=r.synonyms,s=i.token,a=i.meanings,u=e.value,l=e.badSyn,d=o(e);return l?(t.warn("Synonym error: cannot_find_synonym",{expected:e.value}),n.getCounter("synonyms.error.cannot_find_synonym").increment()):s&&s!==u?n.getCounter("synonyms.error.syn_for_wrong_token").increment():s?n.getCounter("synonyms.success").increment():n.getCounter("synonyms.error.token_missing").increment(),s&&s!==u?(t.warn(c(s,u)?"Got synonym for similar word":"Got synonym for wrong token",{expected:u,got:s}),Object.assign(d,{kind:"synonym",title:u,meanings:[],replacements:[]})):Object.assign(d,{kind:"synonym",match:e,meanings:a.map(function(e){return{title:e.meaning,replacements:e.synonyms.map(function(e){return p.createSimpleReplacement(e.derived)})}}),replacements:(r.replacements||[]).map(p.createSimpleReplacement)})}function l(e){var t=e.rawMatch;if(!t.group&&"synonyms"===t.action)return u(e);switch(p.alertGroupFromString(e.rawMatch.group)){case p.AlertGroup.plagiarism:return s(e);case p.AlertGroup.enhancement:return a(e);default:return i(e)}}Object.defineProperty(t,"__esModule",{value:!0});var h=n(5),d=n(7),p=n(97);t.getBasicAlertFields=r,t.getSynonymBasicAlertFields=o,t.isTokensSimilar=c,t.createAlert=l},556:function(e,t,n){"use strict";function r(e){switch(e){case"office-addin":return"officeAddin";case"desktop-mac":return"macApp";case"desktop-windows":return"winApp";case"chrome-extension":return"chromeExt";case"firefox-extension":return"firefoxExt";case"safari-extension":return"safariExt";case"edge-extension":return"edgeExt";case"referral":return"referral";case"no-referral":return"no-referral";case"campaign-end":return"campaignEnd";case"proofit-cancelled":return"proofitCancel";case"proofit-completed":return"proofitComplete";default:return o.assertNever(e)}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),i=n(197),s=n(118);t.defaultState={active:null},t.bannerToTracking=r;var a=function(){function e(e,t,n,r,o){this._state=e,this._browser=t,this._os=n,this._extension=r,this._telemetry=o,this.state=this._state.view()}return e.prototype.initialize=function(e,t,n){this._settings=n,this._banners=e;var r=e.later,o=r.filter(function(e){return Date.now()<=e.expire});o.length!==r.length&&this._updateBanners({later:o});var i=this._getActiveBanner(t);this._state.set({active:i}),i&&this._shown(i)},e.prototype._notHidden=function(e){return this._banners.dismiss.concat(this._banners.later.map(function(e){return e.type})).indexOf(e)<0},e.prototype._getExtensionBanner=function(){var e=this._browser+"-extension";return!i.isExtensionInstalled()&&this._notHidden(e)&&i.isBrowserHasExtension(this._browser)?e:null},e.prototype._getDesktopBanner=function(e){if("mac"!==this._os&&"windows"!==this._os)return null;var t="desktop-"+this._os;return!e.has(s.UserGroups.DESKTOP_EDITOR_INSTALLED)&&this._notHidden(t)?t:null},e.prototype._getOfficeAddinBanner=function(e){if("windows"!==this._os)return null;var t="office-addin",n=this._banners.shown.indexOf(t)>-1;return i.isAddinInstalled(e)||n||!this._notHidden(t)?null:t},e.prototype._getActiveBanner=function(e){var t=this._getExtensionBanner(),n=this._getDesktopBanner(e),r=this._getOfficeAddinBanner(e);return t||n||r||null},e.prototype._updateBanners=function(e){this._banners=Object.assign({},this._banners,e),this._settings&&this._settings.updateBanners(this._banners)},e.prototype._shown=function(e){var t=this._banners.shown;t.indexOf(e)>-1||(t.push(e),this._updateBanners({shown:t}))},e.prototype.remind=function(e){var t=this._banners.later;t.push({type:e,expire:Date.now()+864e5}),this._updateBanners({later:t}),this._state.set({active:null})},e.prototype.dismiss=function(e){var t=this._banners.dismiss;t.push(e),this._updateBanners({dismiss:t}),this._state.set({active:null})},e.prototype.cancel=function(e){this._state.set({active:null})},e.prototype._isExtension=function(e){return["chrome-extension","firefox-extension","safari-extension","edge-extension"].indexOf(e)>-1},e.prototype.install=function(e,t){var n=this;this._isExtension(e)?(this._telemetry.bannerActionClicked(r(e),t),this._extension.install().then(function(e){return e&&n._state.set({active:null})})):this._state.set({active:null})},e}();t.BannersModelImpl=a},557:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(27),i=n(12),s=n(5),a=n(208),c=n(29);t.defaultState={items:[],importantItems:[]};var u=function(){function e(e,t,n){var r=this;this._state=e,this._appConfig=t,this.create=new a.EditorNotificationFactory,this._queue=this._state.lens("items"),this._importantQueue=this._state.lens("importantItems"),this.items=i.Atom.combine(this._queue,this._importantQueue,function(e,t){return t.length?[t[0]]:e.slice(0,3)}),this._notificationsSubs=new Map,this._nextId=function(){var e=1;return function(){return e++}}(),this.items.pairwise().subscribe(function(e){var t=e[0],n=e[1];t.filter(function(e){return-1===n.indexOf(e)}).forEach(function(e){return r._extract(e.id)}),n.filter(function(e){return-1===t.indexOf(e)}).forEach(function(e){return r._put(e)})}),n.subscribe(function(e){return r.cleanup()})}return e.prototype.show=function(e){var t=this,n=this._nextId(),o=r.__assign({},e,{id:n}),i=o.important||"error"===o.severity?this._importantQueue:this._queue;return o.exclusiveTag&&c.Option.of(i.get().find(function(e){return e.exclusiveTag===o.exclusiveTag})).forEach(function(e){return t.hide(e.id)}),i.modify(function(e){return e.concat([o])}),n},e.prototype.showMessage=function(e){return this.show(this.create.generic(e))},e.prototype.showError=function(e){return this.show(this.create.error(e))},e.prototype.hide=function(e){var t=[],n=function(n){return n.id!==e||(t.push(n),!1)};this._queue.modify(function(e){return e.filter(n)}),this._importantQueue.modify(function(e){return e.filter(n)}),t.forEach(function(e){e.dismissedHandler&&e.dismissedHandler()})},e.prototype.expire=function(e){this.hide(e)},e.prototype.cleanup=function(){this._queue.modify(this._cleanup)},e.prototype._cleanup=function(e){return e.filter(function(e){return e.dontRemoveOnAnyAction||e.important})},e.prototype._put=function(e){var t=this;if(s.Monitoring.Logging.getLogger("notifications").log("error"===e.type?s.Logging.LogLevel.WARN:s.Logging.LogLevel.INFO,"Notification shown: "+e.type,s.EventProps.fromAny(e)),e.denaliShowTimeMs!==1/0&&!e.important){var n=this._appConfig.notificationShowTimeMs||e.denaliShowTimeMs||7e3;this._notificationsSubs.set(e.id,o.Observable.interval(n).take(1).subscribe(function(){return t.hide(e.id)}))}},e.prototype._extract=function(e){this._notificationsSubs.has(e)&&(this._notificationsSubs.get(e).unsubscribe(),this._notificationsSubs.delete(e))},e}();t.DenaliNotificationsModelImpl=u},558:function(e,t,n){"use strict";function r(e,t){return{re:new RegExp("^("+e+")([\\s\\S]*)$"),createResult:t}}function o(e){for(var t=[],n=e,r=!1,o=0,i=void 0;n.length>0;){var s=function(e){for(var t=0,n=c;t<n.length;t++){var r=n[t],o=e.match(r.re);if(null!==o)return[r.createResult(o),o[o.length-1]]}}(n);void 0===s&&(r=!0);var u=s||function(t){var n=["<span class='gr_grammar_del'>","<span class='gr_grammar_ins'>","→"].map(function(e){return t.indexOf(e)});if(n.findIndex(function(e){return 0===e})>0)throw new Error("Couldn't parse transform: "+e);if(n=n.filter(function(e){return e>0}),n.length>0){var r=Math.min.apply(Math,n);return[{type:"text",text:t.substring(0,r)},t.substring(r)]}return[{type:"text",text:t},""]}(n),l=u[0],h=u[1];i&&"text"===i.type&&"text"===l.type?i.text+=l.text:(i&&"delete"===i.type&&"insert"===l.type&&(t.push({type:"arrow"}),o++),t.push(l)),"arrow"===l.type&&o++,i=t[t.length-1],n=h}return(r||0===t.length||o>1)&&a.Monitoring.Logging.getLogger("model.editor.alert_replacement").warn("Bad parsing of transform",{transformHtml:e,transformPartCount:t.length,arrowCount:o}),t}function i(e,t){return{newText:t,transform:o(e)}}function s(e){return{newText:e,transform:[{type:"insert",text:e}]}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),c=[r("(?:\\<span class='gr_grammar_del'\\>([\\S\\s]*?)\\</span\\>)",function(e){return{type:"delete",text:e[2]}}),r("(?:\\<span class='gr_grammar_ins'\\>([\\S\\s]*?)\\</span\\>)",function(e){return{type:"insert",text:e[2]}}),r("(→)",function(e){return{type:"arrow"}}),r("([^<>→]+)",function(e){return{type:"text",text:e[1]}})];t.parseTransformHtml=o,t.createReplacement=i,t.createSimpleReplacement=s},559:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(297),o=function(){function e(e,t,n,o,i,s,a,c){this.title=e,this.todo=t,this.replacements=n,this.isActive=o,this.isApplied=i,this.extraProperties=s,this.isVisibleQuickReplacement=a,this.onReplace=c,this.isDidYouMean=!!this.extraProperties.isDidYouMean,this.hasAddToDictionary=!!this.extraProperties.hasAddToDictionary,this.isEmptyReplacement=r.isNoReplacement(this.replacements),this.replacement=r.getReplacementModel({isDidYouMean:this.isDidYouMean,isActive:this.isActive,replacements:this.replacements,todo:this.todo,onReplace:this.onReplace}),this.isLongReplacement=this.replacement.template===r.CardReplacementTemplate.long,this.isReplacementUnderTitle=this.isLongReplacement||this.replacement.template===r.CardReplacementTemplate.didYouMean,this.isHighlightTextLabel=!this.isVisibleQuickReplacement,this.isShowTextTitle=this.isEmptyReplacement||this.extraProperties.isShowTitle||this.isReplacementUnderTitle||!this.isVisibleQuickReplacement}return e}();t.CommonHeaderModelImpl=o;var i=function(){function e(e,t,n,r){this.title=e,this.isActive=t,this.isApplied=n,this._url=r,this.plagiarism={url:this._url,urlTitle:this._url.map(function(e){return e.replace(/https?:\/\//,"")}),title:this.title}}return e}();t.PlagiarismHeaderModelImpl=i;var s=function(){function e(e,t,n,r){this.title=e,this.isActive=t,this.isApplied=n,this.isVisibleQuickReplacement=r,this.isHighlightTextLabel=!this.isVisibleQuickReplacement}return e}();t.EnhancementHeaderModelImpl=s},560:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(27);t.TIMEOUT=1e4,t.successResult=function(e,t){return{status:"success",result:e,time:t?Date.now()-t:void 0}},t.failedResult=function(e,t){return{status:"failed",result:e,time:t?Date.now()-t:void 0}},t.timeoutMessage="Failed by timeout",t.timeoutLimit=function(e){return r.delay(e).then(function(){throw new o.TimeoutError})}},561:function(e,t,n){"use strict";function r(e,t){if(!e||!e.parentElement)return!1;var n=e.className;return"string"==typeof n&&n.indexOf(t)>-1||r(e.parentElement,t)}function o(e,t,n){if(!e||!e.parentElement)return!1;var r=e.attributes.getNamedItem(t);return!(!r||r.value!==n)||o(e.parentElement,t,n)}function i(e,t){if(!t)return!1;for(;t.parentNode;){if(e===t.parentNode)return!0;t=t.parentNode}return!1}function s(e,t){return{top:e.top-t.top,bottom:e.bottom-t.bottom,left:e.left-t.left,right:e.right-t.right,width:e.width,height:e.height}}function a(e,t){return{top:e.top-t.top,bottom:e.bottom-t.top,left:e.left-t.left,right:e.right-t.left,width:e.width,height:e.height}}function c(e){if(!e)throw new Error("elem should not be null or undefined");var t=e.getBoundingClientRect();if(t.width||t.height){var n=e.ownerDocument,r=window,o=n.documentElement;return{top:t.top+r.pageYOffset-o.clientTop,left:t.left+r.pageXOffset-o.clientLeft,width:t.width,height:t.height}}return t}function u(e){return void 0!==e.dataset&&"true"===e.dataset.disabled}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(Boolean).join(" ")}Object.defineProperty(t,"__esModule",{value:!0}),t.hasParentWithClassName=r,t.hasParentWithAttribute=o,t.isParent=i,t.absToRelativeBuggy=s,t.absToRelative=a,t.getOffset=c;!function(e){function t(e,t){var n=t.x,r=t.y;return Math.trunc(e.top)<=Math.trunc(r)&&Math.trunc(e.bottom)>=Math.trunc(r)&&Math.trunc(e.left)<=Math.trunc(n)&&Math.trunc(e.right)>=Math.trunc(n)}e.empty={top:0,bottom:0,left:0,right:0,height:0,width:0},e.hasPoint=t}(t.Rect||(t.Rect={})),t.isDisabled=u,t.classes=l},562:function(e,t,n){"use strict";function r(e,t){return{dangerouslySetInnerHTML:{__html:u.sanitize(e,t)}}}function o(e){return function(t){t.stopPropagation(),e&&e(t)}}function i(e){return function(t){t.preventDefault(),e&&e(t)}}function s(e,t){return void 0===t&&(t="px"),{MsTransform:"translateY("+e+t+")",WebkitTransform:"translateY("+e+t+")",MozTransform:"translateY("+e+t+")",OTransform:"translateY("+e+t+")",transform:"translateY("+e+t+")"}}function a(e,t,n){return void 0===n&&(n="px"),{MsTransform:"translate("+e+n+", "+t+n+")",WebkitTransform:"translate("+e+n+", "+t+n+")",MozTransform:"translate("+e+n+", "+t+n+")",OTransform:"translate("+e+n+", "+t+n+")",transform:"translate("+e+n+", "+t+n+")"}}function c(e,t){return function(n){n.propertyName===e&&t(n)}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(148);t.setInnerHTML=r,t.stopPropagation=o,t.preventDefault=i,t.translateY=s,t.translate=a,t.waitTransition=c},563:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(60),i=n(117),s=function(){function e(e,t){void 0===t&&(t=0),this._operations=e,this._rev=t}return e.prototype.withRevision=function(t){return new e(this._operations,t)},Object.defineProperty(e.prototype,"revision",{get:function(){return this._rev},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"operations",{get:function(){return this._operations},enumerable:!0,configurable:!0}),e.prototype.apply=function(e){return this.operations.reduce(function(e,t){return t.apply(e)},e)},e.prototype.sequencify=function(){return this},e.prototype.transformAgainst=function(t){var n=this;if(t instanceof e){var r=[],o=t;return o=o.sequencify(),this._operations.forEach(function(e){var t=[e];o._operations.forEach(function(e){t=t.map(function(t){return t.transformAgainst(e,n._rev,o._rev)}).reduce(function(e,t){return e.concat(t)},[])}),r=r.concat(t)}),new e(r,this._rev)}throw new Error("Should be transformed only against OperationSet")},e.prototype.pack=function(e){var t=this;return this.operations.map(function(n){return n.pack(e||t._rev)})},e.unpack=function(t){if(!Array.isArray(t))throw new Error("Illegal argument. Should be string[]");if(0===t.length)return new e([]);var n=t.filter(function(e){return!e.startsWith("=")}).map(function(e){var t=e.substr(0,1),n=e.substr(1).split(":"),o=n[0],s=n[1],a=n[2],c=n[3];return r=parseInt(c,36),new i.Operation(t,parseInt(o,36),a.replace(/%3A/gi,":").replace(/%25/g,"%"),parseInt(s,36))}),r=0;return new e(n,r)},e.prototype.toString=function(){return this._operations.toString()},e}();t.OperationSet=s;var a=function(e){function t(t){void 0===t&&(t="Unknown reason");var n=e.call(this,t)||this;return n.name="OTError",n.reason=t,n}return r.__extends(t,e),t}(o.CustomError);t.OTError=a;var c=function(e){function t(t){void 0===t&&(t="removed");var n=e.call(this,t)||this;return n.name="OTRemoveError",n}return r.__extends(t,e),t}(a);t.OTRemoveError=c;var u=function(){function e(e,t,n){void 0===t&&(t=function(){}),void 0===n&&(n=function(){}),this.cs=e,this.successCallback=t,this.failureCallback=n}return Object.defineProperty(e.prototype,"operations",{get:function(){return this.cs.operations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"revision",{get:function(){return this.cs.revision},enumerable:!0,configurable:!0}),e.prototype.apply=function(e){return this.cs.apply(e)},e.prototype.pack=function(){return this.cs.pack()},e}();t.Revision=u;var l=function(){function e(e){void 0===e&&(e=0),this._operations=[],this._staging=!1,this._revision=e}return Object.defineProperty(e.prototype,"revision",{get:function(){return this._revision},enumerable:!0,configurable:!0}),e.prototype.leastRevision=function(){return this.isEmpty?this.revision:this._operations[0].revision-1},e.prototype.push=function(e,t,n){this.pushAll([e],t,n)},e.prototype.pushAll=function(e,t,n){var r=new u(new s(e,++this._revision),t,n);this._operations.push(r)},e.prototype.incRevision=function(){this._revision++},e.prototype.clear=function(e,t){void 0===t&&(t=0);var n="string"==typeof e?e:e.message;this._operations.forEach(function(e){return e.failureCallback(new a(n))}),this._operations=[],this._revision=t,this._staging=!1},e.prototype.acknowledge=function(e){if(this._staging){this._staging=!1;var t=this._operations.shift();t&&t.successCallback(e)}},e.prototype.forEach=function(e){this._operations.forEach(function(t){return e(t.cs)})},e.prototype.remove=function(){var e=this._operations.shift();return e&&(this._staging=!1),void 0!==e},e.prototype.poll=function(){var e=this._operations.slice(0,1);return 0===e.length?null:(this._staging=!0,e[0])},e.prototype.pop=function(){var e=this._operations.shift();return void 0===e?null:e},e.prototype.popAll=function(){if(this.isStaging)throw new Error("Invalid state");var e=this._operations;return this._operations=[],e},e.prototype.reload=function(e,t){if(this._staging){var n=this._operations.slice(0,1);if(0!==n.length){try{var r=n[0];t=new s(r.operations,e._revision).apply(t),e.pushAll(r.operations,r.successCallback,r.failureCallback),e._staging=!0}catch(e){}this.remove()}}try{for(var o=t,i=0,c=this._operations;i<c.length;i++){var u=c[i];o=new s(u.operations,e._revision).apply(o)}t=o;for(var l=0,h=this._operations;l<h.length;l++){var u=h[l];e.pushAll(u.operations,u.successCallback,u.failureCallback)}}catch(e){for(var d=0,p=this._operations;d<p.length;d++){var u=p[d];u.failureCallback(new a("cannot be applied"))}}return t},Object.defineProperty(e.prototype,"length",{get:function(){return this._operations.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStaging",{get:function(){return this._staging},enumerable:!0,configurable:!0}),e.prototype.resetStaging=function(){this._staging=!1},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._operations.length},enumerable:!0,configurable:!0}),e.prototype.transformAgainst=function(e,t){void 0===t&&(t=e.revision);var n=t+1;return this._operations=this._operations.map(function(t){var r=new s(t.operations,n),o=e.transformAgainst(r),i=r.transformAgainst(e);return e=o,new u(new s(i.operations,i.revision),t.successCallback,t.failureCallback)}),this._revision=this.isEmpty?t:this._operations[this.length-1].revision,e.withRevision(e.revision)},e.prototype.getChangesSince=function(e){return this._operations.filter(function(t){return t.revision>e}).map(function(e){return new s(e.operations,e.revision)})},e}();t.OperationQueue=l},564:function(e,t,n){"use strict";function r(e){return{proofit:(e.data&&e.data.proofit?f.Proofit.parseResult(e.data.proofit):void 0)||void 0}}function o(e){return!!e&&![e.ContextualSpelling,e.Enhancement,e.Grammar,e.Plagiarism,e.Punctuation,e.SentenceStructure,e.Style].map(function(e){return e&&"object"==typeof e&&"boolean"==typeof e.active}).some(function(e){return!e})}function i(e){return e?{ContextualSpelling:{active:e.contextualSpelling},Enhancement:{active:e.enhancement},Grammar:{active:e.grammar},Plagiarism:{active:e.plagiarism},Punctuation:{active:e.punctuation},SentenceStructure:{active:e.sentenceStructure},Style:{active:e.style}}:null}function s(e){return e&&o(e)?{contextualSpelling:e.ContextualSpelling.active,grammar:e.Grammar.active,sentenceStructure:e.SentenceStructure.active,punctuation:e.Punctuation.active,style:e.Style.active,enhancement:e.Enhancement.active,plagiarism:e.Plagiarism.active}:null}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),c=n(381),u=n(73),l=n(149),h=n(195),d=n(290),p=n(1335),f=n(301),m=n(289),g=n(60),_=n(202),y=n(5),v=n(207),b=n(565),w=function(){function e(e){if(this._delta={},!e||!e.id)throw new Error("document is undefined or doesn't have ID");try{this._parsedRemoteMongodb=e.mongodb?JSON.parse(e.mongodb):void 0}catch(t){throw new Error("Corrupted 'mongodb' value in document ID "+e.id+": "+e.mongodb)}this._original=Object.assign({},e,{id:String(e.id),extraProps:this._parseSettings(e.mongodb)})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._original.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._delta.title||this._original.title||""},set:function(e){this._delta.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstContent",{get:function(){return this._original.first_content||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._original.content||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"revision",{get:function(){return this._original.vsn||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originalFileName",{get:function(){return this._original.orig_filename||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._original.created_at?g.stringToDate(this._original.created_at):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updatedAt",{get:function(){return this._original.updated_at?g.stringToDate(this._original.updated_at):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errors",{get:function(){return this._delta.errors||this._original.errors||0},set:function(e){this._delta.errors=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._original.size||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return Object.assign({},this._original.extraProps,this._delta.extraProps)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"genre",{get:function(){return this.settings.genre||null},enumerable:!0,configurable:!0}),e.prototype.setGenre=function(e){this._delta.extraProps=Object.assign({},this._delta.extraProps,{genre:e})},Object.defineProperty(e.prototype,"checks",{get:function(){return this.settings.checks||null},enumerable:!0,configurable:!0}),e.prototype.setChecks=function(e){this._delta.extraProps=Object.assign({},this._delta.extraProps,{checks:e})},Object.defineProperty(e.prototype,"context",{get:function(){return void 0===this.settings.context?c.option.none:c.option.some(this.settings.context)},enumerable:!0,configurable:!0}),e.prototype.setContext=function(e){this._delta.extraProps=Object.assign({},this._delta.extraProps,{context:e})},Object.defineProperty(e.prototype,"proofit",{get:function(){return this.settings.proofit||null},enumerable:!0,configurable:!0}),e.prototype.resetProofit=function(){this._delta.extraProps=Object.assign({},this._delta.extraProps,{proofit:null})},e.prototype._isDirty=function(){return Object.getOwnPropertyNames(this._delta||{}).length>0},e.prototype._popChanges=function(){var e=this._getRawDocument(this._delta);return e.id=Number(this._original.id),e},e.prototype._getRawDocument=function(e){if(e.extraProps){var t=Object.assign({},this.settings,e.extraProps),n=null===t.proofit;return Object.assign({},e,{mongodb:JSON.stringify(Object.assign({},this._parsedRemoteMongodb,{genre:t.genre,apps:i(t.checks)},void 0!==t.context&&{context:_.DocumentContext.serialize(t.context)},n?{proofit:null}:void 0))})}return Object.assign({},e)},e.prototype.syncWithRemoteMongodb=function(e){this._parsedRemoteMongodb=e},e.prototype._parseDeltaDocument=function(e){return Object.assign({},e,{extraProps:this._parseSettings(e.mongodb)})},e.prototype._mergeParsedDocuments=function(e,t){return Object.assign({},e,t,{extraProps:Object.assign({},e.extraProps,t.extraProps)})},e.prototype._applyChanges=function(e){this._original=this._mergeParsedDocuments(this._original,this._parseDeltaDocument(e)),this._delta={}},e.prototype._parseSettings=function(e){var t={};if(!e)return t;try{var n=JSON.parse(e);if(n){var r=f.Proofit.parseResult(n.proofit),o=n.genre,i=s(n.apps),a=_.DocumentContext.parse(n.context);return Object.assign({},void 0!==n.proofit&&{proofit:r},void 0!==n.genre&&{genre:o},void 0!==n.apps&&{checks:i},void 0!==a&&{context:a})}return t}catch(e){return t}},e}();t.Document=w;var E=function(){function e(e,t,n){this._url=e,this._fetch=t,this._token=n,this._clientType="web",this._ajax=u.Ajax.factory(this._fetch,"dox",v.DoxErrors.doxErrorMapper),this._wsBaseUrl=this._getWsBaseUrl(e)}return e.prototype._getWsBaseUrl=function(e){var t=new RegExp("http(s?)://([^/]+)/?.*$"),n=t.exec(e);if(null===n)throw new Error("Cannot parse ws url");n[0];return"ws"+n[1]+"://"+n[2]},e.prototype._getWsUrl=function(e){var t=null===e||void 0===e?"/documents/ws":"/documents/"+e+"/ws";return""+this._wsBaseUrl+t},Object.defineProperty(e.prototype,"clientType",{set:function(e){this._clientType=e,this._ajax=u.Ajax.factory(this._fetch,"dox",v.DoxErrors.doxErrorMapper,"web"===e?{}:{"X-Client-Type":e})},enumerable:!0,configurable:!0}),e.prototype.listDocuments=function(t,n,r){return void 0===t&&(t=e.unlimited),void 0===n&&(n=A.Any),void 0===r&&(r=!1),this.searchDocument(T.all(),t,n,r)},e.prototype.openDocumentsWS=function(e,t){return void 0===t&&(t=S._defaultReconnect),C.create(this._getWsUrl(),e,t)},e.prototype.getDocumentById=function(e){var t=u.RequestBuilder.get(this._url,"/documents").pathParam(e);return this._ajax(this._prepareRequest(t).build()).then(function(e){return new w(e)})},e.prototype.openDocumentById=function(e,t,n,r){return void 0===r&&(r=k._defaultReconnect),k.create(this._getWsUrl(e),t,n,r)},e.prototype.searchDocument=function(t,n,r,o){void 0===n&&(n=e.unlimited),void 0===r&&(r=A.Any),void 0===o&&(o=!1);var i=u.RequestBuilder.get(this._url,"/documents").queryParam("search",t.toSearchString()).queryParam("limit",String(n)).queryParam("firstCall",String(o));return this._ajax(this._prepareRequest(i).build()).then(function(e){return e.map(function(e){return new w(e)})})},e.prototype.createDocument=function(e){var t=e._getHttpRequestBuilder().url(this._url,"/documents").method("post");return this._ajax(this._prepareRequest(t).build()).then(function(e){return new w(e)})},e.prototype.ensuredDownloadLink=function(e,t){var n=this;return void 0===t&&(t=!0),this.getDocumentById(e).then(function(e){return n.downloadLink(e.id,t)})},e.prototype.downloadLink=function(e,t){return void 0===t&&(t=!0),u.RequestBuilder.join(this._url,"/documents",encodeURIComponent(e),"download")+(t?"":"?no_tracking")},e.prototype.downloadLinkProofread=function(e){return u.RequestBuilder.join(this._url,"/documents",encodeURIComponent(e),"proofread")},e.prototype.deleteDocumentById=function(e){var t=u.RequestBuilder.del(this._url,"/documents").pathParam(e);return this._ajax(this._prepareRequest(t).build(),u.Ajax.toVoid)},e.prototype.restoreDocumentById=function(e){var t=u.RequestBuilder.post(this._url,"/documents",encodeURIComponent(e),"restore");return this._ajax(this._prepareRequest(t).build(),u.Ajax.toVoid)},e.prototype.saveDocument=function(e){if(!e._isDirty())return Promise.resolve();var t=e._popChanges(),n=u.RequestBuilder.put(this._url,"/documents").pathParam(String(e.id)).json(t);return this._ajax(this._prepareRequest(n).build(),u.Ajax.toVoid).then(function(){return e._applyChanges(t)})},e.prototype._prepareRequest=function(e){return this._authorize(e).header("X-API-Version","1")},e.prototype._authorize=function(e){return this._token?e.cookie("grauth",this._token):e},e.unlimited=0,e}();t.Dox=E,t.processMongodbChange=r;var S=function(){function e(e){var t=this;this._url=e,this._log=y.Monitoring.Logging.getLogger("coreclients.remote",y.Logging.LogLevel.DEBUG),this._ws=l.WS.create().onDisconnect(function(e){return t._handleDisconnect(e)}).onMessage(function(e,n){return t._handleMessage(n)}).onError(l.errPrintln),this._fsm=new h.StateMachine(I.DISCONNECTED,I.CLOSED).from(I.DISCONNECTED).to(I.CONNECTING).on(O.CONNECT).from(I.DISCONNECTED).to(I.RECONNECT_SCHEDULED).on(O.SCHEDULE_RECONNECT).from(I.CONNECTING,I.RECONNECT_SCHEDULED).to(I.CONNECTED).on(O.CONNECTED).from(I.CONNECTED).to(I.READY).on(O.INITIALIZE).from(I.CONNECTED,I.CONNECTING,I.RECONNECT_SCHEDULED,I.READY).to(I.DISCONNECTED).on(O.DISCONNECT).from(I.CONNECTED,I.CONNECTING,I.RECONNECT_SCHEDULED,I.READY,I.DISCONNECTED).to(I.CLOSED).on(O.CLOSE).on(I.CLOSED,function(e){t._conn&&t._conn.close(),e.args&&e.args instanceof l.WSError&&(t._error=e.args,t._log.error("Remote connection to dox ws closed",t._error))}).on(I.CONNECTING,function(e){return t._connect()})}return e.prototype._handleDisconnect=function(e){return a.__awaiter(this,void 0,void 0,function(){var t,n=this;return a.__generator(this,function(r){switch(r.label){case 0:return[4,this._fsm.event(O.DISCONNECT,e.reason)];case 1:if(!r.sent())return[3,5];this._log.info("Disconnected",e.reason),r.label=2;case 2:return r.trys.push([2,3,,5]),this._disconnectHandler(e,e.reconnect.nextDelay,function(t){return a.__awaiter(n,void 0,void 0,function(){var n,r,o=this;return a.__generator(this,function(i){switch(i.label){case 0:return[4,this._fsm.event(O.SCHEDULE_RECONNECT)];case 1:return i.sent()?[4,e.reconnect.scheduleReconnect(t)]:[3,4];case 2:return n=i.sent(),[4,this._fsm.event(O.CONNECTED,n).catch(function(e){o._log.warn("Reconnect failed due to error",e),n.close()})];case 3:r=i.sent(),r?(this._log.info("Reconnected to DOX WS successful",{url:this._url,canFinalize:r}),this._conn=n):(this._log.info("Immediate disconnect after reconnect to DOX WS",{url:this._url,state:I[this._fsm.current]}),n.close()),i.label=4;case 4:return[2]}})})}),[3,5];case 3:return t=r.sent(),[4,this._fsm.event(O.CLOSE,t)];case 4:return r.sent(),[3,5];case 5:return[2]}})})},e.prototype.close=function(){var e=this;return this._fsm.event(O.CLOSE).then(function(t){t&&clearTimeout(e._timeout)})},e.prototype._connect=function(){return a.__awaiter(this,void 0,void 0,function(){var e,t;return a.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this._ws.connect(this._url)];case 1:return e=n.sent(),[4,this._fsm.event(O.CONNECTED,e)];case 2:return n.sent()?[2,this._conn=e]:(e.close(),[2,void 0]);case 3:throw t=n.sent(),new v.DoxErrors.ConnectionError(this._url);case 4:return[2]}})})},e._defaultReconnect=function(e,t,n){var r=e.code,o=e.reason,i=e.reconnect;if(r!==v.DoxErrors.DoxWsErrorCodes.GOING_AWAY){if(r===v.DoxErrors.DoxWsErrorCodes.NOT_FOUND||r===v.DoxErrors.DoxWsErrorCodes.UNAUTHORIZED)throw new v.DoxErrors.WSDisconnectedOnInitError(r,o);if(r===v.DoxErrors.DoxWsErrorCodes.TOO_BIG)throw new v.DoxErrors.WSMessageIsTooBigError;var s=i.reconnectCounter;if(s>=5)throw new v.DoxErrors.WSDisconnectedAfterMultipleRetries(s,r,o);n(t).catch(function(e){y.Monitoring.Logging.getLogger("coreclients.remote").warn("Reconnect failed with an error",e)})}},e}();t.Remote=S;var C=function(e){function t(t,n,r,o,i){var s=e.call(this,t)||this;return s.url=t,s._initHandler=n,s._failHandler=r,s._mongodbchangeHandler=o,s._disconnectHandler=i,s._fsm.on(I.CLOSED,function(e){var t=e.args?e.args:v.DoxErrors.CLOSED_ERROR;s._failHandler&&s._failHandler(t)}),s._fsm.event(O.CONNECT).then(function(){return n(s)}).catch(r),s}return a.__extends(t,e),t.create=function(e,n,r){return new Promise(function(o,i){return new t(e,o,i,n,r)})},t.prototype._handleMessage=function(e){return a.__awaiter(this,void 0,void 0,function(){var t;return a.__generator(this,function(n){switch(this._log.trace("<<< ",{message:e}),e.op){case"mongodb_change":this._handleMongodbChangeMessage(e);break;default:t=e.op,this._log.warn("Never",{message:t})}return[2]})})},t.prototype._handleMongodbChangeMessage=function(e){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(t){return this._mongodbchangeHandler&&this._mongodbchangeHandler(String(e.id),r(e)),[2]})})},t}(S);t.RemoteDocumentsList=C;var k=function(e){function t(t,n,r,o,i,s,a){void 0===a&&(a=500);var c=e.call(this,t)||this;return c.url=t,c._changeHandler=o,c._mongodbchangeHandler=i,c._sendDelay=a,c._nextId=0,c._revision=0,c._clientId=-1,c._text="",c._linkedDocument=void 0,c._initHandler=n,c._failHandler=r,c._disconnectHandler=s,c._fsm.from(I.READY).to(I.WAIT_ACK).on(O.SEND).from(I.WAIT_ACK).to(I.READY).on(O.ACK,O.RESET).from(I.WAIT_ACK).to(I.DISCONNECTED).on(O.DISCONNECT).from(I.WAIT_ACK).to(I.CLOSED).on(O.CLOSE).on(I.READY,function(e){return c._trySendAfterTimeout()}).on(I.CLOSED,function(e){var t=e.args?e.args:v.DoxErrors.CLOSED_ERROR;c._failHandler&&c._failHandler(t),c._queue&&c._queue.clear(t,0)}).on(I.DISCONNECTED,function(e){return c._clear()}),c._fsm.event(O.CONNECT).catch(function(e){c._failHandler&&(c._failHandler(e),c._failHandler=null)}),c}return a.__extends(t,e),t.create=function(e,n,r,o,i){return void 0===i&&(i=500),new Promise(function(s,a){return new t(e,s,a,n,r,o,i)})},t.prototype.pushChanges=function(e){var t=this;return new Promise(function(n,r){if(t._fsm.is(I.CLOSED))return void r(t._error?t._error:v.DoxErrors.CLOSED_ERROR);0===e.length?n():t._queue.pushAll(e,function(){return n()},r)})},t.prototype.setText=function(e){var t=this;return new Promise(function(n,r){if(t._fsm.is(I.CLOSED))return void r(t._error?t._error:v.DoxErrors.CLOSED_ERROR);var o=p.Diff.diffAsOperations(t._text,e);0===o.length?n(e):(t._queue.pushAll(o,function(){return n(e)},r),t._text=e)})},t.prototype.getText=function(){return this._text},t.prototype._clear=function(){this._nextId=0,this._clientId=0,this._revision=0},t.prototype._trySendAfterTimeout=function(){var e=this;this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){e._queue.isEmpty||e._queue.isStaging?e._trySendAfterTimeout():e._send()},this._sendDelay)},t.prototype._replaceText=function(e){this._text=e,this._changeHandler&&this._changeHandler(this,this._text)},t.prototype._handleMessage=function(e){return a.__awaiter(this,void 0,void 0,function(){var t;return a.__generator(this,function(n){switch(this._log.trace("<<<",{message:e}),e.op){case"init":this._handleInitMessage(e);break;case"patch":this._handlePatchMessage(e);break;case"reset":this._handleResetMessage(e);break;case"vsn":break;case"mongodb_change":this._handleMongodbChangeMessage(e);break;case"proofit_turnaround_options":case"proofit_create_job":break;default:t=e,t.code===v.DoxErrors.DoxWsErrorCodes.GOING_AWAY||t.code===v.DoxErrors.DoxWsErrorCodes.NOT_FOUND?this._log.info("Unexpected message",{message:e}):this._log.warn("Unexpected message",{message:e})}return[2]})})},t.prototype._handleResetMessage=function(e){return a.__awaiter(this,void 0,void 0,function(){var t;return a.__generator(this,function(n){switch(n.label){case 0:return t=this._fsm.current===I.READY,t?[3,2]:[4,this._fsm.event(O.RESET)];case 1:t=n.sent(),n.label=2;case 2:return t&&(this._queue.clear("reset",e.vsn),this._revision=e.vsn,this._clientId=e.clientId,this._replaceText(e.text)),[2]}})})},t.prototype._handlePatchMessage=function(e){return a.__awaiter(this,void 0,void 0,function(){var t;return a.__generator(this,function(n){switch(n.label){case 0:return this._revision=e.v,e.cl!==this._clientId?[3,2]:[4,this._fsm.event(O.ACK)];case 1:return n.sent()&&this._queue.acknowledge(e.v),[3,3];case 2:t=d.Changesets.unpack(e.ch),t=this._queue.transformAgainst(t,this._revision),this._replaceText(t.apply(this._text)),n.label=3;case 3:return this._conn.send(new b.Message.VersionMessage(this._nextId++,e.v)),[2]}})})},t.prototype._handleInitMessage=function(e){return a.__awaiter(this,void 0,void 0,function(){var t,n,r,o;return a.__generator(this,function(i){switch(i.label){case 0:return[4,this._fsm.event(O.INITIALIZE)];case 1:return(t=i.sent())?(n=this._queue,r=e.text,this._clientId=e.clientId,this._revision=e.vsn,this._nextId=1,this._queue=new d.ChangesetsQueue(this._revision),n?(r=n.reload(this._queue,r),this._queue.isStaging?[4,this._fsm.event(O.SEND)]:[3,3]):[3,3]):[3,4];case 2:i.sent()&&(o=this._queue.poll())&&this._conn.send(new b.Message.PatchMessage(this._nextId++,this._clientId,this._revision,o.pack())),i.label=3;case 3:this._initHandler?(this._text=r,this._initHandler(this),this._initHandler=null,this._failHandler=null):this._replaceText(r),i.label=4;case 4:return[2]}})})},t.prototype._handleMongodbChangeMessage=function(e){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(t){return this._mongodbchangeHandler&&this._mongodbchangeHandler(String(e.id),r(e)),this._linkedDocument&&e.data&&this._linkedDocument.syncWithRemoteMongodb(e.data),[2]})})},t.prototype._send=function(){var e=this;this._fsm.event(O.SEND).then(function(t){if(t){var n=e._queue.poll();if(null===n)return;var r=n.pack(),o=new b.Message.PatchMessage(e._nextId++,e._clientId,n.revision,r);e._log.trace(">>>",{message:o}),e._conn.send(o)}else e._fsm.event(O.CONNECT)}).catch(l.errPrintln)},t.prototype.linkToDocument=function(e){this._linkedDocument=e},t}(S);t.RemoteDocument=k;var x=function(){function e(e){this._httpRequest=e}return e.text=function(t,n){var r=u.RequestBuilder.create().json();return(t||n)&&r.body({content:t,title:n}),new e(r)},e.file=function(t){var n=u.RequestBuilder.create();if(!t)throw new TypeError("File was not provided");if(!t.name)throw new TypeError("Empty filename passed to file() function");if(!t.size)throw new TypeError("File size wasn't provided");if(t.size>m.MAX_FILE_SIZE)throw new v.DoxErrors.FileSizeOutOfRangeError(m.MAX_FILE_SIZE);var r=(t.name.split("\\").pop()||"").split("/").pop();if(!r)throw new v.DoxErrors.UnsupportedFileTypeError(t.name);if(!r.match(e.supportedExtensionsRE))throw new v.DoxErrors.UnsupportedFileTypeError(r);var o=new FormData;return o.append("source_file",t),n.body(o),new e(n)},e.prototype._getHttpRequestBuilder=function(){return this._httpRequest.isBodyPresent()?this._httpRequest:this._httpRequest.body({})},e.supportedExtensions=["doc","docx","odt","rtf","txt","htm","html"],e.supportedExtensionsRE=new RegExp("\\.("+e.supportedExtensions.join("|")+")$","i"),e}();t.CreateRequest=x;var T=function(){function e(e){this._str=e}return e.contains=function(t){return new e(t)},e.all=function(){return new e("")},e.prototype.toSearchString=function(){return this._str},e}();t.SearchRequest=T;var A;!function(e){e[e.Updated=0]="Updated",e[e.Created=1]="Created",e[e.Any=2]="Any"}(A=t.OrderBy||(t.OrderBy={})),t.fromCheckingSettings=i,t.toCheckingSettings=s;var I;!function(e){e[e.DISCONNECTED=0]="DISCONNECTED",e[e.CONNECTING=1]="CONNECTING",e[e.RECONNECT_SCHEDULED=2]="RECONNECT_SCHEDULED",e[e.CONNECTED=3]="CONNECTED",e[e.READY=4]="READY",e[e.WAIT_ACK=5]="WAIT_ACK",e[e.CLOSED=6]="CLOSED"}(I=t.States||(t.States={}));var O;!function(e){e[e.CONNECT=0]="CONNECT",e[e.CONNECTED=1]="CONNECTED",e[e.SCHEDULE_RECONNECT=2]="SCHEDULE_RECONNECT",e[e.DISCONNECT=3]="DISCONNECT",e[e.CLOSE=4]="CLOSE",e[e.INITIALIZE=5]="INITIALIZE",e[e.SEND=6]="SEND",e[e.ACK=7]="ACK",e[e.RESET=8]="RESET"}(O=t.Events||(t.Events={}))},565:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);!function(e){var t=function(){function e(e){this.id=e}return e}();e.Base=t;var n=function(e){function t(t,n,r,o){var i=e.call(this,t)||this;return i.id=t,i.cl=n,i.v=r,i.ch=o,i.op="patch",i}return r.__extends(t,e),t}(t);e.PatchMessage=n;var o=function(e){function t(t,n){var r=e.call(this,t)||this;return r.id=t,r.vsn=n,r.op="vsn",r}return r.__extends(t,e),t}(t);e.VersionMessage=o;var i=function(e){function t(t,n,r,o,i){var s=e.call(this,t)||this;return s.id=t,s.title=n,s.errors=r,s.extra_params=o,s.proofit=i,s.op="update_document_metadata",s}return r.__extends(t,e),t}(t);e.UpdateDocumentMetadata=i;var s=function(e){function t(t){var n=e.call(this,t)||this;return n.id=t,n.op="proofit_turnaround_options",n}return r.__extends(t,e),t}(t);e.ProofitOptionsMessage=s;var a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.id=t,r.turnaround=n,r.op="proofit_create_job",r}return r.__extends(t,e),t}(t);e.ProofitPlaceOrderMessage=a}(t.Message||(t.Message={}))},566:function(e,t,n){"use strict";function r(e){switch(e){case o.officeAddin:return"officeAddin";case o.desktopMac:return"macApp";case o.desktopWindows:return"winApp";case o.extensionChrome:return"chromeExt";case o.extensionFirefox:return"firefoxExt";case o.extensionSafari:return"safariExt";case o.extensionEdge:return"edgeExt";default:return i.assertNever(e)}}Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(7),s=n(197),a=n(118);!function(e){e[e.officeAddin=0]="officeAddin",e[e.desktopMac=1]="desktopMac",e[e.desktopWindows=2]="desktopWindows",e[e.extensionChrome=3]="extensionChrome",e[e.extensionFirefox=4]="extensionFirefox",e[e.extensionSafari=5]="extensionSafari",e[e.extensionEdge=6]="extensionEdge"}(o=t.Apps||(t.Apps={})),t.isExtension=function(e){return[o.extensionChrome,o.extensionFirefox,o.extensionSafari,o.extensionEdge].some(function(t){return t===e})};var c=function(e,t,n,r){var c=[];if(!e.size)return c;var u;if(s.isBrowserHasExtension(n))switch(n){case"chrome":u=o.extensionChrome;break;case"firefox":u=o.extensionFirefox;break;case"safari":u=o.extensionSafari;break;case"edge":u=o.extensionEdge}else u=void 0;if(u&&c.push({app:u,installed:s.isExtensionInstalled()}),r&&("windows"===t&&c.push({app:o.officeAddin,installed:i.Extension.isAddinInstalled(e)}),"windows"===t||"mac"===t)){var l="windows"===t?o.desktopWindows:o.desktopMac;c.push({app:l,installed:e.has(a.UserGroups.DESKTOP_EDITOR_INSTALLED)})}return c},u=function(){function e(e,t,n,r,o){this._browser=e,this._os=t,this._extension=n,this._showDesktopApps=r,this._telemetry=o}return e.prototype.getAppsItems=function(e){return c(e,this._os,this._browser,this._showDesktopApps.get().enabled)},e.prototype.onInstallClicked=function(e){t.isExtension(e)&&this._extension.install(),this._telemetry.installAppClicked(r(e))},e.prototype.onMoreClicked=function(e){this._telemetry.learnMoreClicked(r(e))},e}();t.AppsModelImpl=u},567:function(e,t,n){"use strict";function r(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function o(e){void 0===e&&(e=[]);var t=e.reduce(function(e,t){var n=t.group,r=t.category,o=t.categoryHuman;return e[r]?e[r].count+=1:e[r]={group:n,category:r,categoryHuman:o,count:1},e},{});return Object.keys(t).map(function(e){return t[e]})}function i(e){return c.isDesktopEditor(c.getBrowserInfo().browser)?"Desktop"+u.camelize(e):e}function s(e,t,n){var s=t?{page:"free",utm_medium:l,utm_source:h,utm_campaign:i(t)}:{page:"free"},c=o(n),u=c.length?{alerts:a.compressToEncodedURIComponent(JSON.stringify(c))}:{},d={app_type:"app",return_url:document.location.href};return e+"?"+r(Object.assign({},u,d,s))}Object.defineProperty(t,"__esModule",{value:!0});var a=n(569),c=n(49),u=n(148),l="internal",h="upHook";t.getUpgradeUrl=s},570:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.appConfig={env:"prod",logLevel:"INFO",crashLogLevel:"DEBUG",collectLogs:!0,collectCrashLogs:!0,copyLogsToConsole:!1,enableTracking:!0,alertCachePrefix:"editorTsAlertCache",alertCacheVersion:"2",userSettingsPrefix:"userSettings",userSettingsVersion:"1",defaultDialect:"american",notificationShowTimeMs:0,selfUpdate:{versionCheckInterval:216e5,latestVersionDelay:864e5,forceUpdateOnHiddenDelay:3e5,retryFailedVersionCheckInterval:3e5,retryFailedVersionCheckLimit:20,versionFilePath:"/version.json"},domains:{cookie:".grammarly.com",localServer:"denali-local.grammarly.com"},api:{authUrl:"https://auth.grammarly.com/v3",institutionUrl:"https://institution.grammarly.com",dapiUrl:"https://data.grammarly.com",doxUrl:"https://dox.grammarly.com",doxWsUrl:"wss://dox.grammarly.com",irbisUrl:"https://irbis.grammarly.com",subscriptionUrl:"https://subscription.grammarly.com/api/v1",capiWsUrl:"wss://capi.grammarly.com/freews",capiApiUrl:"https://capi.grammarly.com/api",gnarApi:{url:"https://gnar.grammarly.com"},pdfGeneratorUrl:"https://dox.grammarly.com/docproc/html2pdf",felogUrl:"https://f-log-editor.grammarly.io",sumoUrl:"https://endpoint2.collection.us2.sumologic.com/receiver/v1/http/ZaVnC4dhaV0Bxac28IqT2frgzsjX7HEotu8EZEZr07YE9RWLCzrOMGwzO9aL6c_iSiidkEplFOod2igKIxz_7s2CHlXc2u-XuLpetEBK1fV6xjfN2Sw2gA==",crashLogUrl:"https://f-log-editor.grammarly.io/crash",onlineTestUrl:"/online-test.json",wsTest:"wss://wstest.grammarly.com",proofitResultUrl:"https://dox.grammarly.com/documents/_docId_/proofread",redirect:"https://redirect.grammarly.com/redirect"},app:{name:"editor"},urls:{free:"/free"},funnel:{resetPassword:"https://www.grammarly.com/resetpassword",accountDeleted:"https://www.grammarly.com/account-deleted",subscribe:"https://www.grammarly.com/subscribe",upgrade:"https://www.grammarly.com/upgrade",signin:"https://www.grammarly.com/signin",socialSignin:"https://www.grammarly.com/share/signin",signup:"https://www.grammarly.com/signup",mainPage:"https://www.grammarly.com/",deleteSocialAccount:"https://www.grammarly.com/social/delete-account"},officeAddin:{installURL:"http://download-office.grammarly.com/latest/GrammarlyAddInSetup.exe",infoURL:"http://www.grammarly.com/office-addin/windows"},desktop:{windows:{installURL:"http://download-editor.grammarly.com/windows/GrammarlySetup.exe",infoURL:"https://www.grammarly.com/native/windows"},mac:{installURL:"http://download-editor.grammarly.com/osx/Grammarly.dmg",infoURL:"https://www.grammarly.com/native/mac"}},extension:{chrome:{installURL:"https://chrome.google.com/webstore/detail/kbfnbcaeplbcioakkpcpgfkobkghlhen",infoURL:"https://chrome.google.com/webstore/detail/grammarly-spell-checker-g/kbfnbcaeplbcioakkpcpgfkobkghlhen?hl=en"},firefox:{installURL:"https://addons.mozilla.org/firefox/downloads/latest/566314/addon-566314-latest.xpi",iconURL:"https://addons.cdn.mozilla.net/user-media/addon_icons/566/566314-32.png",infoURL:"https://addons.mozilla.org/en-US/firefox/addon/grammarly-1/"},safari:{installURL:"https://safari-extensions.apple.com/details/?id=com.grammarly.spellchecker.extension-W8F64X92K3"},edge:{installURL:"ms-windows-store://pdp?ProductId=9p59wxtbhzzm",infoURL:"https://www.microsoft.com/en-us/store/p/grammarly-for-microsoft-edge/9p59wxtbhzzm?rtc=1"}},edu:{adminPanelURL:"https://admin-panel.grammarly.com"},support:{login:"https://support.grammarly.com/login",email:"support@grammarly.com",mainPage:"https://support.grammarly.com/",newRequest:"https://support.grammarly.com/hc/en-us/requests/new",contact:"https://www.grammarly.com/contact",connectionTroubleshooting:"https://support.grammarly.com/hc/en-us/articles/115000090271-Network-configuration-blocks-Grammarly-services",emailExistsKBUrl:"https://support.grammarly.com/hc/en-us/articles/115000090791-Changing-your-email-to-an-email-that-already-exists",phoenixSupportUrl:"https://ecampus.phoenix.edu/common/contactus/reportProblem.jsp",phoenixWritingHelpUrl:"https://portal.phoenix.edu/social/community/support/writing",diagnosticTestPath:"/diagnostic-test?origin=editor",documentAcceptTrackedChanges:"https://support.office.com/en-us/article/Accept-tracked-changes-4838d24c-d5d1-4c6c-8e39-78b44bd2b4cc"},privacyPolicy:"https://www.grammarly.com/privacy-policy",termsOfServise:"https://www.grammarly.com/terms"},t.buildInfo={}},571:function(e,t,n){"use strict";function r(e,t){return t?Math.max(e,t+u):e}function o(e){return Object.keys(e).map(function(t){return e[t]}).sort(function(e,t){return e.alert.highlightPosition.top-t.alert.highlightPosition.top||e.alert.highlightPosition.left-t.alert.highlightPosition.left||e.alert.highlightPosition.bottom-t.alert.highlightPosition.bottom||e.alert.highlightPosition.right-t.alert.highlightPosition.right||(e.alert.alert.id<t.alert.alert.id?-1:1)}).reduce(function(t,n,o,i){var s=i[o-1]&&i[o-1].alert.alert.id,a=o>0?t[s].top:0,c=o>0?e[s].cardHeight:0;return t[n.alert.alert.id]={top:r(n.alert.highlightPosition.top,a+c),height:n.cardHeight,alert:n.alert},t},{})}function i(e,t){var n={top:e.top+1,height:e.height,left:e.left-60,width:e.width};return{left:{top:t.top,left:t.left,width:t.width,height:t.height-4},right:n}}function s(e,t){return e-t+d}function a(e,t,n,r){var o=e+t+l-(n+r),i=e-h-r;return o<=0&&i>=0?0+r:i<0?i+r:(o>i?i:o)+r}function c(e,n,r,o,i){if(!n.id)return t.emptyLayout;var c=e[n.id];if(!c)return t.emptyLayout;var u="click"===n.source,l=u?a(c.top+r,c.height,o,i):void 0,h=s(c.top,c.alert.highlightPosition.top),d=u?[h,0]:[0,-h];return{scroll:l,textShift:d[0],cardsShift:d[1]}}Object.defineProperty(t,"__esModule",{value:!0});var u=8;t.getCardsPositions=o,t.calculateGuideLayout=i;var l=35,h=20,d=18;t.emptyLayout={scroll:0,textShift:0,cardsShift:0},t.getScrollToFitCard=a,t.calculateEditorLayout=c},572:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1359);t.EditorPageModel=r.EditorPageModel,t.EditorPageModelImpl=r.EditorPageModelImpl,t.editorPageDefaultState=r.defaultState;var o=n(299);t.EditorEngine=o.EditorEngine,t.EditorEngineCheckResults=o.EditorEngineCheckResults,t.EditorEngineCheckingSettings=o.EditorEngineCheckingSettings,t.CheckingStatus=o.CheckingStatus,t.AppliedAlertAction=o.AppliedAlertAction;var i=n(543);t.GrammarlyEditorEngine=i.GrammarlyEditorEngine;var s=n(542);t.EditorSession=s.EditorSession,t.EditorSessionImpl=s.EditorSessionImpl,t.EditorSessionState=s.EditorSessionState,t.editorSessionDefaultState=s.defaultState;var a=n(539);t.CheckingScores=a.CheckingScores;var c=n(291);t.GuideLayout=c.GuideLayout;var u=n(201);t.CheckingSettingsModel=u.CheckingSettingsModel,t.CheckingSettingsState=u.CheckingSettingsState,t.ChecksType=u.ChecksType,t.GenreId=u.GenreId;var l=n(291);t.CardsModel=l.CardsModel;var h=n(540);t.DocumentModel=h.DocumentModel,t.DocumentModelState=h.DocumentModelState;var d=n(541);t.DocumentContent=d.DocumentContent,t.DocumentSession=d.DocumentSession,t.DocumentSessionState=d.DocumentSessionState,t.DocumentSessionImpl=d.DocumentSessionImpl,t.ProofitState=d.ProofitState;var p=n(292);t.TextStatsModel=p.TextStatsModel,t.TextStatsModelState=p.TextStatsModelState,t.TextStatsModelImpl=p.TextStatsModelImpl,t.textStatsModelDefaultState=p.defaultState,t.TextStatsView=p.TextStatsView;var f=n(97);t.Alert=f.Alert,t.AlertExamples=f.AlertExamples,t.AlertGroup=f.AlertGroup,t.AlertId=f.AlertId,t.AlertReplacement=f.AlertReplacement,t.AlertRange=f.AlertRange,t.AlertTransform=f.AlertTransform,t.AlertTransformPart=f.AlertTransformPart,t.AlertPlagiarism=f.AlertPlagiarism;var m=n(1356);t.AlertCache=m.AlertCache,t.AlertCacheImpl=m.AlertCacheImpl},573:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(196);!function(e){function t(){r.invariant(!n(),"FullStory snippet already loaded");var e=document.createElement("script");e.innerHTML=o,document.head.appendChild(e)}function n(){return void 0!==window.FS}var o="window['_fs_debug'] = true;\n  window['_fs_host'] = 'fullstory.com';\n  window['_fs_org'] = '76Y20';\n  window['_fs_namespace'] = 'FS';\n  (function(m,n,e,t,l,o,g,y){\n    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window[\"_fs_namespace\"].');} return;}\n    g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];\n    o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';\n    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);\n    g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};\n    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};\n    g.clearUserCookie=function(c,d,i){if(!c || document.cookie.match('fs_uid=[\";\"]*\"[\";\"]*\"[\";\"]*\"')){\n      d=n.domain;while(1){n.cookie='fs_uid=;domain='+d+\n      ';path=/;expires='+new Date(0).toUTCString();i=d.indexOf('.');if(i<0)break;d=d.slice(i+1)}}};\n    })(window,document,window['_fs_namespace'],'script','user');";e.enable=t,e.isEnabled=n,e.ignoreClass="fs-hide"}(t.Fullstory||(t.Fullstory={}))},60:function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("Invariant condition failed: "+(t?"string"==typeof t?t:t():"(unnamed)"))}function o(e){var t=new Date(e);return isNaN(t.getTime())?null:t}function i(e){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(t){return[2,new Promise(function(t){return setTimeout(t,e)})]})})}function s(e,t,n){return void 0===t&&(t=10),void 0===n&&(n=1e3),a.__awaiter(this,void 0,void 0,function(){var r;return a.__generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,4]),[4,e()];case 1:return[2,o.sent()];case 2:if(r=o.sent(),t<=1||!(r instanceof h))throw r;return c.Monitoring.Logging.root.isEnabled(c.Logging.LogLevel.TRACE)&&c.Monitoring.Logging.root.getLogger("coreclients.utils").trace("retryWithDelay: count "+t+", timeout: "+n,r),[4,i(n)];case 3:return o.sent(),[2,s(e,t-1,1.3*n)];case 4:return[2]}})})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),c=n(5),u=n(29);t.invariant=r;var l=function(){function e(e){var t=new Error(e);this.message=t.message,this.stack=t.stack}return e}();t.CustomError=l;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="RetryError",t}return a.__extends(t,e),t}(l);t.RetryError=h,t.stringToDate=o,t.delay=i,t.retryWithDelay=s;var d=function(){function e(e,t,n,r){void 0===t&&(t=5e3),void 0===n&&(n=""),void 0===r&&(r=new Error("Timeout")),this._doRequest=e,this._timeout=t,this._timeoutError=r,this._requests=new Map,this._log=c.Monitoring.Logging.getLogger("ValueRequester"+(n.length>0?"."+n:""))}return e.prototype.request=function(e){return this._startRequest(e).promise},e.prototype.onValue=function(e,t){this._stopRequest(e,u.Right(t))},e.prototype.onError=function(e,t){this._stopRequest(e,u.Left(t))},e.prototype._startRequest=function(e){var t=this,n=this._doRequest(this,e),r={};return r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t}),r.timer=setTimeout(function(){return t._stopRequest(n,u.Left(t._timeoutError))},this._timeout),this._requests.set(n,r),r},e.prototype._stopRequest=function(e,t){var n=this,r=this._requests.get(e);void 0===r?this._log.error("Got unrequested result or request has already expired."):(clearTimeout(r.timer),t.fold(function(e){n._log.warn("Failing request",e),r.reject(e)},function(e){return r.resolve(e)}),this._requests.delete(e))},e}();t.ValueRequester=d},7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);r.__exportStar(n(196),t),r.__exportStar(n(98),t);var o=n(546);t.Async=o.Async;var i=n(1377);t.Animation=i.Animation;var s=n(1380);t.ConnectionManager=s.ConnectionManager;var a=n(1379);t.Clipboard=a.Clipboard;var c=n(1384);t.Either=c.Either;var u=n(561);t.DOM=u;var l=n(148);t.StringUtils=l;var h=n(562);t.ReactUtils=h;var d=n(300);t.DateUtils=d;var p=n(547);t.LocalStorage=p;var f=n(1381);t.Cookie=f;var m=n(197);t.Extension=m;var g=n(49);t.BrowserInfo=g;var _=n(203);t.ObjectUtils=_;var y=n(1378);t.ArrayUtils=y;var v=n(206);t.RxUtils=v;var b=n(1383);t.DesktopEditor=b;var w=n(1385);t.NotEmpty=w.NotEmpty;var E=n(573);t.Fullstory=E.Fullstory},73:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(60),i="application/json",s="application/x-www-form-urlencoded";t.HTTPMethods=["get","post","put","options","head","trace","delete","connect"];var a=function(){function e(){}return e.factory=function(t,n,r,o){return void 0===n&&(n="unknown"),void 0===r&&(r=e.mapToHTTPError),void 0===o&&(o={}),function(i,s,a){var c=i.url,u=i.body,l=i.method,h=i.headers;void 0===s&&(s=e.parseJSON),void 0===a&&(a=r);var d=(p={body:u,method:l,headers:Object.assign({},o,h),mode:"cors",credentials:"include"},p.grammarly_target=n,p);return t(c,d).then(e._checkStatus(a)).then(s);var p}},e._checkStatus=function(e){var t=this;return function(n){return r.__awaiter(t,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return n.ok?[2,n]:[3,1];case 1:return[4,e(n)];case 2:return[2,t.sent()]}})})}},e.mapToHTTPError=function(e){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(n){switch(n.label){case 0:return[4,e.text()];case 1:throw t=n.sent(),new c({code:e.status,status:e.statusText,url:e.url,body:t})}})})},e.assertMimeType=function(e){return function(t){var n=t.headers.get("Content-Type")||t.headers.get("content-type");if(!n)throw new Error("get empty Content-Type, but expected: "+e);if(-1===n.indexOf(e))throw new Error("get Content-Type: "+n+", but expected: "+e)}},e.parseJSON=function(t){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(n){return e.assertMimeType("application/json")(t),[2,t.json()]})})},e.parseText=function(e){return e.text()},e.toVoid=function(){},e}();t.Ajax=a;var c=function(e){function t(t){var n=t.code,r=t.status,o=t.url,i=t.message,s=t.body,a=e.call(this,i||r||s||"HTTPError")||this;return a.name="HTTPError",a.url=o,a.code=n,a.body=s,a.status=r,a}return r.__extends(t,e),t}(o.CustomError);t.HTTPError=c;var u=function(){function e(e,t,n,r,o){this._url=e,this._method=t,this._headers=n,this._mime=r,this._body=o}return e.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return l.get.apply(l,e).build()},e.post=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return l.post.apply(l,e).build()},e.put=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return l.put.apply(l,e).build()},e.del=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return l.del.apply(l,e).build()},e.head=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return l.head.apply(l,e).build()},Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headers",{get:function(){return this._headers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mime",{get:function(){return this._mime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return this._body},enumerable:!0,configurable:!0}),e}();t.Request=u;var l=function(){function e(e,t,n,r,o,i,s,a){void 0===e&&(e=""),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===o&&(o={}),this._url=e,this._queryParams=t,this._formParams=n,this._cookies=r,this._headers=o,this._method=i,this._mime=s,this._body=a}return e.join=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=[].slice.call(t.filter(function(e){return e.length>0}),0).join("/");return e._normalize(r)},e._normalize=function(e){return e=e.replace(/:\//g,"://"),e=e.replace(/([^:\s])\/+/g,"$1/"),e=e.replace(/\/(\?|#)/g,"$1")},e.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.url.apply(e,t).method("get")},e.post=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.url.apply(e,t).method("post")},e.put=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.url.apply(e,t).method("put")},e.del=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.url.apply(e,t).method("delete")},e.head=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.url.apply(e,t).method("head")},e.url=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e(e.join.apply(e,t))},e.prototype.url=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(""!==this._url)throw new Error("URL already set to "+this._url+", use join(string) to add additional parts to it");return this.join(e.join.apply(e,t))},e.create=function(){return new e},e.prototype.method=function(e){if(-1===t.HTTPMethods.indexOf(e.toLowerCase()))throw new Error("unknown method was passed as an argument: "+e);if(this._method&&this._method!==e)throw new Error("Method already set to "+this._method+", but was overwritten by "+e);return this._method=e,this},e.prototype.join=function(t){return this._url=e.join(this._url,t),this},e.prototype.pathParam=function(t){return this._url=e.join(this._url,encodeURIComponent(t)),this},e.prototype.body=function(e){if(this._body)throw new Error("Body already set to "+this._body+", but was overwritten by "+e);return this._body=e,this},e.prototype.isBodyPresent=function(){return this._body},e.prototype.formParam=function(e,t){return this._formParams.push(this._encodeParam(e,t)),this},e.prototype.header=function(e,t){return this._headers[e]=t,this},e.prototype.queryParam=function(e,t){return this._queryParams.push(this._encodeParam(e,t)),this},e.prototype.cookie=function(e,t){return this._cookies.push(e+"="+t),this},e.prototype.mime=function(e){if(this._mime&&this._mime!==e)throw new Error("MIME already set to "+this._mime+", but was overwritten by "+e);return this._mime=e,this},e.prototype.json=function(e){return e?this.body(e).mime(i):this.mime(i)},e.prototype.build=function(){if(!this._url||0===this._url.length)throw new Error("URL cannot be empty");if(this._url=this._url.replace(/\/$/,""),this._queryParams.length>0&&(this._url+="?"+this._queryParams.join("&")),this._body&&this._formParams.length>0)throw new Error("User formParam() OR body() methods to specify request content, not both");if(this._formParams.length>0){if(this._mime&&this._mime!==s)throw new Error("Only application/x-www-form-urlencoded can be used for form requests, don't specify it mandatory in mime() method");this._mime=s,this._body=this._formParams.join("&")}if(this._mime===i&&this._body&&(this._body=JSON.stringify(this._body)),!this._method)throw new Error("HTTP method was not set");if(this._method=this._method.toLocaleLowerCase(),("get"===this._method||"delete"===this._method)&&this._body)throw new Error("Body is not supported for GET, DELETE requests");if(this._mime&&(this._headers["Content-Type"]=this._mime),this._cookies.length>0){this._headers.Cookie=this._cookies.join("; ")}return new u(this._url,this._method,this._headers,this._mime||null,this._body)},e.prototype._encodeParam=function(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)},e}();t.RequestBuilder=l},80:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1328);t.AppConfig=r.AppConfig,t.BuildInfo=r.BuildInfo,t.DialectString=r.DialectString;var o=window.Grammarly,i=o&&o.denali,s=i&&i.appConfig||n(570).appConfig,a=i&&i.buildInfo;t.appConfig=s||{},t.buildInfo=a||{}},843:function(e,t){e.exports={spinner:"_052b8d00-spinner-spinner",item:"_6f2b1cc8-spinner-item",spinner_bouncedelay:"_7de85e44-spinner-spinner_bouncedelay"}},844:function(e,t){},845:function(e,t){},846:function(e,t){},847:function(e,t){},860:function(e,t,n){e.exports=n.p+"files/997ea3a3690bda688b2a6d7407bb5eb9/logo.svg"},861:function(e,t,n){e.exports=n.p+"files/791af15b554bcd8bf942ef130faffe1f/robot@2x.gif"},914:function(e,t,n){n(845),e.exports=n(1393)},915:function(e,t,n){n(846),e.exports=n(1394)},916:function(e,t,n){n(847),e.exports=n(1395)},97:function(e,t,n){"use strict";function r(e){var t=c[e];if(void 0===t)throw new TypeError("Unknown alert group "+e);return t}Object.defineProperty(t,"__esModule",{value:!0});var o=n(558);t.AlertReplacement=o.AlertReplacement,t.AlertTransform=o.AlertTransform,t.AlertTransformPart=o.AlertTransformPart,t.createReplacement=o.createReplacement,t.createSimpleReplacement=o.createSimpleReplacement;var i=n(298);t.AlertExamples=i.AlertExamples,t.parseExamples=i.parseExamples;var s=n(1357);t.AlertPlagiarism=s.AlertPlagiarism,t.AlertPlagiarismReferenceWeb=s.AlertPlagiarismReferenceWeb,t.AlertPlagiarismReferencePublication=s.AlertPlagiarismReferencePublication,t.parsePlagiarism=s.parsePlagiarism;var a;!function(e){e.contextualSpelling="ContextualSpelling",e.grammar="Grammar",e.sentenceStructure="SentenceStructure",e.punctuation="Punctuation",e.style="Style",e.enhancement="Enhancement",e.plagiarism="Plagiarism",e.synonym="Synonyms"}(a=t.AlertGroup||(t.AlertGroup={}));var c={Spelling:a.contextualSpelling,ContextualSpelling:a.contextualSpelling,Grammar:a.grammar,SentenceStructure:a.sentenceStructure,Punctuation:a.punctuation,Style:a.style,Enhancement:a.enhancement,Plagiarism:a.plagiarism};t.alertGroupFromString=r},98:function(e,t,n){"use strict";function r(e){return!/[!$%^&*()_+|~={}\[\]:";<>?,.\/]/g.test(e)&&e.trim().length>0}function o(e){return new RegExp(["[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*","@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?"].join("")).test(e)}function i(e){setTimeout(e,0)}function s(e){var t,n=!1;return{get value(){return n?t:(t=e(),n=!0,t)}}}function a(e){}function c(e,t){return e||t}function u(e,t){return e+t}function l(e){return e.length>0}function h(e){return function(t){return t[e]}}function d(e){var t;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t||(t=e.apply(void 0,n).then(function(e){return t=null,e}).catch(function(e){throw t=null,e}))}}function p(e){for(var t,n,r=[],o=0,i=e.length;o<i;)t=e.charCodeAt(o++),55296==(63488&t)&&o<i?(n=e.charCodeAt(o++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):r.push(t,n)):r.push(t);return r}function f(e){return new(window.WebSocket||window.MozWebSocket)(e)}function m(e,t){var n=window;n.ddebug=n.ddebug||{},n.ddebug[e]=t}function g(e,t,n){return _.Option.map2(e,t,n).getOrElse(e.equals(t))}Object.defineProperty(t,"__esModule",{value:!0});var _=n(29);t.nameValidation=r,t.emailValidation=o,t.tick=i,t.lazy=s,t.noop=a,t.or=c,t.sum=u,t.notEmpty=l,t.pick=h,t.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},t.throttleByPromise=d,t.decode=p,t.getWebSocket=f,t.registerDebugHelper=m,t.isOptionsEq=g}},[1398]);